!function(){"use strict";define(["_routes","utility","walletInfoAndConditionsController","newWalletBenController","walletBenefitsController","corpBenefitsController"],function(e,t){e.register.controller("headerController",["$scope","$rootScope","$document","cityList","$location","authService","$window","$state","navConstantsSvc","$http","$uibModal","notify","apiProvider","$sce","localStorageService","$compile","$timeout","corpLabsService","medsService","standardEventsSvc",function(e,a,i,o,s,r,n,l,c,d,u,p,m,g,h,y,f,w,k,C){function S(e){var t=new Date;return t.setTime(t.getTime()+60*e*60*1e3),t.toUTCString()}function I(){_.isEmpty(E)||_.isEmpty(r.walletConfigs)&&!B||(_.each(r.walletConfigs,function(e){E[e.walletName]&&(E[e.walletName+"EligibleContracts"]=e.eligibleContracts)}),E.maWalletApplicable=!!r.walletConfigs.find(function(e){return"mawallet"==e.walletName.toLowerCase()}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,hj:!0,dbLog:!0,name:"Wallet Info",payload:window._Site_Props.__getEventParameters({custom:E})}),r.walletInfo=E)}function v(){var t=r.getUserObj();t&&d.post(m.infinitiNode+"tooltiptext",{EntityId:t.userDetails.pmEntityID},{headers:{"Content-Type":"application/json"}}).then(function(t){t.data.isAvailable&&t.data.ToolTipText&&(e.isHelperText=!0,e.helperText=JSON.parse(t.data.ToolTipText))})}function U(){r.makeAjaxCalls(m.infinitiNode+"CorporateData/EntityList",{entityType:6},"POST","","",!1).then(function(t){if(t.data&&t.data.isSuccess){var a=t.data.result;if(e.policyList=a,e.userLinkInsuranceAccount(),window.location.href.includes("medibuddy"))try{var i={appVersion:"",domain:"medibuddyInWeb",event:"HamburgerMenu_LYI_Click"},o=Object.assign({},i,{meta:JSON.stringify(i)});d.post(m.eventlogsUrl,o)}catch(s){console.log(s)}}})["catch"](function(e){})}function b(){r.makeAjaxCalls(m.apiUrl+"GetCorporateFeatureConfiguration",{pMEntityID:e.checkUser.userDetails.pmEntityID},"POST").then(function(i){if(e.checkUser=r.isUserSignedin(),i.data.isSuccess&&i.data.configuration){e.checkUser.corpConfig=i.data.configuration,e.checkUser.corpConfig.enableCorporateServiceNames=t.isJsonObject(e.checkUser.corpConfig.corporateServices)?JSON.parse(e.checkUser.corpConfig.corporateServices).enableCorporateServiceNames:[];var o=e.checkUser.corpConfig.bookTillDate&&parseInt(e.checkUser.corpConfig.bookTillDate.replace("/Date(",""));e.checkUser.corpConfig.bookingBlocked=!1,i.data.serverDate&&(r.serverDate=parseInt(i.data.serverDate.replace("/Date(","")),o>0&&(e.checkUser.corpConfig.bookingBlocked=r.serverDate>=o)),o>0&&(e.checkUser.corpConfig.bookTillDate=new Date(o)),e.checkUser.corpConfig.data=j,e.checkUser&&e.checkUser.userDetails&&c.coBrandingEntityIds.indexOf(e.checkUser.userDetails.pmEntityID)>-1&&(e.isCobranding=!0,e.corpConfig=e.checkUser.corpConfig,a.corpConfig=e.checkUser.corpConfig,e.getLogo(e.checkUser))}else e.checkUser.corpConfig=null;r.setUserObj(e.checkUser)})}function D(){var i=r.isUserSignedin();r.makeAjaxCalls(m.apiUrl+"WellnessConfiguration",{pMEntityID:e.checkUser.userDetails.pmEntityID},"POST",i.token).then(function(i){var o;e.checkUser=r.isUserSignedin(),i.data.isSuccess&&"isAddDependentAllowed"in i.data&&(e.checkUser.isAddDependentAllowed=i.data.isAddDependentAllowed),i.data.isSuccess&&i.data.cwcDisclaimer&&(e.checkUser.cwcDisclaimer=JSON.parse(i.data.cwcDisclaimer)),i.data.isSuccess&&i.data.noSponsoredMessage?e.checkUser.noSponsoredMessage=i.data.noSponsoredMessage:e.checkUser.noSponsoredMessage=!1,i.data.isSuccess&&i.data.redirectToAllTransactions?e.redirectToAllTransactions=i.data.redirectToAllTransactions:e.redirectToAllTransactions=!1,i.data.isSuccess&&i.data.showNewBenefits?(e.showNewBenefitsUI=!0,a.showNewBenefitsUI=!0,a.$emit("newBenefitsFlagSet",!0)):(e.showNewBenefitsUI=!1,a.showNewBenefitsUI=!1,a.$emit("newBenefitsFlagSet",!1)),i.data.isSuccess&&i.data.hideWalletBalance?(e.hideWalletBalance=!0,a.hideWalletBalance=!0,a.$emit("hideWalletBalanceEvent")):(e.hideWalletBalance=!1,a.hideWalletBalance=!1),i.data.isSuccess&&i.data.hraDescription&&(a.hraDescription=i.data.hraDescription,a.$emit("hraDescriptionSet")),e.checkUser.isFlashBookingEnabled=i.data.isFlashBookingEnabled,e.checkUser.corpSponsMessage=i.data.corporateSponsoredMessage,e.checkUser.isRetailLabsFlowEnabled=i.data.isRetailLabsFlowEnabled,e.checkUser.isMergeFlowEnabled=i.data.isMergeFlowEnabled,e.checkUser.isNewMedsFlowEnabled=i.data.isNewMedsFlowEnabled,e.checkUser.isMedsUploadRxFlowEnabled=i.data.isMedsUploadRxFlowEnabled,e.checkUser.isNewAHCFlowEnabled=!!i.data.isNewAHCFlowEnabled,e.checkUser.retailPrescriptionRequired=i.data.isLabsPrescriptionsRequired,e.checkUser.isEnhancedRxFlowEnabled=i.data.isEnhacedRxFlowEnabled,e.checkUser.isRxVerificationRequired=i.data.isRxVerificationRequired,e.checkUser.isReimbursementButton=i.data.isReimbursementButton,e.checkUser.isTestsSuggestionEnabled=!0,e.appNameReimbursement=h.get("utm_appname"),e.checkUser.isUpsellEnabled=!e.checkUser.isRetailUser&&e.checkUser.isMergeFlowEnabled,e.checkUser.corporateBenefitRules=i.data.corporateBenefitRules,e.checkUser.walletCoverageNotes=i.data.walletCoverageNotes,e.checkUser.isLabsPaidUpsellDisabled=i.data.isLabsPaidUpsellDisabled,"retailutility"==e.appNameReimbursement&&(document.cookie="mbServerToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; domain="+t.getCookieDomain()+"; path=/;"),i.data.isSuccess&&i.data.corporateWellnessConfiguration&&e.checkUser?(e.checkUser.corpWellnessConfig=i.data.corporateWellnessConfiguration,o=e.checkUser.corpWellnessConfig.find(function(e){return e&&e.speciality&&e.speciality[0].enableServices})):e.checkUser?i.data.corporateWellnessConfiguration&&(o=e.checkUser.corpWellnessConfig.find(function(e){return e&&e.speciality&&e.speciality[0].enableServices})):(e.checkUser.corpWellnessConfig=null,e.checkUser.isRetailLabsFlowEnabled=!1,e.checkUser.isMergeFlowEnabled=!1,e.checkUser.noSponsoredMessage=!1),i.data.isSuccess&&i.data.authLetterUploadInfo?e.checkUser.authLetterUploadInfo=i.data.authLetterUploadInfo:e.checkUser.authLetterUploadInfo={isAuthLetterUploadRequired:!1},r.setUserObj(e.checkUser),e.checkUser&&e.checkUser.userDetails&&e.checkUser.userDetails.pmEntityID&&c.elderCareCustomEntityIDS.includes(e.checkUser.userDetails.pmEntityID)?r.makeAjaxCalls("https://unified-checkout-frontend.medibuddy.in/unifiedcheckout/benefits/getCustomUrl","","GET",e.checkUser.token).then(function(t){t.data&&t.data.customizedBenefitsUrl&&(a.customizedBenefitsUrl=t.data.customizedBenefitsUrl,o&&o.speciality&&(t.data.customizedBenefitsUrl.indexOf("filterSequence=8")===-1?_.first(o.speciality).enableServices.forEach(function(e){"elder-care"===e.name&&e.isVisible&&(e.isVisible=!1)}):a.customizedBenefitsUrl="https://www.medibuddy.in/unifiedcheckout/benefits/"+e.checkUser.userDetails.pmEntityID+"?filterSections=Programs")),a.$emit("homePageRefreshList",o&&o.speciality?_.first(o.speciality):null)})["catch"](function(e){console.log(e),a.$emit("homePageRefreshList",o&&o.speciality?_.first(o.speciality):null)}):a.$emit("homePageRefreshList",o&&o.speciality?_.first(o.speciality):null)})}function P(){e.checkUser&&e.checkUser.token&&!e.checkUser.encryptedToken?r.makeAjaxCalls(m.apiUrl+"GetUserLongToken",{shortToken:e.checkUser.token},"POST").then(function(t){t.data.isSuccess&&(h.set("corpToken",t.data.encryptedToken),e.checkUser=r.isUserSignedin(),e.checkUser.encryptedToken=t.data.encryptedToken,r.setUserObj(e.checkUser),e.authToken=e.checkUser.encryptedToken)}):e.checkUser&&e.checkUser.token&&e.checkUser.encryptedToken&&!e.checkUser.uuid}var T=f(function(){var t=angular.element(document.getElementById("headerView"));t.html(r.returnContents("header.html")),y(t.contents())(e)},0);a.customBenefitsUrl="",a.hraDescription="",e.redirectToAllTransactions=!1,e.isSBI=!1,e.healthCheckId=c.healthCheckId;var E={},B=!1,L=!1;e.isWebView=a.isWebView,e.newWalletUi=!1,e.walletBenefitsUi=!1,e.showMessage=!1,e.isHelperText=!1,e.showLinkedProfile=!1,e.showLastLinking=!1,e.editAgeGender=!1,e.closeModalAfterSwitching=!1,e.isHomePageValue=!1,e.userLinkProfile=!1,e.hasOtherThanRetailAccount=!1,e.collapseTrackOrderOptions=!0,e.showNewBenefitsUI=!1,e.mediAssistLinks={Ecard:"https://mediassisttpa.in/download-ecard/",NetworkHospital:"https://mediassisttpa.in/network-hospital-search/"},a.showNewBenefitsUI=!1,a.hideWalletBalance=!1,e.trackOrderArray=[{name:"Labs",imageSrc:"/assets/icons/order/labs-trackorder.svg"},{name:"Medicine",imageSrc:"/assets/icons/order/medicine-trackorder.svg"},{name:"In Clinic Consultations",imageSrc:"/assets/icons/order/consults-trackorder.svg"},{name:"Others",imageSrc:"/assets/icons/order/others-trackorder.svg"}];try{n.fbAsyncInit=function(){FB.init({appId:"198628023814821",status:!0,cookie:!0,xfbml:!0,version:"v3.0"})}}catch(M){console.log("Facebook access is dennied"),r.FbNotEnabled=!0}var A=window.location.search,N=new URLSearchParams(A),O=N.get("utm_source"),F=N.get("utm_medium"),W=N.get("utm_campaign");e.fireOnLoadEvent=function(){n.sessionStorage.setItem("utm_source",O?O:"medibuddyInWeb"),F&&n.sessionStorage.setItem("utm_medium",F),W&&n.sessionStorage.setItem("utm_campaign",W),a.utm_source_og=n.sessionStorage.getItem("utm_source"),a.utm_campaign_og=n.sessionStorage.getItem("utm_campaign"),a.utm_medium_og=n.sessionStorage.getItem("utm_medium"),n.sessionStorage.getItem("appLoaded")||(n.sessionStorage.setItem("appLoaded",!0),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"App Loaded",payload:{},branchLog:{name:"Landing",custom_data:{medibuddyUserId:"",pmEntityId:"",source:n.sessionStorage.getItem("utm_source"),maid:"",platform:"MBWeb"}}}),"app.home"==l.current.name&&window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",name:"MB Home Page"}))},e.setMediAssistLink=function(){var e=document.cookie,t=e.split(";"),a="";if(t.forEach(function(e){var t=e.trim().split("="),i=t[0],o=t[1];"maLinksVariant"==i&&(a=o)}),a)"A"==a&&(m.ecardLink="/ecard",m.networkHospital="/networkHospitals");else{var i=Math.random();i<=.95?(m.ecardLink="/ecard",m.networkHospital="/networkHospitals",document.cookie="maLinksVariant=A; expires="+S(24)):document.cookie="maLinksVariant=B; expires="+S(24)}},e.setMediAssistLink(),e.fireOnLoadEvent(),e.isHomePage=function(){return"/"==n.location.pathname?e.isHomePageValue=!0:e.isHomePageValue=!1,e.isHomePageValue},e.showMbbeliefs=function(){return!!["/aboutus/","/mbbvalues"].includes(n.location.pathname)},e.redirectToTrackOrder=function(t){switch(t){case"Labs":l.go("app.patientListing",{service:""});break;case"Medicine":l.go("app.orders",{service:"Medicine"});break;case"In Clinic Consultations":window.location.href=c.offlineConsultsTrackOrder+"?longToken="+e.authToken;break;case"Others":l.go("app.orders",{service:""})}};var x,R=e.isMobileView?200:300;e.isSticky=!1,e.handleScrollEvent=function(){var a=t.getScrollPosition(),i=document.querySelector("#products");a>R&&!document.querySelector(".modal-open")?((document.querySelector("header").classList.contains("home")||e.isMobileView)&&(document.querySelector("header").classList.add("sticky-header"),i&&i.classList.contains("sticky-header")&&document.querySelector("#corpLoginBtnNew")&&document.querySelector("ul.nav").classList.add("m-r-0")),i&&!e.isMobileView&&(i.classList.remove("widget"),i.classList.add("sticky-header"),document.querySelector("#products").classList.contains("sticky-header")&&document.querySelector("#corpLoginBtnNew")&&document.querySelector("ul.nav").classList.add("m-r-0")),e.isSticky=!0,e.$apply()):(document.querySelector("header").classList.remove("sticky-header"),document.querySelector("ul.nav").classList.remove("m-r-0"),i&&!e.isMobileView&&(i.classList.remove("sticky-header"),document.querySelector("ul.nav").classList.remove("m-r-0"),i.classList.add("widget")),e.isSticky=!1,e.$apply())},e.walletUi=function(e){u.open({animation:!0,template:'<div class="modal-body br-20"><ng-include src="\'templates/walletBenefits.html\'"></ng-include></div>',controller:"walletBenefitsController",controllerAs:"walletBenefitsControllerCtrl",size:a.isMobileView?"full-height-mobile":"lg"})},e.newWalletBenefitsUi=function(e){u.open({animation:!0,template:'<div class="modal-body br-20"><ng-include src="\'templates/newWalletBen.html\'"></ng-include></div>',controller:"newWalletBenController",controllerAs:"newWalletBenControllerCtrl",size:a.isMobileView?"full-height-mobile":"lg"})},v();var H=_.throttle(e.handleScrollEvent,c.scrollThrottleThreshold);n.addEventListener("scroll",H),e.medsCartInfo=r.medsCartInfo,e.profileToggled=function(t){e.collapseTrackOrderOptions=!0,t&&!angular.element(document.querySelector("header")).hasClass("sticky-header")?(angular.element(document.body).addClass("bodyScrollFix"),x=f(function(){e.driver&&e.driver.highlight({element:document.querySelector("#profile-menu")})})):e.driver&&e.driver.hasHighlightedElement()&&e.driver.reset()},e.hideHeaderFooterForMobile=!!_.isNull(h.get("hideHeaderFooterForMobile"))||h.get("hideHeaderFooterForMobile"),n.scrollTo(0,0),e.walletBalance=0,r.insuranceSelected=!1;var j=c.topCities;e.dummyCities=j;var $=a.$on("selectedCity",function(t,a){e.insuranceSelected=!1,a&&(a.categoryItemTypeId===c.dentalFilterName?(r.topCities=_.intersection(e.dummyCities,o[c.dentalId]),e.selected=a.searchk,e.toggleFilters("Dental"),e.checkForCity(a)):a.categoryItemTypeId===c.medicineFilterName?(r.topCities=_.intersection(e.dummyCities,o[c.medicineId]),e.toggleFilters("app.pharmacy"==l.$current.name?"Pharmacy":"Medicine"),e.medicineKeyword=a.medicine):a.categoryItemTypeId===c.consultationFilterName?(r.topCities=_.intersection(e.dummyCities,o[c.consultationId]),e.selected=a.searchk,e.toggleFilters("Consultation"),e.checkForCity(a)):a.categoryItemTypeId===c.investigationFilterName?(r.topCities=_.intersection(e.dummyCities,o[c.investigationId]),e.investigationKeyWords=a.searchk,e.isCovid=_.contains(c.covidPackageList,a.searchk),e.toggleFilters("Labtest"),"app.labs"!==l.current.name&&e.checkForCity(a)):a.categoryItemTypeId===c.olServiceFilterName?(e.olKeyWords=decodeURIComponent(a.searchk),e.toggleFilters("olService")):a.categoryItemTypeId===c.gsoFilterName?e.toggleFilters("gso"):a.categoryItemTypeId===c.genomFilterName?(e.toggleFilters("Genome"),e.checkForCity(a)):a.categoryItemTypeId===c.homeHealthCareFilterName?(r.topCities=_.intersection(e.dummyCities,o[c.homehealthcareId]),e.keyWords=a.searchc,e.toggleFilters("Home Health Care"),e.checkForCity(a)):a.categoryItemTypeId===c.healthCheckFilterName&&(r.topCities=_.intersection(e.dummyCities,o[c.healthCheckId]),e.selected=a.searchc,e.toggleFilters("Health checks"),e.checkForCity(a))),e.selectedCity=r.getCity()});e.checkForCity=function(t){t.city||r.getCity()||e.selectCity()},e.redirect=function(e,t){l.includes("app.ahc")||(l.go(e,{},{reload:e}),t&&window._MB_Analytics.__push({isCleverTap:!0,name:t}))},e.insuranceClick=function(){e.checkUser=r.getUserObj(),r.insuranceSelected=!0,e.checkUser?l.go("app.insurancePage",{},{reload:"app.insurancePage"}):e.userSignin()},e.openMandatoryPopup=function(){r.openLoginPopup("lg","templates/openMandatoryMobilePopup.html?"+timeStamp,void 0,"templates/openMandatoryMobilePopup.html?",null,"Mandatory-Popup-Flow"),a.$emit("checkMappingV1Complete")},e.checkForUbiPopUp=function(){if(e.user&&e.user.userDetails&&e.user.userDetails.pmEntityID&&c.UBIEntityIds.indexOf(e.user.userDetails.pmEntityID)>-1&&e.user.corpDetails&&e.user.corpDetails.employeeDetail&&e.user.corpDetails.employeeDetail.beneficiaries&&e.user.corpDetails.employeeDetail.beneficiaries.length>0){var t=e.user.corpDetails.employeeDetail.beneficiaries.filter(function(e,t){return e&&e.editBeneficiaryName&&e.editBeneficiaryName===!0});t&&t.length>0&&r.openUbiPopUp("lg","templates/openMandatoryMobilePopup.html?"+timeStamp,void 0,"templates/openUbiPopUp.html?",null,"Mandatory-Popup-Flow",t)}},e.getUserProfile=function(){if(e.CorpOrMAWalletFound=!1,e.MBWalletFound=!1,e.user&&e.user.token&&e.user.userDetails){var i=m.apiUrl+"UserProfile.json";r.makeAjaxCalls(i,"","GET",e.user.token).then(function(i){if(i.data.isSuccess){e.user=r.isUserSignedin(),window._Site_Props.__setUserObj(e.user),i.data.profile.employeeDetail&&(e.relation=i.data.profile.employeeDetail.beneficiaries,e.formatMAWalletBalance(),e.user.corpDetails.employeeDetail=i.data.profile?i.data.profile.employeeDetail:{},r.setUserObj(e.user),e.checkForUbiPopUp()),i.data.profile.isAgreedToAHCConsent&&(e.user.userDetails.isAgreedToAHCConsent=i.data.profile.isAgreedToAHCConsent,r.setUserObj(e.user)),r.profileInfo=i.data.profile,r.profileInfo&&r.profileInfo.userAddresses&&(r.userAddresses=r.profileInfo.userAddresses.filter(function(e){return e.latitude&&e.longitude}));var o=h.get("utm_appname");r.makeAjaxCalls(m.apiUrl+"GetUserLongToken",{shortToken:e.user.token},"POST").then(function(t){if(t.data.isSuccess){h.set("corpToken",t.data.encryptedToken),e.checkUser=r.isUserSignedin(),e.checkUser.encryptedToken=t.data.encryptedToken,r.setUserObj(e.checkUser);var i=new Date;console.log("Start CM",i),e.checkUser.encryptedToken?d.post(m.profileLinkUrl+"checkMappingV1",{deviceId:"",advertiserId:"",platform:"medibuddyInWeb"},{headers:{"Content-Type":"application/json",mbservertoken:t.data.encryptedToken}}).then(function(t){t.data&&t.data.result&&t.data.result.daData&&t.data.result.daData.data&&t.data.result.daData.data.id&&h.set("patientId",t.data.result.daData.data.id);var s=new Date;console.log("End CM",s-i);var r={screen:"HOME_PAGE",appVersion:"",domain:"medibuddyInWeb",event:"LF_HOME_PAGE_LOAD_CHECKMAPPING",advertiserId:window.sessionStorage.getItem("branch_fingerprint"),auth_uuid:h.get("auth_uuid")||void 0,createdAt:JSON.stringify(new Date),mbUserId:e.user.userDetails.userId,time:parseInt(s-i)},n=Object.assign({},r,{meta:JSON.stringify(r)});if(d.post(m.eventlogsUrl,n),e.userProfiles=t.data.result.connectedProfiles,e.affinityProfile=[],e.insuranceProfile=[],e.corporateProfile=null,e.userProfiles&&e.userProfiles.affinityUserData&&e.userProfiles.affinityUserData.length>=0&&_.forEach(e.userProfiles.affinityUserData,function(t){e.affinityProfile.push(t),t.isActive&&(e.currentUserProfile=t,e.titleToShowUser=e.titleToShow(e.currentUserProfile.title))}),e.userProfiles&&e.userProfiles.insuranceUserData&&e.userProfiles.insuranceUserData.length>=0&&_.forEach(e.userProfiles.insuranceUserData,function(t){e.insuranceProfile.push(t),t.isActive&&(e.currentUserProfile=t,e.titleToShowUser=e.titleToShow(e.currentUserProfile.title))}),e.userProfiles&&e.userProfiles.corporateUserData&&(e.corporateProfile=e.userProfiles.corporateUserData,e.userProfiles.corporateUserData.isActive&&(e.currentUserProfile=e.corporateProfile,e.titleToShowUser=e.titleToShow(e.currentUserProfile.title)),h.set("corpMbId",e.corporateProfile.mbUserId),h.set("corpToken",e.checkUser.encryptedToken)),e.userProfiles&&e.userProfiles.retailUserData&&(e.retailProfile=e.userProfiles.retailUserData,e.userProfiles.retailUserData.isActive&&(e.currentUserProfile=e.retailProfile,e.titleToShowUser=e.titleToShow(e.currentUserProfile.title)),h.set("retailMbId",e.retailProfile.mbUserId)),e.closeModalAfterSwitching&&(G=setTimeout(e.closeOnSuccess,0)),(e.corporateProfile||e.insuranceProfile.length)&&(e.userLinkProfile=!0),e.corporateProfile||e.insuranceProfile.length||e.affinityProfile.length?e.hasOtherThanRetailAccount=!0:e.hasOtherThanRetailAccount=!1,t.data.result.isSwitchProfileEnabled&&e.retailProfile?(e.showLinkedProfile=!0,e.showLastLinking=!1):(e.showLinkedProfile=!1,e.showLastLinking=!0),["retailutility"].includes(o))try{t.data&&t.data.result&&t.data.result.showPopUp&&(t.data.result.showPopUp=0)}catch(c){}if(t.data&&t.data.result&&t.data.result.auth_uuid?h.set("auth_uuid",t.data.result.auth_uuid):h.set("auth_uuid",null),t.data&&t.data.result&&t.data.result.showPopUp&&!["retailutility"].includes(o)&&"app.alltransactions"!=l.current.name){if(window.location.href.indexOf("https://www.medibuddy.in/")>-1){var r={screen:"Mandatory_Phone_Number_Popup",appVersion:"",domain:"medibuddyInWeb",event:"LF_MANDATORY_MOBILE_POPUP_SHOWN",advertiserId:window.sessionStorage.getItem("branch_fingerprint"),auth_uuid:h.get("auth_uuid")||void 0,createdAt:JSON.stringify(new Date),mbUserId:e.user.userDetails.userId},n=Object.assign({},r,{meta:JSON.stringify(r)});d.post(m.eventlogsUrl,n)}window._MB_Analytics.__push({isCleverTap:!0,dbLog:"mbConsumerLabs",name:"Mandatory Popup Loaded",payload:window._Site_Props.__getEventParameters({custom:{pmEntityId:e.user&&e.user.userDetails?e.user.userDetails.pmEntityID:"",userId:e.user&&e.user.userDetails?e.user.userDetails.userId:""}})}),h.set("showSkipText",t.data.result.showSkipText);var u=h.get("delayForMandatoryPopup")+1||0;return setTimeout(e.openMandatoryPopup,u),void h.remove("delayForMandatoryPopup")}a.$emit("checkMappingV1Complete",{pmEntityID:e.checkUser&&e.checkUser.userDetails&&e.checkUser.userDetails.pmEntityID})})["catch"](function(t){a.$emit("checkMappingV1Complete"),e.showLastLinking=!0,e.showLinkedProfile=!1,console.log("Some Error Occured",t),setTimeout(e.closeDialogBox,2e3)}):null}}),r.profileInfo.dob&&(r.profileInfo.dob=new Date(parseInt(r.profileInfo.dob.replace("/Date(","")))),r.profileInfo.gender&&("f"===r.profileInfo.gender.toLowerCase()?r.profileInfo.gender="Female":"m"===r.profileInfo.gender.toLowerCase()?r.profileInfo.gender="Male":r.profileInfo.gender="Others"),e.user&&e.user.userDetails&&e.user.userDetails.pmEntityID&&"11191535"==e.user.userDetails.pmEntityID&&(e.isSBI=!1),e.$emit("userDetails")}if(e.trackUser||r.isSSOLogin){window._Site_Props.__setUserObj(e.user),window._MB_Analytics.__trackUser(!0),e.trackUser=!1;var s=window.navigator.userAgent.toLowerCase(),c="web";if(s.indexOf("android")>-1?c="Android":/iphone|ipod|ipad/.test(s)&&(c="iOS"),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"SignIn",payload:window._Site_Props.__getEventParameters({custom:{userName:r.loggedUserName,SSOLogin:r.isSSOLogin},google:window._Site_Props.__googleTransform("SignIn","",_.property("displayName")(e.user.userDetails)+" has Signed In")}),branchLog:{name:"CustomLogin",custom_data:{medibuddyUserId:t.getFlatProperty(e.user,"userDetails.userId")+"",pmEntityId:t.getFlatProperty(e.user,"userDetails.pmEntityID")+"",source:n.sessionStorage.getItem("utm_source"),maid:t.getFlatProperty(e.user,"userDetails.maid")+"",type:e.user.isRetailUser?"Retail":"Corporate",platform:"MBWeb",browser_fingerprint_id:window.sessionStorage.getItem("branch_fingerprint")||"",os:c}}}),e.user&&e.user.userDetails){var u={pmEntityId:e.user.userDetails.pmEntityID||null,mbUserId:e.user.userDetails.userId||null,email:e.user.userDetails.email||void 0,phone:e.user.userDetails.phone||void 0,name:e.user.userDetails.firstName||void 0,corporateName:e.user.corpDetails&&e.user.corpDetails.employeeDetail&&e.user.corpDetails.employeeDetail.companyName||void 0};window._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"MBWebsiteLoginSuccessful",payload:window._Site_Props.__getEventParameters({custom:{auth_uuid:h.get("auth_uuid")||void 0,loginScreenEvent:"Login Page",doctorId:u.pmEntityId,screen:"Login",element:"",info:u.name,domain:u.corporateName,appVersion:"",consultationId:u.mbUserId}})}),window._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"MBAppHomeScreenLanding",payload:window._Site_Props.__getEventParameters({custom:{screen:o||N.get("utm_source"),appVersion:"",domain:"medibuddy",event:"MBAppHomeScreenLanding",advertiserId:window.localStorage.getItem("UniqSessionId"),auth_uuid:h.get("auth_uuid")||void 0,mbUserId:e.user&&e.user.userDetails&&e.user.userDetails.userId||null,pmEntityId:u.pmEntityId}})})}}})["catch"](function(t){setTimeout(e.closeDialogBox,2e3)})}},e.titleToShow=function(t){if(e.isMobileView){if(!(t.length>14))return t;e.currentUserProfileTitle=t.slice(0,14)+"..."}else{if(!(t.length>20))return t;e.currentUserProfileTitle=t.slice(0,20)+"..."}return e.currentUserProfileTitle},e.formatMAWalletBalance=function(){e.MaWalletDetails&&e.MaWalletDetails.balanceDetail&&(_.forEach(e.MaWalletDetails.balanceDetail.polDetails,function(t,a){var i=_.findWhere(e.relation,{maid:t.maid});_.isEmpty(i)||(t.relation=i.relationName,t.benefName=i.name)}),r.walletDetails=_.without(r.walletDetails,_.findWhere(r.walletDetails,{walletName:"MAWallet"})),r.walletDetails&&r.walletDetails.push(e.MaWalletDetails)),a.$broadcast("showWalletInfo")},e.getWalletConditions=function(){var t=m.apiUrl+"/walletconfig";B=!1,r.makeAjaxCalls(t,{},"POST",e.user.token).then(function(e){e.data.isSuccess&&(r.walletConfigs=e.data.walletConfigs||[]),B=!0,I(),a.$broadcast("walletConfigLoaded")})};var V,G;e.switchProfile=function(t,a,i,o){var s=new Date;console.log("Start SWP",s),e.switchProfileMeantime(),r.makeAjaxCalls(m.profileLinkUrl+"switchProfile",{targetId:t,toProfile:a,fromProfile:i},"POST","","","",{mbServerToken:e.checkUser.encryptedToken}).then(function(t){var i=t.data.isForcedToRetail;"retail"==e.currentUserProfile.type?t.data.authServerToken&&(V=t.data.authServerToken):"insurance"==e.currentUserProfile.type?V="retail"==a?t.data.data.MBtoken.authServerToken:t.data.authServerToken:"corporate"==e.currentUserProfile.type?"affinity"==a||"insurance"==a?V=t.data.authServerToken:t.data.data.MBtoken.authServerToken&&(V=t.data.data.MBtoken.authServerToken):"affinity"==e.currentUserProfile.type&&("corporate"==a||"insurance"==a||"affinity"==a?V=t.data.authServerToken:t.data.data.MBtoken.authServerToken&&(V=t.data.data.MBtoken.authServerToken)),e.isMchiUser=!1,e.isCobranding=!1,"insurance"==a&&(e.isMchiUser=!0,e.isCobranding=!0),i&&!o&&(window._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_PUSHED_TO_RETAIL",payload:window._Site_Props.__getEventParameters({custom:{appVersion:"",domain:"medibuddy",Origin:"backend",advertiserId:window.localStorage.getItem("UniqSessionId"),auth_uuid:h.get("auth_uuid")||void 0,mbUserId:e.user&&e.user.userDetails&&e.user.userDetails.userId||null}})}),e.forcedToRetailLogin(t.data.errorDetails)),i&&o&&window._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_PUSHED_TO_RETAIL",payload:window._Site_Props.__getEventParameters({custom:{appVersion:"",domain:"medibuddy",Origin:"User",advertiserId:window.localStorage.getItem("UniqSessionId"),auth_uuid:h.get("auth_uuid")||void 0,mbUserId:e.user&&e.user.userDetails&&e.user.userDetails.userId||null}})}),V&&(h.set("newProfileAuthToken",V),e.marketPlaceLogin(i,o,s))})["catch"](function(t){e.switchProfileFailed()})},e.triggerSwitchEvent=function(){window._MB_Analytics.__push({isCleverTap:!0,dbLog:!0,hj:!0,name:"SWP_PROFILE_VIEW_INITIATED",payload:window._Site_Props.__getEventParameters({custom:{pmEntityId:e.user&&e.user.userDetails?e.user.userDetails.pmEntityID:"",userId:e.user&&e.user.userDetails?e.user.userDetails.userId:"",auth_uuid:h.get("auth_uuid")||void 0,mbUserId:e.user.userDetails.userId}})})},e.marketPlaceLogin=function(i,o,s){s||(s=new Date),e.showLoader();var n=h.get("newProfileAuthToken");r.makeAjaxCalls(m.apiUrl+"/MarketPlaceLogon",{IsSSOLogin:!0,authServerAccessToken:n},"POST").then(function(n){if(n.data.isSuccess){n&&n.data&&n.data.user&&n.data.user.token&&(document.cookie="redirect="+n.data.user.token+"; domain="+t.getCookieDomain()),r.setUserObj(n.data.user),a.$emit("userLogin",""),e.refreshServiceCache(),i?e.closeModalAfterSwitching=!1:e.closeModalAfterSwitching=!0,o&&(e.closeModalAfterSwitching=!0),h.remove("newProfileAuthToken");var l=new Date;console.log("End SWP",l-s);var c={screen:"HOME_PAGE",appVersion:"",domain:"medibuddyInWeb",event:"LF_HOME_PAGE_LOAD_SWITCHPROFILE",advertiserId:window.sessionStorage.getItem("branch_fingerprint"),auth_uuid:h.get("auth_uuid")||void 0,createdAt:JSON.stringify(new Date),mbUserId:e.user.userDetails.userId,time:parseInt(l-s)},u=Object.assign({},c,{meta:JSON.stringify(c)});d.post(m.eventlogsUrl,u)}})["catch"](function(t){e.marketPlaceFailed()})},e.getUniqueSwitchID=function(){var e=h.get("swpIdentifier");return h.remove("swpIdentifier"),e},e.generateUniqueSwitchID=function(){h.get("swpIdentifier")&&h.remove("swpIdentifier");var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var a=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?a:3&a|8).toString(16)});return h.set("swpIdentifier",t),t},e.refreshServiceCache=function(){w.corpBenfits={},w.l2cParams={},w.walletDetails={},h.remove("medsCartId"),h.remove("patientId"),h.remove("medsCart")},e.refreshPage=function(){window.location.reload()},e.showSubsButton=!1,e.getSubsEligibility=function(){var t=r.getSubsEligibility();t.then(function(t){t.data.isSuccess&&(e.showSubsButton=t.data.isButtonDisplay)})},e.retryBalanceCount=2,e.toggled=function(t){t&&window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,hj:!0,dbLog:!0,name:"MWR_WALLET_CLICK",payload:window._Site_Props.__getEventParameters({custom:_.extend(E,{maWalletApplicable:!e.walletError.ma.showretry})})})},e.trackOrderOpen=function(){e.collapseTrackOrderOptions=!e.collapseTrackOrderOptions},e.getBalance=function(){e.loadingBalance=!0;var t=r.getWalletBalance();E={},t.then(function(t){e.CorpBalance=0,e.loadingBalance=!1,e.MABalance=0,e.CORPBalance=0,e.walletError={ma:{errmsg:"",showretry:!1}},e.corpWalletDisplayName="",e.maWalletDisplayName="",e.MBWalletFound=!1,e.CorpWalletFound=!1,e.MaWalletFound=!1,e.CorpOrMAWalletFound=!1,r.CorpBalance=0,r.MABalance=0,e.benefMABalance=[],e.MBBalance=0,r.MBBalance=0,e.medicalBenefitsName="",e.showStar=!1,r.maDisplayType="",r.corpDisplayType="",r.corpAliasName="",r.maAliasName="",r.mawalletFailed=!1,w.walletConfig={walletLoaded:!0,walletDetails:[]},r.walletDetails=[],r.isTermsAndConditionsApplicable=t.data.isTermsOfUseApplied,e.isTermsAndConditionsApplicable=r.isTermsAndConditionsApplicable,r.totalWalletBalance=t.data.totalWalletBalance,t.data.isSuccess&&t.data.walletDetails&&t.data.walletDetails.length>0&&(e.walletDetails=t.data.walletDetails,_.forEach(t.data.walletDetails,function(t,a){"mbwallet"===t.walletName.toLowerCase()?(e.MBBalance=t.balance,r.MBBalance=e.MBBalance,t.isMbWallet=!0,e.MBWalletFound=!0,t.aliasName=t.aliasName?t.aliasName:c.mbWalletDefaultName,r.walletDetails.push(t)):"corpwallet"!==t.walletName.toLowerCase()&&"mawallet"!==t.walletName.toLowerCase()||(e.CorpOrMAWalletFound=!0,"corpwallet"===t.walletName.toLowerCase()&&(r.CorpBalance=t.balance,e.CORPBalance=t.balance,t.isCorpWallet=!0,e.CorpWalletFound=!0,e.medicalBenefitsName=e.medicalBenefitsName?e.medicalBenefitsName:t.aliasName,t.aliasName=t.aliasName?t.aliasName:c.corpWalletDefaultName,r.corpAliasName=t.aliasName,e.corpWalletDisplayName=t.aliasName,r.corpDisplayType=t.displayType,r.walletDetails.push(t)),"mawallet"===t.walletName.toLowerCase()&&(r.MABalance=t.balance,e.MABalance=t.balance,t.isMaWallet=!0,e.MaWalletFound=!0,e.walletError.ma.errmsg=t.errorMessage,e.walletError.ma.showretry=t.showRetryWallet,r.mawalletFailed=t.showRetryWallet,e.MaWalletDetails=t,e.medicalBenefitsName=e.medicalBenefitsName?e.medicalBenefitsName:t.aliasName,t.aliasName=t.aliasName?t.aliasName:c.maWalletDefaultName,r.maAliasName=t.aliasName,e.maWalletDisplayName=t.aliasName,r.maDisplayType=t.displayType,r.walletDetails.push(t))),w.walletConfig.walletDetails=r.walletDetails.map(function(e){return{type:e.walletName,balance:e.balance}}),t.balance>0&&(E[t.walletName]=t.balance,E.MAFailed=e.walletError.ma.showretry)}),L&&window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:!0,name:"MWR_RETRY_WALLET",payload:window._Site_Props.__getEventParameters({custom:{RetrySuccessful:!e.walletError.ma.showretry,MAWalletBalance:e.MABalance}})}),c.newWalletUiEntityId.indexOf(e.loggedinUser.pmEntityID)>-1&&(e.newWalletUi=!0),c.walletBenefitsUiEntityId.indexOf(e.loggedinUser.pmEntityID)>-1&&(e.walletBenefitsUi=!0),I(),e.CorpOrMAWalletFound&&(e.CorpBalance=parseFloat(r.CorpBalance+r.MABalance).toFixed(2),e.displayBalance=e.CorpBalance.toString(),e.medicalBenefitsName=e.medicalBenefitsName?e.medicalBenefitsName:c.maWalletDefaultName,e.CorpBalance>c.amountDisplayLimit&&(r.maDisplayType||r.corpDisplayType)&&(e.displayBalance=e.displayBalance.substring(0,4)+"..")),
(e.MBWalletFound&&!e.CorpOrMAWalletFound||e.CorpOrMAWalletFound&&!e.MBWalletFound)&&(e.addClassBalone=!0),e.MaWalletFound&&e.checkUser&&e.checkUser.userDetails&&e.checkUser.corpDetails&&e.checkUser.corpDetails.employeeDetail?(e.relation=e.checkUser.corpDetails.employeeDetail.beneficiaries,e.formatMAWalletBalance()):(e.CorpOrMAWalletFound||e.MBWalletFound)&&(e.relation?e.formatMAWalletBalance():a.$broadcast("showWalletInfo")))})["catch"](function(t){e.loadingBalance=!1})},e.retryBalance=function(){e.retryBalanceCount&&!e.loadingBalance&&(L=!0,e.getBalance(),e.retryBalanceCount-=1)},e.getLogo=function(t){var i;e.corpConfig&&(i=e.corpConfig.corporateLogo),!i&&t&&t.userDetails&&(i="/static/corpLogo/"+t.userDetails.pmEntityID+".png"),i&&d.get(m.staticUrl.slice(0,-1)+i.slice(7,i.length),{responseType:"blob"}).then(function(e){var t=new FileReader;t.readAsDataURL(e.data),t.onload=function(e){a.corpConfig.corporateLogo=e.target.result}})},e.toggleFilters=function(t){var a=r.toggeFilter(t);e.isFocus=!1,e.isMedicine=a.isMedicine,e.isPharmacy=a.isPharmacy,e.isHealthcheckup=a.isHealthcheckup,e.isConsultation=a.isConsultation,e.isInvestigation=a.isInvestigation,e.isOlService=a.isOlService,e.isHomeHealthCare=a.isHomeHealthCare,e.isDental=a.isDental,e.dataSet.categoryItemTypeId=a.categoryItemTypeId,e.cities=a.cities,r.allCities=e.cities},l.params&&l.params.city?(e.selectedCity=l.params.city,(e.selectedCity&&!r.getCity()||e.selectedCity!==r.getCity())&&r.setCity(e.selectedCity)):h.get("city")&&(e.selectedCity=h.get("city")),window._Site_Props.__setLocation(e.selectedCity),e.user={},e.$state=l,e.placeholderText="Search",e.facebookResponse={email:""};e.cities=o,r.allCities=e.cities,e.isopenCityModel=!1,e.isEmailValid=!0,e.isopenlogin=!1,e.isopenCity=!1;if(e.checkUser=r.isUserSignedin(),e.islogin=!1,e.checkUser){if(e.user=e.checkUser,e.islogin=!0,r.refreshOrders=!0,e.getBalance(),e.getWalletConditions(),e.getUserProfile(),c.subscriptionEntityIds.indexOf(e.checkUser.userDetails.pmEntityID)>-1&&e.getSubsEligibility(),e.authToken=e.checkUser.encryptedToken,c.accentureProfileEditEntityIds.indexOf(e.checkUser.userDetails.pmEntityID)>-1){var q=new Date(parseInt(e.checkUser.userDetails.dateOfBirth.replace("/Date(",""))),J=new Date("Jan 01 1900");q.getFullYear()==J.getFullYear()&&(e.editAgeGender=!0)}var z=r.isUserSignedin();z&&z.userDetails&&c.coBrandingEntityIds.indexOf(z.userDetails.pmEntityID)>-1&&(e.isCobranding=!0,e.corpConfig=z.corpConfig,a.corpConfig=z.corpConfig,a.corpConfig&&e.getLogo(z)),e.checkUser.isRetailUser=t.getFlatProperty(e.checkUser,"userDetails.pmEntityID")===c.retailUserEntityId,r.setUserObj(e.checkUser),P(),e.checkUser.isRetailUser||e.checkUser.corpConfig||!e.checkUser.corpDetails||b(),D(),e.userName=e.user.userDetails.displayName.charAt(0).toUpperCase()+e.user.userDetails.displayName.slice(1),e.loggedinUser=e.checkUser.userDetails,e.loggedinUser&&(e.islogin=!0),e.userName=e.user.userDetails.displayName.charAt(0).toUpperCase()+e.user.userDetails.displayName.slice(1),a.$emit("closePopup",{})}else e.loggedinUser=e.checkUser,e.userName="";e.signInCorpAcc=function(){r.showLinkingScreen=!0,r.openLoginPopup("lg","templates/openLoginPopUpnew.html?"+timeStamp)},e.corporateflowswitch=function(){window.sessionStorage.setItem("corp_redirection_cta",!0);var e="";l.includes("app.corporate")?(e="Redirection to Merge Flow",l.go("app.consumercorplabs")):l.includes("app.consumercorplabs")&&(e="Redirection to Corporate Flow",l.go("app.corporate")),e&&w.sendEvents(e)},e.trackOrderAhc=function(){window._MB_Analytics.__push({isCleverTap:!0,hj:!0,name:"AHC Track Order",payload:window._Site_Props.__getEventParameters({custom:{Origin:"AHC Landing Page"}})}),l.go("app.ahcOrderListing")},e.aboutUsRedirect=function(){try{window._MB_Analytics.__push({branchLog:{name:"AboutUsInweb",custom_data:{medibuddyUserId:"",pmEntityId:"",source:window.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:window.sessionStorage.getItem("branch_fingerprint")||""}}})}catch(e){console.log(e)}l.go("app.aboutus")},e.mbBeliefsRedirect=function(){l.go("app.mbbvalues")},e.userSigninOld=function(e){try{if(w.sendEvents("Link Corp Account"),"https://www.medibuddy.in/"===window.location.href){var t={screen:"Login",appVersion:"",domain:"medibuddyInweb",event:"linkCorpAccClick"},a=Object.assign({},t,{meta:JSON.stringify(t)});d.post(m.eventlogsUrl,a)}window._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,hj:!0,dbLog:!0,name:"LF_CORPORATE_LOGIN_INITATE",payload:window._Site_Props.__getEventParameters({custom:{auth_uuid:h.get("auth_uuid")||void 0,loginScreenEvent:"CORP_FRM_RETAIL"}})})}catch(i){console.log(i)}r.showRegisterTab=e,r.showLinkingScreen=!1,r.openLoginPopupCorp("lg","templates/corporateLoginPopup.html?"+timeStamp,{},"HEADER_CONTROLLER")},e.userSignin=function(e,t){try{window._MB_Analytics.__push({branchLog:{name:"LoginInweb",custom_data:{medibuddyUserId:"",pmEntityId:"",source:window.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:window.sessionStorage.getItem("branch_fingerprint")||""}}})}catch(a){console.log(a)}window._MB_Analytics.__push({excludeCleverTap:"true",dbLog:!0,hj:!0,name:"LF_LOGIN_INITATE",payload:window._Site_Props.__getEventParameters({custom:{auth_uuid:h.get("auth_uuid")||void 0,loginScreen:"Retail_Login",utm_source:"medibuddy"}})}),r.showRegisterTab=e,r.showLinkingScreen=!1,r.openLoginPopup("lg","templates/openLoginPopUpnew.html?"+timeStamp,null,null,null,t)},e.userSignup=function(){r.showLinkingScreen=!1,r.openSingupPopup("","templates/openSignup.html?"+timeStamp)},e.openSubsPopup=function(){r.openSubsPopup()},e.checkoutSubsCart=function(){console.log("puhsed cart item to db/redis"),s.url("/subsCheckout")},e.$on("landingUrl",function(e,t){var a=s.$$path;n.location.replace(a)}),e.policyList=[],e.userLinkInsuranceAccount=function(){e.policyList.length>0?(window._MB_Analytics.__push({isCleverTap:!0,dbLog:!0,hj:!0,name:"LF_INSURANCE_LOGIN_INITATE",payload:window._Site_Props.__getEventParameters({custom:{pmEntityId:e.user&&e.user.userDetails?e.user.userDetails.pmEntityID:"",userId:e.user&&e.user.userDetails?e.user.userDetails.userId:"",auth_uuid:h.get("auth_uuid")||void 0,mbUserId:e.user.userDetails.userId}})}),r.openInsurancePopUp("lg","templates/insuranceAccountLink.html?"+timeStamp,{policyList:e.policyList,userInfo:e.checkUser.userDetails})):U()},e.switchProfileMeantime=function(){u.open({animation:!0,backdrop:"static",scope:e,templateUrl:"switch_profile.html",controller:["$scope","$uibModalInstance",function(t,a){e.isForcedToRetailLogin=!1,e.showSwitchProfileErrorSection=!1,e.errorMsgTitle="",e.errorMsgDescription="",e.showCrossIcon=!1,e.showTryAgainOption=!1,t.closeDialogBox=function(){a.dismiss("cancel")},e.closeOnSuccess=function(){document.getElementById("loader").style.display="none",document.getElementById("success-div").style.display="block",document.getElementById("failure-div").style.display="none",e.updatedUserInfo=r.isUserSignedin();var a={phone:e.updatedUserInfo.userDetails.phone||void 0,name:e.updatedUserInfo.userDetails.firstName||void 0,corporateName:e.updatedUserInfo.corpDetails&&e.updatedUserInfo.corpDetails.employeeDetail&&e.user.corpDetails.employeeDetail.companyName||void 0};window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,hj:!0,dbLog:!0,name:"HOME_SCREEN_LOADED_SUCCESSFULLY",payload:window._Site_Props.__getEventParameters({custom:{auth_uuid:h.get("auth_uuid")?JSON.stringify(h.get("auth_uuid")):void 0,swpIdentifier:e.getUniqueSwitchID(),timeStamp:JSON.stringify((new Date).valueOf()),pmEntityId:e.updatedUserInfo.userDetails.pmEntityID||null,mbUserId:e.updatedUserInfo.userDetails.userId||null,email:e.updatedUserInfo.userDetails.email||void 0,domain:a.corporateName,appVersion:""}})}),setTimeout(t.closeDialogBox,1e3)},e.switchProfileFailed=function(){e.showCrossIcon=!0,e.showTryAgainOption=!1,e.isForcedToRetailLogin=!1,document.getElementById("loader").style.display="none",document.getElementById("success-div").style.display="none",document.getElementById("failure-div").style.display="block"},e.showLoader=function(){document.getElementById("loader").style.display="block",document.getElementById("success-div").style.display="none",document.getElementById("failure-div").style.display="none"},e.forcedToRetailLogin=function(t){e.showCrossIcon=!0,e.showTryAgainOption=!1,e.isForcedToRetailLogin=!0,e.errorMsgTitle=t.errorMsgTitle,e.errorMsgDescription=t.errorMsgDescription,document.getElementById("loader").style.display="none",document.getElementById("success-div").style.display="none",document.getElementById("failure-div").style.display="block"},e.marketPlaceFailed=function(){e.showCrossIcon=!1,e.showTryAgainOption=!0,e.isForcedToRetailLogin=!1,document.getElementById("loader").style.display="none",document.getElementById("success-div").style.display="none",document.getElementById("failure-div").style.display="block"},e.showSwitchProfileError=function(){e.showSwitchProfileErrorSection=!0}}],size:e.isMobileView?"xs":"login"});e.updatedUserInfo=r.isUserSignedin();var t={pmEntityId:e.updatedUserInfo.userDetails.pmEntityID||null,mbUserId:e.updatedUserInfo.userDetails.userId||null,email:e.updatedUserInfo.userDetails.email||void 0,corporateName:e.updatedUserInfo.corpDetails&&e.updatedUserInfo.corpDetails.employeeDetail&&e.user.corpDetails.employeeDetail.companyName||void 0};window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,hj:!0,dbLog:!0,name:"SWP_SWITCH_INITIATE",payload:window._Site_Props.__getEventParameters({custom:{auth_uuid:h.get("auth_uuid")?JSON.stringify(h.get("auth_uuid")):void 0,swpIdentifier:e.generateUniqueSwitchID(),timeStamp:JSON.stringify((new Date).valueOf()),pmEntityID:t.pmEntityId,mbUserId:t.mbUserId,emailId:t.email,domain:t.corporateName,appVersion:""}})})};var K=a.$on("refreshWallet",function(t,a){e.getBalance()}),Y=a.$on("userLogin",function(i,o){v(),e.checkUser=r.getUserObj(),a.corpConfig=null,e.checkUser&&(e.user=e.checkUser,Q(),e.trackUser=!0,e.getUserProfile(),e.islogin=!0,r.refreshOrders=!0,e.getBalance(),c.subscriptionEntityIds.indexOf(e.checkUser.userDetails.pmEntityID)>-1&&e.getSubsEligibility(),e.getWalletConditions(),e.checkUser.isRetailUser=t.getFlatProperty(e.checkUser,"userDetails.pmEntityID")===c.retailUserEntityId,r.setUserObj(e.checkUser),P(),e.checkUser.isRetailUser||e.checkUser.corpConfig||!e.checkUser.corpDetails||b(),D(),k.removePatientId(),r.insuranceSelected&&e.insuranceClick(),e.userName=e.user.userDetails.displayName.charAt(0).toUpperCase()+e.user.userDetails.displayName.slice(1),e.loggedinUser=e.checkUser.userDetails,e.loggedinUser&&(e.islogin=!0),e.userName=e.user.userDetails.displayName.charAt(0).toUpperCase()+e.user.userDetails.displayName.slice(1),"app.medicine"===l.current.name?e.$emit("userProfile",!0):e.$emit("openAppointmentForm",r.setBookingData))});a.$$listeners.userLogout=[];a.$on("userLogout",function(t,i){e.isHelperText=!1,e.isCorpUser=!1,e.showMessage=!1,a.corpConfig=null,e.newWalletUi=!1,e.isMchiUser=!1,e.isCobranding=!1,e.walletBenefitsUi=!1,e.editAgeGender=!1,e.user.userDetails&&window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"SignOut",payload:window._Site_Props.__getEventParameters({google:window._Site_Props.__googleTransform("SignOut","",_.property("displayName")(e.user.userDetails)+" has Signed Out")})}),e.user={},window._Site_Props.__setUserObj(e.user),e.islogin=!1,r.orderHistory=[],E={},k.removeMedsCart(),k.removePrescription()});e.dataSet={categoryItemTypeId:e.categoryItemTypeId,keyword:"",condition:"",pinCode:""},e.keyWords=void 0,e.selected=void 0,e.searchk=function(){e.megaSearchData&&0!==e.megaSearchData.length?e.showMegaSearch=!1:e.showMegaSearch?p({message:"Please select the procedure to proceed",position:"center",duration:5e3}):e.showMegaSearch=!0},e.onBlur=function(){e.placeholderText="select",e.isFocus=!1},e.onFocusHc=function(){e.placeholderText="type",e.searchCondition=["Master","Executive","Preventive","Diabetes","Cardiac","Cancer"],e.isFocus=!0},e.onFocus=function(){e.placeholderText="type",e.searchCondition=[],e.isFocus=!0},e.onFocusHHCare=function(){e.placeholderText="Type",e.searchCondition=["Physiotherapist Visit","Attendant Visit","Nursing Visit"],e.isFocus=!0},e.getkeywords=function(){e.placeholderText="type"},e.onSelect=function(t,a,i){e.dataSet.condition=a;var o=e.dataSet.condition+" health check in city "+e.selectedCity;window._MB_Analytics.__push({isCleverTap:!1,isGoogle:!0,name:"event",payload:window._Site_Props.__getEventParameters({google:window._Site_Props.__googleTransform("Health checks","search",o)})}),l.go("app.packagesnew",{categoryItemTypeId:c.healthCheckFilterName,searchc:e.dataSet.condition,searchdata:e.dataSet.condition+" health checkup packages in "+e.selectedCity,city:e.selectedCity},{reload:"app.packagesnew"}),e.toggleFilters("Health checks")},e.ngModelOptionsSelected=function(e){var t;return arguments.length?void(t=e):t},e.modelOptions={debounce:{"default":200,blur:250},getterSetter:!0},e.isConsultsLoading=!1,e.getconsultation=function(t){return t?t.length>2?(e.isConsultsLoading=!0,d.get(m.apiUrl+"keywordlookup/"+e.dataSet.categoryItemTypeId+"/"+t+"/0/0.json",{headers:{City:e.selectedCity}}).then(function(t){if(e.isConsultsLoading=!1,t.data.keywords&&0!==t.data.keywords.length)return t.data.keywords},function(t){e.isConsultsLoading=!1})):void 0:["Cardiologist","Gynaecologist","Nephrologist","Gastroenterologist","Ophthalmologist","ENT","Paediatrician","General Physician"]},e.isDentalLoading=!1,e.getDental=function(t){return t?t.length>2?(e.isDentalLoading=!0,d.get(m.apiUrl+"keywordlookup/"+e.dataSet.categoryItemTypeId+"/"+t+"/0/0.json",{headers:{City:e.selectedCity}}).then(function(t){if(e.isDentalLoading=!1,t.data.keywords&&0!==t.data.keywords.length)return t.data.keywords},function(t){e.isDentalLoading=!1})):void 0:["Dentist","Dental Surgeon","Periodontist","Pedodontist","Prosthodontist","Orthodontist","Oral & Maxillofacial Surgeon"]},e.isLabTestsLoading=!1,e.getLabTestKeywords=function(t){return t?t.length>2?(e.isLabTestsLoading=!0,d.get(m.apiUrl+"keywordlookup/"+e.dataSet.categoryItemTypeId+"/"+t+"/0/0.json",{headers:{City:e.selectedCity}}).then(function(t){if(e.isLabTestsLoading=!1,t.data.keywords&&t.data.keywords.length>0)return t.data.keywords},function(t){e.isLabTestsLoading=!1})):void 0:e.isCovid?_.isEmpty(e.user)||e.user&&e.user.isRetailUser?["COVID-19 RT-PCR - Swab Test","COVID-19 Antibody - GT - Blood Test"]:["COVID-19 RT-PCR - Swab Test","COVID-19 Antibody - GT - Blood Test"]:["T3","Vitamin B12","HBA1C","Liver Function Test","CBC","Lipid Profile"]},e.familyFlowClicked=function(){w.sendEventsV1(C.FFW_ENTRY_TO_MY_FAMILY_PAGE,{familyPageEntrySource:"Hamburger Menu"}),window.location.href="https://www.medibuddy.in/family-flow"},e.onSelectInvestigation=function(t,a,i){e.dataSet.keyword=a;var o=e.dataSet.condition+" in city "+e.cityName;window._MB_Analytics.__push({isCleverTap:!1,isGoogle:!0,name:"event",payload:window._Site_Props.__getEventParameters({google:window._Site_Props.__googleTransform("Labtest","search",o)})}),l.go("app.labtest",{searchk:e.dataSet.keyword,city:e.selectedCity},{reload:"app.labtest"})},e.onSelectConsultation=function(t,a,i){e.dataSet.condition=a;var o=e.dataSet.condition+" in city "+e.selectedCity;window._MB_Analytics.__push({isCleverTap:!1,isGoogle:!0,name:"event",payload:window._Site_Props.__getEventParameters({google:window._Site_Props.__googleTransform("consultation","search",o)})}),l.go("app.consultation",{categoryItemTypeId:c.consultationFilterName,searchk:e.dataSet.condition,city:e.selectedCity,location:e.selectedLocality},{reload:"app.consultation"}),e.toggleFilters("Consultation")},e.onSelectDental=function(t,a,i){e.dataSet.condition=a;var o=e.dataSet.condition+" in city "+e.selectedCity;window._MB_Analytics.__push({isCleverTap:!1,isGoogle:!0,name:"event",payload:window._Site_Props.__getEventParameters({google:window._Site_Props.__googleTransform("Dental","search",o)})}),l.go("app.dentalPage",{categoryItemTypeId:c.dentalFilterName,searchk:e.dataSet.condition,city:e.selectedCity},{reload:"app.dentalPage"}),e.toggleFilters("Dental")},e.onFocusOlService=function(){e.placeholderText="Type",e.searchCondition=["Cardiologist","Gynaecologist","Nephrologist","Gastroenterologist","Ophthalmologist","ENT","Paediatrician","General Physician"]},e.onSelectOlService=function(t,a,i){e.dataSet.keyword=a;var o=e.dataSet.keyword+" in olService";window._MB_Analytics.__push({isCleverTap:!1,isGoogle:!0,name:"event",payload:window._Site_Props.__getEventParameters({google:window._Site_Props.__googleTransform("Tele Consultation","search",o)})}),l.go("app.olservice",{searchc:"",searchk:e.dataSet.keyword},{reload:"app.olservice"})},e.showExploreInvestigation=function(t){if(t){e.dataSet.keyword=t;var a=e.dataSet.keyword+" in city "+e.selectedCity;window._MB_Analytics.__push({isCleverTap:!1,isGoogle:!0,name:"event",payload:window._Site_Props.__getEventParameters({google:window._Site_Props.__googleTransform("Labtest","search",a)})}),l.go("app.labtest",{searchk:e.dataSet.keyword,city:e.selectedCity},{reload:"app.labtest"}),e.toggleFilters("Labtest")}},e.showExploreConsultation=function(t){if(t){e.dataSet.keyword=t;var a=e.dataSet.keyword+" in city "+e.selectedCity;window._MB_Analytics.__push({isCleverTap:!1,isGoogle:!0,name:"event",payload:window._Site_Props.__getEventParameters({google:window._Site_Props.__googleTransform("consultation","search",a)})}),l.go("app.consultation",{categoryItemTypeId:c.consultationFilterName,searchk:e.dataSet.keyword,city:e.selectedCity,location:e.selectedLocality},{reload:"app.consultation"}),e.toggleFilters("Consultation")}},e.showExploreDental=function(t){if(t){e.dataSet.keyword=t;var a=e.dataSet.keyword+" in city "+e.selectedCity;window._MB_Analytics.__push({isCleverTap:!1,isGoogle:!0,name:"event",payload:window._Site_Props.__getEventParameters({google:window._Site_Props.__googleTransform("Dental","search",a)})}),l.go("app.dentalPage",{categoryItemTypeId:c.dentalFilterName,searchk:e.dataSet.keyword,city:e.selectedCity},{reload:"app.dentalPage"}),e.toggleFilters("Dental")}},e.showExploreMedicine=function(t){if(t&&6==t.length)if(r.setPincode(t),e.isPharmacy)l.go("app.pharmacy",{medicine:e.medicineKeyword,pincode:t},{reload:"app.pharmacy"});else{var a=t+" in city "+e.selectedCity;window._MB_Analytics.__push({isCleverTap:!1,isGoogle:!0,name:"event",payload:window._Site_Props.__getEventParameters({google:window._Site_Props.__googleTransform("Medicine","search",a)})}),l.go("app.medicine",{city:e.selectedCity,pincode:t},{reload:"app.medicine"})}},e.showExplorePharmacy=function(e){e&&e.length>2&&(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"Pharmacy Cart",payload:window._Site_Props.__getEventParameters({custom:{medicine:e,pincode:r.getPincode()}})}),l.go("app.pharmacy",{medicine:e,pincode:r.getPincode()},{reload:"app.pharmacy"}))},e.showExplorePage=function(t){if(t){e.dataSet.condition="",e.dataSet.keyword=t;var a=e.dataSet.keyword+" health check in city "+e.selectedCity;window._MB_Analytics.__push({isCleverTap:!1,isGoogle:!0,name:"event",payload:window._Site_Props.__getEventParameters({google:window._Site_Props.__googleTransform("Health checks","search",a)})}),l.go("app.packagesnew",{categoryItemTypeId:c.healthCheckFilterName,searchc:e.dataSet.keyword,searchdata:e.dataSet.keyword+" health checkup packages in "+e.selectedCity,city:e.selectedCity},{reload:"app.packagesnew"}),e.toggleFilters("Health checks")}},e.selectMatch=function(t){e.keyWordValue=t},e.onSelectHHCare=function(t,a,i){e.dataSet.condition=a;var o=e.dataSet.condition+" in city "+e.cityName;window._MB_Analytics.__push({isCleverTap:!1,isGoogle:!0,name:"event",payload:window._Site_Props.__getEventParameters({google:window._Site_Props.__googleTransform("Home Health Care","search",o)})}),l.go("app.homehealthcare",{categoryItemTypeId:c.homeHealthCareFilterName,searchc:e.dataSet.condition,city:e.selectedCity},{reload:"app.homehealthcare"})},e.showExploreHHcare=function(t){if(t){e.dataSet.condition=t;var a=e.dataSet.condition+" in city "+e.cityName;window._MB_Analytics.__push({isCleverTap:!1,isGoogle:!0,name:"event",payload:window._Site_Props.__getEventParameters({google:window._Site_Props.__googleTransform("Home Health Care","search",a)})}),l.go("app.homehealthcare",{categoryItemTypeId:c.homeHealthCareFilterName,searchc:e.dataSet.condition,city:e.selectedCity},{reload:"app.homehealthcare"})}},e.setUserCity=function(t){r.setCity(t),r.cityData=t,e.cityName=r.cityData,e.selectedCity=e.cityName,window._Site_Props.__setLocation(e.cityName),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"City Change",payload:window._Site_Props.__getEventParameters({google:window._Site_Props.__googleTransform("City","Change","City Changed to "+e.cityName)})}),a.$broadcast("changeCity",e.cityName)},e.pushReimbursementEvent=function(e){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,hj:!1,dbLog:!0,name:"Reimbursement_button_click"})},e.showBenefWalletAllotment=function(){if(e.showNewBenefitsUI){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,hj:!0,dbLog:!0,name:"MWR_WALLET_CLICK",payload:window._Site_Props.__getEventParameters({custom:e.checkUser.userDetails})});u.open({animation:!0,templateUrl:"wallet/corpBenefits.html?"+timeStamp,controller:"corpBenefitsController",controllerAs:"corpBenefitsCtrl",size:a.isMobileView?"benefitsUIMob full-height-mobile":"benefitsUI subsModal"})}if((e.isTermsAndConditionsApplicable||e.MaWalletFound)&&!l.is("app.walletInfo")&&(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,hj:!1,dbLog:!0,name:"Benefits_Icon_Clicked"}),!e.showNewBenefitsUI)){window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"OldBenefitsUIOpen",name:"OldBenefitsUIOpen",payload:window._Site_Props.__getEventParameters({custom:e.checkUser.userDetails})});u.open({animation:!0,template:'<div class="modal-body"><button class="btn btn-default btn-close pull-left" type="button" ng-click="cancelDialog()"><i class="mm mm-close"></i></button><ng-include src="\'templates/walletInfoAndConditions.html\'"></ng-include></div>',controller:"walletInfoAndConditionsController",controllerAs:"walletInfoCtrl",size:a.isMobileView?"full-height-mobile":"lg"})}},e.selectCity=function(){(l.includes("app.corporate")||l.includes("app.corporateListing"))&&_.isEmpty(r.corporatePackages)||(r.cityError="",r.cityPopup("lg"))},e.$on("allCities",function(t,a){a&&e.setUserCity(a)});document.querySelector("#mb-widget");e.signout=function(){r.makeAjaxCalls(m.apiUrl+"MPLogout",{AceessToken:e.user.token},"POST").then(function(e){}),r.logoutUser(),e.isMchiUser=!1,e.isCobranding=!1,e.corpConfig=null,e.islogin=!1,e.loggedinUser={},e.user={},e.MBBalance=0,e.MBWalletFound=!1,r.MBBalance=0,r.MBWalletFound=!1,e.CorpBalance=0,e.MABalance=0,e.CORPBalance=0,e.corpWalletDisplayName="",e.maWalletDisplayName="",e.CorpWalletFound=!1,e.CorpOrMAWalletFound=!1,e.MaWalletFound=!1,r.CorpWalletFound=!1,r.CorpBalance=0,e.addClassBalone=!1,e.showLastLinking=!1,e.showLinkedProfile=!1,e.hasOtherThanRetailAccount=!1,r.walletConfigs=[],r.walletInfo={},a.OneClickFlowLogin=!1,h.remove("policyNumber"),h.remove("subs_eligible"),h.remove("retailMbId"),h.remove("retailToken"),h.remove("corpToken"),h.remove("daservertoken"),h.remove("toShowMandPopUp"),document.cookie="surgeryToken=;expires="+c.PastDate+";"},e.clearText=function(){e.keywords="",e.keyWords="",e.selected="",e.investigationKeyWords="",e.olKeyWords="",e.medicineKeyword=""},e.showHomePage=function(){e.user&&e.user.userDetails&&11187361==e.user.userDetails.pmEntityID||(e.flashbooking=!1,e.keywords="",e.selected="",e.investigationKeyWords="","app.home"!==l.current.name&&"app.mediCheckoutCart"!==l.current.name&&"app.checkout"!==l.current.name&&"app.ahcCheckout"!==l.current.name&&"app.consumerLabsCheckout"!==l.current.name&&l.go("app.home",{service:""},{reload:"app.home"}))},e.notifyMessage=c.notifyMessage;var Q=function(){e.showMessage=!1,e.notifyMessage=""};Q(),e.categoryResult={numberProvider:100,categories:["dentist","prosthodontist","orthodontist","dentist","endodontist","implantologist"]},e.categoryProceduresResult={numberProvider:100,procedures:["Bonding","Braces","Bridges and Implants","Crowns and Caps","Dentures","Extractions","Filling and Repairs","Gum Surgery","Oral Cancer Examinations","Root Canals","Sealants","Teeth Whitening","Veneers"]},e.cartItemCount=0,e.medsCartItemsCount=0,e.$on("cartItemsCount",function(t,a){e.cartItemCount=a}),e.$on("medsCartItemsCount",function(t,a){e.medsCartItemsCount=a?a:0}),e.goToMedsCart=function(){e.medsCartItemsCount>0?l.go("app.medicineCart",{medicine:"Medicines",pincode:r.getPincode()},{reload:"app.medicineCart"}):p({message:"Please add some item in cart",position:"center",duration:5e3})},a.$on("$destroy",function(){Y(),$(),K(),f.cancel(T),deregisterCoporateConfig(),n.removeEventListener("scroll",H),document.querySelector("header").classList.remove("sticky-header"),e.isSticky=!1,e.$apply(),e.isSBI=!1}),a.$on("hideWalletBalanceEvent",function(){e.hideWalletBalance=a.hideWalletBalance}),a.$on("SwitchProfile",function(t,a){e.checkUser=r.isUserSignedin(),e.checkUser.encryptedToken=a.updatedToken,r.setUserObj(e.checkUser),e.switchProfile(a.targetId,a.toProfile,a.fromProfile,a.unlinkAccount)}),e.getHospitalization=function(){l.go("app.hospitalization",{reload:"app.hospitalization"})}}])})}();