!function(){"use strict";define(["_routes","utility"],function(e,t){e.register.controller("walletInfoAndConditionsController",["$scope","authService","$rootScope","$window","$sce","navConstantsSvc","apiProvider","localStorageService","$uibModal",function(e,n,l,a,i,o,s,r,c){function d(e){if(e.data){if(e.data.eventName&&e.data.eventBody){console.log("sending iframe event for : "+e.data.eventName.toString());try{window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"fintech",name:e.data.eventName,payload:window._Site_Props.__getEventParameters({custom:e.data.eventBody})})}catch(t){console.log("error sending analytics event from wallet benefits UI")}}if(e.data.openLink){var l="";"longToken"===e.data.tokenType?l+=n.getUserObj().encryptedToken:"shortToken"===e.data.tokenType&&(l+=n.getUserObj().token),window.open(e.data.openLink+l)}}}function u(){if(e.entityId=p.userDetails&&p.userDetails.pmEntityID?p.userDetails.pmEntityID:null,0==e.iframeSource.length&&(e.iframeSource="https://www.medibuddy.in/unifiedcheckout/benefits/"+e.entityId+"?authToken="+p.encryptedToken+"&click_source=WalletInfo"+e.marketingString,e.iframeSource=i.trustAsResourceUrl(e.iframeSource)),e.showNewBenefitsUI=l.showNewBenefitsUI,a.addEventListener("message",d),e.isMobileView&&e.showNewBenefitsUI){a.removeEventListener("message",d),e.showNewBenefitsUI=!1;c.open({animation:!0,templateUrl:"wallet/corpBenefits.html?"+timeStamp,controller:"corpBenefitsController",controllerAs:"corpBenefitsCtrl",size:l.isMobileView?"benefitsUIMob full-height-mobile":"benefitsUI subsModal"})}e.showNewBenefitsUI||a._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"OldBenefitsUIOpen",name:"OldBenefitsUIOpen",payload:a._Site_Props.__getEventParameters({custom:p.userDetails})})}function m(){e.userAuth.encryptedToken&&e.authToken||n.makeAjaxCalls(s.apiUrl+"GetUserLongToken",{shortToken:e.userAuth.token},"POST").then(function(t){console.log("response=",t),t.data.isSuccess&&(r.set("corpToken",t.data.encryptedToken),e.userAuth.encryptedToken=t.data.encryptedToken,n.setUserObj(e.userAuth),e.authToken=e.userAuth.encryptedToken)})}a.scrollTo(0,0);var f=this;e.conditionCallFired=!1;var p=n.isUserSignedin();e.showNewBenefitsUI=!1,e.entityId=void 0,e.userAuth=n.isUserSignedin(),e.hideWalletBalance=l.hideWalletBalance,e.iframeSource="",e.marketingString="",l.$on("hideWalletBalanceEvent",function(){e.hideWalletBalance=l.hideWalletBalance}),l.$on("newBenefitsFlagSet",function(){if(l.showNewBenefitsUI){var a=window.location.search.substring(1);e.marketingString=a&&a.length>0?"&"+a:"";var o=n.isUserSignedin();document.cookie="shortToken="+o.token+";domain="+t.getCookieDomain()+";path=/;",n.makeAjaxCalls("https://unified-checkout-frontend.medibuddy.in/unifiedcheckout/benefits/getCustomUrl","","GET",o.token).then(function(t){t.data&&t.data.customizedBenefitsUrl&&(t.data.customizedBenefitsUrl.includes("?")?e.iframeSource=i.trustAsResourceUrl(t.data.customizedBenefitsUrl+"&click_source=WalletInfo"+e.marketingString):e.iframeSource=i.trustAsResourceUrl(t.data.customizedBenefitsUrl+"?click_source=WalletInfo"+e.marketingString)),u()})["catch"](function(e){console.log(e),u()})}}),e.isReimbursementButton=p.isReimbursementButton,e.appNameReimbursement=r.get("utm_appname"),e.isAccentureUser=p&&p.userDetails&&o.allAccentureEntityIds.indexOf(p.userDetails.pmEntityID)>-1,e.accenturePolicy=i.trustAsHtml("<div class='conditions'> <div class='policy-conditions'> <h3><b> Account Balance T&C:</b></h3> <ul> <li> Account balance can be utilized for employee health checkup only, not for dependents. </li><li> In case you opt for reimbursement of INR 2000 instead of cashless, account balance will become INR 0. </li></ul> </div> </div>"),e.init=function(){e.wallets=n.walletDetails?n.walletDetails.length:0;var t=_.findWhere(n.walletDetails,{walletName:"MAWallet"});e.MAWalletFound=!_.isEmpty(t),e.MABalance=t&&t.balance?t.balance:n.MABalance,n.walletConfigs||(n.walletConfigs=[]),n.MBBalance>0&&!_.findWhere(n.walletConfigs,{walletName:"MBWallet"})&&n.walletConfigs.push({walletName:"MBWallet"}),e.corpBalance=n.CorpBalance,e.MBBalance=n.MBBalance,e.mawalletFailed=n.mawalletFailed||!1,e.MaWalletName=n.maAliasName,e.corpWalletName=n.corpAliasName},m(),e.pushReimbursementEvent=function(){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,hj:!1,dbLog:!0,name:"Reimbursement_click_from_benefits"})},e.walletSelection=function(t){e.selectedWallet=_.findWhere(n.walletDetails,{walletName:t}),!e.selectedWallet||!e.selectedWallet.balanceDetail||e.selectedWallet&&e.selectedWallet.balanceDetail&&e.selectedWallet.balanceDetail.policies&&1===e.selectedWallet.balanceDetail.policies.length&&e.selectedWallet.balanceDetail.polDetails&&1===e.selectedWallet.balanceDetail.polDetails.length?f.showBenefDetails=!1:f.showBenefDetails=!0,e.mawalletFailed&&(f.showBenefDetails=!0)},e.$watch(function(){return document.getElementById("benifitsTnCpage")},function(e,t){if(e){var n=document.getElementById("benifitsTnCpage").getElementsByClassName("btn btn-offers btn-primary");_.forEach(n,function(e){e.addEventListener("click",h)})}});var h=function(){var e=this.parentElement.parentElement.getElementsByTagName("td")[0].innerText.split("\n")[0];e=e.toLowerCase().replace(/[^a-zA-Z]+/g,""),e+="_click_from_benefits",window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,hj:!1,dbLog:!0,name:e})};e.loadPolicyConditions=function(){(n.isTermsAndConditionsApplicable||e.isAccentureUser)&&(_.forEach(n.walletConfigs,function(e,t){var l=_.findWhere(n.walletDetails,{walletName:e.walletName});_.isEmpty(l)||("mbwallet"===e.walletName.toLowerCase()&&(l.policyConditions=i.trustAsHtml(o.MbWalletDefaultTermsOfUse)),e.walletTermsOfUse&&(l.policyConditions=i.trustAsHtml(e.walletTermsOfUse)))}),e.MAWalletFound?e.walletSelection("MAWallet"):e.walletSelection(_.first(n.walletDetails).walletName))},e.user=n.getUserObj(),e.user?(e.init(),e.loadPolicyConditions()):n.openIdealLoginPopup("lg","templates/corporateIdealLoginPopup.html?"+timeStamp,{},"CORP_PHONE","WALLET_INFO_CONRTOLLER"),e.cancelDialog=function(){B(),this.$dismiss()};var w=l.$on("walletConfigLoaded",function(){e.init(),e.loadPolicyConditions()}),g=l.$on("showWalletInfo",function(){e.init(),e.loadPolicyConditions(),e.noWallet=!1}),b=l.$on("cfpLoadingBar:completed",function(){e.noWallet=!e.wallets}),B=function(){var e=document.getElementById("benifitsTnCpage").getElementsByClassName("btn btn-offers btn-primary");_.forEach(e,function(e){e.removeEventListener("click",h)})};e.$on("$destroy",function(){a.removeEventListener("message",d)}),l.$on("$destroy",function(){g(),b(),w()})}])})}();