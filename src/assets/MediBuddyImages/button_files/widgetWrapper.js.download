!function(){"use strict";define(["_routes","utility"],function(e,t){e.register.directive("widgetWrapper",["$rootScope","$state","$location","cityList","authService","$anchorScroll","navConstantsSvc","$timeout",function(e,i,r,n,a,o,c,s){return{restrict:"AE",scope:{createApp:"=?",setup:"=?",pipeline:"=?",serviceList:"=?"},link:function(d,l,u){function p(){var e=a.isUserSignedin(),t=!1;e&&(t=!e||e&&e.userDetails&&c.consultSponsoredTagEntityId.indexOf(e.userDetails.pmEntityID)>-1),m=l[0].querySelector("mb-widget")||{},h=d.createApp(d.setup,{serviceList:d.serviceList,cityList:n,defaultCity:a.getCity(),activeService:a.activeService?a.activeService.name:"",pmEntityID:t}),h.mount(m),m&&m.children.length&&(m=m.children[0],v())}function v(){if(m.addEventListener&&(m.addEventListener("serviceDropdownStatus",function(e){e.stopPropagation(),e.detail&&d.driver?(angular.element(document.body).addClass("bodyScrollFix"),k=s(function(){d.driver.highlight(document.querySelector(".more-section"))},100)):d.driver&&d.driver.hasHighlightedElement()&&d.driver.reset(),e.stopImmediatePropagation()}),m.addEventListener("selectCity",function(e){e.stopPropagation(),d.moreCity(),d.$apply(),e.stopImmediatePropagation()}),m.addEventListener("serviceActionClicked",function(e){if(e.stopPropagation(),e.detail&&e.detail.service&&e.detail.action&&"button"==e.detail.action.type){try{window._MB_Analytics.__push({branchLog:{name:"StartconsultationInweb",custom_data:{medibuddyUserId:t.getFlatProperty(d.user,"userDetails.userId")+""||"",pmEntityId:t.getFlatProperty(d.user,"userDetails.pmEntityID")+"",source:window.sessionStorage.getItem("utm_source")||"",maid:t.getFlatProperty(d.user,"userDetails.maid")+""||"",platform:"MBWeb",browser_fingerprint_id:window.sessionStorage.getItem("branch_fingerprint")||""}}})}catch(i){console.log(i)}var r=e.detail.action.btnLink;c.serviceRequireToken.indexOf(e.detail.service)>-1&&(d.checkUser=a.isUserSignedin(),d.checkUser&&d.checkUser.encryptedToken&&(r+="&accessToken="+d.checkUser.encryptedToken+"&source=medibuddy-web")),window.open(r,e.detail.action.target)}e.stopImmediatePropagation()}),m.addEventListener("serviceToggled",function(e){if(e.stopPropagation(),d.checkUser=a.isUserSignedin(),e.detail&&e.detail.service){if((!e.detail.action||e.detail.action&&!e.detail.action.skipCityValidate)&&g(e.detail.service),e.detail.service&&(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,hj:!0,dbLog:!0,name:"MainServiceClicked",payload:window._Site_Props.__getEventParameters({custom:{serviceName:e.detail.service,itemSource:"Home"}})}),window.updateSrc=!0,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"labtest"==e.detail.service||"covid"==e.detail.service?"labs":"medicine"==e.detail.service?"meds":"",hj:!0,name:"medicine"==e.detail.service?"MedsIconClick":"vision-care"==e.detail.service?"VisionCare_web_icon_click":"Service Icon Clicked",payload:window._Site_Props.__getEventParameters({custom:{serviceName:e.detail.service,srcPage:"Home Page"}})}),window.updateSrc=!1),"doctor"==e.detail.service||"mb-gold"==e.detail.service)try{window._MB_Analytics.__push({branchLog:{name:"doctor"==e.detail.service?"talktodoctorInWeb":"medibuddygoldInWeb",custom_data:{medibuddyUserId:t.getFlatProperty(d.user,"userDetails.userId")+""||"",pmEntityId:t.getFlatProperty(d.user,"userDetails.pmEntityID")+"",source:window.sessionStorage.getItem("utm_source")||"",maid:t.getFlatProperty(d.user,"userDetails.maid")+""||"",platform:"MBWeb",browser_fingerprint_id:window.sessionStorage.getItem("branch_fingerprint")||""}}})}catch(r){console.log(r)}if("consultation"==e.detail.service||"dental"==e.detail.service)try{window._MB_Analytics.__push({branchLog:{name:"consultation"==e.detail.service?"OPD_web":"OPD_dental",custom_data:{medibuddyUserId:t.getFlatProperty(d.user,"userDetails.userId")+""||"",pmEntityId:t.getFlatProperty(d.user,"userDetails.pmEntityID")+"",source:window.sessionStorage.getItem("utm_source")||"",maid:t.getFlatProperty(d.user,"userDetails.maid")+""||"",platform:"MBWeb",browser_fingerprint_id:window.sessionStorage.getItem("branch_fingerprint")||""}}})}catch(r){console.log(r)}if("doctor"==e.detail.service){var n=e.detail.action.btnLink;c.serviceRequireToken.indexOf(e.detail.service)>-1&&(d.checkUser=a.isUserSignedin(),d.checkUser&&d.checkUser.encryptedToken&&(n+="&accessToken="+d.checkUser.encryptedToken+"&source=medibuddy-web")),window.open(n,e.detail.action.target)}if("surgery"==e.detail.service){var n=e.detail.action.link;d.checkUser=a.isUserSignedin(),d.checkUser&&d.checkUser.encryptedToken&&(document.cookie="surgeryToken="+d.checkUser.encryptedToken),window.open(n,e.detail.action.target)}if("consultation"==e.detail.service){var n=e.detail.action.link;d.checkUser=a.isUserSignedin(),n+=d.checkUser&&d.checkUser.token?"?shortToken="+d.checkUser.token+"&utm_source=medibuddyInWeb":"?utm_source=medibuddyInWeb",window.open(n,e.detail.action.target)}if("dental"==e.detail.service){var n=e.detail.action.link;d.checkUser=a.isUserSignedin(),n+=d.checkUser&&d.checkUser.token?"&shortToken="+d.checkUser.token+"&utm_source=medibuddyInWeb&banner=dental":"?utm_source=medibuddyInWeb&banner=dental",window.open(n,e.detail.action.target)}if(e.detail.action&&"redirect"==e.detail.action.type){var s=e.detail.action;if(s.href)o(s.href);else if(s.route)i.go("app."+s.route);else if(s.link){var n=s.link?e.detail.action.link.replace("?accessToken=token&","?"):"";c.serviceRequireToken.indexOf(e.detail.service)>-1&&(d.checkUser=a.isUserSignedin(),d.checkUser&&d.checkUser.encryptedToken&&(n+="&accessToken="+d.checkUser.encryptedToken+"&source=medibuddy-web")),window.open(n,s.target)}}else{var l=d.serviceList.find(function(t){return t.name==e.detail.service});a.activeService=l,o(e.detail.action&&e.detail.action.href?e.detail.action.href:"services")}}e.stopImmediatePropagation()}),m.addEventListener("serviceActionItem",function(e){if(e.stopPropagation(),d.checkUser=a.isUserSignedin(),e.detail&&e.detail.service&&e.detail.searchText){if("covid"==e.detail.service){var t=!d.checkUser||d.checkUser&&d.checkUser.userDetails&&d.checkUser.isRetailLabsFlowEnabled;if(t){var r=c.covidPackages.find(function(t){return t.packageName===e.detail.searchText});if(r)return void i.go("app.labs",{packageId:r.packageId})}}"medicine"==e.detail.service&&window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",hj:!0,name:"MedsHomePincodeSearch",payload:window._Site_Props.__getEventParameters({custom:{pincode:e.detail.searchText}})}),d.onServiceAction(e.detail.service,e.detail.searchText,e.detail.subActionText)}e.stopImmediatePropagation()})),r.search().service&&m.dispatchEvent){var e=r.search().service.toLowerCase();m.dispatchEvent(new CustomEvent("serviceSelected",{detail:e}))}}function g(e){"medicine"===e?d.toggleFilters(e,"Medicine"):"consultation"===e?d.toggleFilters(e,"Consultation"):"labtest"===e?d.toggleFilters(e,"Labtest"):"homehealthcare"===e||"home-health-care"===e?d.toggleFilters(e,"Home Health Care"):"dental"===e?d.toggleFilters(e,"Dental"):"teleconsultation"===e||"tele-consultation"===e?d.toggleFilters(e,"olService"):"covid"===e?d.toggleFilters(e,"covid"):"health-check"===e?d.toggleFilters(e,"Health checks"):"genome"===e&&d.toggleFilters(e,"Genome")}d.isMobileView=e.isMobileView,_.extend(d,d.pipeline),d.pipeline.$el=m;var m,h;p();var k;requirejs(["tour"],function(t){d.driver=new t({opacity:.5,allowClose:!1,padding:0,keyboardControl:!1,onReset:function(){angular.element(document.body).removeClass("bodyScrollFix"),i(),s.cancel(k)}});var i=e.$on("$stateChangeStart",function(){d.driver.reset()})}),d.$on("activateService",function(e,t){m&&m.dispatchEvent&&m.dispatchEvent(new CustomEvent("serviceSelected",{detail:t}))}),d.$on("citySelected",function(e,t){m&&m.dispatchEvent&&m.dispatchEvent(new CustomEvent("citySelected",{detail:t}))}),d.$on("serviceListUpdate",function(e,t){d.serviceList=t,h.unmount(),p()})}}}])})}();