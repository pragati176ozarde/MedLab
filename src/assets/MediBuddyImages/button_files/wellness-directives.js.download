!function(){"use strict";define(["_routes","utility","angular","angular"],function(e,a,t){e.register.directive("activeBooking",["$rootScope","authService","$state","$window","apiProvider","navConstantsSvc","$uibModal","notify","$http","$location",function(e,a,t,i,r,o,s,n,c,d){return{restrict:"E",scope:{small:"=?",activeOrder:"=?",companyName:"=?",hideHeader:"=?"},templateUrl:"/corpWellness/directive/activeBooking.html?"+timeStamp,link:function(t,i,s){t.isMobileView=e.isMobileView,t.selectedCity=a.getCity(),t.userInfo=a.isUserSignedin(),t.rescheduleClicked=!1;var c=a.isUserSignedin();c&&(t.wellnessConfig=c.corpWellnessConfig||[]),t.emitPackage=function(){t.$emit("refreshOrders")},t.emitcancel=function(e){e&&e.stopPropagation(),t.$emit("emitcancel",t.activeOrder),window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"medibuddy",name:"Corp_landing_Cancelled",payload:window._Site_Props.__getEventParameters({custom:{price:_.reduce(t.activeOrder.requests,function(e,a){return e+a.price},0),city:_.first(t.activeOrder.requests).city,previousStatus:_.first(t.activeOrder.requests).status}})})},t.goToOrderDetail=function(){d.url("/orderData?orderid="+t.activeOrder.orderId)},t.loadSlots=function(e){if(e&&e.stopPropagation(),t.rescheduleClicked)return void(t.rescheduleClicked=!1);window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"medibuddy",name:"Corp_landing_Reschedule",payload:window._Site_Props.__getEventParameters({custom:{price:_.reduce(t.activeOrder.requests,function(e,a){return e+a.price},0),city:_.first(t.activeOrder.requests).city,previousStatus:_.first(t.activeOrder.requests).status}})});var i=a.isUserSignedin();a.makeAjaxCalls(r.apiUrl+"Labs/ProvidersCalendar",{ProviderIds:[t.activeOrder.servingProviderId],NoOfDays:30,ContractId:o.ahcContract,IsHomeVisitCase:t.activeOrder.isHomeVisit},"POST",i.token).then(function(e){e.data.isSuccess&&e.data.providerSlots&&_.isArray(e.data.providerSlots)&&!_.isEmpty(e.data.providerSlots)&&(t.slotsObj={dcId:t.activeOrder.providerId,dcName:t.activeOrder.providerName,contractId:o.ahcContract,providerSlots:e.data.providerSlots},t.rescheduleClicked=!0,i&&i.corpConfig&&i.corpConfig.bookTillDate&&(t.slotsObj.bookTillDate=new Date(i.corpConfig.bookTillDate)))})["catch"](function(e){})},t.closeReshedule=function(){t.rescheduleClicked=!1};var l=function(){if(t.rescheduledTime){var e=a.isUserSignedin(),i={orderId:t.activeOrder.orderId,remarks:"Rescheduled by customer",scheduledDate:t.rescheduledTime};a.makeAjaxCalls(r.apiUrl+"/Reschedule.json",i,"POST",e.token).then(function(e){e.data.isSuccess?(t.closeReshedule(),t.emitPackage()):n({message:e.data?e.data.errorMessage:"Sorry! We were unable to reschedule your appointment due to some technical glitch from our side. Please wait a few minutes before you try again.",position:"center",duration:5e3})})["catch"](function(e){n({message:"Sorry! We were unable to reschedule your appointment due to some technical glitch from our side. Please wait a few minutes before you try again.",position:"center",duration:5e3})})}};t.$on("selectedSlot",function(e,a){t.rescheduledTime=a.prefDateTime instanceof Date&&a.prefDateTime.toJSON(),l()}),t.getDownloadUrls=function(e){e&&e.stopPropagation(),window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"medibuddy",name:"Corp_landing_Downloadreport",payload:window._Site_Props.__getEventParameters({custom:{price:_.reduce(t.activeOrder.requests,function(e,a){return e+a.price},0),city:_.first(t.activeOrder.requests).city}})});var i=a.isUserSignedin();a.makeAjaxCalls(r.apiUrl+"/orderDetail/"+t.activeOrder.orderId,"","GET",i.token).then(function(e){e.data.isSuccess?t.downloadReport(_.compact(_.flatten(_.pluck(e.data.order.requests,"attachments")))):n({message:"We are facing technical issues while downloading your report. Please try again after some time or call our customer support",position:"center",duration:5e3})})["catch"](function(e){n({message:"We are facing technical issues while downloading your report. Please try again after some time or call our customer support",position:"center",duration:5e3})})},t.downloadReport=function(e){e.length&&a.multipleFilesDownload(e)}}}}]),e.register.directive("addBenef",["$rootScope","authService","corpWellnessService","notify","navConstantsSvc",function(e,a,i,r,o){return{restrict:"E",scope:{small:"=?",isAhc:"=?"},templateUrl:"/corpWellness/directive/addBenef.html?"+timeStamp,link:function(s,n,c){function d(){m=[],s.userInfo={relationName:"Others"},s.noMatch=!1,s.isAhc||i.sendCleverTapEvent("Beneficiary Add Details",{},!0)}var l=a.isUserSignedin();s.primaryRelationArray=["Others","Brother","Sister","Daughter","Son"];var p=["Mother","Father","Spouse","Husband"],u=[];l&&l.corpDetails&&l.corpDetails.employeeDetail&&(l.corpDetails.employeeDetail.beneficiaries.forEach(function(e){u.push(e.relationName)}),p.forEach(function(e){u.includes(e)||s.primaryRelationArray.push(e)})),l&&l.userDetails&&(s.enableRelation=o.enableAddRelation.includes(l.userDetails.pmEntityId)),s.isMobileView=e.isMobileView;var m;d(),s.gender={M:"Male",F:"Female"},s.disableGender=!1,s.genderChage=function(){s.disableGender=!1,s.userInfo.gender="";var e=["Brother","Father","Son","Husband"],a=["Mother","Sister","Daughter"];e.includes(s.userInfo.relationName)?(s.disableGender=!0,s.userInfo.gender="M"):a.includes(s.userInfo.relationName)&&(s.disableGender=!0,s.userInfo.gender="F")},s.calenderDetails={isOpen:!1,dobOptions:{maxDate:new Date,minDate:new Date(1917,1,1)}},s.closeDialog=function(){$uibModalInstance.dismiss("cancel")},s.submitForm=function(e){if(s.errorMessage="",e){var a=t.copy(s.userInfo),o=["Brother","Father","Son"],n=["Mother","Sister","Daughter"];if(o.includes(a.relationName)&&"M"!=a.gender||n.includes(a.relationName)&&"F"!=a.gender)return void r({message:"Gender is incorrect as per the relation.",position:"center",duration:5e3});var c=i.addOnBenefs(a);c.then(function(e){s.isAhc?window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"ahc",name:"AHC Add Member CTA Clicked",payload:window._Site_Props.__getEventParameters({custom:{name:s.userInfo.name,dob:s.userInfo.dob,gender:s.userInfo.gender,Relationship:s.userInfo.relationName}})}):i.sendCleverTapEvent("Beneficiary Added",s.userInfo,!0),s.$emit("refreshPackageList",e),e.noMatch||(r({message:s.userInfo.name+" added as beneficiary",position:"center",duration:5e3}),e.packageAdded&&s.$emit("addToCart",e.packageAdded))})["catch"](function(e){e&&e.errorMessage&&(s.errorMessage=e.errorMessage)})}}}}}]),e.register.directive("addLabTest",["$rootScope","authService","corpWellnessService",function(e,a,t){return{restrict:"E",scope:{packageDetail:"=?",showDetails:"=?",showAddTests:"=?",index:"=?",isPopup:"=?",recommendTests:"=?"},templateUrl:"/corpWellness/directive/addLabTest.html?"+timeStamp,link:function(a,i,r){a.isMobileView=e.isMobileView,a.updateAddOn=function(e,i){i>-1?(a.packageDetail.labTestItems.splice(i,1),e.isSelected=!1,a.recommendTests.viewCount--):(a.packageDetail.labTestItems.push(e),e.isSelected=!0,a.recommendTests.viewCount++);var r=a.recommendTests.filterResult.findIndex(function(a){return a.packageId==e.packageId});a.recommendTests.filterResult[r].isSelected=e.isSelected;var o={packageName:e.packageName,providerName:e.dcName,providerCity:e.dcCity,providerLocation:e.dcLocation,price:e.price};e.isSelected?t.sendCleverTapEvent("Add AddOn",o,!0):t.sendCleverTapEvent("Remove AddOn",o,!0),a.packageDetail.showAddon=!_.isEmpty(a.packageDetail.labTestItems),a.packageDetail.isEdit||a.$emit("updateCartPrice")},a.recommendTests&&(a.recommendTests.viewCount=3+a.packageDetail.labTestItems.length,a.recommendTests.labTestItems&&_.each(a.recommendTests.labTestItems,function(e){e.isSelected=!!_.find(a.packageDetail.labTestItems,function(a){return a.packageId==e.packageId})})),a.showAddTests||(a.packageDetail.showAddon=!0)}}}]),e.register.directive("hcCard",["$rootScope","authService","$state","corpWellnessService","apiProvider",function(e,a,t,i,r){return{restrict:"E",scope:{small:"=?",packageDetail:"=?",companyName:"=?",pipeline:"=?",checkout:"=?",hideHeader:"=?",dcPricing:"=?"},templateUrl:"/corpWellness/directive/hcCard.html?"+timeStamp,link:function(o,s,n){o.isMobileView=e.isMobileView,o.selectedCity=a.getCity(),o.userInfo=a.isUserSignedin(),o.emitPackage=function(){o.$emit("addToCart",o.packageDetail)},o.openDesc=function(e){e&&e.stopPropagation(),o.packageDetail.showDetails=!o.packageDetail.showDetails},o.checkoutPackage=function(e){e&&e.stopPropagation(),a.corporatePackages.packageDetail=o.packageDetail,i.sendCleverTapEvent("Buy Now",{packageId:o.packageDetail.packageId,visitType:o.packageDetail.isHomeSampleOnlyPackage?"HomeVisit":"LabsVisit",pincode:a.getPincode()?a.getPincode():"Other"}),a.corporatePackages.packageDetail.phleboEnable=!1,a.makeAjaxCalls(r.apiUrl+"GetProviderForPackage",{packageId:o.packageDetail.packageId},"POST","",o.selectedCity).then(function(e){if(e.data.isSuccess&&!_.isEmpty(e.data.providers)){a.corporatePackages.providers=e.data.providers;for(var r=0;r<a.corporatePackages.providers.length;r++){const s=a.corporatePackages.providers[r];"MediBuddy Phlebo Labs"==s.dcName&&(s.dcName="MediBuddyProvider")}a.corporatePackages.blockDates=_.groupBy(e.data.blockBookingDetails,"idNo"),a.corporatePackages.phleboIds=[],_.forEach(a.corporatePackages.providers,function(e){"MediBuddyProvider"==e.dcName&&0!=e.providerId&&(a.corporatePackages.packageDetail.phleboEnable=!0,a.corporatePackages.phleboIds.push(e.providerId))}),a.corporatePackages.packageDetail.phleboEnable?(i.sendCleverTapEvent("UCP Instant Checkout"),t.go("app.checkout",{packageId:o.packageDetail.packageId})):i.getProviderSlots(o.packageDetail).then(function(e){t.go("app.checkout",{packageId:o.packageDetail.packageId})})}})},o.$on("$destroy",function(){o.packageDetail.showDetails=!1})}}}]),e.register.directive("priceBreakup",["$rootScope","navConstantsSvc",function(e,a){return{restrict:"E",scope:{packageList:"=?",packageDetail:"=?",finalPayment:"=?",hideName:"=?",homeSample:"=?",wallet:"=?",couponValue:"=?",totalAmount:"=?",dcPricing:"=?",selectedProvider:"=?",priceFetched:"=?"},templateUrl:"/corpWellness/directive/priceBreakup.html?"+timeStamp,link:function(t,i,r){t.isMobileView=e.isMobileView,t.homeSamplePackage=a.homeSamplePackage}}}])})}();