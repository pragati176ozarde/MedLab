!function(){"use strict";define(["_routes","utility"],function(e,t){e.register.controller("corpBenefitsController",["$scope","authService","$rootScope","$window","$sce","navConstantsSvc","apiProvider","localStorageService","$state","$timeout","standardEventsSvc",function(e,a,n,l,i,o,s,c,d,r,u){function f(e){if(e.data){if(e.data.eventName&&e.data.eventBody){console.log("sending iframe event for : "+e.data.eventName.toString());try{window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"fintech",name:e.data.eventName,payload:window._Site_Props.__getEventParameters({custom:e.data.eventBody})});const t=e.data.eventBody.ContractName;["MP_CONSULTATION","MP_DENTAL"].includes(t)&&window._MB_Analytics.__push({name:u.OFC_ICON_CLICKED.name,schema:u.OFC_ICON_CLICKED.schema,payload:window._Site_Props.__getEventParameters({custom:e.data.eventBody})})}catch(n){console.log("error sending analytics event from wallet benefits UI")}}if(e.data.openLink){var l="";"longToken"===e.data.tokenType?l+=a.getUserObj().encryptedToken:"shortToken"===e.data.tokenType&&(l+=a.getUserObj().token),window.open(e.data.openLink+l)}}}function m(){document.cookie="shortToken="+e.userAuth.token+";domain="+t.getCookieDomain()+";path=/;",0==e.unifiedBenefitsUrl.length&&(e.unifiedBenefitsUrl=i.trustAsResourceUrl("https://www.medibuddy.in/unifiedcheckout/benefits/"+e.userAuth.userDetails.pmEntityID+"?authToken="+e.userAuth.encryptedToken+"&click_source=WalletIconClick")),e.wallets=a.walletDetails?a.walletDetails.length:0,0===e.wallets?e.noWallet=!0:(e.walletInfo=a.walletDetails,_.each(a.walletDetails,function(t){e.totalBalance+=t.balance?t.balance:0,"corpwallet"===t.walletName.toLowerCase()||"mawallet"===t.walletName.toLowerCase()?(e.corpWalletBalance+=t.balance?t.balance:0,"MAWallet"===t.walletName&&t.showRetryWallet&&(e.noWallet=!0)):e.buddyCoinBalance+=t.balance?t.balance:0}))}l.scrollTo(0,0),e.hideWalletBalance=n.hideWalletBalance,l.addEventListener("message",f);var w=this;e.conditionCallFired=!1,e.unifiedBenefitsUrl="";var h=a.isUserSignedin();e.isMobileView=n.isMobileView,e.userAuth=a.isUserSignedin(),e.isReimbursementButton=h.isReimbursementButton,e.appNameReimbursement=c.get("utm_appname"),e.totalBalance=0,e.buddyCoinBalance=0,e.corpWalletBalance=0,e.walletInfo=[],e.noWallet=!1,e.customeUrl="",e.redirectToHelpState=function(){window.location.assign("https://faq.medibuddy.in/?utm_source=medibuddywebfaq&type=general&accessToken="+h.token)},e.cancelDialog=function(){l.removeEventListener("message",f),this.$dismiss(),window.location.href.includes("walletInfo")&&(window.location.href="/")},e.init=function(){a.makeAjaxCalls("https://unified-checkout-frontend.medibuddy.in/unifiedcheckout/benefits/getCustomUrl","","GET",e.userAuth.token).then(function(t){t.data&&t.data.customizedBenefitsUrl&&(t.data.customizedBenefitsUrl.includes("?")?e.unifiedBenefitsUrl=i.trustAsResourceUrl(t.data.customizedBenefitsUrl+"&click_source=WalletIconClick"):e.unifiedBenefitsUrl=i.trustAsResourceUrl(t.data.customizedBenefitsUrl+"?click_source=WalletIconClick")),m()})["catch"](function(e){console.log(e),m()})},e.walletSelection=function(t){e.selectedWallet=_.findWhere(a.walletDetails,{walletName:t}),!e.selectedWallet||!e.selectedWallet.balanceDetail||e.selectedWallet&&e.selectedWallet.balanceDetail&&e.selectedWallet.balanceDetail.policies&&1===e.selectedWallet.balanceDetail.policies.length&&e.selectedWallet.balanceDetail.polDetails&&1===e.selectedWallet.balanceDetail.polDetails.length?w.showBenefDetails=!1:w.showBenefDetails=!0,e.mawalletFailed&&(w.showBenefDetails=!0)},e.init(),n.$on("hideWalletBalanceEvent",function(){e.hideWalletBalance=n.hideWalletBalance});var p=n.$on("walletConfigLoaded",function(){e.init()}),B=n.$on("showWalletInfo",function(){r(function(){e.init()})});n.$on("$destroy",function(){B(),p()})}])})}();