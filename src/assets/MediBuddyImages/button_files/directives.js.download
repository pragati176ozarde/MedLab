!function(){"use strict";define(["_routes","utility"],function(e,t){e.register.directive("downloadAppLink",["$rootScope","$window",function(e,t){return{restrict:"E",scope:{isMobileView:"=",mobileImgHeight:"=",webImgHeight:"=",section:"="},template:'<a class="m-r-5" ng-click="appRedirect()" rel="noopener" aria-label="Android">            <img src="/assets/images/android.png" height="{{isMobileView ? mobileImgHeight : webImgHeight}}" class="android popout" alt="Download Android App" style="transition: transform 0.3s ease;"/>          </a>          <a class="m-l-5" ng-click="appRedirect(true)" rel="noopener" aria-label="IOS">            <img src="/assets/images/ios.png" height="{{isMobileView ? mobileImgHeight : webImgHeight}}" class="ios popout" alt="Download IOS App" style="transition: transform 0.3s ease;"/>          </a>',link:function(a,i,o){a.section=a.section||"FirstFold",a.appRedirect=function(i){var o="https://tfgsu.app.link/MBSite?~channel="+t.location.href+"&~feature=MBSite&~campaign="+a.section+"&~tags=MBSite";e.isWebView?t.open(o,"_blank"):t.open(i?"https://itunes.apple.com/us/app/medibuddy/id946666981?ls=1&mt=8":"https://play.google.com/store/apps/details?id=in.medibuddy&hl=en","_blank")}}}}]),e.register.directive("marketApiMasking",["$rootScope",function(e){return{restrict:"AE",scope:{loadingMsg:"=?"},template:'<div class="form-loading" ng-if="loading"><span>Processing, please wait!<img src="/assets/gif/loader.gif" alt=""/><hr ng-if="loadingMsg"><div class="loading-msg" ng-if="loadingMsg"><p>{{loadingMsg[showIndex]}}</p></div></span></div>',link:function(t,a,i){t.showIndex=0;var o=e.$on("cfpLoadingBar:loading",function(){t.loadingMsg&&t.loadingMsg.length>1&&(t.showIndex=Math.floor(Math.random()*t.loadingMsg.length)),t.loading=!0}),n=e.$on("cfpLoadingBar:completed",function(){t.loading=!1});e.$on("$destroy",function(){n(),o()})}}}]),e.register.directive("notifyMsg",["$rootScope","$uibModal","$interval","localStorageService",function(e,t,a,i){return{restrict:"AE",scope:{msg:"=?",timer:"=?",always:"=?",normalText:"=?"},template:'<div ng-if="!isMobileView && msg && (!notificationViewed || always)" class="alert-lg alert-warning m-t-10 m-b-0 text-center" uib-alert close="closeAlert()"><button class="close m-r-5 no-pointers"><span ng-if="dismissTimer && !timer" aria-hidden="true">{{dismissTimer}}</span></button><strong>{{msg}}</strong></div>',link:function(o,n,s){function r(){i.setStorageType("sessionStorage"),i.set("notificationViewed",JSON.stringify(!0)),i.setStorageType("localStorage")}!o.normalText&&n&&n[0]&&n[0].classList.add("mdTxt"),o.dismissTimer=20;var l,c;o.isMobileView=e.isMobileView,o.closeAlert=function(){o.msg="",a.cancel(l),o.isMobileView&&c?(c.dismiss("cancel"),c=null):r()},i.setStorageType("sessionStorage"),o.notificationViewed=i.get("notificationViewed"),i.setStorageType("localStorage"),o.notificationViewed&&!o.always||(o.timer||(l=a(function(){1===o.dismissTimer?o.closeAlert():o.dismissTimer--},1e3)),e.isMobileView&&(c=t.open({animation:!0,scope:o,backdrop:"none",template:'<div class="modal-bottom-header modal-header p-l-10 p-r-10"><div class="br-10 alert-lg alert-warning m-0 justify-text" uib-alert close="cancelDialog()"><button class="close m-r-5 no-pointers"><span ng-if="dismissTimer && !timer" aria-hidden="true">{{dismissTimer}}</span></button><strong>{{msg}}</strong></div></div>',controller:["$scope","$uibModalInstance",function(e,t){e.cancelDialog=function(){t.dismiss("cancel"),c=null,r()}}],size:"bottom",windowClass:"bottom-sheet"}),c.closed.then(function(){r(),a.cancel(l)}))),o.$on("$destroy",function(){l&&a.cancel(l)})}}}]),e.register.directive("checkConnection",["$rootScope","$window","$timeout",function(e,t,a){return{restrict:"AE",template:'<div class="note-header" ng-if="connectionText">{{connectionText}}</div>',link:function(e,i,o){e.connectionText="",e.isOnline=function(){a(function(){t.navigator.onLine?e.connectionText="":e.connectionText="No network connection. Please try after some time."},0)},e.isOnline(),t.addEventListener("online",e.isOnline),t.addEventListener("offline",e.isOnline)}}}]),e.register.directive("ratingStar",["$rootScope","navConstantsSvc",function(e,t){return{restrict:"AE",scope:{stars:"=?",action:"=?",size:"=?",spacing:"=?"},template:'<div class="rating star {{ratingClass}}" ng-class="{\'no-pointers\':!action,\'cursor-pointer\':action,\'lg m-t-15\':large,\'xl m-t-15\':xtraLarge}"><span ng-class="{\'m-l-10\':spacing}" ng-repeat="each in scale" ng-mouseenter="onHover(each)" ng-mouseleave="onLeave()" ng-click="onClick(each)"></span></div>',link:function(e,a,i){e.activeStars=t.ratingStarClasses[e.stars]?t.ratingStarClasses[e.stars]:t.ratingStarClasses[1],e.action&&(e.activeStars="outline"),"lg"==e.size?e.large=!0:"xl"==e.size&&(e.xtraLarge=!0),e.ratingClass=e.activeStars,e.scale=[1,2,3,4,5],e.onHover=function(a){e.ratingClass=t.ratingStarClasses[a]},e.onLeave=function(){e.ratingClass=e.activeStars},e.onClick=function(a){e.activeStars=t.ratingStarClasses[a],e.$emit("starsSelected",a)}}}}]),e.register.directive("shareIt",["$rootScope","navConstantsSvc","$stateParams","authService","notify",function(e,t,a,i,o){return{restrict:"AE",scope:{shareObj:"=obj",openDefault:"=opendefault"},template:'<div ng-class="openDefault? \'share-open-default\' : \'\'">                            <span class="icon share-icon-button"><img src="assets/icons/share.svg" alt=""/></span>                            <span class="group">                                <span class="icon" uib-tooltip="Share with facebook" ng-if="!fbNotEnabled"> <img src="assets/icons/facebook.svg" ng-click="facebookShare()" alt=""/> </span>                                <span class="icon" uib-tooltip="Share with twitter"> <img src="assets/icons/twitter.svg" ng-click="twitterShare()" alt=""/> </span>                                <span class="icon" uib-tooltip="Share with whatsapp"> <img src="assets/icons/whatsapp.svg" ng-click="whatsappShare()" alt=""/> </span>                                <span class="icon" uib-tooltip="Share with email"> <img src="assets/icons/email.svg" ng-click="mailShare()"> </span>                                <span class="icon" uib-tooltip="Copy to clipboard"> <img src="assets/icons/copy.svg" ng-click="copyToClipboard()" alt=""/> </span>                            </span>                        </div>',link:function(e,t,n){e.fbNotEnabled=i.FbNotEnabled,e.getPackageShareData=function(t){switch(t){case"email":return{shareMailSubject:"Today's The Day You Do Something For Your Health",shareText:"Promote prevention and Safeguard your health.\n\nCheck out "+e.shareObj.packageName+" on MediBuddy\n",shareLink:e.shareLink};case"facebook":return{shareMailSubject:"Here's The One Thing You Need",shareText:"Check "+e.shareObj.packageName+" on MediBuddy",shareLink:e.shareLink,caption:e.shareObj.dcName};case"twitter":return{shareText:"Here's The One Thing You Need \nCheck "+e.shareObj.packageName+" on MediBuddy",shareLink:e.shareLink};case"whatsapp":return{shareText:"This is definitely worth 5 minutes of your time. Thank me later.\n\nCheck "+e.shareObj.packageName+" on MediBuddy \n",shareLink:e.shareLink};case"clipboard":return{copyText:e.shareLink};default:return{shareLink:e.shareObj.shareLink,shareMailSubject:e.shareObj.shareMailSubject,copyText:e.shareObj.copyText,shareText:e.shareObj.shareText}}},e.getShareLink=function(){e.categoryId=i.checkSeriveType[a.categoryItemTypeId],e.shareLink=window.location.origin+"/product/"+(e.categoryId?e.categoryId:"")+"/"+(a.searchk?a.searchk:"")+"/"+(a.searchc?a.searchc:"")+"/"+e.shareObj.packageId+"/"+(a.dcId?"?dcId="+a.dcId:"")},e.facebookShare=function(){try{var t;e.shareObj.packageId?(t=e.getPackageShareData("facebook"),window._Site_Props.__setPackageDetails({packageName:e.shareObj.packageName,providerName:e.shareObj.dcName,providerLocation:e.shareObj.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Facebook Share",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Share","Facebook",e.shareObj.packageName+" by "+e.shareObj.dcName)})})):(t=e.getPackageShareData(),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Facebook Share",payload:window._Site_Props.__getEventParameters({service:!0,custom:{shareType:e.shareObj.shareType},google:window._Site_Props.__googleTransform("Share","Facebook",e.shareObj.shareType)})})),FB.ui({method:"share_open_graph",app_id:"198628023814821",action_type:"og.shares",display:"popup",action_properties:JSON.stringify({object:{"og:url":t.shareLink,"og:title":t.shareMailSubject,"og:description":t.shareText}})})}catch(a){o({message:"Facebook access is denied",position:"center",duration:2e3})}},e.twitterShare=function(){var t;e.shareObj.packageId?(t=e.getPackageShareData("twitter"),window._Site_Props.__setPackageDetails({packageName:e.shareObj.packageName,providerName:e.shareObj.dcName,providerLocation:e.shareObj.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Twitter Share",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Share","Twitter",e.shareObj.packageName+" by "+e.shareObj.dcName)})})):(t=e.getPackageShareData(),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Twitter Share",payload:window._Site_Props.__getEventParameters({service:!0,custom:{shareType:e.shareObj.shareType},google:window._Site_Props.__googleTransform("Share","Twitter",e.shareObj.shareType)})}));var a={url:t.shareLink,text:t.shareText,hashtags:"MediBuddy"},i="http://twitter.com/share?";for(var o in a)i+="&"+o+"="+encodeURIComponent(a[o]);window.open(i)},e.whatsappShare=function(){var t;e.shareObj.packageId?(t=e.getPackageShareData("whatsapp"),window._Site_Props.__setPackageDetails({packageName:e.shareObj.packageName,providerName:e.shareObj.dcName,providerLocation:e.shareObj.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Whatsapp Share",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Share","Whatsapp",e.shareObj.packageName+" by "+e.shareObj.dcName)})})):(t=e.getPackageShareData(),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Whatsapp Share",payload:window._Site_Props.__getEventParameters({service:!0,custom:{shareType:e.shareObj.shareType},google:window._Site_Props.__googleTransform("Share","Whatsapp",e.shareObj.shareType)})}));var a=t.shareText+t.shareLink,i="https://api.whatsapp.com/send?text="+encodeURIComponent(a);window.open(i)},e.mailShare=function(){var t;e.shareObj.packageId?(t=e.getPackageShareData("email"),window._Site_Props.__setPackageDetails({packageName:e.shareObj.packageName,providerName:e.shareObj.dcName,providerLocation:e.shareObj.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Email Share",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Share","Email",e.shareObj.packageName+" by "+e.shareObj.dcName)})})):(t=e.getPackageShareData(),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Email Share",payload:window._Site_Props.__getEventParameters({service:!0,custom:{shareType:e.shareObj.shareType},google:window._Site_Props.__googleTransform("Share","Email",e.shareObj.shareType)})}));var a="mailto:?Subject=",i=encodeURI(t.shareMailSubject),o=encodeURI(t.shareText+t.shareLink);a+=i+"&Body="+o,window.open(a)},e.copyToClipboard=function(){var t;e.shareObj.packageId?(t=e.getPackageShareData("clipboard"),window._Site_Props.__setPackageDetails({packageName:e.shareObj.packageName,providerName:e.shareObj.dcName,providerLocation:e.shareObj.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Copy to Clipboard",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Share","Clipboard",e.shareObj.packageName+" by "+e.shareObj.dcName)})})):(t=e.getPackageShareData(),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Copy to Clipboard",payload:window._Site_Props.__getEventParameters({service:!0,custom:{shareType:e.shareObj.shareType},google:window._Site_Props.__googleTransform("Share","Clipboard",e.shareObj.shareType)})}));var a=document.createElement("textarea");a.value=t.copyText,a.setAttribute("readonly",""),a.style.position="absolute",a.style.left="-9999px",document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),o({message:"Copied to clipboard",position:"center",duration:2e3})},!_.isEmpty(e.shareObj)&&e.shareObj.packageId&&e.getShareLink()}}}]),e.register.directive("focusElement",["$rootScope",function(e){return{restrict:"AE",link:function(e,t,a){t[0].focus()}}}]),e.register.directive("dynamicContentLoad",["$rootScope","$window","$timeout","$document",function(e,t,a,i){return{link:function(e,a,o){var n=a[0];angular.element(i)[0].body,e.debounchFunction=function(){t.pageYOffset+t.innerHeight>n.offsetHeight+100&&e.$apply(o.dynamicContentLoad)},i.bind("scroll",e.debounchFunction)}}}]),e.register.directive("labelText",["$rootScope","$window","$timeout","$document",function(e,t,a,i){return{restrict:"A",link:function(e,t,a){t.bind("focus",function(){t.parent().addClass("active completed"),t.addClass("active completed")}),t.bind("blur",function(){""===t.val()&&(t.parent().removeClass("completed"),t.parent().removeClass("active"))})}}}]),e.register.directive("sponserPackage",["$rootScope","$compile","$timeout","$stateParams","authService","apiProvider","$sce","navConstantsSvc","$state",function(e,t,a,i,o,n,s,r,l){return{restrict:"AE",scope:{ctrlData:"=bind",ageRangeValue:"=?",genderFilter:"=genderFilter",hsc:"=?",pipeline:"=?",isMobileView:"=?"},template:'<div ng-show="allAhcPackageList.length>0">                    <div class="result-box col-sm-12 col-xs-12 corp-hc-banner" ng-if="!isBookingAllowed">                    <span class="label label-info">Corporate Specific</span>                    <div class="col-sm-2" ng-if="!isMobileView">                        <img id="imghealthCheck" src="/assets/images/wellness_bg.png" alt="" height="100"/>                    </div>                    <div class="col-sm-8 col-xs-8" ng-class="{\'p-l-0 p-r-0\':isMobileView}">                        <div class="bold m-b-10 heading-color lgTxt" ng-if="!isMobileView">Congratulations !!</div>                        <div ng-class="{\'mdTxt\':!isMobileView}">You are eligible to avail Health Check benefits provided by your corporate.</div>                    </div>                    <div class="col-sm-2 col-xs-4 text-center">                        <button class="btn btn-default light-bold br-5" ng-click="redirectToCorpBenefits()" ng-class="{\'p-l-20 p-r-20 m-t-30\':!isMobileView,\'m-t-10\':isMobileView}">Continue</button>                    </div>                  </div>                  <div  ng-repeat="data in allAhcPackageList track by $index" ng-if="isBookingAllowed">                  <div class="result-box corp p-0" ng-class="{\'offer\':isMobileView,\'m-0\':showHideSponserPackage}" style="margin-bottom: {{showHideSponserPackage?0:30}}px!important">                    <div class="clearfix ahc-package-container" ng-if="!isMobileView">                        <span ng-if="data.priceStartFrom > 1">Corporate Specific</span>                        <span ng-if="data.priceStartFrom == 0">Corporate Sponsored</span>                        &emsp;&nbsp;<label>{{data.sponserPackageDetails.length}} Providers are serving this package</label>                    </div>                    <div class="row box" ng-if="isMobileView">                    <div class="col-xs-12 provider">                        <div class="disc">                        <b ng-click="fetchDetails(data.provider)" class="product-name">{{data.provider.packageName}}</b>                        <div class="col-xs-6 p-l-0 m-b-10">                        <p><b style="margin-left:0;">Tests: {{:: data.provider.packageTestCount}}</b><b style="margin-left:0;" ng-if="data.provider.packageConsultationCount &gt; 0">, Consultations: {{:: data.provider.packageConsultationCount}} </b></p>                        <p>by<b><span ng-if="!nextDayFilter && data.sponserTempPackageDetails.length">{{data.sponserTempPackageDetails.length}}</span><span ng-if="nextDayFilter">{{autoBookSlots.length}}</span> Providers</b></p>                        <p><i class="mm mm-map-marker"></i>{{cityName}}</p>                        </div>                        <div class="col-xs-6 p-r-0 text-right">                        <a class="btn btn-default btn-sm outline-primary" ng-click="fetchDetails(data.provider)">{{data.provider.detailsClicked?"Hide":"Show"}}&nbsp;Details</a>                        </div>                        <span class="label label-info label-offer" ng-if="data.priceStartFrom > 1">Corporate Specific</span>                        <span class="label label-info label-offer" ng-if="data.priceStartFrom == 0">Corporate Sponsored</span>                        <a ng-if="!data.showHideSponserPackage" ng-click="showHideSponserPackageFunc(data)" class="btn btn-primary btn-booking">Show Providers</a>                        <a ng-if="data.showHideSponserPackage" ng-click="hideSponserPackageFunc(data)" class="btn btn-primary btn-booking">Hide Providers</a>                        </div>                    </div>                    </div>                    <div class="row box" ng-if="!isMobileView">                      <div class="col-xs-6 provider">                        <div class="disc"><b ng-click="fetchDetails(data.provider)" class="product-name">{{data.provider.packageName}}</b>                          <p>by<b><span ng-if="!nextDayFilter && data.sponserTempPackageDetails.length">{{data.sponserTempPackageDetails.length}}</span><span ng-if="nextDayFilter">{{autoBookSlots.length}}</span> Providers</b><span class="product-location"><i class="mm mm-map-marker"></i>{{cityName}}</span></p>                        </div>                      </div>                      <div class="col-xs-3 p-l-0 p-r-0 extra text-center">                        <div class="btn-group btn-product-details" ng-click="fetchDetails(data.provider)">                          <div style="float:left">{{data.provider.packageTestCount}}<span>Tests</span></div>                          <div style="float:right"><b ng-if="data.provider.packageConsultationCount &gt; 0">{{:: data.provider.packageConsultationCount}}</b><span ng-if="data.provider.packageConsultationCount === 0">No</span><span> Consult(s)</span></div>                          <div class="details">Details<i class="mm mm-chevron-down"></i></div>                        </div>                      </div>                      <div class="col-xs-3 book">        \t\t\t\t<div class="price pull-right">        \t\t\t\t\t<span ng-if="data.priceStartFrom > 0"> <span ng-if="data.totalDifferedPrice > 1" style="color: #666;font-size: 12px;">Start From </span> <i class="mm mm-rupee"></i> {{data.priceStartFrom}}</span>        \t\t\t\t</div>                        <a ng-show="!data.showHideSponserPackage" ng-click="showHideSponserPackageFunc(data)" class="btn btn-primary btn-booking">Show Providers</a>                        <a ng-show="data.showHideSponserPackage" ng-click="hideSponserPackageFunc(data)" class="btn btn-primary btn-booking">Hide Providers</a>                      </div>                    </div>                    <div ng-show="data.provider.detailsClicked || (detailsClicked &amp;&amp; data.provider.packageId === clickPackageId)" class="detailswraper" ng-class="{\'no-animate\':isMobileView}"><a ng-click="closeDetails()" class="closeBtn"><i class="mm mm-close"></i></a>                      <div ng-if="data.homeSampleCollection" style="width: 250px; margin-top: 6px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-right hscAwail"><i style="width:30px; height:30px;" class="img-icon icon-hsc pull-left"></i>Home Sample Collection Available</div>                      <uib-tabset>                        <uib-tab index="0" heading="Description">                          <div class="row">                            <div class="col-sm-5 tests">                              <ul>                                <li tooltip-placement="top" uib-tooltip="{{consultationInnerTest}}"><b>Consultation(s)<span ng-if="dc.packageConsultationCount &gt; 0">{{dc.packageConsultationCount}}</span><span ng-if="dc.packageConsultationCount === 0">_</span></b></li>                              </ul>                              <ul>                                <li><b>Tests<span>{{nonConsultationTestCount}}</span></b></li>                                <li ng-repeat="test in nonConsultationTest" tooltip-placement="top" tooltip-class="tt-test" uib-tooltip="{{test.innerTests}}" class="smTxt">{{test.name}}<span>{{test.count}}</span></li>                              </ul>                            </div>                            <div class="col-sm-7">                              <div style="padding:10px 0" class="clearfix">                                <div ng-if="data.minAge || data.maxAge" style="margin-right: 5px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left">                                  Age Range:                                  &nbsp;<span ng-if="data.minAge &lt; 60">{{data.minAge}} - {{data.maxAge}}</span><span ng-if="data.minAge &gt; 59">{{data.minAge}} +</span>                                </div>                                <div style="line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left"><span ng-if="data.genderType === \'F\'"> Female Specific Package </span> </div>                              </div>                              <div ng-bind-html="packageDescription" class="smTxt"></div>                            </div>                          </div>                        </uib-tab>                        <uib-tab index="1" ng-if="packageInstructions" heading="Instructions">                          <div ng-bind-html="packageInstructions" line-height:14px;="line-height:14px;" class="smTxt"></div>                        </uib-tab>                      </uib-tabset>                    </div>                  </div>                  <div class="clearfix m-b-30" ng-if="data.showHideSponserPackage && showHideSponserPackageList.length">                    <provider-selection selected-package="selectedPackage" dc-list="showHideSponserPackageList" pipeline="pipeline" checkout="false" provider-slots="providerSlots" all-ahc-package-list="allAhcPackageList" old-corporate-flow="true"></provider-selection>                    </div>                  </div>                  </div>',link:function(t,a,c){t.closeDetails=function(){t.clickPackageId=""},t.detailsClicked=!1,t.ageRangeValue={maxAge:100,minAge:0,isTrue:!1},t.genderFilter={type:"both",isTrue:!1},t.$on("closeSlot",function(e){t.clickPackageId=""}),t.fetchDetails=function(e){if(t.bookClicked=!1,t.isMobileView?(e.detailsClicked=!e.detailsClicked,e.bookClicked=!1):t.detailsClicked=!t.detailsClicked,t.clickPackageId=e.packageId,t.detailsClicked||e.detailsClicked){var a="/showDcDetails"+e.packageId+"/"+e.packageName;window._Site_Props.__setPackageDetails({packageName:e.packageName,providerName:e.dcName,providerLocation:e.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"show Dc Detail",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("AHC","showDcDetail",e.packageName+" by "+e.dcName)})}),(new Date).getTime(),a=n.apiUrl+"/PackageDetails/"+e.packageId,t.consultationTest=[],t.consultationTestCount=0,t.nonConsultationTest=[],t.nonConsultationTestCount=0,o.makeAjaxCalls(a,"","GET").then(function(e){e.data.packageDetail&&(t.packageDetail=e.data.packageDetail,t.packageDetail.packageTests&&_.each(t.packageDetail.packageTests.testGroups,function(e,a){var i="";"Consultation"===e.name?(_.each(e.tests,function(e,t){i+=e.name+", "}),t.consultationInnerTest=i.slice(0,i.length-2),t.consultationTest.push(e),t.consultationTestCount+=e.count):(_.each(e.tests,function(e,t){i+=e.name+", "}),e.innerTests=i.slice(0,i.length-2),t.nonConsultationTest.push(e),t.nonConsultationTestCount+=e.count)}),t.packageDescription=s.trustAsHtml(t.packageDetail.description),t.packageInstructions=s.trustAsHtml(t.packageDetail.instruction))})}},t.hideSponserPackageFunc=function(e){window._Site_Props.__setPackageDetails({packageName:t.selectedPackage.packageName}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"AHC Hide Providers",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{companyName:t.user.corpDetails.employeeDetail.companyName}})}),t.selectedPackage=[],e.showHideSponserPackage=!1,t.showHideSponserPackageListPackageId=""},t.showHideSponserPackageFunc=function(e){t.selectedPackage=e.provider,e.showHideSponserPackage=!0,e.showHideSponserPackage?(t.showHideSponserPackageList=e.sponserTempPackageDetails,t.showHideSponserPackageListPackageId=e.provider.packageId,window._Site_Props.__setPackageDetails({packageName:t.selectedPackage.packageName}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"AHC Show Providers",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{companyName:t.user.corpDetails.employeeDetail.companyName}})})):(t.showHideSponserPackageListPackageId="",t.showHideSponserPackageList=[])},t.returnTime=function(e){var t=o.getTimeFormate(e);return t},t.$on("changeCity",function(e,a){t.getAhcPackage()});var d=e.$on("userDetails",function(e,a){t.getAhcPackage()}),p=(e.$on("userLogout",function(e,a){t.allAhcPackageList=[],t.providerSlots=[]}),e.$on("filterAHCItems",function(e,a){t.allAhcPackageList=angular.copy(t.tempallAhcPackageList),a.Provider.length>0&&a.Location.length>0?(t.allAhcPackageList=t.filterByProvider(t.allAhcPackageList,a.Provider),t.allAhcPackageList=t.filterByLocation(t.allAhcPackageList,a.Location,!0)):a.Provider.length>0?t.allAhcPackageList=t.filterByProvider(t.allAhcPackageList,a.Provider):a.Location.length>0&&(t.allAhcPackageList=t.filterByLocation(t.allAhcPackageList,a.Location,!1)),_.each(t.allAhcPackageList,function(e,a){e.provider.packageId==t.showHideSponserPackageListPackageId&&(t.showHideSponserPackageList=e.sponserTempPackageDetails,t.sponsored.fetchSlotInfo(!0))})}));t.filterByProvider=function(e,t){return _.each(e,function(a,i){a.sponserTempPackageDetails=[],_.each(a.sponserPackageDetails,function(e,i){_.each(t,function(t,i){e.dcName.toLowerCase().indexOf(t.dcName.toLowerCase())>=0&&a.sponserTempPackageDetails.push(e)})}),0===a.sponserTempPackageDetails.length&&(e=_.difference(e,a))}),e},t.filterByLocation=function(e,t,a){return a?_.each(e,function(a,i){_.each(a.sponserTempPackageDetails,function(e,i){var o=!1;_.each(t,function(t,a){e.dcLocation.toLowerCase()===t.dcLocation.toLowerCase()&&(o=!0)}),o||(a.sponserTempPackageDetails=_.difference(a.sponserTempPackageDetails,e))}),0===a.sponserTempPackageDetails.length&&(e=_.difference(e,a))}):_.each(e,function(a,i){a.sponserTempPackageDetails=[],_.each(a.sponserPackageDetails,function(e,i){_.each(t,function(t,i){e.dcLocation.toLowerCase()===t.dcLocation.toLowerCase()&&a.sponserTempPackageDetails.push(e)})}),0===a.sponserTempPackageDetails.length&&(e=_.difference(e,a))}),e},t.getAhcPackage=function(){if(t.user=o.isUserSignedin(),t.user&&i.searchc&&("preventive"===i.searchc.toLowerCase()||"master"===i.searchc.toLowerCase()||"executive"===i.searchc.toLowerCase())){t.allAhcPackageList=[],t.providerSlots=[];var e=n.apiUrl+"AHC/GetPackage.json";t.cityName=o.getCity();var a=-1;o.makeAjaxCalls(e,{},"POST",t.user.token,t.cityName).then(function(e){if(t.allAhcPackageList=[],e.data.ahcPackages&&e.data.ahcPackages.length>0&&(_.each(e.data.ahcPackages,function(i,o){i.packageName.toLowerCase().indexOf("ahc")>-1&&(a=o),i.packageFilters&&i.packageFilters.length>0&&_.forEach(i.packageFilters,function(e,t){var a=e;if("gender"===a.substring(0,6).toLowerCase()){var o=a.split(":")[1];i.genderType=o}else if("maxage"===a.substring(0,6).toLowerCase()){var n=a.split(":")[1];i.maxAge=parseInt(n)}else if("minage"===a.substring(0,6).toLowerCase()){var s=a.split(":")[1];i.minAge=parseInt(s),i.minAge>59&&(i.maxAge=60)}else"homesamplecollection"===a.substring(0,20).toLowerCase()?i.homeSampleCollection=a.split(":")[1]?a.split(":")[1].toLowerCase():a.split(":")[1]:"priority"===a.substring(0,8).toLowerCase()?i.corpPriority=!0:"isgoldpartner"===a.substring(0,13).toLowerCase()?i.goldPartner=!0:(i.genderType||(i.genderType="both"),i.minAge=i.minAge>0?i.minAge:0,i.maxAge=i.maxAge>0?i.maxAge:59)}),t.tempAchPackage={},t.tempAchPackage.priceObj={},_.isEmpty(e.data.availableSlots)||(i.availableSlots=e.data.availableSlots),t.tempAchPackage.provider=i,t.tempAchPackage.genderType=i.genderType,t.tempAchPackage.minAge=i.minAge,t.tempAchPackage.maxAge=i.maxAge,t.providerSlots=e.data.providerSlots||[],t.tempAchPackage.sponserPackageDetails=i.providers,"updateFilters"in(t.pipeline||{})&&t.pipeline.updateFilters(t.tempAchPackage.sponserPackageDetails);var n=e.data.availableSlots;t.tempAchPackage.sponserTempPackageDetails=t.tempAchPackage.sponserPackageDetails,_.each(t.tempAchPackage.sponserPackageDetails,function(e,a){var o=n||i.availableSlots;_.isEmpty(o)||_.isEmpty(o[0].slots)||(t.tempAchPackage.priceObj[e.price]=0,e.slotStartTime=t.returnTime(o[0].slots[0].slotStartTime),e.slotEndTime=t.returnTime(o[0].slots[0].slotEndTime)),e.goldPartner=i.goldPartner||"",e.corpPriority=i.corpPriority||"",e.homeSampleCollection=i.homeSampleCollection||"",e.genderType=i.genderType,e.minAge=i.minAge,e.maxAge=i.maxAge,e.packageId=i.packageId,e.availableSlots=o,e.packageName=i.packageName,e.isAHC=!0,e.isSponser=0===e.price,e.contractId=r.ahcContract});var s=Object.keys(t.tempAchPackage.priceObj);s.length>1?(t.tempAchPackage.priceStartFrom=_.first(s.sort()),t.tempAchPackage.totalDifferedPrice=s.length):1===s.length?(t.tempAchPackage.priceStartFrom=_.first(s.sort()),t.tempAchPackage.totalDifferedPrice=s.length):(t.tempAchPackage.priceStartFrom=_.first(s.sort()),t.tempAchPackage.totalDifferedPrice=s.length),delete t.tempAchPackage.priceObj,t.allAhcPackageList.push(t.tempAchPackage),t.tempallAhcPackageList=t.allAhcPackageList}),a>0)){var i=t.allAhcPackageList.splice(a,1);t.allAhcPackageList.splice(0,0,_.first(i))}}),t.user&&t.user.corpConfig&&(t.isBookingAllowed=t.user.corpConfig.isBookingAllowed)}},e.$on("$destroy",function(){p(),d()}),t.getAhcPackage(),t.$watchGroup(["sponserPackageDetails"],function(e){t.tempCtrlData=[],e&&e&&(t.tempCtrlData=t.ctrlData,t.sponserPackageDetails&&t.sponserPackageDetails.length>0&&(t.tempCtrlData=_.union(t.tempCtrlData,t.sponserPackageDetails),_.isEmpty(_.difference(t.tempCtrlData,e))||(t.ctrlData=t.tempCtrlData)))}),t.redirectToCorpBenefits=function(){window._MB_Analytics.__push({isCleverTap:!0,name:"Redirect to UCP"}),l.go("app.corporate")}}}}]),e.register.directive("offeredPackage",["$rootScope","$compile","$timeout","$stateParams","authService","apiProvider","$sce","navConstantsSvc","$state","$window","$location",function(e,t,a,i,o,n,s,r,l,c,d){return{restrict:"AE",scope:{ctrlData:"=bind",corpids:"=?",blockData:"=blockdata",priceRangeValue:"=priceRangeValue",ageRangeValue:"=?",genderFilter:"=genderFilter",hsc:"=?",orderSelected:"=orderBy",isMobileView:"=?"},template:'<div ng-if="tempCtrlData.length &gt; 0" ng-repeat="dc in tempCtrlData|pricebetween:priceRangeValue.minPrice :priceRangeValue.maxPrice :priceRangeValue.isTrue |ageRange: ageRangeValue.minAge :ageRangeValue.maxAge : ageRangeValue.isTrue |gender: genderFilter |hscFilter: hsc.isSelected |orderBy:orderSelected track by dc.trackId" class="result-box"  ng-class="!dc.corpPriority ? \'offer\' : \'\'">            <div class="share hideSm" ng-if="!dc.corpPriority"> </div>            <div class="row box" ng-if="isMobileView">                <div class="col-xs-12 provider">                    <div class="logo">                        <div class="noLogo bg1">{{:: dc.dcName.charAt(0)}}</div>                    </div>                    <div class="disc">                        <a class="product-name" ng-click="bookSlotAfterValidation(dc)">{{:: dc.packageName}}</a>                        <div ng-class="{\'col-xs-9 p-l-0 p-r-0\':isMobileView}">                            <p><b style="margin-left:0;">Tests: {{:: dc.packageTestCount}}</b><b style="margin-left:0;" ng-if="dc.packageConsultationCount &gt; 0">, Consultations: {{:: dc.packageConsultationCount}} </b></p>                            <p>by<span ng-if="dc.providerRelativeUrl">&nbsp;<a href="{{dc.providerRelativeUrl}}">{{:: dc.dcName}}</a></span><b ng-if="!dc.providerRelativeUrl">{{:: dc.dcName}}</b></p>                            <p class="loaction">                                <span class="product-location" ng-hide="dc.homeSampleCollection"><i class="mm mm-map-marker"></i>{{:: dc.dcLocation}}</span>                                <span class="hsc" ng-show="dc.homeSampleCollection" title="A trained technician will visit your home to collect the samples"><i class="mm mm-sample"></i>&nbsp;Home Sample Collection</span>                            </p>                            <p><i class="mm mm-clock"></i>{{:: dc.slotStartTime}} - {{:: dc.slotEndTime}}</p>                            <span class="label label-info" ng-if="dc.corpPriority"> Exclusive </span>                            <span class="label label-info label-offer" ng-if="!dc.corpPriority"> Special Offer </span>                        </div>                        <div class="col-xs-3 p-l-0 p-r-0 text-right" ng-if="isMobileView">                            <div class="m-b-5 price" ng-if="dc.price >0"><b>&#x20B9;&nbsp;{{dc.price}}</b></div>                            <div class="m-b-5 price" ng-if="dc.priceRange > dc.price"><i class="mm mm-rupee"></i><strike>{{:: dc.priceRange}}</strike></div>                            <span class="discount" ng-if="dc.priceRange > dc.price">{{dc.discountPercent}}% OFF</span>                        </div>                        <div class="book" style="padding-left:0!important">                            <div ng-if="!isMobileView">                                <div class="clearfix">                                    <span class="discount"><span ng-if="(dc.priceRange &gt; dc.price)">{{dc.discountPercent}}% Off</span></span>                                    <span class="price pull-right"><b>&#x20B9;&nbsp;{{:: dc.price}}</b></span>                                </div>                                <div class="strike pull-right" ng-if="(dc.priceRange &gt; dc.price)"><i class="mm-rupee"></i> <strike>{{:: dc.priceRange}}</strike></div>                            </div>                            <a ng-click="bookSlotAfterValidation(dc)" class="btn btn-primary btn-booking" style="float: right">View Package<i class="mm mm-female" ng-if="dc.genderType == \'F\'"></i> <i class="mm mm-male" ng-if="dc.genderType == \'M\'"></i></a>                        </div>                    </div>                </div>            </div>            <div class="row box" ng-if="!isMobileView">                <div class="col-xs-6 provider">                  <div class="logo">                    <div class="noLogo bg1">{{:: dc.dcName.charAt(0)}}</div>                  </div>                  <div class="disc"><a class="product-name" ng-click="bookSlotAfterValidation(dc)">{{:: dc.packageName}}</a>                    <div ng-class="{\'col-xs-9 p-l-0 p-r-0\':isMobileView}">                        <p class="m-b-5">                            by<span ng-if="dc.providerRelativeUrl">&nbsp;<a href="{{dc.providerRelativeUrl}}" target="_blank">{{:: dc.dcName}}</a></span><b ng-if="!dc.providerRelativeUrl">{{:: dc.dcName}}</b>                            <span ng-if="dc.salePrice" class="m-l-10 discount"><span>{{dc.saleName}}</span></span>                        </p>                        <p class="loaction">                            <span class="product-location" ng-hide="dc.homeSampleCollection"><i class="mm mm-map-marker"></i>{{:: dc.dcLocation}}</span>                            <span class="hsc" ng-show="dc.homeSampleCollection" title="A trained technician will visit your home to collect the samples"><i class="mm mm-sample"></i>&nbsp;Home Sample Collection</span>                        </p>                        <span class="label label-info" ng-if="dc.corpPriority"> Exclusive </span>                        <span class="label label-info label-offer" ng-if="!dc.corpPriority"> Special Offer </span>                    </div>                    <div class="col-xs-3 p-l-0 p-r-0 text-right" ng-if="isMobileView">                        <div class="m-b-5 price" ng-if="dc.price >0"><b>&#x20B9;&nbsp;{{dc.price}}</b></div>                        <div class="m-b-5 price" ng-if="dc.priceRange > dc.price"><i class="mm mm-rupee"></i><strike>{{:: dc.priceRange}}</strike></div>                        <span class="discount" ng-if="dc.priceRange > dc.price">{{dc.discountPercent}}% OFF</span>                    </div>                  </div>                </div>                <div class="col-xs-3 p-l-0 p-r-0 extra text-center package-new-design">                  <div class="btn-group btn-product-details">                    <div style="float:left">{{:: dc.packageTestCount}}<span>Tests</span></div>                    <div style="float:right"><b ng-if="dc.packageConsultationCount &gt; 0">{{:: dc.packageConsultationCount}}</b><span ng-if="dc.packageConsultationCount === 0">No</span><span> Consult(s)</span></div>                  </div>                </div>                <div class="col-xs-3 book">                    <div ng-if="!isMobileView">                        <div class="clearfix">                            <span class="discount"><span ng-if="(dc.priceRange &gt; dc.price || dc.salePrice)">{{dc.salePrice ? "43" : dc.discountPercent}}% Off</span></span>                            <div class="price pull-right"><b>&#x20B9;&nbsp;{{:: dc.salePrice? dc.salePrice: dc.price}}</b></div>                        </div>                        <div ng-if="(dc.priceRange &gt; dc.price || dc.salePrice)" class="pull-right strike"><i class="mm-rupee"></i>                            <strike>{{:: dc.priceRange}}</strike>                        </div>                    </div>                    <a ng-click="bookSlotAfterValidation(dc)" class="btn btn-primary btn-booking"> View Package<i class="mm mm-female" ng-if="dc.genderType == \'F\'"></i> <i class="mm mm-male" ng-if="dc.genderType == \'M\'"></i></a>                </div>              </div>              <div ng-show="dc.detailsClicked || (detailsClicked &amp;&amp; dc.dcId === clickDCId &amp;&amp; dc.packageId === clickPackageId)" class="detailswraper"  ng-class="{\'no-animate\':isMobileView}"><a class="closeBtn"><i class="mm mm-close"></i></a>                <div ng-if="dc.homeSampleCollection" style="width: 250px; margin-top: 6px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-right"><i style="width:30px; height:30px;" class="img-icon icon-hsc pull-left"></i>Home Sample Collection Available</div>                <uib-tabset>                  <uib-tab index="0" heading="Description">                    <div class="row">                      <div class="col-sm-5 tests">                        <ul>                          <li tooltip-placement="top" uib-tooltip="{{dc.consultationInnerTest}}"><b>Consultation(s)<span ng-if="dc.packageConsultationCount &gt; 0">{{dc.packageConsultationCount}}</span><span ng-if="dc.packageConsultationCount === 0">_</span></b></li>                        </ul>                        <ul>                          <li><b>Tests<span>{{dc.nonConsultationTestCount}}</span></b></li>                          <li ng-repeat="test in dc.nonConsultationTest" tooltip-placement="top" tooltip-class="tt-test" uib-tooltip-template= "\'myTooltip.html\'" class="smTxt">{{test.name}}<span>{{test.count}}</span></li>                          <script type="text/ng-template" id="myTooltip.html">                            <ol class="test-list">                              <li ng-repeat="testinner in test.innerTests"> {{testinner}} </li>                            </ol>                          </script>                        </ul>                      </div>                      <div class="col-sm-7">                        <div class="clearfix">                          <div style="margin-right: 5px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left">                            Age Range:                            &nbsp;<span ng-if="dc.minAge &lt; 60">{{dc.minAge}} - {{dc.maxAge}}</span><span ng-if="dc.minAge &gt; 59">{{dc.minAge}} +</span>                          </div>                          <div style="line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left"><span ng-if="dc.genderType == \'F\'">Female Specific Package</span><span ng-if="dc.genderType == \'M\'">Male Specific Package</span></div>                        </div>                        <div ng-bind-html="dc.packageDescription" class="smTxt"></div>                      </div>                    </div>                  </uib-tab>                  <uib-tab index="1" heading="Instructions">                    <div ng-bind-html="dc.packageInstructions" line-height:14px;="line-height:14px;" class="smTxt"></div>                  </uib-tab>                </uib-tabset>              </div>              <div ng-if="dc.bookClicked || (bookClicked &amp;&amp; dc.dcId === clickDCId &amp;&amp; dc.packageId === clickPackageId)" class="detailswraper bookwraper"  ng-class="{\'no-animate\':isMobileView}"><a ng-click="bookSlotAfterValidation(dc)" class="closeBtn"><i class="mm mm-close"></i></a>                <div style="padding:10px 0" class="appointment-details">                  <medi-book-slot obj="dc" block-details="blockData" errormessage="errorMessage" pipeline="pipeline"></medi-book-slot>                </div>              </div>            </div>',
link:function(e,t,a){e.pipeline={},e.bookSlotAfterValidation=function(e){var t={packageName:e.packageName,vendorName:e.dcName,vendorLocation:e.dcLocation,visitType:"home sample collection"===e.homeSampleCollection?"home sample":"lab visit",itemSource:"VendorPackageListingPage",refUrl:c.location.href};window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"ChooseVendor",dbLog:"hc",hj:!0,payload:window._Site_Props.__getEventParameters({service:!0,"package":!1,custom:t})});var a=o.isUserSignedin(),s={packageId:e.packageId,searchc:i.searchc,city:i.city,categoryItemTypeId:i.categoryItemTypeId,coupon:i.coupon||"",dcId:e.dcId};if(a&&a.token){var d={sessionData:{},forceUpdate:!0};d.sessionData[r.healthCheckId]="",o.makeAjaxCalls(n.apiUrl+"/SessionStorage.json",d,"POST",a.token).then(function(e){l.go("app.packageDetail",s,{reload:"app.packageDetail"})})}else l.go("app.packageDetail",s,{reload:"app.packageDetail"})},e.getDetailViewUrl=function(e){return location.origin+"/product/"+i.categoryItemTypeId+"//"+i.searchc+"/"+e.packageId+(i.coupon?"/?coupon="+i.coupon:"/")},e.fetchDetails=function(t){if(e.bookClicked=!1,e.isMobileView?(t.detailsClicked=!t.detailsClicked,t.bookClicked=!1):e.detailsClicked=!e.detailsClicked,e.clickDCId=t.dcId,e.clickPackageId=t.packageId,e.detailsClicked||t.detailsClicked){var a="/showDcDetails"+t.packageId+"/"+t.packageName;window._Site_Props.__setPackageDetails({packageName:t.packageName,providerName:t.dcName,providerLocation:t.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"show Dc Detail",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Health Checks","showDcDetail",t.packageName+" by "+t.dcName)})}),(new Date).getTime(),t.description||(a=n.apiUrl+"/PackageDetails/"+t.packageId,t.consultationTest=[],t.consultationTestCount=0,t.nonConsultationTest=[],t.nonConsultationTestCount=0,o.makeAjaxCalls(a,"","GET").then(function(a){a.data.packageDetail&&(e.packageDetail=a.data.packageDetail,_.each(e.packageDetail.packageTests.testGroups,function(e,a){var i;"Consultation"===e.name?(i="",_.each(e.tests,function(e,t){i+=e.name+", "}),t.consultationInnerTest=i.slice(0,i.length-2),t.consultationTest.push(e),t.consultationTestCount+=e.count):(i=[],_.each(e.tests,function(e,t){i.push(e.name)}),e.innerTests=i,t.nonConsultationTest.push(e),t.nonConsultationTestCount+=e.count)}),t.packageDescription=s.trustAsHtml(e.packageDetail.description),t.packageInstructions=s.trustAsHtml(e.packageDetail.instruction))}))}},e.user=o.isUserSignedin(),e.sortCollection=function(t){return e.user&&e.user.userDetails&&r.positionWiseHCPackagesEntityId.includes(e.user.userDetails.pmEntityID)?t:(t=_.sortBy(t,"plh"===e.orderSelected||"phl"===e.orderSelected?"price":"discountPercent"),"phl"!==e.orderSelected&&"dhl"!==e.orderSelected||(t=t.reverse()),t)},e.differenceCtrlData=[],e.$watch("ctrlData",function(t){t&&(e.offeredPackageId=o.getOfferPackageIdList(),t&&(t&&t.length!==e.differenceCtrlData.length&&(e.tempCtrlData=[],e.corpPriorData=[],e.tempOfferData=[],_.each(e.corpids,function(t,a){var i=_.findWhere(e.ctrlData,{packageId:t});_.isEmpty(i)||(e.corpPriorData.push(i),e.differenceCtrlData=_.difference(e.ctrlData,e.corpPriorData),e.ctrlData=e.differenceCtrlData)}),_.each(e.offeredPackageId,function(t,a){var i=_.findWhere(e.ctrlData,{packageId:t});_.isEmpty(i)||(e.tempOfferData.push(i),e.differenceCtrlData=_.difference(e.ctrlData,e.tempOfferData),e.ctrlData=e.differenceCtrlData)})),e.corpPriorData=e.sortCollection(e.corpPriorData),e.tempOfferData=e.sortCollection(e.tempOfferData),e.user&&e.user.userDetails&&r.mediAssistIds.indexOf(e.user.userDetails.pmEntityID)>-1?e.tempCtrlData=e.corpPriorData.concat(e.tempOfferData):e.tempCtrlData=e.tempOfferData.concat(e.corpPriorData)))})}}}]),e.register.directive("offeredPackageGeneral",["$rootScope","$compile","$timeout","$stateParams","authService","apiProvider","$sce","navConstantsSvc",function(e,t,a,i,o,n,s,r){return{restrict:"AE",scope:{url:"=?",requestData:"=?",ageRangeValue:"=?",genderFilter:"=?",isMobileView:"=?"},template:'<div ng-if="tempCtrlData.length &gt; 0" ng-repeat="dc in tempCtrlData |ageRange: ageRangeValue.minAge :ageRangeValue.maxAge : ageRangeValue.isTrue |gender: genderFilter track by dc.packageId" class="result-box healthchecks">              <div class="row box">                <div class="col-xs-6 provider">                  <div class="logo">                    <div class="noLogo bg1">{{:: dc.dcName.charAt(0)}}</div>                  </div>                  <div class="disc"><a ng-click="fetchDetails(dc)" class="product-name">{{:: dc.packageName}}</a>                    <div ng-class="{\'col-xs-9 p-l-0 p-r-0\':isMobileView}">                        <p>by<b>&nbsp;{{:: dc.dcName}}</b></p>                        <p class="loaction">                            <span class="product-location" ng-hide="dc.homeSampleCollection"><i class="mm mm-map-marker"></i>{{:: dc.dcLocation}}</span>                            <span class="hsc" ng-show="dc.homeSampleCollection" title="A trained technician will visit your home to collect the samples"><i class="mm mm-sample"></i>&nbsp;Home Sample Collection</span>                        </p>                    </div>                    <div class="col-xs-3 p-l-0 p-r-0 text-right" ng-if="isMobileView">                        <div class="m-b-5 price" ng-if="dc.price >0"><b>&#x20B9;&nbsp;{{dc.price}}</b></div>                        <div class="m-b-5 price" ng-if="dc.priceRange > dc.price"><i class="mm mm-rupee"></i><strike>{{:: dc.priceRange}}</strike></div>                        <div class="discount" ng-if="dc.priceRange > dc.price">{{dc.discountPercent}}% OFF</div>                    </div>                  </div>                </div>                <div class="col-xs-3 p-l-0 p-r-0 extra text-center">                  <p class="availTiming"><i class="mm mm-clock"></i>{{:: dc.slotStartTime}} - {{:: dc.slotEndTime}}</p>                  <div ng-if="!isMobileView" ng-click="fetchDetails(dc)" class="btn-group btn-product-details">                    <div style="float:left">{{:: dc.packageTestCount}}<span>Tests</span></div>                    <div style="float:right"><b ng-if="dc.packageConsultationCount &gt; 0">{{:: dc.packageConsultationCount}}</b><span ng-if="dc.packageConsultationCount === 0">No</span><span> Consult(s)</span></div>                    <div class="details">Details<i class="mm mm-chevron-down"></i></div>                  </div>                  <p ng-if="isMobileView" style="text-align:left;"><b style="margin-left:0;">Tests: {{:: dc.packageTestCount}}</b><b ng-if="dc.packageConsultationCount &gt; 0">, Consultation: {{:: dc.packageConsultationCount}}</b></p>                </div>                <div class="col-xs-3 book" ng-class="{\'extra\':isMobileView}">                    <div ng-if="!isMobileView">                        <div class="clearfix">                            <span class="discount"><span ng-if="(dc.priceRange &gt; dc.price)">{{dc.discountPercent}}% Off</span></span>                            <div class="price pull-right"><b>&#x20B9;&nbsp;{{:: dc.price}}</b></div>                        </div>                        <div ng-if="(dc.priceRange &gt; dc.price)" class="pull-right strike"><i class="mm-rupee"></i>                            <strike>{{:: dc.priceRange}}</strike>                        </div>                    </div>                  <a ng-click="bookSlotAfterValidation(dc)" class="btn btn-primary btn-booking"> Book Now<i class="mm mm-female" ng-if="dc.genderType == \'F\'"></i> <i class="mm mm-male" ng-if="dc.genderType == \'M\'"></i></a>                </div>              </div>              <div ng-show="dc.detailsClicked || (detailsClicked &amp;&amp; dc.dcId === clickDCId &amp;&amp; dc.packageId === clickPackageId)" class="detailswraper"  ng-class="{\'no-animate\':isMobileView}"><a ng-click="fetchDetails(dc)" class="closeBtn"><i class="mm mm-close"></i></a>                <div ng-if="dc.homeSampleCollection" style="width: 250px; margin-top: 6px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-right"><i style="width:30px; height:30px;" class="img-icon icon-hsc pull-left"></i>Home Sample Collection Available</div>                <uib-tabset>                  <uib-tab index="0" heading="Description">                    <div class="row">                      <div class="col-sm-5 tests">                        <ul>                          <li tooltip-placement="top" uib-tooltip="{{dc.consultationInnerTest}}"><b>Consultation(s)<span ng-if="dc.packageConsultationCount &gt; 0">{{dc.packageConsultationCount}}</span><span ng-if="dc.packageConsultationCount === 0">_</span></b></li>                        </ul>                        <ul>                          <li><b>Tests<span>{{dc.nonConsultationTestCount}}</span></b></li>                          <li ng-repeat="test in dc.nonConsultationTest" tooltip-placement="top" tooltip-class="tt-test" uib-tooltip-template= "\'myTooltip.html\'" class="smTxt">{{test.name}}<span>{{test.count}}</span></li>                          <script type="text/ng-template" id="myTooltip.html">                            <ol class="test-list">                              <li ng-repeat="testinner in test.innerTests"> {{testinner}} </li>                            </ol>                          </script>                        </ul>                      </div>                      <div class="col-sm-7">                        <div class="clearfix">                          <div style="margin-right: 5px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left">                            Age Range:                            &nbsp;<span ng-if="dc.minAge &lt; 60">{{dc.minAge}} - {{dc.maxAge}}</span><span ng-if="dc.minAge &gt; 59">{{dc.minAge}} +</span>                          </div>                          <div style="line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left"><span ng-if="dc.genderType == \'F\'">Female Specific Package</span><span ng-if="dc.genderType == \'M\'">Male Specific Package</span></div>                        </div>                        <div ng-bind-html="dc.packageDescription" class="smTxt"></div>                      </div>                    </div>                  </uib-tab>                  <uib-tab index="1" heading="Instructions" ng-if="packageInstructions">                    <div ng-bind-html="dc.packageInstructions" line-height:14px;="line-height:14px;" class="smTxt"></div>                  </uib-tab>                </uib-tabset>              </div>              <div ng-if="dc.bookClicked || (bookClicked &amp;&amp; dc.dcId === clickDCId &amp;&amp; dc.packageId === clickPackageId)" class="detailswraper bookwraper"  ng-class="{\'no-animate\':isMobileView}"><a ng-click="bookSlotAfterValidation(dc)" class="closeBtn"><i class="mm mm-close"></i></a>                <div style="padding:10px 0" class="appointment-details">                  <medi-book-slot obj="dc" errormessage="errorMessage"></medi-book-slot>                </div>              </div>            </div>',link:function(t,a,l){t.ageRangeValue={maxAge:100,minAge:0,isTrue:!1},t.genderFilter={type:"both",isTrue:!1},t.bookSlotAfterValidation=function(e){t.detailsClicked=!1,t.isMobileView?(e.bookClicked=!e.bookClicked,e.detailsClicked=!1):t.bookClicked=!t.bookClicked,t.clickDCId=e.dcId,t.clickPackageId=e.packageId,t.bookClicked||e.bookClicked?(window._Site_Props.__setPackageDetails({packageName:e.packageName,providerName:e.dcName,providerLocation:e.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,dbLog:"hc",name:"Request Slot",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform(i.categoryItemTypeId,"RequestSlot",e.packageName+" by "+e.dcName)})})):window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Slot Selection Cancelled",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform(i.categoryItemTypeId,"SlotSelectionCancelled",e.packageName+" by "+e.dcName)})})},t.fetchDetails=function(e){if(t.bookClicked=!1,t.isMobileView?(e.detailsClicked=!e.detailsClicked,e.bookClicked=!1):t.detailsClicked=!t.detailsClicked,t.clickDCId=e.dcId,t.clickPackageId=e.packageId,t.detailsClicked||e.detailsClicked){var a="/showDcDetails"+e.packageId+"/"+e.packageName;window._Site_Props.__setPackageDetails({packageName:e.packageName,providerName:e.dcName,providerLocation:e.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"show Dc Detail",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Dental","showDcDetail",e.packageName+" in Dental")})}),(new Date).getTime(),e.packageDescription||(a=n.apiUrl+"/PackageDetails/"+e.packageId,e.consultationTest=[],e.consultationTestCount=0,e.nonConsultationTest=[],e.nonConsultationTestCount=0,o.makeAjaxCalls(a,"","GET").then(function(a){a.data.packageDetail&&(t.packageDetail=a.data.packageDetail,_.each(t.packageDetail.packageTests.testGroups,function(t,a){var i;"Consultation"===t.name?(i="",_.each(t.tests,function(e,t){i+=e.name+", "}),e.consultationInnerTest=i.slice(0,i.length-2),e.consultationTest.push(t),e.consultationTestCount+=t.count):(i=[],_.each(t.tests,function(e,t){i.push(e.name)}),t.innerTests=i,e.nonConsultationTest.push(t),e.nonConsultationTestCount+=t.count)}),e.packageDescription=s.trustAsHtml(t.packageDetail.description),e.packageInstructions=s.trustAsHtml(t.packageDetail.instruction))}))}},t.weekFilter=r.weekGroup,_.forEach(t.weekFilter,function(e,t){e.isDisabled=!0}),o.makeAjaxCalls(t.url,t.requestData,"POST").then(function(e){e.data&&e.data.categoryItemTypeResponse&&e.data.categoryItemTypeResponse.length>0&&(t.tempCtrlData=e.data.categoryItemTypeResponse[0].categoryItems,_.forEach(t.tempCtrlData,function(e,a){t.tempCtrlData[a].uniqueId=1+a,t.tempCtrlData[a].day0=!1,t.tempCtrlData[a].day1=!1,t.tempCtrlData[a].day2=!1,t.tempCtrlData[a].day3=!1,t.tempCtrlData[a].day4=!1,t.tempCtrlData[a].day5=!1,t.tempCtrlData[a].day6=!1,e.packageFilters&&e.packageFilters.length>0&&_.forEach(e.packageFilters,function(e,i){var o=e;if("gender"===o.substring(0,6).toLowerCase()){var n=o.split(":")[1];t.tempCtrlData[a].genderType=n}else if("maxage"===o.substring(0,6).toLowerCase()){var s=o.split(":")[1];t.tempCtrlData[a].maxAge=parseInt(s)}else if("minage"===o.substring(0,6).toLowerCase()){var l=o.split(":")[1];t.tempCtrlData[a].minAge=parseInt(l),t.tempCtrlData[a].minAge>59&&(t.tempCtrlData[a].maxAge=100)}else"homesamplecollection"===o.substring(0,20).toLowerCase()?t.tempCtrlData[a].homeSampleCollection=o.split(":")[1]?o.split(":")[1].toLowerCase():o.split(":")[1]:"keywords"===o.substring(0,8).toLowerCase()&&o.split(":")[1].toLowerCase().indexOf(r.dentalPackageName.toLowerCase())>-1?t.tempCtrlData[a].isDentalPackage=!0:"priority"===o.substring(0,8).toLowerCase()?t.tempCtrlData[a].corpPriority=!0:(t.tempCtrlData[a].genderType||(t.tempCtrlData[a].genderType="both"),t.tempCtrlData[a].minAge=t.tempCtrlData[a].minAge>0?t.tempCtrlData[a].minAge:0,t.tempCtrlData[a].maxAge=t.tempCtrlData[a].maxAge>0?t.tempCtrlData[a].maxAge:59)}),_.forEach(e.availableSlots,function(i,o){var n=i;0===n.day&&e.day0===!1?(t.tempCtrlData[a].day0=!0,t.tempCtrlData[a].daysSet0=n.day,t.weekFilter[6].isDisabled=!1):1===n.day&&e.day1===!1?(t.tempCtrlData[a].day1=!0,t.tempCtrlData[a].daysSet1=n.day,t.weekFilter[n.day-1].isDisabled=!1):2===n.day&&e.day2===!1?(t.tempCtrlData[a].day2=!0,t.tempCtrlData[a].daysSet2=n.day,t.weekFilter[n.day-1].isDisabled=!1):3===n.day&&e.day3===!1?(t.tempCtrlData[a].day3=!0,t.tempCtrlData[a].daysSet3=n.day,t.weekFilter[n.day-1].isDisabled=!1):4===n.day&&e.day4===!1?(t.tempCtrlData[a].day4=!0,t.tempCtrlData[a].daysSet4=n.day,t.weekFilter[n.day-1].isDisabled=!1):5===n.day&&e.day5===!1?(t.tempCtrlData[a].day5=!0,t.tempCtrlData[a].daysSet5=n.day,t.weekFilter[n.day-1].isDisabled=!1):6===n.day&&e.day6===!1&&(t.tempCtrlData[a].day6=!0,t.tempCtrlData[a].daysSet6=n.day,t.weekFilter[n.day-1].isDisabled=!1)}),_.isEmpty(e.availableSlots)||_.isEmpty(e.availableSlots[0].slots)||(e.slotStartTime=o.getTimeFormate(e.availableSlots[0].slots[0].slotStartTime),e.slotEndTime=o.getTimeFormate(e.availableSlots[0].slots[0].slotEndTime)),e.priceRange&&!isNaN(e.priceRange)&&(e.priceRange=parseInt(e.priceRange.split(".")[0])),e.price<e.priceRange?e.discountPercent=100-Math.round(e.price/e.priceRange*100):e.discountPercent=0,e.trackId=e.dcId+e.packageId}),t.originalCtrlData=t.tempCtrlData)}),e.$on("filterAHCItems",function(e,a){t.tempCtrlData=angular.copy(t.originalCtrlData),a.Provider.length>0&&t.filterByProvider(a.Provider),a.Location.length>0&&t.filterByLocation(a.Location)}),t.filterByProvider=function(e){_.each(t.tempCtrlData,function(a,i){_.each(e,function(e,i){a.dcName.toLowerCase().indexOf(e.dcName.toLowerCase())<0&&(t.tempCtrlData=_.without(t.tempCtrlData,a))})})},t.filterByLocation=function(e){_.each(t.tempCtrlData,function(a,i){_.each(e,function(e,i){a.dcLocation.toLowerCase()!==e.dcLocation.toLowerCase()&&(t.tempCtrlData=_.without(t.tempCtrlData,a))})})}}}}]),e.register.directive("megaMenu",["$rootScope","$compile","$stateParams","authService","apiProvider",function(e,t,a,i,o){return{restrict:"AE",scope:{configdata:"=?",searchdata:"="},templateUrl:"/templates/megaMenuTemplate.html?"+timeStamp,link:function(e,t,a){e.searchdata?(e.search=e.searchdata,e.validity=!0):(e.search=[],e.searchdata=[],e.validity=!1),e.editSearchData=function(t,a,i){if("checkbox"===i){if(a>=e.search.length)e.search[a]=angular.copy(t);else if(t.isSelected)e.search[a].name=e.search[a].name+","+t.name;else{var o=e.search[a].name.indexOf(t.name);0===o?e.search[a].name=e.search[a].name.substring(o+1+t.name.length,e.search[a].name.length):e.search[a].name=e.search[a].name.substring(0,o-1)+e.search[a].name.substring(o+t.name.length,e.search[a].name.length)}e.search[a].name?e.checkValidityAndAssign(t):(e.validity=!1,e.searchdata=[],e.search.splice(a,1))}else if(!t.isSelected){if(t.isSelected=!0,a<e.search.length){for(var n=e.search.length-a,s=a;s<e.search.length;s++)e.search[s].isSelected=!e.search[s].isSelected;e.search.splice(a,n),e.search[a]=t}else e.search[a]=t;e.checkValidityAndAssign(t)}},e.checkValidityAndAssign=function(t){t.types&&0!==t.types.length?(e.searchdata=[],e.validity=!1):(e.validity=!0,e.searchdata=e.search)}}}}]),e.register.directive("affixDirective",["$timeout","$rootScope",function(e,t){return{restrict:"A",link:function(e,a,i){i.affixDirective&&!t.isMobileView&&requirejs(["sticky"],function(){$(i.affixDirective).stick_in_parent({parent:"#containeWrap",offset_top:20}),i.pinbottom&&$(i.affixDirective).on("sticky_kit:bottom",function(e){$(this).parent().css("position","static")}).on("sticky_kit:unbottom",function(e){$(this).parent().css("position","relative")})})}}}]),e.register.directive("scrollUp",["$rootScope","$window","$timeout","$document",function(e,t,a,i){return{restrict:"AE",scope:{},template:'<div ng-show="scrollTopBtnShow">          <a class="scrollTopBtn" ng-click="scrollToTop()" >              <i class="mm mm-chevron-up"></i>           </a> </div>',link:function(e,o,n){e.scrollTopBtnShow=!1,o[0],angular.element(i)[0].body,e.scrollToTop=function(){e.scrollTopBtnShow=!1,t.scrollTo(0,0)};var s=!1;e.debounchFunction=function(){s||(s=!0,a(function(){s=!1,t.pageYOffset>300?e.scrollTopBtnShow=!0:e.scrollTopBtnShow=!1},100,!0))},i.bind("scroll",e.debounchFunction)}}}]),e.register.directive("dentalOfferedPackage",["$rootScope","$compile","$timeout","$stateParams","authService","apiProvider","$sce",function(e,t,a,i,o,n,s){return{restrict:"AE",scope:{ctrlData:"=bind"},template:'<div ng-if="tempCtrlData.length &gt; 0" ng-repeat="dc in tempCtrlData track by dc.packageId" class="result-box healthchecks">              <div class="row box">                <div class="col-xs-6 provider">                  <div class="logo">                    <div class="noLogo bg1">{{:: dc.dcName.charAt(0)}}</div>                  </div>                  <div class="disc"><a ng-click="fetchDetails(dc)" class="product-name">{{:: dc.packageName}}</a>                    <p>by&nbsp;<b>{{:: dc.dcName}}</b></p>                    <p ng-hide="dc.homeSampleCollection" class="product-location"><i class="mm mm-map-marker"></i>{{:: dc.dcLocation}}</p>                    <p class="loaction">                        <span class="product-location" ng-hide="dc.homeSampleCollection"><i class="mm mm-map-marker"></i>{{:: dc.dcLocation}}</span>                        <span class="hsc" ng-show="dc.homeSampleCollection" title="A trained technician will visit your home to collect the samples"><i class="mm mm-sample"></i>&nbsp;Home Sample Collection</span>                    </p>                  </div>                </div>                <div class="col-xs-3 p-l-0 p-r-0 extra text-center">                    <div ng-class="{\'col-xs-9 p-l-0 p-r-0\':isMobileView}">                        <p class="availTiming"><i class="mm mm-clock"></i>{{:: dc.slotStartTime}} - {{:: dc.slotEndTime}}</p>                        <div ng-click="fetchDetails(dc)" class="btn-group btn-product-details">                            <div style="float:left">{{:: dc.packageTestCount}}<span>Tests</span></div>                            <div style="float:right"><b ng-if="dc.packageConsultationCount &gt; 0">{{:: dc.packageConsultationCount}}</b><span ng-if="dc.packageConsultationCount === 0">No</span><span> Consult(s)</span></div>                            <div class="details">Details<i class="mm mm-chevron-down"></i></div>                    </div>                    <div class="col-xs-3 p-l-0 p-r-0 text-right" ng-if="isMobileView">                        <div class="m-b-5 price" ng-if="dc.price >0"><b>&#x20B9;&nbsp;{{dc.price}}</b></div>                        <div class="m-b-5 price" ng-if="dc.priceRange > dc.price"><i class="mm mm-rupee"></i><strike>{{:: dc.priceRange}}</strike></div>                        <div class="discount" ng-if="dc.priceRange > dc.price">{{dc.discountPercent}}% OFF</div>                    </div>                </div>                </div>                <div class="col-xs-3 book">                    <div ng-if="!isMobileView">                        <div class="clearfix">                            <span class="discount"><span ng-if="(dc.priceRange &gt; dc.price)">{{dc.discountPercent}}% Off</span></span>                            <div class="price pull-right"><b>&#x20B9;&nbsp;{{:: dc.price}}</b></div>                        </div>                        <div ng-if="(dc.priceRange &gt; dc.price)" class="pull-right strike"><i class="mm-rupee"></i>                            <strike>{{:: dc.priceRange}}</strike>                            </div>                    </div>                  <a ng-click="bookSlotAfterValidation(dc)" class="btn btn-primary btn-booking"> Book Now<i class="mm mm-female" ng-if="dc.genderType == \'F\'"></i> <i class="mm mm-male" ng-if="dc.genderType == \'M\'"></i></a>                </div>              </div>              <div ng-show="(detailsClicked &amp;&amp; dc.dcId === clickDCId &amp;&amp; dc.packageId === clickPackageId)" class="detailswraper"><a ng-click="fetchDetails(dc)" class="closeBtn"><i class="mm mm-close"></i></a>                <div ng-if="dc.homeSampleCollection" style="width: 250px; margin-top: 6px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-right"><i style="width:30px; height:30px;" class="img-icon icon-hsc pull-left"></i>Home Sample Collection Available</div>                <uib-tabset>                  <uib-tab index="0" heading="Description">                    <div class="row">                      <div class="col-sm-5 tests">                        <ul>                          <li tooltip-placement="top" uib-tooltip="{{consultationInnerTest}}"><b>Consultation(s)<span ng-if="dc.packageConsultationCount &gt; 0">{{dc.packageConsultationCount}}</span><span ng-if="dc.packageConsultationCount === 0">_</span></b></li>                        </ul>                        <ul>                          <li><b>Tests<span>{{nonConsultationTestCount}}</span></b></li>                          <li ng-repeat="test in nonConsultationTest" tooltip-placement="top" tooltip-class="tt-test" uib-tooltip-template= "\'myTooltip.html\'" class="smTxt">{{test.name}}<span>{{test.count}}</span></li>                          <script type="text/ng-template" id="myTooltip.html">                            <ol class="test-list">                              <li ng-repeat="testinner in test.innerTests"> {{testinner}} </li>                            </ol>                          </script>                        </ul>                      </div>                      <div class="col-sm-7">                        <div class="clearfix">                          <div style="margin-right: 5px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left">                            Age Range:                            &nbsp;<span ng-if="dc.minAge &lt; 60">{{dc.minAge}} - {{dc.maxAge}}</span><span ng-if="dc.minAge &gt; 59">{{dc.minAge}} +</span>                          </div>                          <div style="line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left"><span ng-if="dc.genderType == \'F\'">Female Specific Package</span><span ng-if="dc.genderType == \'M\'">Male Specific Package</span></div>                        </div>                        <div ng-bind-html="packageDescription" class="smTxt"></div>                      </div>                    </div>                  </uib-tab>                  <uib-tab index="1" heading="Instructions" ng-if="packageInstructions">                    <div ng-bind-html="packageInstructions" line-height:14px;="line-height:14px;" class="smTxt"></div>                  </uib-tab>                </uib-tabset>              </div>              <div ng-if="(bookClicked &amp;&amp; dc.dcId === clickDCId &amp;&amp; dc.packageId === clickPackageId)" class="detailswraper bookwraper"><a ng-click="bookSlotAfterValidation(dc)" class="closeBtn"><i class="mm mm-close"></i></a>                <div style="padding:10px 0" class="appointment-details">                  <medi-book-slot obj="dc" errormessage="errorMessage"></medi-book-slot>                </div>              </div>            </div>',link:function(e,t,a){e.bookSlotAfterValidation=function(t){e.detailsClicked=!1,e.bookClicked=!e.bookClicked,e.clickDCId=t.dcId,e.clickPackageId=t.packageId,e.bookClicked?(window._Site_Props.__setPackageDetails({packageName:t.packageName,providerName:t.dcName,providerLocation:t.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Request Slot",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Dental","RequestSlot",t.packageName+" by "+t.dcName)})})):window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Slot Selection Cancelled",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Dental","SlotSelectionCancelled",t.packageName+" by "+t.dcName)})})},e.fetchDetails=function(t){if(e.bookClicked=!1,e.detailsClicked=!e.detailsClicked,e.clickDCId=t.dcId,e.clickPackageId=t.packageId,e.detailsClicked){var a="/showDcDetails"+t.packageId+"/"+t.packageName;window._Site_Props.__setPackageDetails({packageName:t.packageName,providerName:t.dcName,providerLocation:t.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"show Dc Detail",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Dental","showDcDetail",t.packageName+" by "+t.dcName)})}),(new Date).getTime(),a=n.apiUrl+"/PackageDetails/"+t.packageId,e.consultationTest=[],e.consultationTestCount=0,e.nonConsultationTest=[],e.nonConsultationTestCount=0,o.makeAjaxCalls(a,"","GET").then(function(t){t.data.packageDetail&&(e.packageDetail=t.data.packageDetail,_.each(e.packageDetail.packageTests.testGroups,function(t,a){var i;"Consultation"===t.name?(i="",_.each(t.tests,function(e,t){i+=e.name+", "}),e.consultationInnerTest=i.slice(0,i.length-2),e.consultationTest.push(t),e.consultationTestCount+=t.count):(i=[],_.each(t.tests,function(e,t){i.push(e.name)}),t.innerTests=i,e.nonConsultationTest.push(t),e.nonConsultationTestCount+=t.count)}),e.packageDescription=s.trustAsHtml(e.packageDetail.description),e.packageInstructions=s.trustAsHtml(e.packageDetail.instruction))})}},e.offeredPackageId=["5c61e9d09fac48c59283e5232456a00b","fe6864995a5b43afb4e30b15881fdd72","c64c428211f4416e977b8b240077c346","fcd503088dbc4ceeb3058bcbaed27f26","11af8f74b273438d978b31a1dbeabf38","a43ba83f3f6249f092a99caa97a6913a","427f742a0c8c449c8a2cd7157556513c","fcbd55b850ae44dbb3cc2aa198790556","88bcd06622ba4c3d97f899d06d1851fd","56672801f7a54a2b946e4214e577755e","4cbf8ba66a894429a17c33529086d0bd","35478d9f2fd54caeaf665862701f3fa2","966a6a02ff6a444db618698785530442","1ad7ba65d44a49e8b57c7d013f0eae08","398f25a26601420aaeb538927bda62fd","7df5aa2925d646f9933204b926717b76","e0f776c2aee04739a61b669568b8af5e","0605161adb314bb0bb67724d1ac64fcd","41fe385218b74c7b931c0f90ab2b42e3","4087675642344c82adc7dce053a7843d","68516193850c46c882b831aec6327975","4adfdf94520b44ff8ccb398ad7df2715","b8356371feac4d518fd5842683b4b81d","3fbd6450b0f8495e9204da3ce9978788","78e86a92f4874085a506a30b5111a18a","efb46a4b12224ae5a7a00ff8ad61f7c8","edb95cd759c74b659410f5a50d4da181","962ee811547743af84a39b4fdc12ea0e","c69c608bb27f47849bb580b204d10a72","0aacf18415004c1eae5bfa5493d73f54","e7cd88c45e5a465881b2bc7b7afc51c3","dd2c7863dc93454ca58e297909c96e2c","8cef315e269c4b328f01353c60601832","b3d06b7d73324144bc080db2a19289c0","49995e3ff5d141f286bcdf43f0665336","a9a6c9b2d2d54f75abe06e8e1c944505"],e.differenceCtrlData=[],e.$watch("ctrlData",function(t){t&&t&&t&&t.length!==e.differenceCtrlData.length&&(e.tempCtrlData=[],_.each(e.ctrlData,function(t,a){e.offeredPackageId.indexOf(t.packageId)>=0&&(e.tempCtrlData.push(t),e.differenceCtrlData=_.difference(e.ctrlData,e.tempCtrlData),e.ctrlData=e.differenceCtrlData)}))})}}}]),e.register.directive("sponserPackageDental",["$rootScope","$compile","$timeout","$stateParams","authService","apiProvider","$sce","navConstantsSvc",function(e,t,a,i,o,n,s,r){return{restrict:"AE",scope:{ctrlData:"=bind"},template:'<div ng-show="allAhcPackageList.length>0">                  <div  ng-repeat="data in allAhcPackageList |ageRange: ageRangeValue.minAge :ageRangeValue.maxAge : ageRangeValue.isTrue |gender: genderFilter track by $index">                  <div class="result-box corp">                    <div class="row box">                      <div class="col-xs-6 provider">                        <div class="disc"><a ng-click="fetchDetails(data.provider)" class="product-name">{{data.provider.packageName}}</a>                          <p>by<b>{{data.sponserTempPackageDetails.length}} Providers</b><span class="product-location"><i class="mm mm-map-marker"></i>{{cityName}}</span></p>                        </div>                      </div>                      <div class="col-xs-3 p-l-0 p-r-0 extra text-center">                        <div class="btn-group btn-product-details" ng-click="fetchDetails(data.provider)">                          <div style="float:left">{{data.provider.packageTestCount}}<span>Tests</span></div>                          <div style="float:right"><span>{{data.provider.packageConsultationCount}}</span><span> Consult(s)</span></div>                          <div class="details">Details<i class="mm mm-chevron-down"></i></div>                        </div>                      </div>                      <div class="col-xs-3 book">        \t\t\t\t<div class="price pull-right">        \t\t\t\t\t<span ng-if="data.priceStartFrom > 0"> <span ng-if="data.totalDifferedPrice > 1" style="color: #666;font-size: 12px;">Start From </span> <i class="mm mm-rupee"></i> {{data.priceStartFrom}}</span>        \t\t\t\t</div>                        <div class="clearfix">                          <div class="label-corpSponcered" ng-if="data.priceStartFrom > 1">Corporate Specific</div>        \t\t\t\t  <div class="label-corpSpecific" ng-if="data.priceStartFrom == 0">Corporate Sponsored</div>                        </div>                        <a ng-show="data.provider.packageId !== showHideSponserPackageListPackageId" ng-click="showHideSponserPackageFunc(data)" class="btn btn-primary btn-booking">Show Providers</a>                        <a ng-show="showHideSponserPackage && data.provider.packageId === showHideSponserPackageListPackageId" ng-click="hideSponserPackageFunc(data)"  class="btn btn-primary btn-booking">Hide Providers</a>                      </div>                    </div>                    <div ng-show="(detailsClicked &amp;&amp; data.provider.packageId === clickPackageId)" class="detailswraper"><a ng-click="closeDetails()" class="closeBtn"><i class="mm mm-close"></i></a>                      <div ng-if="data.homeSampleCollection" style="width: 250px; margin-top: 6px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-right hscAwail"><i style="width:30px; height:30px;" class="img-icon icon-hsc pull-left"></i>Home Sample Collection Available</div>                      <uib-tabset>                        <uib-tab index="0" heading="Description">                          <div class="row">                            <div class="col-sm-5 tests">                              <ul>                                <li tooltip-placement="top" uib-tooltip="{{consultationInnerTest}}"><b>Consultation(s)<span ng-if="dc.packageConsultationCount &gt; 0">{{dc.packageConsultationCount}}</span><span ng-if="dc.packageConsultationCount === 0">_</span></b></li>                              </ul>                              <ul>                                <li><b>Tests<span>{{nonConsultationTestCount}}</span></b></li>                                <li ng-repeat="test in nonConsultationTest" tooltip-placement="top" tooltip-class="tt-test" uib-tooltip-template= "\'myTooltip.html\'" class="smTxt">{{test.name}}<span>{{test.count}}</span></li>                                <script type="text/ng-template" id="myTooltip.html">                                  <ol class="test-list">                                    <li ng-repeat="testinner in test.innerTests"> {{testinner}} </li>                                  </ol>                                </script>                              </ul>                            </div>                            <div class="col-sm-7">                              <div style="padding:10px 0" class="clearfix">                                <div ng-if="data.minAge || data.maxAge" style="margin-right: 5px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left">                                  Age Range:                                  &nbsp;<span ng-if="data.minAge &lt; 60">{{data.minAge}} - {{data.maxAge}}</span><span ng-if="data.minAge &gt; 59">{{data.minAge}} +</span>                                </div>                                <div style="line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left"><span ng-if="data.genderType === \'F\'"> Female Specific Package </span> </div>                              </div>                              <div ng-bind-html="packageDescription" class="smTxt"></div>                            </div>                          </div>                        </uib-tab>                        <uib-tab index="1" ng-if="packageInstructions" heading="Instructions">                          <div ng-bind-html="packageInstructions" line-height:14px;="line-height:14px;" class="smTxt"></div>                        </uib-tab>                      </uib-tabset>                    </div>                  </div>                  <div ng-repeat="dc in showHideSponserPackageList track by $index" ng-if="showHideSponserPackage && data.provider.packageId === showHideSponserPackageListPackageId" class="result-box corp-list">                    <div class="row box">                      <div class="col-xs-6 provider">                        <div class="logo">                          <div class="noLogo bg1">T</div>                        </div>                        <div class="disc"><a ng-click="fetchDetails(dc)" class="product-name">{{:: dc.dcName}}.</a>                          <p class="product-location"><i class="mm mm-map-marker"></i>{{:: dc.dcLocation}}</p>                          <p class="availTiming"><i class="mm mm-clock"></i>{{dc.slotStartTime}} - {{dc.slotEndTime}}</p>                        </div>                      </div>                      <div class="col-xs-3 p-l-0 p-r-0 extra text-center"></div>                      <div class="col-xs-3 book">                        <div ng-if="dc.price > 0" class="clearfix price">                          Rs. {{dc.price}}                        </div>                        <div ng-if="dc.price === 0 && !isMobileView" class="clearfix">                          <div class="label-corpSponcered" > Sponsored </div>                        </div>                        <a class="btn btn-primary btn-booking" ng-click="bookSlotAfterValidation(dc)" >Book Now</a>                      </div>                  </div>                  <div ng-if="(bookClicked &amp;&amp; dc.dcId === clickDCId &amp;&amp; dc.packageId === clickPackageId)" class="detailswraper bookwraper">                    <a ng-click="closeDetails(dc)" class="closeBtn"><i class="mm mm-close"></i></a>                    <div style="padding:10px 0" class="appointment-details">                      <medi-book-slot obj="dc" errormessage="scope.errorMessage"></medi-book-slot>                    </div>                    </div>                  </div>                  </div>                  </div>',
link:function(t,a,i){t.detailsClicked=!1,t.ageRangeValue={maxAge:100,minAge:0,isTrue:!1},t.genderFilter={type:"both",isTrue:!1},t.closeDetails=function(){t.clickPackageId=""},t.fetchDetails=function(e){if(t.bookClicked=!1,t.detailsClicked=!0,t.clickPackageId=e.packageId,t.detailsClicked){var a="/showDcDetails"+e.packageId+"/"+e.packageName;window._Site_Props.__setPackageDetails({packageName:e.packageName,providerName:e.dcName,providerLocation:e.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"show Dc Detail",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Dental","showDcDetail",e.packageName+" by "+e.dcName)})}),(new Date).getTime(),a=n.apiUrl+"/PackageDetails/"+e.packageId,t.consultationTest=[],t.consultationTestCount=0,t.nonConsultationTest=[],t.nonConsultationTestCount=0,o.makeAjaxCalls(a,"","GET").then(function(e){e.data.packageDetail&&(t.packageDetail=e.data.packageDetail,t.packageDetail.packageTests&&_.each(t.packageDetail.packageTests.testGroups,function(e,a){var i="";"Consultation"===e.name?(i="",_.each(e.tests,function(e,t){i+=e.name+", "}),t.consultationInnerTest=i.slice(0,i.length-2),t.consultationTest.push(e),t.consultationTestCount+=e.count):(i=[],_.each(e.tests,function(e,t){i.push(e.name)}),e.innerTests=i,t.nonConsultationTest.push(e),t.nonConsultationTestCount+=e.count)}),t.packageDescription=s.trustAsHtml(t.packageDetail.description),t.packageInstructions=s.trustAsHtml(t.packageDetail.instruction))})}},t.hideSponserPackageFunc=function(){t.showHideSponserPackage=!1,t.showHideSponserPackageListPackageId=""},t.showHideSponserPackageFunc=function(e){t.showHideSponserPackage=!0,t.showHideSponserPackage?(t.showHideSponserPackageList=e.sponserTempPackageDetails,t.showHideSponserPackageListPackageId=e.provider.packageId):t.showHideSponserPackageListPackageId=""},t.returnTime=function(e){var t=o.getTimeFormate(e);return t},t.$on("changeCity",function(e,a){t.getAhcPackage()});var r=e.$on("userDetails",function(e,a){t.getAhcPackage()}),l=(e.$on("userLogout",function(e,a){t.allAhcPackageList=[]}),e.$on("filterAHCAgeItems",function(e,a){t.ageRangeValue=a}),e.$on("filterAHCGenderItems",function(e,a){t.genderFilter=a}),e.$on("filterAHCItems",function(e,a){t.allAhcPackageList=angular.copy(t.tempallAhcPackageList),a.Provider.length>0&&a.Location.length>0?(t.allAhcPackageList=t.filterByProvider(t.allAhcPackageList,a.Provider),t.allAhcPackageList=t.filterByLocation(t.allAhcPackageList,a.Location,!0)):a.Provider.length>0?t.allAhcPackageList=t.filterByProvider(t.allAhcPackageList,a.Provider):a.Location.length>0&&(t.allAhcPackageList=t.filterByLocation(t.allAhcPackageList,a.Location,!1))}));t.filterByProvider=function(e,t){return _.each(e,function(a,i){a.sponserTempPackageDetails=[],_.each(a.sponserPackageDetails,function(e,i){_.each(t,function(t,i){e.dcName.toLowerCase().indexOf(t.dcName.toLowerCase())>=0&&a.sponserTempPackageDetails.push(e)})}),0===a.sponserTempPackageDetails.length&&(e=_.difference(e,a))}),e},t.filterByLocation=function(e,t,a){return a?_.each(e,function(a,i){_.each(a.sponserTempPackageDetails,function(e,i){var o=!1;_.each(t,function(t,a){e.dcLocation.toLowerCase()===t.dcLocation.toLowerCase()&&(o=!0)}),o||(a.sponserTempPackageDetails=_.difference(a.sponserTempPackageDetails,e))}),0===a.sponserTempPackageDetails.length&&(e=_.difference(e,a))}):_.each(e,function(a,i){a.sponserTempPackageDetails=[],_.each(a.sponserPackageDetails,function(e,i){_.each(t,function(t,i){e.dcLocation.toLowerCase()===t.dcLocation.toLowerCase()&&a.sponserTempPackageDetails.push(e)})}),0===a.sponserTempPackageDetails.length&&(e=_.difference(e,a))}),e},t.getAhcPackage=function(){t.allAhcPackageList=[];var e=n.apiUrl+"/categoryitemtypesearch.json";t.user=o.isUserSignedin(),t.cityName=o.getCity(),o.makeAjaxCalls(e,{categoryItemTypeId:"77b6448303f94721b52e16dd55878326",keyword:"DENTALPACKAGE"},"POST",t.user.token,t.cityName).then(function(e){t.allAhcPackageList=[],e.data.categoryItemTypeResponse&&e.data.categoryItemTypeResponse.length>0&&_.each(e.data.categoryItemTypeResponse,function(e,a){e.packageFilters&&e.packageFilters.length>0&&_.forEach(e.packageFilters,function(t,a){var i=t;if("gender"===i.substring(0,6).toLowerCase()){var o=i.split(":")[1];e.genderType=o}else if("maxage"===i.substring(0,6).toLowerCase()){var n=i.split(":")[1];e.maxAge=parseInt(n)}else if("minage"===i.substring(0,6).toLowerCase()){var s=i.split(":")[1];e.minAge=parseInt(s),e.minAge>59&&(e.maxAge=60)}else"homesamplecollection"===i.substring(0,20).toLowerCase()?e.homeSampleCollection=i.split(":")[1]?i.split(":")[1].toLowerCase():i.split(":")[1]:(e.genderType||(e.genderType="both"),e.minAge=e.minAge>0?e.minAge:0,e.maxAge=e.maxAge>0?e.maxAge:59)}),t.tempAchPackage={},t.tempAchPackage.priceObj={},t.tempAchPackage.provider=e,t.tempAchPackage.genderType=e.genderType,t.tempAchPackage.minAge=e.minAge,t.tempAchPackage.maxAge=e.maxAge,t.tempAchPackage.sponserPackageDetails=e.providers,t.tempAchPackage.sponserTempPackageDetails=t.tempAchPackage.sponserPackageDetails,_.each(t.tempAchPackage.sponserPackageDetails,function(a,i){_.isEmpty(e.availableSlots)||_.isEmpty(e.availableSlots[0].slots)||(t.tempAchPackage.priceObj[a.price]=0,a.slotStartTime=t.returnTime(e.availableSlots[0].slots[0].slotStartTime),a.slotEndTime=t.returnTime(e.availableSlots[0].slots[0].slotEndTime)),a.genderType=e.genderType,a.minAge=e.minAge,a.maxAge=e.maxAge,a.packageId=e.packageId,a.availableSlots=e.availableSlots,a.packageName=e.packageName,a.isSponser=!0});var i=Object.keys(t.tempAchPackage.priceObj);i.length>1?(t.tempAchPackage.priceStartFrom=_.first(i.sort()),t.tempAchPackage.totalDifferedPrice=i.length):1===i.length?(t.tempAchPackage.priceStartFrom=_.first(i.sort()),t.tempAchPackage.totalDifferedPrice=i.length):(t.tempAchPackage.priceStartFrom=_.first(i.sort()),t.tempAchPackage.totalDifferedPrice=i.length),delete t.tempAchPackage.priceObj,t.allAhcPackageList.push(t.tempAchPackage),t.tempallAhcPackageList=t.allAhcPackageList})})},t.bookSlotAfterValidation=function(e){t.detailsClicked=!1,t.bookClicked=!0,t.clickDCId=e.dcId,t.clickPackageId=e.packageId,t.bookClicked?(window._Site_Props.__setPackageDetails({packageName:e.packageName,providerName:e.dcName,providerLocation:e.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Request Slot",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Dental","RequestSlot",e.packageName+" by "+e.dcName)})})):window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Slot Selection Cancelled",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Dental","SlotSelectionCancelled",e.packageName+" by "+e.dcName)})})},e.$on("$destroy",function(){l(),r()}),t.getAhcPackage(),t.$watchGroup(["sponserPackageDetails"],function(e){t.tempCtrlData=[],e&&e&&(t.tempCtrlData=t.ctrlData,t.sponserPackageDetails&&t.sponserPackageDetails.length>0&&(t.tempCtrlData=_.union(t.tempCtrlData,t.sponserPackageDetails),_.isEmpty(_.difference(t.tempCtrlData,e))||(t.ctrlData=t.tempCtrlData)))})}}}]),e.register.directive("blogContent",["authService",function(e){return{restrict:"E",replace:!0,scope:{pageName:"=?",tabName:"=?"},template:'<div class="discover" ng-class="{\'m-0\':pageName===\'offers\'}" ng-hide="!links.length"><h3 ng-class="{\'text-center m-b-10\':pageName===\'offers\'}">Discover More</h3><div class="row"><div class="col-xs-6 col-md-4 bx" ng-repeat="link in links track by $index"><a href="{{link.blogLink}}" target="_blank"><img src="{{link.image}}" alt=""/>{{link.blogTitle}}</a></div></div></div>',link:function(e,t,a){requirejs(["blogContents"],function(t){e.links=_.property("links")(_.findWhere(t,{pageName:e.pageName})),e.tabName&&(e.links=_.property("links")(_.findWhere(e.links,{tabName:e.tabName})))})}}}]),e.register.directive("ahcBanner",["authService","navConstantsSvc","notify",function(e,t,a){return{restrict:"E",replace:!0,scope:{isMobileView:"=?",openDefault:"=opendefault"},template:'                        <div>                            <div ng-if="isCognizantUser">                                <div class="row p-t-10 p-b-10 m-b-10 m-t-10 br-20 mandatory-border" style="background: linear-gradient(0deg, #FFDFE0 0%, #FFF5F5 100%);" >                                    <div class="p-l-30 col-md-8" ng-if="!isMobileView" style="background-img: url()">                                        <span class="lgTxt bold"> Refer your friend and get 100 Buddy coins each! </span>                                        <p class="smdTxt1"> Share the code with your friend and get the 100 Buddy coins on their first annual health checkup <a ng-click=ahcBannerOnClick("ahcReferralBanner_KnowMore") ui-sref="app.ahcReferral"><b>Know more &gt;</b></a></p>                                    </div >                                    <div class="col-md-2 m-t-5" ng-if="!isMobileView" style="width:300px;">                                        <span class="col-md-2 m-t-5" ng-if="!isMobileView" style="width:200px;">                                            <span>                                                <span style="box-shadow: 0 0 15px rgb(24 24 24 / 16%);">                                                    <span ng-click="copyToClipboard()" class="br-10 white-bg smdTxt bold p-t-10 p-b-10">                                                        <span class="p-l-5" >{{referralCode1}}</span>                                                        <span class="vl" style="height:100%; border-left: #E0E0E0;  width: 1px; position: absolute;  margin-left: -1px;"></span>                                                        <span > <img src="assets/icons/ahc/copy-blue.svg" height="40px" width=auto; "/> </span>                                                    </span>                                                </span>                                            </span>                                        </span>                                        <span class="col-md-2 m-t-10" ng-if="!isMobileView" style="margin-left:-20px">                                            <span class="share share-ahc hideSm cursor-pointer" style="">                                                <span class="openDefault? \'share-open-default\' : \'\'">                                                    <div class="icon-ahc share-icon-button" style="margin-bottom=40px; padding:0 0 0 0;"><img src="assets/icons/ahc/share.svg" height="35px" alt=""  /></div>                                                        <span class="group" style="width:100px;">                                                            <span class="p-l-4 p-r-4" ng-if="!fbNotEnabled"><img src="assets/icons/facebook.svg" ng-click="facebookShare()" alt="" height="30px" /> </span>                                                            <span class="p-l-4 p-r-4" > <img src="assets/icons/telegram.svg" ng-click="telegramShare()" alt="" height="30px" /> </span>                                                            <span class="p-l-4 p-r-4" > <img src="assets/icons/whatsapp.svg" ng-click="whatsappShare()" alt="" height="30px" /> </span>                                                        </span>                                                </span>                                            </span>                                        </span>                                    </div>                                    <div class="p-l-10 p-r-10" ng-if="isMobileView">                                        <span class="smTxt bold"> Refer your friend and get 100 Buddy coins each! </span>                                        <p class="xsmTxt"> Share the code with your friend and get the 100 Buddy coins on their first annual health checkup <a ng-click=ahcBannerOnClick("ahcReferralBanner_KnowMore") ui-sref="app.ahcReferral"><b>Know more &gt;</b></a></p>                                    </div>                                    <div class="col-md-2" ng-if="isMobileView">                                        <span>                                            <span class="">                                                <span ng-click="copyToClipboard()" class="br-10 white-bg smdTxt3 bold p-t-5 p-b-5">                                                    <span class="p-l-5" >{{referralCode1}}</span>                                                    <span class="vl" style="height:100%; border-left: #E0E0E0;  width: 1px; position: absolute;  margin-left: -1px;"></span>                                                    <span > <img src="assets/icons/ahc/copy-blue.svg" height="30px" width=auto; "/> </span>                                                </span>                                            </span>                                        </span>                                        <span class="p-l-10 xsmTxt" >or share via</span>                                        <span class="p-l-10" ng-if="!fbNotEnabled"><img src="assets/icons/facebook.svg" ng-click="facebookShare()" alt="" height="30px" /> </span>                                        <span class="p-l-10" > <img src="assets/icons/telegram.svg" ng-click="telegramShare()" alt="" height="30px" /> </span>                                        <span class="p-l-10" > <img src="assets/icons/whatsapp.svg" ng-click="whatsappShare()" alt="" height="30px" /> </span>                                    </div>                                </div>                        </div>                    </div>                ',link:function(t,i,o){if(t.user=e.getUserObj(),t.isCognizantUser=!1,t.user&&t.user.encryptedToken&&t.isCognizantUser){var n={authority:"authgateway.docsapp.in",accept:"application/json, text/plain, */*","content-type":"application/json",mbservertoken:t.user.encryptedToken};e.makeAjaxCalls("https://authgateway.docsapp.in/reward/referral/generateCoupon",{key:"referralAHC"},"POST",t.user.token,"",!0,n).then(function(e){e.data.success&&(t.referralCode1=e.data.code,t.referralText1=e.data.text,t.referralInvite1=e.data.text+" Referral Code: -  "+e.data.code,t.referralUrl1="https://www.medibuddy.in/refer/AHC")})}t.ahcBannerOnClick=function(e){window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:e,name:e})},t.whatsappShare=function(){t.ahcBannerOnClick("achReferralBanner_WhatsAppShare_"+t.referralCode1);var e=t.referralInvite1+t.referralUrl1,a="https://api.whatsapp.com/send?text="+encodeURIComponent(e);window.open(a)},t.facebookShare=function(){t.ahcBannerOnClick("achReferralBanner_FBShare_"+t.referralCode1);var e="http://www.facebook.com/sharer.php?u="+encodeURIComponent(t.referralUrl1)+"&t="+encodeURIComponent(t.referralInvite1);window.open(e)},t.telegramShare=function(){t.ahcBannerOnClick("achReferralBanner_TelegramShare_"+t.referralCode1);var e="https://t.me/share/url?url="+encodeURIComponent(t.referralUrl1)+"&text="+encodeURIComponent(t.referralInvite1);window.open(e)},t.copyToClipboard=function(){t.ahcBannerOnClick("achReferralBanner_CopyToClipBoard_"+t.referralCode1);var e=document.createElement("textarea"),i=t.referralInvite1+"\n"+t.referralUrl1;e.value=i,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),a({message:"Copied to clipboard",position:"center",duration:2e3})},t.mailShare=function(){var e="mailto:?Subject=",a=encodeURI("Get amazing rewards | Avail Annual Health Checkup now on MediBuddy"),i=encodeURIComponent(t.referralUrl1)+"\n"+encodeURIComponent(t.referralInvite1);e+=a+"&Body="+i,window.open(e)}}}}]),e.register.directive("limitTo",[function(){return{restrict:"A",link:function(e,t,a){var i=parseInt(a.limitTo),o=/Backspace|Enter/;angular.element(t).on("keydown",function(e){o.test(event.key)||this.value.length==i&&e.preventDefault()})}}}]),e.register.directive("hcDescription",["$rootScope","apiProvider","authService","corpWellnessService","$sce","navConstantsSvc",function(e,t,a,i,o,n){return{restrict:"E",scope:{packageDetail:"=",ahc:"="},templateUrl:"/templates/hcDescription.html?"+timeStamp,link:function(t,a,s){function r(e){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"show Dc Detail",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("AHC","showDcDetail",e.packageName+" by "+e.dcName)})}),t.packageDetail.descLoaded||i.getPackageDetail(e.packageId,t.ahc).then(function(e){e.packageDetail&&(t.packageDetail.consultationTest=[],t.packageDetail.nonConsultationTest=[],t.packageDetail=_.extend(t.packageDetail,_.omit(e.packageDetail,"name","id")),t.packageDetail.descLoaded=!0,t.packageDetail.packageTests&&_.each(t.packageDetail.packageTests.testGroups,function(e,a){var i="";"Consultation"===e.name?(_.each(e.tests,function(e,t){i+=e.name+", "}),t.packageDetail.consultationInnerTest=i.slice(0,i.length-2),t.packageDetail.consultationTest.push(e)):(_.each(e.tests,function(e,t){i+=e.name+", "}),e.innerTests=i.slice(0,i.length-2).split(","),t.packageDetail.nonConsultationTest.push(e),t.packageDetail.nonConsultationTestCount+=e.count)}),t.packageDescription=o.trustAsHtml(t.packageDetail.description),t.packageInstructions=o.trustAsHtml(t.packageDetail.instruction))})}t.isMobileView=e.isMobileView,window._Site_Props.__setPackageDetails({packageName:t.packageDetail.packageName,providerName:t.packageDetail.dcName,providerLocation:t.packageDetail.dcLocation}),t.ahc&&(t.ahcInstructions=n.ahcInstructions),r(t.packageDetail),t.hideForm=function(){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Hide Dc Detail",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("AHC","showDcDetail",t.packageDetail.packageName+" by "+t.packageDetail.dcName)})}),t.packageDetail.showDetails=!1};var l=t.$on("clearForm",function(){t.hideForm()});t.$on("$destroy",function(){l()})}}}]),e.register.directive("labsFileUpload",["$rootScope","Upload","$timeout","authService","apiProvider","$window","$http","patternService","notify","corpLabsService","navConstantsSvc",function(e,t,a,i,o,n,s,r,l,c,d){return{restrict:"AE",scope:{isCorpLabs:"=?",isCart:"=?"},templateUrl:"/templates/labsFileUploadTemplate.html?"+timeStamp,link:function(e,n,s){e.step=1,e.phoneNumber="",e.totalFiles=[],e.updatedFiles={},e.patternCheck=r;var p="";e.closePopUp=function(){e.$parent&&e.$parent.$parent&&e.$parent.$parent.$dismiss&&e.$parent.$parent.$dismiss("cancel")},e.validate=function(t,a){var i=new RegExp(e.patternCheck.getRegexExpression(a)),o=String.fromCharCode(t.charCode?t.charCode:t.which);if(!i.test(o)&&13!==t.charCode&&9!==t.charCode)return t.preventDefault(),!1},e.updatePhone=function(t){e.phoneNumber=t},e.uploadRxIfSignedInUser=function(){try{if(e.isCorpLabs?c.sendEvents("Upload Click",{fileType:p}):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Upload Click",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})}),e.isCart)return e.step=4,void e.$emit("prescriptionUpload",e.files[e.files.length-1]);var t=i.isUserSignedin();if(!t)return void(e.step=2);var a=o.apiUrl+"/Labs/UploadRx.json",n={PrescriptionId:e.files[0].result.fileUploadedList[0]};i.makeAjaxCalls(a,n,"POST",t.token).then(function(t){t.data.isSuccess?(e.step=4,e.isCorpLabs?c.sendEvents("Upload Success",{fileType:p}):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Upload Success",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})})):(e.step=5,e.isCorpLabs?c.sendEvents("Upload Failed"):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Upload Failed",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})}))})}catch(s){e.step=5,l({message:"There is some challenge uploading the prescription, please try again later",position:"center",duration:5e3}),e.isCorpLabs?c.sendEvents("Upload Failed"):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Upload Failed",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})})}},e.uploadRxWithPhoneNumber=function(){try{e.isCorpLabs?c.sendEvents("Enter User Details Submit"):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Enter User Details Submit",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})});var t=o.apiUrl+"/Labs/UploadRx.json",a={PrescriptionId:e.files[0].result.fileUploadedList[0],PhoneNumber:e.phoneNumber};i.makeAjaxCalls(t,a,"POST").then(function(t){t.data.isSuccess?(e.step=3,e.isCorpLabs?c.sendEvents("Enter Success"):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Upload Success",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})})):(e.step=5,l({message:"There is some challenge uploading the prescription, please try again later",position:"center",duration:5e3}),e.isCorpLabs?c.sendEvents("Upload Failed"):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Upload Failed",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})}))})}catch(n){e.step=5,e.isCorpLabs?c.sendEvents("Upload Failed"):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Upload Failed",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})})}},e.uploadFiles=function(o,n){if(o){String.prototype.includes||(String.prototype.includes=function(){return String.prototype.indexOf.apply(this,arguments)!==-1});for(var s=0;s<o.length;s++)if(o[s].name.indexOf("exe")>-1||o[s].name.indexOf("bat")>-1||o[s].size/1048576>15)n.push(o[s]),o.splice(s,1),s--;else{var r=_.where(e.totalFiles,{name:o[s].name});_.isEmpty(r)&&e.totalFiles.push(o[s])}}e.files=o,n.length>0&&(e.errFiles=n),0===n.length&&e.totalFiles.length>0&&(e.errFiles=[]),angular.forEach(o,function(o){if(_.contains(e.totalFiles,o)){var n=o.name.split(".").pop();p="pdf"===n?"pdf":"image";var s=n.length,r=o.name.substring(0,o.name.length-s-1)+(new Date).getTime()+"."+o.name.split(".").pop();o=t.rename(o,r),o.isLoading=!0,i.uploadFile(o,d.labtestContract,"Prescription").then(function(t){a(function(){t.data.isSuccess?(o.result=t.data,e.updatedFiles[t.data.fileDetails[0].fileName]=t.data.fileDetails,e.isCorpLabs?c.sendEvents("File Type For Upload",{fileType:p}):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"File Type For Upload",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page",fileType:"pdf"===n?"pdf":"image"}})})):(e.step=5,e.isCorpLabs?c.sendEvents("Upload Failed",{fileType:p}):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Upload Failed",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})})),o.isLoading=!1})},function(t){o.isLoading=!1,e.step=5,e.isCorpLabs?c.sendEvents("Upload Failed",{fileType:p}):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Upload Failed",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})})})}})}}}}]),e.register.directive("mediBookSlot",["$rootScope","navConstantsSvc","authService","$state","apiProvider","$httpParamSerializer","$stateParams","$timeout","notify","$location","$uibModal",function(e,t,a,i,o,n,s,r,l,c,d){return{restrict:"AE",scope:{obj:"=obj",blockDetails:"=blockDetails",errormessage:"=errormessage",callCtrl:"=callCtrl",sponsored:"=?",pipeline:"=?",prefDate:"=?",isRecommendation:"=?",driver:"=?",slotsToShow:"=?",autoBookSlots:"=?",fromTimeline:"=?",dateFilter:"=?",emitSlotHandler:"=?",initDate:"=?",hideDatePicker:"=?",hideHeader:"=?",hideFooter:"=?",dayLimit:"=?",divideByHour:"=?",isLabs:"=?",isNewTemplate:"=?",isNewAhc:"=?",bookTillDate:"=?",fromCorporate:"=?",oldCorporateFlow:"=?",isMediClinic:"=?",mediclinicConfig:"=?",isOfflineConsults:"=?",doctorSlotData:"=doctorSlotData",doctorSlotError:"=doctorSlotError",showSlotsOpenText:"=showSlotsOpenText"},terminal:!0,priority:1e6,templateUrl:"templates/myPopoverTemplate.html?"+timeStamp,link:function(p,m,u){function g(e){var t=e.date,a=p.daysCollection,i=e.mode;return 0===a.length?i="":1===a.length?"day"===i&&t.getDay()===a[0].day:2===a.length?"day"===i&&(t.getDay()===a[0].day||t.getDay()===a[1].day):3===a.length?"day"===i&&(t.getDay()===a[0].day||t.getDay()===a[1].day||t.getDay()===a[2].day):4===a.length?"day"===i&&(t.getDay()===a[0].day||t.getDay()===a[1].day||t.getDay()===a[2].day||t.getDay()===a[3].day):5===a.length?"day"===i&&(t.getDay()===a[0].day||t.getDay()===a[1].day||t.getDay()===a[2].day||t.getDay()===a[3].day||t.getDay()===a[4].day):6===a.length?"day"===i&&(t.getDay()===a[0].day||t.getDay()===a[1].day||t.getDay()===a[2].day||t.getDay()===a[3].day||t.getDay()===a[4].day||t.getDay()===a[5].day):void 0}function h(e){var t=e.date,a=e.mode;if("day"===a)for(var i=new Date(t).setHours(0,0,0,0),o=0;o<p.events.length;o++){var n=new Date(p.events[o].date).setHours(0,0,0,0);if(i===n)return p.events[o].status}return""}function f(e,t){var a=_.isDate(e)?e:new Date(e),i=_.isDate(t)?t:new Date(t);return Math.floor((Date.UTC(i.getFullYear(),i.getMonth(),i.getDate())-Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()))/864e5)}function y(t){p.hideDatePicker||(te=r(function(){var a=t||p.gliderId;j[a]=new Glider(document.querySelector("#"+a),{slidesToShow:"auto",slidesToScroll:"auto",draggable:!0,itemWidth:e.isMobileView?75:100,exactWidth:e.isMobileView?75:100,arrows:{prev:"."+p.gliderPrevClass,next:"."+p.gliderNextClass}})}))}function v(e){var t=e%60,a="",i=Math.floor(e/60);return i>=12?(a="PM",12===i?i=i:i-=12):a="AM",[i,t,a]}function k(){return F&&(U&&V.getHours()<H.autoBookMB||(!_.isEmpty(p.obj.providerSlots)||!_.isEmpty(A))&&V.getHours()<H.autoBookHC)}function b(){return x&&!_.isEmpty(p.obj.providerSlots)&&V.getHours()<H.autoBookCovid}function D(){return p.dateFilter&&V.getHours()<H.autoBookAHC}function C(e){ie=angular.isDefined(e)?e:p.dateArray.findIndex(function(e){return e.isDay===!0}),ie>-1?(oe=p.dateArray[ie],ne=1===f(V,oe.date),se=2===f(V,oe.date),oe.isDisabled||(ne&&!(D()||k()||b())||se&&$)&&!p.isLabs&&!p.isMediClinic&&!p.isOfflineConsults?(p.dateArray[ie].isDay=!1,p.dateArray[ie].isSlotNotAvail=!0,ie+=1,C()):("app.homehealthcare"===i.current.name||"app.genome"===i.current.name||p.sponsored?p.pickTimeWithoutSlot(oe,p.sponsored):p.pickTime(oe,ie),ae=r(function(){document.querySelector("#"+p.gliderId)&&ie>1&&(document.querySelector("#"+p.gliderId).scrollLeft=70*ie)},200))):_.isEmpty(oe)||p.pickTimeWithoutSlot(oe,p.sponsored)}function P(e){if(_.isArray(e)&&!_.isEmpty(e)){p.obj.providerSlots=e;var t=_.first(p.obj.providerSlots).daySlots?"daySlots":"slots";p.pipeline.groupedSlots=_.groupBy(_.flatten(_.pluck(p.obj.providerSlots,t)),function(e){var t=new Date(parseInt(e.date.replace("/Date(","").replace(")/",""))).setHours(0,0,0,0);if(e.workingDaySlots){var a=p.dateArray.find(function(e){return _.isEqual(new Date(t),e.date)});!a||a.isOverbooked||a.isSlotNotAvail||a.isHoliday||a.isDisabled||(a.isDay=!0,a.availableSlots=e.workingDaySlots)}return t}),p.pipeline.updateDateSlots(),C()}else p.obj.providerSlots=null;p.isMedibuddyLoading=!1,y()}function w(e){if(P(e),C(),p.prefDate){var t=angular.copy(p.prefDate.date),a=p.dateArray.findIndex(function(e){return e.date.setHours(0,0,0,0)==t.setHours(0,0,0,0)});a>-1&&(p.pickTime(p.dateArray[a],a),ae=r(function(){document.querySelector("#"+p.gliderId).scrollLeft=70*a},200))}}var S=p.obj;setTimeout(function(){p.isMediClinic&&(p.slotDetails=p.obj)},500),p.preferdStartTime="",p.startWith=0,p.previousWith=0;var T=p.divideByHour?60:30;p.isMediClinic&&(T=p.divideByHour?30:15),p.daysCount=15;var A=p.sponsored||p.prefDate||{};p.currentDay=p.prefDate&&p.prefDate.date?p.prefDate.date:"",p.pipeline||(p.pipeline={}),p.pipeline.homeSampleError=!1;var I="selectedSlot";p.emitSlotHandler&&_.isString(p.emitSlotHandler)&&(I=p.emitSlotHandler),p.userObj=a.isUserSignedin(),p.dropDownConsentFLow=!1,p.dropdownBranches=[],p.isDropDownOpen=!1,p.selectedDropDownBranch=null,p.confirmConsent=!1,p.dropdownDefaultValue="";var O,L={},M=document.getElementsByClassName("timeslider-days")[0];if(document.getElementsByClassName("timeslider-days").length>1)for(O=0;O<document.getElementsByClassName("timeslider-days").length;O++)if(document.getElementsByClassName("timeslider-days")[O].clientWidth>0){M=document.getElementsByClassName("timeslider-days")[O];break}if(M?(p.sliderWidth=M.clientWidth,p.widthOfOneDay=80,p.noOfDaysDisplayed=parseInt(p.sliderWidth/p.widthOfOneDay)-1):(p.noOfDaysDisplayed=7,p.sliderWidth=560,p.widthOfOneDay=80),!_.isEmpty(S))if(S.requests){var B=_.first(S.requests);window._Site_Props.__setPackageDetails({packageName:B.packageName,providerName:B.providerName,providerLocation:B.providerLocation})}else window._Site_Props.__setPackageDetails({packageName:S.packageName,providerName:S.dcName,providerLocation:S.dcLocation});p.isPreviousValue={cursor:"not-allowed"},p.isNextValue={},p.appointmentData={patientName:"",email:"",gender:"",phone:"",dateOfBirth:"",genderValue:t.genderTitle,prefDate:"",prefDateTime:"",relation:""};var F=_.contains(["app.comparePage","app.packagesnew","app.packageDetail","app.oneClick","app.checkout","app.mediCheckoutCart"],i.current.name)||t.contractDetails[p.obj.orderType]==t.healthCheckFilterName||p.obj.contractId==t.ahcContract,x=p.obj.contractId===t.labtestContract&&p.obj.isCovid,N=F||p.isLabs||p.obj.contractId===t.labtestContract;p.blockDates=_.map(t.blockDates,function(e){var t=e.date.substring(e.date.length-4,e.date.length);return e.date=e.date.replace(t,(new Date).getFullYear()+""),e}),p.blockDetails&&_.each(p.blockDetails,function(e,t){var i="";if("provider_overbooking"===e.blockType.toLowerCase())e.idNo&&e.idNo.indexOf(p.obj.dcId)>-1&&(i=new Date(parseInt(e.blockDate.replace("/Date(","").replace(")/",""))),p.blockDates.push({date:i.toLocaleDateString("en-US").replace(/[^ -~]/g,""),reason:"overbooking"}));else if("holiday"===e.blockType.toLowerCase())(!e.idNo||0===e.idNo.length||e.idNo.indexOf(p.obj.dcId)>-1)&&(i=new Date(parseInt(e.blockDate.replace("/Date(","").replace(")/",""))),p.blockDates.push({date:i.toLocaleDateString("en-US").replace(/[^ -~]/g,""),reason:"holiday"}));else if("package_id"===e.blockType.toLowerCase())e.idNo&&e.idNo.indexOf(p.obj.packageId)>-1&&(i=new Date(parseInt(e.blockDate.replace("/Date(","").replace(")/",""))),p.blockDates.push({date:i.toLocaleDateString("en-US").replace(/[^ -~]/g,""),reason:"overbooking"}));else if("policy_enddate"===e.blockType.toLowerCase()){var o=a.isUserSignedin();if(e.idNo&&e.idNo.indexOf(o.userDetails.pmEntityID.toString())>-1){i=new Date(parseInt(e.blockDate.replace("/Date(","").replace(")/","")));var n=_.range(20);_.each(n,function(e){p.blockDates.push({date:i.toLocaleDateString("en-US").replace(/[^ -~]/g,""),reason:"policy expired"}),i.setDate(i.getDate()+1)})}}else"mediclinic"===e.blockType.toLowerCase()&&(i=new Date(e.blockDate),p.blockDates.push({date:i.toLocaleDateString("en-US").replace(/[^ -~]/g,""),reason:"overbooking"}))}),p.close=function(){p.dateArray[p.pickTimeIndex].isOpen=!1,p.FinalTime=p.preferdStartTime},p.isOfflineConsults=a.isOfflineConsults,Date.prototype.addDays=function(e){return this.setDate(this.getDate()+parseInt(e)),this},Date.prototype.addDays1=function(e){var t=new Date(this.valueOf());return t.setDate(t.getDate()+e),t},p.takeServerDate=function(){var e;return e=a.serverDate?new Date(a.serverDate):new Date};var E=p.takeServerDate();E=E.addDays(p.daysCount),p.dateOptions={dateDisabled:g,formatYear:"yy",maxDate:E,minDate:p.takeServerDate(),startingDay:1},p.showPopover=!1,p.pad=function(e,t){return e=e.toString(),e.length<t?p.pad("0"+e,t):e},p.selectDropDownBranch=function(e){p.selectedDropDownBranch=e,
p.isDropDownOpen=!1},p.doConsent=function(){p.modalInstance&&p.modalInstance.close(),p.confirmConsent=!0},p.openConsentForm=function(){p.modalInstance=d.open({templateUrl:"templates/,.html?"+timeStamp,size:"sm",resolve:{proceedFurther:function(){return p.doConsent}},controller:["$scope","$uibModalInstance","proceedFurther",function(e,t,a){e.proceedFurther=a,e.closeModal=function(){t.dismiss("cancel")}}]})},p.calculateTimeSlots=function(e){var t=[],a=0,i=0;a=e.slotStartTime,i=e.slotEndTime;for(var o=a;o<i;o++){var n;o===a?n=a:(n=a+T,a=n),i>=n&&t.push({slotStartTime:n})}return t},p.today=function(){p.dt=p.takeServerDate()},p.today(),p.inlineOptions={customClass:h,minDate:p.takeServerDate(),showWeeks:!0};var R;p.localScope=p,p.instantbooking=!1,p.selectSlots=function(e){p.selectedSlotsValue=e},p.getDeviceType=function(e){p.deviceType=e},p.clearDeviceTypeSelection=function(){p.deviceType=void 0},p.createMCConsult=function(e){return p.selectedSlotsValue?e?"2"!=e||p.deviceType?p.selectedSlotsValue.active?("1"!=e&&p.deviceType||(p.deviceType="medibuddy"),p.selectedSlotsValue.callType=e,p.selectedSlotsValue.deviceType=p.deviceType,void p.$emit("selectedSlotMC",p.selectedSlotsValue)):void l({message:"Slot Not Available. Please Select Another Slot",position:"center",duration:5e3}):void l({message:"Please Select Device Type for Video Call",position:"center",duration:5e3}):void l({message:"Please Select Consult Type",position:"center",duration:5e3}):void l({message:"Please Select a Slot",position:"center",duration:5e3})},p.selectedTime=function(t,i){angular.forEach(p.slots,function(a,i){a.slotStartTime===t.slotStartTime&&a.startTime===t.startTime&&a.isSelected===t.isSelected?(p.slots[i].isSelected=!0,R=r(function(){if(e.isMobileView){var t="AM"==p.slots[i].startTimeAmPm?"amGlider":"pmGlider";document.querySelector("#"+t).scrollLeft=70*i}},200)):p.slots[i].isSelected=!1}),p.hideDatePicker||(p.currentDay=p.dayPrefered),angular.forEach(p.dateArray,function(e,t){p.dateArray[t].isSelected=!1});var o=_.find(p.dateArray,function(e){return e.date.setHours(0,0,0,0)==p.currentDay.setHours(0,0,0,0)});o.isSelected=!0,p.dateArray.push(o),p.dateArray=a.getUniqId(p.dateArray);var n,s,l,c,d;if(p.instantbooking?(p.preferdStartTime=p.instantTime,p.preferdEndTime=t.endTime+t.endTimeAmPm,p.isSelectedPreferdTime=!0,n=parseInt(p.nowT.split(":",2)[1]),s=0,l=0,c=parseInt(p.nowT.split(":",2)),d=new Date(p.currentDay.getFullYear(),p.currentDay.getMonth(),p.currentDay.getDate(),c,n,s,l),p.prefDateTime=d,p.prefDateTimeString=t.slotStartDateTime,L.slotDistributionForDate=t.slotDistributionForDate||[],L.slotDistributionForInterval=t.slotDistributionForInterval||[],p.isError=!1):(p.preferdStartTime=t.startTime+" "+t.startTimeAmPm,p.preferdEndTime=t.endTime+t.endTimeAmPm,p.isSelectedPreferdTime=!0,n=t.slotStartTime%60,s=0,l=0,c=Math.floor(t.slotStartTime/60),d=new Date(p.currentDay.getFullYear(),p.currentDay.getMonth(),p.currentDay.getDate(),c,n,s,l),p.prefDateTime=d,p.prefDateTimeString=t.slotStartDateTime,L.slotDistributionForDate=t.slotDistributionForDate||[],L.slotDistributionForInterval=t.slotDistributionForInterval||[],p.isError=!1),p.hideFooter){var m={date:p.currentDay,time:p.preferdStartTime,endTime:p.preferdEndTime,provider:p.obj,prefDateTime:p.prefDateTime,slotStartTime:t.slotStartTime};t.servingProviders&&(m.servingProviders=t.servingProviders),p.$emit(I,m)}},p.gliderId="glider"+(""+Math.random()).substring(2,5),p.gliderPrevClass="glider-prev-"+(""+Math.random()).substring(2,5),p.gliderNextClass="glider-next-"+(""+Math.random()).substring(2,5);var j={};p.isMobileView=e.isMobileView,p.pickTimeWithoutSlot=function(e,t){p.tempData&&(p.tempData.isSelected=!1),p.sponsored&&(p.sponsored.prefDate={date:e.date,position:document.getElementById(p.gliderId)?document.getElementById(p.gliderId).scrollLeft:0},p.sponsored.fetchSlotInfo(t)),p.tempData=e,e.isSelected=!0,p.isSelectedPreferdTime=!0,p.prefDateTime=e.date,p.preferdStartTime=e.date,p.FinalTime=e.date},p.pickTime=function(e,t){if(p.preferdStartTime="",p.pickTimeIndex=t,e.isDay===!0){if(p.dayPrefered=e.date,p.tempData&&(p.tempData.isSelected=!1),p.tempData=e,e.showPopover=!e.showPopover,e.isSelected=!0,p.selectedDayTime=[],p.prefDate&&p.prefDate.date){var a=new Date(p.prefDate.date).getTime();p.pipeline.groupedSlots[a]&&p.fromCorporate?angular.forEach(p.pipeline.groupedSlots[a],function(e,t){e.providerId==parseInt(p.obj.dcId)&&angular.forEach(e.workingDaySlots,function(e,t){p.selectedDayTime.push(e)})}):p.pipeline.oldCorporateProviderGroupedSlots&&p.pipeline.oldCorporateProviderGroupedSlots[a]&&angular.forEach(p.pipeline.oldCorporateProviderGroupedSlots[a],function(e,t){e.providerId==parseInt(p.obj.dcId)&&angular.forEach(e.workingDaySlots,function(e,t){p.selectedDayTime.push(e)})})}if(e.availableSlots?(angular.forEach(e.availableSlots,function(e,t){p.selectedDayTime.push(e)}),p.selectedDayTime.push(e.availableSlots)):W&&!p.fromCorporate&&angular.forEach(W,function(t,a){t.day===e.day&&angular.forEach(t,function(e,t){p.selectedDayTime.push(e)})}),!_.isEmpty(p.selectedDayTime))if(N){var i=p.selectedDayTime[1].map(function(e){return _.pick(e,"slotStartTime","slotStartDateTime","slotEndTime","slotEndDateTime","servingProviders","slotCount","slotDistributionForDate","slotDistributionForInterval")});p.isLabs?(p.slots=[],p.slots=p.devideTimeSlots(i)):(p.slots={},p.slots[0]=p.devideTimeSlots(i))}else p.slots={},_.each(p.selectedDayTime[1],function(e,t){var a=p.calculateTimeSlots(p.selectedDayTime[1][t]);p.slots[t]=p.devideTimeSlots(a)});p.isTime=!0}else p.isTime=!1;if(_.isArray(p.slots)){p.amSlots=p.slots.filter(function(e){return e.slotStartTime<720}),p.amSlotsMweb=[];for(var o=0;o<p.amSlots.length;o+=2)p.amSlotsMweb.push(p.amSlots.slice(o,o+2).map(function(e,t){return e}));p.pmSlots=p.slots.filter(function(e){return e.slotStartTime>=720}),p.pmSlotsMweb=[];for(var o=0;o<p.pmSlots.length;o+=2)p.pmSlotsMweb.push(p.pmSlots.slice(o,o+2).map(function(e,t){return e}))}if(p.emitSlotHandler&&(p.isLabs||p.currentDay)&&(p.$emit("slotDateChange",{date:p.currentDay,prefDate:e.date}),p.prefDate&&p.prefDate.time)){var n=_.union(p.amSlots,p.pmSlots).find(function(e){return e.time==p.prefDate.time});n&&p.selectedTime(n)}console.log(p.dateArray)},p.dynamicPopover={templateUrl:"myPopoverTemplate.html?"+timeStamp},p.devideTimeSlots=function(e){return angular.forEach(e,function(t,a){if(t.slotStartTime||0===t.slotStartTime){var i=v(t.slotStartTime),o=p.pad(i[0],"2")+":"+p.pad(i[1],"2");e[a].startTime=o,e[a].startTimeMweb=i[1]?o:i[0],e[a].isSelected=!1,e[a].startTimeAmPm=i[2],e[a].time=o+" "+i[2],t.slotEndTime&&(i=v(t.slotEndTime),o=p.pad(i[0],"2")+":"+p.pad(i[1],"2"),e[a].endTime=o,e[a].endTimeMweb=i[1]?o:i[0],e[a].endTimeAmPm=i[2])}}),e},p.getDates=function(e,t){var a=[],i=e,o=new Date;for(p.tomorrowDateIndex=-1,e.getFullYear()!==o.getFullYear()||e.getMonth()!==o.getMonth()||e.getDate()!==o.getDate()+1||p.isLabs||p.isMediClinic||p.isOfflineConsults||(p.tomorrowDateIndex=0);i<=t;)a.push(i),i=i.addDays1(1);return a},p.appointmentDetails={packageData:{},userData:{}},p.appointmentDetails.packageData=S;var W=p.appointmentDetails.packageData.availableSlots;W?"homeVisitDate"==p.emitSlotHandler&&S.homeVisitAvailableSlots?W=S.homeVisitAvailableSlots:(1==p.pipeline.homeSampleSelection||p.pipeline.isHomeVisit)&&S.radiologyAvailableSlots&&(W=S.radiologyAvailableSlots):W=p.obj.availableSlots,p.availableSlots=[],_.forEach(W,function(e,t){p.availableSlots[e.day]=e});var U,V=p.takeServerDate(),$=!1,H=t.nextDayThreshold,G=1,q="30";_.isString(p.appointmentDetails.packageData.dcName)&&(U=p.appointmentDetails.packageData.dcName.toLowerCase().indexOf("thyrocare")>-1);var z=new Date,Y=14;!(V.getHours()>=H.autoBookMB)||F||x||p.dateFilter||p.isLabs||p.isMediClinic||p.isOfflineConsults?p.isOfflineConsults&&(G=z.getHours()<Y?1:2):($=!0,G=2);var J=29;"app.olservice"===i.current.name?J=7:(p.isLabs||_.isDate(p.initDate))&&(G=0),p.dayLimit&&(J=p.dayLimit);var K,Q=_.isDate(p.initDate)?Math.floor(p.initDate):a.serverDate||new Date;for(K=p.getDates(new Date(Q).addDays(G),new Date(Q).addDays(J+G)),p.dateArray=[],O=0;O<K.length;O++)p.dateArray.push({id:O+1,showPopover:!1,isOpen:!1,isSelected:!1,date:new Date(K[O].setHours(0,0,0,0)),isDay:!1,day:new Date(K[O]).getDay()});for(var X=0;X<p.dateArray.length;X++){"app.olservice"===i.current.name&&X>2&&(p.dateArray[X].isDay=!1);var Z=p.dateArray[X],ee=_.findWhere(p.blockDates,{date:Z.date.toLocaleDateString("en-US").replace(/[^ -~]/g,"")});ee?(p.dateArray[X].isDay=!1,p.dateArray[X].isDisabled=!0,"overbooking"===ee.reason?p.dateArray[X].isOverbooked=!0:"holiday"===ee.reason&&(p.dateArray[X].isHoliday=!0)):_.isDate(p.bookTillDate)&&p.dateArray[X].date>p.bookTillDate?(p.dateArray[X].isDay=!1,p.dateArray[X].isDisabled=!0):_.isEmpty(p.availableSlots[Z.day])||_.isEmpty(p.availableSlots[Z.day].slots)||(p.dateArray[X].isDay=!0),p.sponsored&&!p.sponsored.isAutoSlotProviderAvailable&&0==X&&(p.dateArray[X].isDay=!1)}var te,ae,ie=-1,oe={},ne=!1,se=!1,re=a.isUserSignedin();if(_.isEmpty(p.obj.providerSlots)&&!A.prefDate&&!p.hideDatePicker&&N||p.oldCorporateFlow){p.isMedibuddyLoading=!0;var le,ce;if(N){le=o.apiUrl+"Labs/ProvidersCalendar";var de=p.obj.dcIds?p.obj.dcIds.map(function(e){return e?parseInt(e):0}):[parseInt(p.obj.dcId)];ce={ProviderIds:_.uniq(de),NoOfDays:q,pmEntityId:re.userDetails.pmEntityID,ContractId:p.obj.contractId,IsHomeVisitCase:!(!p.pipeline.isHomeVisit&&_.isEmpty(p.obj.dcIds)&&!p.obj.homeSampleCollection),packageIds:p.obj.packageIds,pincode:parseInt(p.obj.pincode),noOfSlots:p.obj.noOfSlots,requestIds:p.obj.requestIds},_.isEmpty(ce.packageIds)||isNaN(_.first(ce.packageIds))&&(ce.packageIds=[]),p.oldCorporateFlow&&(ce.ContractId=t.ahcContract,ce.pmEntityId=re.userDetails.pmEntityID,ce.ProviderIds=_.map(p.obj.providers,function(e){return parseInt(e.dcId)}))}else le=o.apiUrl+"/ProviderSlots",ce={ProviderIds:[p.obj.dcId],NoOfDays:q,ContractId:p.obj.contractId};a.makeAjaxCalls(le,ce,"POST",p.userObj.token).then(function(e){if(console.log("ProvidersWithCalendar --> Done",e),e.data.serverDate&&(a.serverDate=parseInt(e.data.serverDate.replace("/Date(",""))),!p.dateFilter){if(e.data.blockTillDate){var t=parseInt(e.data.blockTillDate.replace("/Date(",""));t>0&&(t=new Date(t),_.each(p.dateArray,function(e){e.date<t&&(e.isDay=!1,e.isDisabled=!0)}))}if(e.data.blockTime){var i=parseInt(e.data.blockTime);i>0&&(H.autoBookHC=i,H.autoBookCovid=i)}}_.isEmpty(e.data.providerDetails)||_.isEmpty(e.data.slotDetails)?w(e.data.providerSlots):(console.log("Emitting providers --> Done"),p.$emit("providersForPackage",{providers:e.data.providerDetails.providers,providerSlots:e.data.slotDetails.providerSlots}),e.data.unionOfSlots&&w([{slots:e.data.unionOfSlots}]))},function(e){p.isMedibuddyLoading=!1,y(),C(),l({message:"Unable to get provider slots at this moment, Please try after sometime",position:"center",duration:5e3})})}else r(function(){w(p.obj.providerSlots)});p.bookSlot=function(){r(function(){p.maxMinCheck=!0,p.calendarCheck=!1,_.isUndefined(p.minHours)&&(p.maxMinCheck=!1),("app.homehealthcare"===i.current.name||"app.genome"===i.current.name||p.sponsored)&&(p.calendarCheck=!0,p.isTime=!1),p.$apply()},0,!0)},p.bookSlot(),p.calendarCheck&&(p.isTime=!1),p.setBooking=function(){return e.$broadcast("mbProvider"),p.genomeCantBookCheck=!1,p.userObj=a.isUserSignedin(),p.driver&&p.driver.reset(),p.pipeline.homeSampleError=!1,p.pipeline.homeVisitDate&&p.prefDateTime&&Math.floor(p.prefDateTime)<=Math.floor(p.pipeline.homeVisitDate.prefDateTime)?void(p.pipeline.homeSampleError=!0):void(p.emitSlotHandler?(p.isMediClinic&&window._MB_Analytics.__push({isCleverTap:p.dropDownConsentFLow,dbLog:"mediclinic",name:"MC Confirm Slot Button Clicked",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"MediClinic Slot Selection Page",patientId:p.obj.patientId,doctorId:p.obj.doctorUniqueId,prefDateTime:p.preferdStartTime,branch:p.dropDownConsentFLow?p.selectedDropDownBranch.branch:"N/A",zone:p.dropDownConsentFLow?p.selectedDropDownBranch.zone:"N/A"}})}),p.$emit(I,{date:p.currentDay,time:p.preferdStartTime,provider:p.obj,prefDateTime:p.prefDateTime})):p.userObj?_.isEmpty(p.userObj)||a.makeAjaxCalls(o.apiUrl+"/UpdateSession/"+p.userObj.token,"","GET").then(function(e){if(e.data)if(t.jllEntityIds.indexOf(p.userObj.userDetails.pmEntityID)>=0&&"app.genome"===i.current.name)l({message:"This service is not available for you.",position:"center",duration:5e3,classes:"has-error"});else if(F){var o=p.pickTimeIndex;C(o),o==ie&&p.setBookingAfterValidation()}else p.setBookingAfterValidation();else a.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"bookSlot",func:"setBooking",args:null,stayInState:!0})}):p.callCtrl?a.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:p.callCtrl,func:"bookSlotAfterValidation",args:null,stayInState:!0}):a.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"bookSlot",func:"setBooking",args:null,stayInState:!0}))},p.setBookingAfterValidation=function(){p.obj.prefDateTime=p.prefDateTime;var e={};if(p.appointmentDetails.packageData.orderId){if(e={appointmentDate:p.prefDateTime,appointmentDateValue:p.prefDateTime.toDateString(),"Order Id":p.obj.orderId,from:p.fromTimeline?"Timeline":"Track Order"},window._Site_Props.__setServiceDetails({serviceName:t.contractDetails[p.obj.orderType]}),p.obj.requests){var r=_.first(p.obj.requests);window._Site_Props.__setPackageDetails({packageName:r.packageName,providerName:r.providerName,providerLocation:r.providerLocation})}var d={orderId:p.appointmentDetails.packageData.orderId,remarks:"Rescheduled by customer",scheduledDate:p.prefDateTimeString||p.prefDateTime};_.isEmpty(L)||(d.slotDistributionForDate=L.slotDistributionForDate,d.slotDistributionForInterval=L.slotDistributionForInterval),p.pipeline.homeVisitDate&&p.pipeline.homeVisitDate.prefDateTime&&(d.homeVisitDate=p.pipeline.homeVisitDate.prefDateTime,e.homeSampleDate=p.pipeline.homeVisitDate.prefDateTime.toLocaleString());var m=o.apiUrl+"/Reschedule.json";a.makeAjaxCalls(m,d,"POST",p.userObj.token).then(function(i){i.data.isSuccess&&i.data.order?(p.isLabs||window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"RescheduleOrderConfirm",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:e,google:window._Site_Props.__googleTransform(t.contractDetails[p.obj.orderType],"Reschedule",p.obj.packageName+" at "+a.getCity())})}),a.refreshOrders=!0,a.timeline.details=null,p.appointmentDetails.packageData&&p.appointmentDetails.packageData.emit?p.$emit("orderRescheduled",p.prefDateTime):c.url("/orderData?orderid="+i.data.order.orderId)):l({message:"There is some technical issue, Please try after sometime",position:"center",duration:5e3})})["catch"](function(e){l({message:"There is some technical issue, Please try after sometime",position:"center",duration:5e3})})}else if(a.setBookingData=p.obj,a.detailsForBooking={docObj:p.obj,errorMessage:p.errormessage,isMediClinic:p.isMediClinic},s.searchc?(p.eventLabel=p.obj.packageName+" in "+s.searchc+" from "+a.getCity(),p.eventCategory=s.categoryItemTypeId):s.searchk&&(p.eventLabel=s.searchk+" from "+a.getCity(),p.eventCategory=s.categoryItemTypeId),s.categoryItemTypeId===t.investigationFilterName?(p.eventCategory="Labtest",p.eventLabel=p.obj.dcName.trim()):s.categoryItemTypeId===t.dentalFilterName&&(p.eventCategory="Dental",p.eventLabel=p.obj.packageName+" at "+a.getCity()),n(p.obj.prefDateTime),s.categoryItemTypeId===t.genomFilterName&&(p.eventCategory="GENOME",p.eventLabel=p.obj.packageName+" at "+a.getCity()),p.obj.isDentalPackage&&(p.eventCategory="Dental",window._Site_Props.__setServiceDetails({serviceName:p.eventCategory,serviceType:s.searchk})),e={appointmentDate:p.obj.prefDateTime,appointmentDateValue:p.obj.prefDateTime.toDateString()},p.isRecommendation&&(e.isRecommendation=!0),p.pipeline.homeVisitDate&&p.pipeline.homeVisitDate.prefDateTime&&(e.homeSampleDate=p.pipeline.homeVisitDate.prefDateTime.toLocaleString()),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,fbq:!0,fbqReference:"AddToCart",name:p.medicine?"MedsProceedToAddressPage":"Slot Booked",dbLog:!p.medicine||"meds",hj:!0,googleSheet:!0,payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:e,google:window._Site_Props.__googleTransform(p.eventCategory,"slotBooked",p.eventLabel)})}),s.categoryItemTypeId===t.investigationFilterName||s.categoryItemTypeId===t.healthCheckFilterName){var u={sessionData:{},forceUpdate:!0},g=s.categoryItemTypeId===t.investigationFilterName?t.investigationId:t.healthCheckId,h=" diagnostic centers";s.packgName=s.packgName?s.packgName.replace(h,""):"",p.obj.testName=s.packgName,u.sessionData[g]=JSON.stringify(p.obj),a.makeAjaxCalls(o.apiUrl+"/SessionStorage.json",u,"POST",p.userObj.token).then(function(t){t.data.isSuccess&&i.go("app.payment",{categoryItemTypeId:g,searchc:s.searchc,searchk:s.searchk,packageId:p.obj.packageId,dcId:p.obj.dcId,appTime:p.obj.prefDateTime.getTime(),dcName:s.dcName,dcCity:p.obj.dcCity,packgName:s.packgName,coupon:s.coupon,isRecommendation:e.isRecommendation,doctorId:p.obj?p.obj.doctorUniqueId:""},{reload:"app.payment"})})}else s.categoryItemTypeId=a.checkSeriveType[s.categoryItemTypeId],i.go("app.payment",{categoryItemTypeId:p.obj.isDentalPackage?t.dentalPackageId:s.categoryItemTypeId,searchc:s.searchc,searchk:p.obj.isDentalPackage?t.dentalPackageName:s.searchk,packageId:p.obj.packageId,dcId:p.obj.dcId,dcName:s.dcName,dcCity:p.obj.dcCity,appTime:p.obj.prefDateTime.getTime(),pB:p.obj.poweredBy,coupon:s.coupon,isRecommendation:e.isRecommendation,doctorId:p.obj?p.obj.doctorUniqueId:""},{reload:"app.payment"})},r(function(){var e=a.getAddress();window._MB_Analytics.__push({isCleverTap:!0,name:"Provider Visible Issue",payload:window._Site_Props.__getEventParameters({custom:{dateArray:p.dateArray,sponsored:p.sponsored,isTime:p.isTime,isCalender:p.calendarCheck,bookTillDate:p.bookTillDate,serverDate:a.serverDate,user:a.isUserSignedin(),pincode:a.getPincode(),latLong:e&&e.latLng?e.latLng:""}})})});var pe=!1,me=e.$on("bookSlot",function(e,t){pe=!0}),ue=e.$on("userDetails",function(e,t){pe&&p.setBooking()});p.pipeline.updateDateSlots=function(){_.isEmpty(p.pipeline.groupedSlots)?p.dateArray[0].overallSlotState="not-available":(_.each(p.dateArray,function(e,a){var i={max:0,available:0};_.each(p.pipeline.groupedSlots[e.date.setHours(0,0,0,0)],function(e,t){i.max+=e.totalSlots,e.availableSlots>0&&(i.available+=e.availableSlots)}),e.isOverbooked||e.isSlotNotAvail||e.isHoliday||!e.isDay||(0==i.available?(e.overallSlotState={className:"not-available",status:"Unavailiable"},e.isDisabled=!0):i.available<=i.max*(t.minSlotThreshold/100)?e.overallSlotState={className:"almost-full",status:"Filling fast",color:"#cc8800"}:e.overallSlotState={className:"slot-available",status:"Available",color:"#81a200"})}),p.oldCorporateFlow&&p.pipeline.groupedSlots&&(p.pipeline.oldCorporateProviderGroupedSlots=p.pipeline.groupedSlots))},p.prefDate||p.$on("onEditSlot",function(e,t){var a=_.find(p.dateArray,function(e){return e.date.setHours(0,0,0,0)==t.setHours(0,0,0,0)});a&&p.pickTimeWithoutSlot(a)}),p.$on("$destroy",function(){_.each(j,function(e,t){r.cancel(e),e&&(e.destroy(),j[t]=null)}),r.cancel(te),r.cancel(R),r.cancel(ae),me(),ue()})}}}]),e.register.directive("mediListingFilter",["$rootScope","authService","$timeout","$state","navConstantsSvc",function(e,t,a,i,o){return{restrict:"E",replace:!1,scope:{attributePackages:"=bind",weekFilter:"=week",isOfferFilter:"=isofferfilter",isHscFilter:"=ishscfilter",isGoldPartnerFilter:"=isgoldpartnerfilter",goldPartner:"=goldpartner",hsc:"=hsc",offer:"=offer",locSearch:"=locSearch",pipeline:"=?"},templateUrl:"/templates/listing-filter.html?"+timeStamp,link:function(e){e.filterPackageCollection={dummyProvider:[],provider:[],priceRange:[]},e.weeksArray=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],e.changeStatus=function(e){return _.forEach(e,function(t,a){e[a].isSelected=!1}),e},e.filterFor={provider:"provider",location:"Location",age:"Age",week:"Days",price:"Price",gender:"Gender"};var n;e.getFiltersApplied=function(a){n={OnlyDiscounted:!!e.offer&&e.offer.isSelected,OnlyPreferredPartners:!!e.goldPartner&&e.goldPartner.isSelected,OnlyHSC:!!e.hsc&&e.hsc.isSelected,MedicalCenter:e.selectedProviderCollection.length>0?_.pluck(e.selectedProviderCollection,"dcName").join(","):"",Location:e.selectedLocationCollection.length>0?_.pluck(e.selectedLocationCollection,"dcLocation").join(","):"",Gender:_.where(e.genderGroup,{isSelected:!0}).length>0?_.pluck(_.where(e.genderGroup,{isSelected:!0}),"gender").join(","):"",Age:e.selectedAgeCollection.length>0?_.pluck(e.selectedAgeCollection,"ageGroup").join(","):"",AppointmentDay:e.selectedWeeksCollection.length>0?_.pluck(e.selectedWeeksCollection,"day").join(","):"",PriceRange:!(!e.isClearPriceFilter||_.isNaN(e.priceRangeValue.minPrice))&&e.priceRangeValue.minPrice+"-"+e.priceRangeValue.maxPrice},window._Site_Props.__setFilterDetails(n),a||(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"Filter Applied",payload:window._Site_Props.__getEventParameters({service:!0,filter:!0})}),e.eventLabel="",_.forEach(n,function(t,a){t&&(e.eventLabel+=a+", ")}),e.eventLabel=e.eventLabel.length>2?e.eventLabel.substring(0,e.eventLabel.length-2)+" filter applied in ":"Filters reset in ",e.eventLabel+=t.getCity(),window._MB_Analytics.__push({isCleverTap:!1,isGoogle:!0,name:"event",payload:window._Site_Props.__getEventParameters({google:window._Site_Props.__googleTransform(e.eventCategory,"Filter Applied",e.eventLabel)})})),$("#provider-filter").trigger("sticky_kit:recalc")},e.eventCategory="app.hospitalizationlist"===i.current.name?"Hospitalization":i.params.categoryItemTypeId,i.params&&i.params.provider&&(e.filterProvider=i.params.provider),i.params&&i.params.l&&(e.filterLocation=i.params.l),e.selectedLocationCollection=[],e.reloadCollections=function(){e.selectedProviderCollection=[],e.selectedLocationCollection=[],e.selectedGenderrCollection=[],e.selectedAgeCollection=[],e.selectedWeeksCollection=[],e.demoAenitiesCollection=[],e.providerCollectionValue=[],e.amenitiesCollection=[],e.modifiedDataFordcServices=[],e.categoryItemCollectionWithLocation=[],e.locationFinalDataCollection=[],e.filterLocationDataCollection=[],e.categoryItemCollectionDemo=[],e.filterPackageCollection.provider=[],e.filterPackageCollection.priceRange=[],e.minPrice=0,e.maxPrice=0,e.providerCount=0,e.isClearPriceFilter=!1,e.ageGroup=e.changeStatus(o.ageGroup),e.genderGroup=e.changeStatus(o.genderGroup),e.weekGroup=e.weekFilter},e.reloadCollections(),e.getFiltersApplied(!0),e.updateFilter=function(t){e.$emit("updatedFilterCollection",t)},e.isClearPriceFilter=!1,e.clearAllFilter=function(){e.reloadCollections(),e.getFilterData(e.clearAllFilterCollection),e.updateFilter(e.finalCollection),e.priceRangeValue.maxPrice=e.priceRangeValue.MaximumPriceValue,e.priceRangeValue.minPrice=0,e.isClearPriceFilter=!1,e.$emit("priceRangeValue",e.priceRangeValue),e.ageRangeValue.maxAge=100,e.ageRangeValue.minAge=0,e.filterCollection("","Provider"),e.filterCollection("","Location"),e.$emit("filterAHCItems",{Provider:[],Location:[]}),e.genderFilter={type:"both",isTrue:!1},e.offer.isSelected=!1,e.hsc.isSelected=!1,e.goldPartner.isSelected=!1,e.selectedAgeCollection=[],e.selectedWeeksCollection=[],e.clearDaysFilter("Days"),e.collection=[],e.$emit("updateAgeFilter",e.ageRangeValue),e.$emit("updateGenderFilter",e.genderFilter),e.getFiltersApplied(),t.filterObj={}},e.slider={min:100,max:180,options:{floor:0,ceil:450,onEnd:e.priceSliderChanged}},e.ageRangeValue={maxAge:100,minAge:0,isTrue:!1},e.genderFilter={type:"both",isTrue:!1},e.$on("clearLocFilter",function(t,a){a&&e.clearLocationFilter(e.filterFor.location)}),e.mapPriceRange=function(o){var n=Math.round(t.finder(Math.min,o,"price"));e.priceRangeValue={minValue:0,maxValue:0,maxPrice:0,minPrice:0,isTrue:!1,MaximumPriceValue:0,MimPriceValue:0,options:{floor:n,ceil:0,step:1,translate:function(e,t,a){switch(a){case"model":return'<b class="mm mm-rupee"></b>'+e;case"high":return'<b class="mm mm-rupee" ></b> '+e;default:return e=""}}},range:{min:0,max:0}},a(function(){e.priceRangeValue.maxPrice=Math.round(t.finder(Math.max,o,"price")),e.priceRangeValue.MaximumPriceValue=Math.round(t.finder(Math.max,o,"price")),e.maxPrice=e.priceRangeValue.maxPrice>0?e.priceRangeValue.maxPrice:0,e.priceRangeValue.maxPrice.toString(),e.priceRangeValue.minPrice=Math.round(t.finder(Math.min,o,"price")),e.priceRangeValue.MimPriceValue=Math.round(t.finder(Math.min,o,"price")),e.minPrice=e.priceRangeValue.minPrice>0?e.priceRangeValue.minPrice:0,e.priceRangeValue.minPrice.toString(),e.priceRangeValue.range.max=e.priceRangeValue.maxPrice>0?e.priceRangeValue.maxPrice:0,e.priceRangeValue.range.min=e.priceRangeValue.minPrice>0?e.priceRangeValue.minPrice:0,e.priceRangeValue.options.ceil=e.priceRangeValue.range.max,e.priceRangeValue.options.minRange=0,e.priceRangeValue.MaximumPriceValue===e.priceRangeValue.MimPriceValue||"app.hospitalizationlist"===i.current.name?e.isPriceFilter=!1:e.isPriceFilter=!0},1)},e.priceRangeValue={range:{min:0,max:0},minPrice:0,maxPrice:0,MaximumPriceValue:0,MimPriceValue:0,trueValue:!1},e.showProviderBox=!1,e.showLocationBox=!1,e.showPriceBox=!1,e.showAgeBox=!1,e.showDayBox=!1,e.showGenderBox=!1,e.mobileClick=function(t){"Provider"===t?(e.showProviderBox=!0,e.showLocationBox=!1,e.showPriceBox=!1,e.showAgeBox=!1,e.showDayBox=!1,e.showGenderBox=!1):"Location"===t?(e.showProviderBox=!1,e.showLocationBox=!0,e.showPriceBox=!1,e.showAgeBox=!1,e.showDayBox=!1,e.showGenderBox=!1):"Price"===t?(e.showProviderBox=!1,e.showLocationBox=!1,e.showPriceBox=!0,e.showAgeBox=!1,e.showDayBox=!1,e.showGenderBox=!1,e.isClearPriceFilter||e.mapPriceRange(e.resolution)):"Age"===t?(e.showProviderBox=!1,e.showLocationBox=!1,e.showPriceBox=!1,e.showAgeBox=!0,e.showDayBox=!1,e.showGenderBox=!1):"Days"===t?(e.showProviderBox=!1,e.showLocationBox=!1,e.showPriceBox=!1,e.showAgeBox=!1,e.showDayBox=!0,e.showGenderBox=!1):"Gender"===t?(e.showProviderBox=!1,e.showLocationBox=!1,e.showPriceBox=!1,e.showAgeBox=!1,e.showDayBox=!1,e.showGenderBox=!0):"clear"===t&&(e.showProviderBox=!1,e.showLocationBox=!1,e.showPriceBox=!1,e.showAgeBox=!1,e.showDayBox=!1,e.showGenderBox=!1)},e.$on("slideEnded",function(){e.priceRangeValue.MaximumPriceValue!==e.priceRangeValue.maxPrice||e.priceRangeValue.minPrice!==e.priceRangeValue.MimPriceValue?(e.priceRangeValue.isTrue=!0,e.isClearPriceFilter=!0,e.$emit("priceRangeValue",e.priceRangeValue),e.getFiltersApplied()):e.priceRangeValue.isTrue&&(e.$emit("priceRangeValue",e.priceRangeValue),e.getFiltersApplied())}),e.isProviderText=!1,e.isLocationText=!1,e.model={providerNmae:"",locationName:""},e.filterCollection=function(t,a){if(t){e.value=[];var i,o=[];"Provider"===a?(e.isProviderText=!0,i=_.first(e.providerDataCollection),o=[],_.isEmpty(i.dcName)?_.isEmpty(i.hospName)||(angular.forEach(e.providerDataCollection,function(a){a.hospName.toLowerCase().indexOf(t.toLowerCase())===-1&&a.selected!==!0||e.value.push(a)}),e.filterPackageCollection.provider=e.value.length>0?e.value:[]):(angular.forEach(e.providerDataCollection,function(a){(a.dcName&&a.dcName.toLowerCase().indexOf(t.toLowerCase())!==-1||a.selected===!0)&&e.value.push(a)}),e.filterPackageCollection.provider=e.value.length>0?e.value:[])):"Gender"===a?(angular.forEach(e.amenitiesDataCollection,function(a){a.name.toLowerCase().indexOf(t.toLowerCase())!==-1&&e.value.push(a)}),e.modifiedDataFordcServices=e.value.length>0?e.value:[]):"Location"===a&&(e.isLocationText=!0,i=_.first(e.providerDataCollection),o=[],_.isEmpty(i.dcLocation)?_.isEmpty(i.hospBranch)||(angular.forEach(e.locationFinalDataCollection,function(a){a.hospBranch.toLowerCase().indexOf(t.toLowerCase())===-1&&a.selectedlocation!==!0||e.value.push(a)}),e.filterLocationDataCollection=e.value.length>0?e.value:[]):(angular.forEach(e.locationFinalDataCollection,function(a){(a.dcLocation&&a.dcLocation.toLowerCase().indexOf(t.toLowerCase())!==-1||a.selectedlocation===!0)&&e.value.push(a)}),e.filterLocationDataCollection=e.value.length>0?e.value:[]))}else"Gender"===a?e.modifiedDataFordcServices=e.amenitiesDataCollection:"Provider"===a?(e.isProviderText=!1,e.model.providerNmae="",e.filterPackageCollection.provider=e.providerDataCollection):"Location"===a&&(e.isLocationText=!1,e.model.locationName="",e.filterLocationDataCollection=e.locationFinalDataCollection)},e.clearFilterText=function(t){"Location"===t?e.filterCollection("",t):"Provider"===t&&e.filterCollection("",t)},e.gender={id:""},e.selectedAgeObj=[],e.selectedGenderObj=[],e.filterOffer=function(){e.isOfferFilter||(angular.noop(),e.offer.isSelected=!0),e.offer.isSelected=!e.offer.isSelected,e.getFiltersApplied()},e.filterHsc=function(){e.isHscFilter||(angular.noop(),e.hsc.isSelected=!0),e.hsc.isSelected=!e.hsc.isSelected,e.getFiltersApplied()},e.filterGoldPartner=function(){e.isGoldPartnerFilter||(angular.noop(),e.goldPartner.isSelected=!0),e.goldPartner.isSelected=!e.goldPartner.isSelected,e.getFiltersApplied()},e.filterAge=function(a){if(e.isAgeFilter)angular.noop();else{e.selectedAgeObj.push(a);var i=t.getUniqId(e.selectedAgeObj);_.forEach(i,function(e,t){e.id===a.id&&(i[t].isSelected=e.isSelected===!1)}),e.packagesIdefilter(i,"Age")}},e.filterGender=function(a){if(e.isGenderFilter)angular.noop();else{e.selectedGenderObj.push(a);var i=t.getUniqId(e.selectedGenderObj);_.forEach(i,function(e,t){e.id===a.id&&(i[t].isSelected=e.isSelected===!1)}),e.packagesIdefilter(i,"Gender")}},e.selectedWeeksrObj=[],e.filterWeeks=function(a){e.selectedWeeksrObj.push(a);var i=t.getUniqId(e.selectedWeeksrObj);_.forEach(i,function(e,t){e.id===a.id&&(i[t].isSelected=e.isSelected===!1)}),e.packagesIdefilter(i,"Week")},e.filterDays=function(e,t){var a=[];return _.forEach(e,function(i,o){_.forEach(i.availableSlots,function(i,o){i.day===t&&a.push(e[o])})}),a},e.filterSelectedCollection=function(t,a,o){var n,s,r=[];if(t.length>0){if(e.filterCollectionData=o,"Provider"===a){var l=[];r=_.first(t),s=[],_.isEmpty(r.dcName)?_.isEmpty(r.hospName)||_.forEach(t,function(t){_.forEach(e.filterCollectionData,function(a,i){t.hospName===a.hospName&&l.push(e.filterCollectionData[i])})}):_.forEach(t,function(t){_.forEach(e.filterCollectionData,function(a,i){t.dcName===a.dcName&&l.push(e.filterCollectionData[i])})}),e.categoryItemCollection=l,e.dummyFilteredCollectionOfProvider=l,n=e.categoryItemCollection}else if("Week"===a)e.searchResultDemoWeekCollection0=[],e.searchResultDemoWeekCollection1=[],e.searchResultDemoWeekCollection2=[],e.searchResultDemoWeekCollection3=[],e.searchResultDemoWeekCollection4=[],e.searchResultDemoWeekCollection5=[],e.searchResultDemoWeekCollection6=[],e.combinedData=[],_.forEach(t,function(t,a){_.forEach(e.filterCollectionData,function(a,i){a.daysSet0===t.day?e.searchResultDemoWeekCollection0.push(e.filterCollectionData[i]):a.daysSet1===t.day?e.searchResultDemoWeekCollection1.push(e.filterCollectionData[i]):a.daysSet2===t.day?e.searchResultDemoWeekCollection2.push(e.filterCollectionData[i]):a.daysSet3===t.day?e.searchResultDemoWeekCollection3.push(e.filterCollectionData[i]):a.daysSet4===t.day?e.searchResultDemoWeekCollection4.push(e.filterCollectionData[i]):a.daysSet5===t.day?e.searchResultDemoWeekCollection5.push(e.filterCollectionData[i]):a.daysSet6===t.day&&e.searchResultDemoWeekCollection6.push(e.filterCollectionData[i])}),e.daysData0=e.searchResultDemoWeekCollection0,e.daysData1=e.searchResultDemoWeekCollection1,e.daysData2=e.searchResultDemoWeekCollection2,e.daysData3=e.searchResultDemoWeekCollection3,e.daysData4=e.searchResultDemoWeekCollection4,e.daysData5=e.searchResultDemoWeekCollection5,e.daysData6=e.searchResultDemoWeekCollection6;var i=0;if(e.daysData0.length>0)for(i=0;i<e.daysData0.length;i++)e.combinedData.push(e.daysData0[i]);if(e.daysData1.length>0)for(i=0;i<e.daysData1.length;i++)e.combinedData.push(e.daysData1[i]);if(e.daysData2.length>0)for(i=0;i<e.daysData2.length;i++)e.combinedData.push(e.daysData2[i]);
if(e.daysData3.length>0)for(i=0;i<e.daysData3.length;i++)e.combinedData.push(e.daysData3[i]);if(e.daysData4.length>0)for(i=0;i<e.daysData4.length;i++)e.combinedData.push(e.daysData4[i]);if(e.daysData5.length>0)for(i=0;i<e.daysData5.length;i++)e.combinedData.push(e.daysData5[i]);if(e.daysData6.length>0)for(i=0;i<e.daysData6.length;i++)e.combinedData.push(e.daysData6[i])}),"app.consultation"===i.current.name?s=_.uniq(e.combinedData,function(e){return e.doctorName}):"app.packagesnew"!==i.current.name&&"app.labtest"!==i.current.name||(s=_.uniq(e.combinedData,function(e){return e.trackId})),e.categoryItemCollection=s,e.dummyFilteredCollectionOfWeek=e.categoryItemCollection,n=e.categoryItemCollection;else if("Location"===a){var c=[];r=_.first(t),s=[],_.isEmpty(r.dcLocation)?_.isEmpty(r.hospBranch)||_.forEach(t,function(t){_.forEach(e.filterCollectionData,function(a,i){(t.hospBranch===a.hospBranch||"home sample collection"===a.homeSampleCollection&&c.indexOf(a)===-1)&&c.push(e.filterCollectionData[i])})}):_.forEach(t,function(t){_.forEach(e.filterCollectionData,function(a,i){(t.dcLocation===a.dcLocation||"home sample collection"===a.homeSampleCollection&&c.indexOf(a)===-1)&&c.push(e.filterCollectionData[i])})}),e.categoryItemCollection=c,e.dummyFilteredCollectionOfLocation=c}n=e.categoryItemCollection,e.$emit("updatedFilterCollection",e.categoryItemCollection)}return n},e.isMin=function(e){for(var t=e[0].start,a=0;a<=e.length-1;a++)Number(e[a].start)<t&&(t=e[a].start);return t},e.isMax=function(e){for(var t=e[0].end,a=0;a<=e.length-1;a++)Number(e[a].end)>t&&(t=e[a].end);return t},e.packagesIdefilter=function(a,i){var o={},n={},s={};a&&("provider"===i.toLowerCase()?(a.selected=a.selected===!1,e.selectedProviderCollection.push(a),e.selectedProviderCollection=_.where(e.selectedProviderCollection,{selected:!0}),e.selectedProviderCollection=t.getUniqCollectionProvider(e.selectedProviderCollection),e.$emit("filterAHCItems",{Provider:e.selectedProviderCollection,Location:e.selectedLocationCollection}),0===e.selectedProviderCollection.length?0===e.selectedWeeksCollection.length&&0===e.selectedLocationCollection.length?(e.categoryItemCollection=e.finalCollection,e.updateFilter(e.categoryItemCollection)):0===e.selectedWeeksCollection.length&&0===e.selectedLocationCollection.length||(e.selectedLocationCollection.length>0&&e.selectedWeeksCollection.length>0?(o=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",e.finalCollection),n=e.filterSelectedCollection(e.selectedLocationCollection,"Location",o),e.updateFilter(n)):e.selectedWeeksCollection.length>0?(s=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",e.finalCollection),e.updateFilter(s)):e.selectedLocationCollection.length>0&&(s=e.filterSelectedCollection(e.selectedLocationCollection,"Location",e.finalCollection),e.updateFilter(s))):e.selectedProviderCollection.length>0&&(0===e.selectedWeeksCollection.length&&0===e.selectedLocationCollection.length?(s=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",e.finalCollection),e.updateFilter(s)):0===e.selectedWeeksCollection.length&&0===e.selectedLocationCollection.length||(e.selectedWeeksCollection.length>0&&e.selectedLocationCollection.length>0?(o=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",e.finalCollection),n=e.filterSelectedCollection(e.selectedLocationCollection,"Location",o),s=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",n),e.updateFilter(s)):e.selectedWeeksCollection.length>0?(o=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",e.finalCollection),s=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",o),e.updateFilter(s)):e.selectedLocationCollection.length>0&&(n=e.filterSelectedCollection(e.selectedLocationCollection,"Location",e.finalCollection),s=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",n),e.updateFilter(s))))):"week"===i.toLowerCase()?(e.selectedWeeksCollection=_.where(a,{isSelected:!0}),0===e.selectedWeeksCollection.length?0===e.selectedProviderCollection.length&&0===e.selectedLocationCollection.length?(e.categoryItemCollection=e.finalCollection,e.updateFilter(e.categoryItemCollection)):0===e.selectedProviderCollection.length&&0===e.selectedLocationCollection.length||(e.selectedProviderCollection.length>0&&e.selectedLocationCollection.length>0?(0===e.dummyFilteredCollectionOfLocation.length||0===e.dummyFilteredCollectionOfProvider.length?e.categoryItemCollection=[]:(o=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",e.finalCollection),n=e.filterSelectedCollection(e.selectedLocationCollection,"Location",o)),e.updateFilter(n)):e.selectedProviderCollection.length>0?(s=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",e.finalCollection),e.updateFilter(s)):e.selectedLocationCollection.length>0&&(s=e.filterSelectedCollection(e.selectedLocationCollection,"Location",e.finalCollection),e.updateFilter(s))):e.selectedWeeksCollection.length>0&&(0===e.selectedProviderCollection.length&&0===e.selectedLocationCollection.length?(s=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",e.finalCollection),e.updateFilter(s)):0===e.selectedProviderCollection.length&&0===e.selectedLocationCollection.length||(e.selectedProviderCollection.length>0&&e.selectedLocationCollection.length>0?(o=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",e.finalCollection),n=e.filterSelectedCollection(e.selectedLocationCollection,"Location",o),s=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",n),e.updateFilter(s)):e.selectedProviderCollection.length>0?(o=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",e.finalCollection),s=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",o),e.updateFilter(s)):e.selectedLocationCollection.length>0&&(n=e.filterSelectedCollection(e.selectedLocationCollection,"Location",e.finalCollection),s=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",n),e.updateFilter(s))))):"age"===i.toLowerCase()?(e.selectedAgeCollection=_.where(a,{isSelected:!0}),e.selectedAgeCollection.length>0?(e.ageRangeValue.maxAge=e.isMax(e.selectedAgeCollection),e.ageRangeValue.minAge=e.isMin(e.selectedAgeCollection),e.ageRangeValue.isTrue=!0,e.$emit("updateAgeFilter",e.ageRangeValue)):(e.ageRangeValue.maxAge=100,e.ageRangeValue.minAge=0,e.ageRangeValue.isTrue=!0,e.$emit("updateAgeFilter",e.ageRangeValue))):"gender"===i.toLowerCase()?(e.collection=_.where(a,{isSelected:!0}),1===e.collection.length?(e.genderFilter={type:e.collection[0].gender,isTrue:!0},e.$emit("updateGenderFilter",e.genderFilter)):(e.genderFilter={type:"both",isTrue:!0},e.$emit("updateGenderFilter",e.genderFilter))):"location"===i.toLowerCase()&&(a.hospBranch?(a.selectedlocation===!1?a.selectedlocation=!0:a.selectedlocation===!0&&(a.selectedlocation=!1),e.selectedLocationCollection.push(a)):a.dcLocation?(a.selectedlocation===!1?a.selectedlocation=!0:a.selectedlocation===!0&&(a.selectedlocation=!1),e.selectedLocationCollection.push(a)):e.selectedLocationCollection=[],e.selectedLocationCollection=_.where(e.selectedLocationCollection,{selectedlocation:!0}),e.selectedLocationCollection=t.getUniqCollectionLocation(e.selectedLocationCollection),0===e.selectedLocationCollection.length?0===e.selectedProviderCollection.length&&0===e.selectedWeeksCollection.length?(e.categoryItemCollection=e.finalCollection,e.updateFilter(e.categoryItemCollection)):0===e.selectedProviderCollection.length&&0===e.selectedWeeksCollection.length||(e.selectedProviderCollection.length>0&&e.selectedWeeksCollection.length>0?(o=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",e.finalCollection),n=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",o),e.updateFilter(n)):e.selectedProviderCollection.length>0?(s=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",e.finalCollection),e.updateFilter(s)):e.selectedWeeksCollection.length>0&&(s=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",e.finalCollection),e.updateFilter(s))):e.selectedLocationCollection.length>0&&(0===e.selectedProviderCollection.length&&0===e.selectedWeeksCollection.length?(s=e.filterSelectedCollection(e.selectedLocationCollection,"Location",e.finalCollection),e.updateFilter(s)):0===e.selectedProviderCollection.length&&0===e.selectedWeeksCollection.length||(e.selectedProviderCollection.length>0&&e.selectedWeeksCollection.length>0?(o=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",e.finalCollection),n=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",o),s=e.filterSelectedCollection(e.selectedLocationCollection,"Location",n),e.updateFilter(s)):e.selectedProviderCollection.length>0?(n=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",e.finalCollection),s=e.filterSelectedCollection(e.selectedLocationCollection,"Location",n),e.updateFilter(s)):e.selectedWeeksCollection.length>0&&(o=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",e.finalCollection),s=e.filterSelectedCollection(e.selectedLocationCollection,"Location",o),e.updateFilter(s)))),e.$emit("filterAHCItems",{Provider:e.selectedProviderCollection,Location:e.selectedLocationCollection}))),e.getFiltersApplied()},e.getFilterData=function(a){if(a.length>0&&(e.isAgeFilter="app.consultation"===i.current.name,e.isGenderFilter="app.consultation"===i.current.name,"app.hospitalizationlist"===i.current.name&&(e.isAgeFilter=!0,e.isGenderFilter=!0,e.isWeekFilter=!0,e.isPriceFilter=!1),e.categoryItemCollection=a,e.finalCollection=e.categoryItemCollection,angular.forEach(e.categoryItemCollection,function(t,a){t.selectedlocation=!1,(t.dcLocation||t.hospBranch)&&e.categoryItemCollectionWithLocation.push(e.categoryItemCollection[a])}),e.categoryItemCollection=e.categoryItemCollectionWithLocation,e.locationFinalDataCollection=t.getUniqCollectionLocation(e.categoryItemCollectionWithLocation),e.filterLocationDataCollection=t.getUniqCollectionLocation(e.categoryItemCollectionWithLocation),e.backupuLocation=e.locationFinalDataCollection,e.providerCollection=t.getUniqCollectionProvider(e.categoryItemCollection),e.filterPackageCollection.provider=e.providerCollection,angular.forEach(e.providerCollection,function(t,a){t.dcName&&t.dcName===e.filterProvider&&(e.filterInital=!0,e.filterOnDc=t),t.selected=!1,e.providerCollectionValue.push(e.providerCollection[a])}),e.filterPackageCollection.provider=e.providerCollectionValue,e.filterPackageCollection.dummyProvider=e.providerCollectionValue,e.providerCount=e.filterPackageCollection.provider.length,e.providerDataCollection=e.filterPackageCollection.provider,_.forEach(e.categoryItemCollection,function(t){t.dcServices&&t.dcServices.length>0&&_.forEach(t.dcServices,function(a,i){e.modifiedDataFordcServices.push({id:i+1,name:t.dcServices[i],selected:!1})})}),_.forEach(e.categoryItemCollection,function(e,t){e.dummyDcServices=[]}),e.modifiedDataFordcServices=t.getUniqCollectionName(e.modifiedDataFordcServices),e.amenitiesDataCollection=e.modifiedDataFordcServices,e.NewFieldForDcServices=t.getNewFieldForDcServices(e.modifiedDataFordcServices,e.categoryItemCollection),e.finalCollection=e.categoryItemCollection,e.locSearch)){var o=_.findWhere(e.filterLocationDataCollection,{dcLocation:e.locSearch});o&&e.packagesIdefilter(o,"Location")}e.categoryItemCollection.length>0&&(e.resolution=e.categoryItemCollection,e.mapPriceRange(e.categoryItemCollection)),e.filterInital&&e.filterOnDc&&e.packagesIdefilter(e.filterOnDc,"Provider")},e.clearProviderFilter=function(t){if(e.model.providerNmae="","provider"===t.toLowerCase()){var a=[];angular.forEach(e.filterPackageCollection.dummyProvider,function(t,i){t.selected=!1,a.push(e.filterPackageCollection.dummyProvider[i])}),e.filterPackageCollection.provider=a,e.packagesIdefilter([],"Provider")}},e.clearLocationFilter=function(t){if(e.model.locationName="","location"===t.toLowerCase()){var a=[];e.filterLocationDataCollection=e.backupuLocation,angular.forEach(e.backupuLocation,function(t,i){t.selectedlocation=!1,a.push(e.backupuLocation[i])}),e.filterLocationDataCollection=a,t={dcLocation:""},e.packagesIdefilter(t,"Location")}},e.clearPriceFilter=function(t){"price"===t.toLowerCase()&&(e.priceRangeValue.maxPrice=e.priceRangeValue.MaximumPriceValue,e.priceRangeValue.minPrice=e.priceRangeValue.MimPriceValue,e.priceRangeValue.isTrue=!0,e.isClearPriceFilter=!1,e.$emit("priceRangeValue",e.priceRangeValue))},e.clearAgeFilter=function(t){"age"===t.toLowerCase()&&(e.packagesIdefilter([],"Age"),e.ageRangeValue.maxAge=100,e.ageRangeValue.minAge=0,e.genderFilter={type:"both",isTrue:!1},e.ageGroup=e.changeStatus(o.ageGroup),e.$emit("updateAgeFilter",e.ageRangeValue))},e.clearDaysFilter=function(t){"days"===t.toLowerCase()&&(e.weekGroup=e.changeStatus(o.weekGroup),e.packagesIdefilter([],"Week"))},e.clearGenderFilter=function(t){"gender"===t.toLowerCase()&&(e.genderGroup=e.changeStatus(o.genderGroup),e.packagesIdefilter([],"Gender"))},e.$watch("attributePackages",function(t){t&&(e.attributeAssessment="",e.reloadCollections(),e.clearAllFilterCollection=t,e.getFilterData(t))}),e.$on("applyFilters",function(t,i){i.OnlyDiscounted&&(e.offer.isSelected=!0,e.getFiltersApplied()),i.OnlyPreferredPartners&&(e.goldPartner.isSelected=!0,e.getFiltersApplied()),i.OnlyHSC&&(e.hsc.isSelected=!0,e.getFiltersApplied()),i.Gender&&i.Gender.split(",").forEach(function(t){var a=_.findWhere(e.genderGroup,{gender:t});e.filterGender(a)}),i.Age&&i.Age.split(",").forEach(function(t){var a=_.findWhere(e.ageGroup,{ageGroup:t});e.filterAge(a)}),i.AppointmentDay&&i.AppointmentDay.split(",").forEach(function(t){var a=_.findWhere(e.weekGroup,{day:parseInt(t)});a.isSelected=!1,e.filterWeeks(a)}),i.MedicalCenter&&i.MedicalCenter.split(",").forEach(function(t){var a=_.findWhere(e.filterPackageCollection.provider,{dcName:t});e.packagesIdefilter(a,"Provider")}),i.Location&&i.Location.split(",").forEach(function(t){var a=_.findWhere(e.filterLocationDataCollection,{dcLocation:t});e.packagesIdefilter(a,"Location")}),a(function(){i&&i.PriceRange&&(e.priceRangeValue.minPrice=i.PriceRange.split("-")[0],e.priceRangeValue.maxPrice=i.PriceRange.split("-")[1],e.$emit("slideEnded",e.priceRangeValue))})}),e.$on("$destroy",function(){_.extend(t.filterObj,n)}),e.pipeline={updateFilters:function(t){e.reloadCollections(),e.clearAllFilterCollection=_.union(e.clearAllFilterCollection,t),e.getFilterData(e.clearAllFilterCollection)}}}}}]),e.register.directive("mediAppointmentForm",["$rootScope","navConstantsSvc","$sce","patternService","authService","$state",function(e,t,a,i,o,n){return{restrict:"E",replace:!0,scope:{openForm:"=open",maxHours:"=?",minHours:"=?",validate:"=validate"},templateUrl:"/templates/appointmentForm.html?"+timeStamp,link:function(e){function a(t){var a=t.date,i=e.daysCollection,o=t.mode;return 0===i.length?o="":1===i.length?"day"===o&&a.getDay()===i[0].day:2===i.length?"day"===o&&(a.getDay()===i[0].day||a.getDay()===i[1].day):3===i.length?"day"===o&&(a.getDay()===i[0].day||a.getDay()===i[1].day||a.getDay()===i[2].day):4===i.length?"day"===o&&(a.getDay()===i[0].day||a.getDay()===i[1].day||a.getDay()===i[2].day||a.getDay()===i[3].day):5===i.length?"day"===o&&(a.getDay()===i[0].day||a.getDay()===i[1].day||a.getDay()===i[2].day||a.getDay()===i[3].day||a.getDay()===i[4].day):6===i.length?"day"===o&&(a.getDay()===i[0].day||a.getDay()===i[1].day||a.getDay()===i[2].day||a.getDay()===i[3].day||a.getDay()===i[4].day||a.getDay()===i[5].day):void 0}function s(t){var a=t.date,i=t.mode;if("day"===i)for(var o=new Date(a).setHours(0,0,0,0),n=0;n<e.events.length;n++){var s=new Date(e.events[n].date).setHours(0,0,0,0);if(o===s)return e.events[n].status}return""}e.maxMinCheck=!0,e.calendarCheck=!1,_.isUndefined(e.minHours)&&_.isUndefined(e.minHours)&&(e.maxMinCheck=!1),"app.homehealthcare"!==n.current.name&&"app.genome"!==n.current.name||(e.calendarCheck=!0),e.daysCollection=[],e.takeServerDate=function(){var e=new Date;return o.serverDate&&(e=new Date(o.serverDate)),e},e.today=function(){e.dt=e.takeServerDate()},e.today(),e.inlineOptions={customClass:s,minDate:e.takeServerDate(),showWeeks:!0},e.isError=!1,e.isGenderSelection=!1,e.validateObj=function(t){"alert-danger"===t&&(e.isError=!0),"Gender"===t.type&&(e.isGenderSelection=!0,t.error?e.errorValueForGender=t.error:e.isGenderSelection=!1)},Date.prototype.addDays=function(e){return this.setDate(this.getDate()+parseInt(e)),this},e.daysCount="packageController"===n.current.controller?30:15;var r=e.takeServerDate();r=r.addDays(e.daysCount),e.dateOptions={dateDisabled:a,formatYear:"yy",maxDate:r,minDate:e.takeServerDate(),startingDay:1},e.dateOptionsForDob={formatYear:"yy",maxDate:e.takeServerDate(),minDate:new Date(1917,1,1),startingDay:1},e.popup={prefDate:!1,dateOfBirth:!1},e.openAppointmentDatePicker=function(){e.popup.prefDate=!0,e.popup.dateOfBirth=!1},e.openDobDatePicker=function(){e.popup.prefDate=!1,e.popup.dateOfBirth=!0},e.toggleMin=function(){var t=e.takeServerDate();e.minDate=t.setDate(t.getDate()+2),e.dateOptions.minDate=e.minDate},e.toggleMin(),e.toggleMaxDob=function(){e.dateOptionsForDob.maxDate=e.takeServerDate()},e.toggleMaxDob(),e.setDate=function(t,a,i){e.dt=new Date(t,a,i)},e.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],e.format=e.formats[0],e.altInputFormats=["M!/d!/yyyy"],e.appointmentData={patientName:"",email:"",gender:"",phone:"",dateOfBirth:"",genderValue:t.genderTitle,prefDate:"",prefDateTime:"",relation:""},e.setMaxHours=e.maxHours,e.setMinHours=e.minHours,e.hstep=1,e.mstep=30,e.relation=t.relation,e.appointmentData.relation=e.relation[0],e.appointmentData.relationID=e.relation[0],e.genderData=t.gender,e.setDate=function(t,a,i){return e.dt=e.minDate,e.dt},e.emailPattern=i,e.newDate=e.takeServerDate();var l=e.newDate.getFullYear()-100;e.minDob=new Date(l,1,1),e.format=t.dateFormate,e.openPopup={opened:!1,openDobPopup:!1},e.user=o.isUserSignedin(),e.user&&(e.appointmentData.patientName=e.user.userDetails.displayName,e.appointmentData.email=e.user.userDetails.email,e.appointmentData.phone=e.user.userDetails.phone),e.cancelBooking=function(){e.$emit("cancelBooking",{})},e.appointmentDetails={packageData:{},userData:{}},e.daysCounts=[{day:1},{day:2},{day:3},{day:4},{day:5},{day:6},{day:0}],Date.prototype.addDays1=function(e){var t=new Date(this.valueOf());return t.setDate(t.getDate()+e),t},e.getDates=function(e,t){for(var a=[],i=e;i<=t;)a.push(i),i=i.addDays1(1);return a},e.openFormView=function(t){"app.consultation"===n.current.name?e.isPriceText=!0:e.isPriceText=!1,e.appointmentDetails.packageData=t,e.daysCountForPackage=[],angular.forEach(e.appointmentDetails.packageData.availableSlots,function(t,a){t.dayOfWeek&&e.daysCountForPackage.push({day:t.day})}),e.daysCollection=_.filter(e.daysCounts,function(t){return!_.findWhere(e.daysCountForPackage,t)});var a="app.consultation"===n.current.name?14:29,i=e.getDates(new Date(o.serverDate),new Date(o.serverDate).addDays(a));e.dateArray=[];for(var s=0;s<i.length;s++)e.dateArray.push({id:s+1,showPopover:!1,isOpen:!1,isSelected:!1,date:new Date(i[s]),isDay:!1,day:new Date(i[s]).getDay()});angular.forEach(e.dateArray,function(t,a){angular.forEach(e.appointmentDetails.packageData.availableSlots,function(i,o){i.day===t.day&&(e.dateArray[a].isDay=!0,1!==e.dateArray[a].id&&2!==e.dateArray[a].id||(e.dateArray[a].isDay=!1))})})},e.isopenlogin=!1,e.isPreviousValue={cursor:"not-allowed"},e.startWith=0,e.previousWith=0,e.next=function(){e.startWith++,e.increasedValue=e.startWith,30===e.dateArray.length?e.increasedValue<=4?(e.previousValue=e.increasedValue,e.nextCss=1===e.previousValue?420:2===e.previousValue?840:3===e.previousValue?1260:4===e.previousValue?1610:"",e.myStyle={"margin-left":-e.nextCss+"px"}):e.startWith=e.previousValue:15===e.dateArray.length&&(e.increasedValue<=8?(e.previousValue=e.increasedValue,e.nextCss=70*e.increasedValue,e.myStyle={"margin-left":-e.nextCss+"px"}):e.startWith=e.previousValue),e.isPreviousValue={}},e.startWith=0,e.previous=function(){var t;if(15===e.dateArray.length)if(e.startWith>1&&(e.startWith--,t=e.startWith),e.previousWith=t?t:0,0!==e.previousWith){var a=e.previousWith;e.previousCss=70*a,e.myStyle={"margin-left":-e.previousCss+"px"}}else 0===e.previousWith&&(e.myStyle={"margin-left":"0px"},e.isPreviousValue={cursor:"not-allowed"});else if(30===e.dateArray.length){e.nextCss=1===e.previousValue?0:2===e.previousValue?-420:3===e.previousValue?-840:4===e.previousValue?-1260:0,0===e.nextCss?e.isPreviousValue={cursor:"not-allowed"}:e.isPreviousValue={},e.myStyle={"margin-left":e.nextCss+"px"};var i=e.previousValue-1;e.previousValue=i,e.startWith=e.previousValue}},e.showPopover=!1,e.pad=function(t,a){return t=t.toString(),t.length<a?e.pad("0"+t,a):t},e.calculateTimeSlots=function(e){var t=[],a=0,i=0;a=e.slotStartTime,i=e.slotEndTime;for(var o=a;o<i;o++){var n;o===a?n=a:(n=a+30,a=n),i>=n&&t.push({slotStartTime:n})}return t},e.devideTimeSlots=function(t){return angular.forEach(t,function(a,i){if(a.slotStartTime){var o=a.slotStartTime%60,n="",s=Math.floor(a.slotStartTime/60);s>=12?(n="PM",12===s?s=s:s-=12):n="AM";var r=e.pad(s,"2")+":"+e.pad(o,"2");t[i].startTime=r,t[i].isSelected=!1,t[i].startTimeAmPm=n}}),t},e.slot1=[],e.slot2=[],e.slot3=[],e.slot4=[],e.slot5=[],e.slot6=[],e.slot7=[],e.slot8=[],e.slot9=[],e.slot10=[],e.pickTimeWithoutSlot=function(t){e.tempData&&(e.tempData.isSelected=!1),e.tempData=t,t.isSelected=!0,e.isSelectedPreferdTime=!0,e.appointmentData.prefDateTime=t.date,e.preferdStartTime=t.date,e.FinalTime=t.date},e.pickTime=function(t,a){if(e.preferdStartTime="",e.pickTimeIndex=a,t.isDay===!0){e.dayPrefered=t.date,t.showPopover=!t.showPopover,e.selectedDayTime=[],e.appointmentDetails.packageData.availableSlots,angular.forEach(e.appointmentDetails.packageData.availableSlots,function(a,i){a.day===t.day&&angular.forEach(a,function(t,a){e.selectedDayTime.push(t)})});var i,o,n,s,r,l,c,d,p,m;1===e.selectedDayTime[1].length&&0===e.slot1.length?(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),e.slot1=e.devideTimeSlots(i),e.slot2=[],e.slot3=[],e.slot4=[],e.slot5=[],e.slot6=[]):2===e.selectedDayTime[1].length&&0===e.slot2.length&&0===e.slot1.length?(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),o=e.calculateTimeSlots(e.selectedDayTime[1][1]),e.slot1=e.devideTimeSlots(i),e.slot2=e.devideTimeSlots(o),e.slot3=[],e.slot4=[],e.slot5=[],e.slot6=[],e.slot7=[],e.slot8=[],e.slot9=[],e.slot10=[]):3===e.selectedDayTime[1].length&&0===e.slot2.length&&0===e.slot1.length&&0===e.slot3.length?(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),o=e.calculateTimeSlots(e.selectedDayTime[1][1]),n=e.calculateTimeSlots(e.selectedDayTime[1][2]),e.slot1=e.devideTimeSlots(i),e.slot2=e.devideTimeSlots(o),e.slot3=e.devideTimeSlots(n),e.slot4=[],e.slot5=[],e.slot6=[],e.slot7=[],e.slot8=[],e.slot9=[],e.slot10=[]):4===e.selectedDayTime[1].length&&0===e.slot2.length&&0===e.slot1.length&&0===e.slot3.length&&0===e.slot3.length?(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),o=e.calculateTimeSlots(e.selectedDayTime[1][1]),n=e.calculateTimeSlots(e.selectedDayTime[1][2]),s=e.calculateTimeSlots(e.selectedDayTime[1][3]),e.slot1=e.devideTimeSlots(i),e.slot2=e.devideTimeSlots(o),e.slot3=e.devideTimeSlots(n),e.slot4=e.devideTimeSlots(s),e.slot5=[],e.slot6=[],e.slot7=[],e.slot8=[],e.slot9=[],e.slot10=[]):5===e.selectedDayTime[1].length&&0===e.slot2.length&&0===e.slot1.length&&0===e.slot3.length&&0===e.slot4.length&&0===e.slot5.length?(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),o=e.calculateTimeSlots(e.selectedDayTime[1][1]),n=e.calculateTimeSlots(e.selectedDayTime[1][2]),s=e.calculateTimeSlots(e.selectedDayTime[1][3]),r=e.calculateTimeSlots(e.selectedDayTime[1][4]),e.slot1=e.devideTimeSlots(i),e.slot2=e.devideTimeSlots(o),e.slot3=e.devideTimeSlots(n),e.slot4=e.devideTimeSlots(s),e.slot5=e.devideTimeSlots(r),e.slot6=[],e.slot7=[],e.slot8=[],e.slot9=[],e.slot10=[]):6===e.selectedDayTime[1].length&&0===e.slot2.length&&0===e.slot1.length&&0===e.slot3.length&&0===e.slot4.length&&0===e.slot5.length&&0===e.slot6.length?(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),o=e.calculateTimeSlots(e.selectedDayTime[1][1]),n=e.calculateTimeSlots(e.selectedDayTime[1][2]),s=e.calculateTimeSlots(e.selectedDayTime[1][3]),r=e.calculateTimeSlots(e.selectedDayTime[1][4]),l=e.calculateTimeSlots(e.selectedDayTime[1][5]),e.slot1=e.devideTimeSlots(i),e.slot2=e.devideTimeSlots(o),e.slot3=e.devideTimeSlots(n),e.slot4=e.devideTimeSlots(s),e.slot5=e.devideTimeSlots(r),e.slot6=e.devideTimeSlots(l),e.slot7=e.devideTimeSlots(c),e.slot8=[],e.slot9=[],e.slot10=[]):7===e.selectedDayTime[1].length?(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),o=e.calculateTimeSlots(e.selectedDayTime[1][1]),n=e.calculateTimeSlots(e.selectedDayTime[1][2]),s=e.calculateTimeSlots(e.selectedDayTime[1][3]),r=e.calculateTimeSlots(e.selectedDayTime[1][4]),l=e.calculateTimeSlots(e.selectedDayTime[1][5]),c=e.calculateTimeSlots(e.selectedDayTime[1][6]),e.slot1=e.devideTimeSlots(i),e.slot2=e.devideTimeSlots(o),e.slot3=e.devideTimeSlots(n),e.slot4=e.devideTimeSlots(s),e.slot5=e.devideTimeSlots(r),e.slot6=e.devideTimeSlots(l),e.slot7=e.devideTimeSlots(c),e.slot8=[],e.slot9=[],e.slot10=[]):8===e.selectedDayTime[1].length?(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),o=e.calculateTimeSlots(e.selectedDayTime[1][1]),n=e.calculateTimeSlots(e.selectedDayTime[1][2]),s=e.calculateTimeSlots(e.selectedDayTime[1][3]),r=e.calculateTimeSlots(e.selectedDayTime[1][4]),l=e.calculateTimeSlots(e.selectedDayTime[1][5]),c=e.calculateTimeSlots(e.selectedDayTime[1][6]),d=e.calculateTimeSlots(e.selectedDayTime[1][7]),e.slot1=e.devideTimeSlots(i),e.slot2=e.devideTimeSlots(o),e.slot3=e.devideTimeSlots(n),e.slot4=e.devideTimeSlots(s),e.slot5=e.devideTimeSlots(r),e.slot6=e.devideTimeSlots(l),e.slot7=e.devideTimeSlots(c),e.slot8=e.devideTimeSlots(d),e.slot9=[],e.slot10=[]):9===e.selectedDayTime[1].length?(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),o=e.calculateTimeSlots(e.selectedDayTime[1][1]),n=e.calculateTimeSlots(e.selectedDayTime[1][2]),s=e.calculateTimeSlots(e.selectedDayTime[1][3]),r=e.calculateTimeSlots(e.selectedDayTime[1][4]),l=e.calculateTimeSlots(e.selectedDayTime[1][5]),c=e.calculateTimeSlots(e.selectedDayTime[1][6]),d=e.calculateTimeSlots(e.selectedDayTime[1][7]),p=e.calculateTimeSlots(e.selectedDayTime[1][8]),e.slot1=e.devideTimeSlots(i),e.slot2=e.devideTimeSlots(o),e.slot3=e.devideTimeSlots(n),e.slot4=e.devideTimeSlots(s),e.slot5=e.devideTimeSlots(r),e.slot6=e.devideTimeSlots(l),e.slot7=e.devideTimeSlots(c),e.slot8=e.devideTimeSlots(d),e.slot9=e.devideTimeSlots(p),e.slot10=[]):10===e.selectedDayTime[1].length&&(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),o=e.calculateTimeSlots(e.selectedDayTime[1][1]),n=e.calculateTimeSlots(e.selectedDayTime[1][2]),s=e.calculateTimeSlots(e.selectedDayTime[1][3]),r=e.calculateTimeSlots(e.selectedDayTime[1][4]),l=e.calculateTimeSlots(e.selectedDayTime[1][5]),c=e.calculateTimeSlots(e.selectedDayTime[1][6]),d=e.calculateTimeSlots(e.selectedDayTime[1][7]),p=e.calculateTimeSlots(e.selectedDayTime[1][8]),m=e.calculateTimeSlots(e.selectedDayTime[1][9]),e.slot1=e.devideTimeSlots(i),e.slot2=e.devideTimeSlots(o),e.slot3=e.devideTimeSlots(n),e.slot4=e.devideTimeSlots(s),e.slot5=e.devideTimeSlots(r),e.slot6=e.devideTimeSlots(l),e.slot7=e.devideTimeSlots(c),e.slot8=e.devideTimeSlots(d),e.slot9=e.devideTimeSlots(p),e.slot10=e.devideTimeSlots(m)),e.isTime=!0}else e.isTime=!1},e.dynamicPopover={templateUrl:"myPopoverTemplate.html"},e.close=function(){e.dateArray[e.pickTimeIndex].isOpen=!1,e.FinalTime=e.preferdStartTime},e.selectedTime=function(t,a){"one"===a?(angular.forEach(e.slot1,function(a,i){a.slotStartTime===t.slotStartTime&&a.startTime===t.startTime&&a.isSelected===t.isSelected?e.slot1[i].isSelected=!0:e.slot1[i].isSelected=!1}),angular.forEach(e.slot2,function(t,a){e.slot2[a].isSelected=!1}),angular.forEach(e.slot3,function(t,a){e.slot3[a].isSelected=!1}),angular.forEach(e.slot4,function(t,a){e.slot4[a].isSelected=!1})):"two"===a?(angular.forEach(e.slot2,function(a,i){a.slotStartTime===t.slotStartTime&&a.startTime===t.startTime&&a.isSelected===t.isSelected?e.slot2[i].isSelected=!0:e.slot2[i].isSelected=!1}),angular.forEach(e.slot1,function(t,a){e.slot1[a].isSelected=!1}),angular.forEach(e.slot3,function(t,a){e.slot3[a].isSelected=!1}),angular.forEach(e.slot4,function(t,a){e.slot4[a].isSelected=!1})):"three"===a?(angular.forEach(e.slot3,function(a,i){a.slotStartTime===t.slotStartTime&&a.startTime===t.startTime&&a.isSelected===t.isSelected?e.slot3[i].isSelected=!0:e.slot3[i].isSelected=!1}),angular.forEach(e.slot2,function(t,a){e.slot2[a].isSelected=!1}),angular.forEach(e.slot1,function(t,a){e.slot1[a].isSelected=!1}),angular.forEach(e.slot4,function(t,a){e.slot4[a].isSelected=!1})):"four"===a&&(angular.forEach(e.slot4,function(a,i){a.slotStartTime===t.slotStartTime&&a.startTime===t.startTime&&a.isSelected===t.isSelected?e.slot4[i].isSelected=!0:e.slot4[i].isSelected=!1}),angular.forEach(e.slot2,function(t,a){e.slot2[a].isSelected=!1}),angular.forEach(e.slot3,function(t,a){e.slot3[a].isSelected=!1}),angular.forEach(e.slot1,function(t,a){e.slot1[a].isSelected=!1})),e.preferdStartTime=t.startTime+t.startTimeAmPm,e.isSelectedPreferdTime=!0,e.currentDay=e.dayPrefered,angular.forEach(e.dateArray,function(t,a){e.dateArray[a].isSelected=!1});var i=_.findWhere(e.dateArray,{date:e.currentDay});i.isSelected=!0,e.dateArray.push(i),e.dateArray=o.getUniqId(e.dateArray);var n=t.slotStartTime%60,s=0,r=0,l=Math.floor(t.slotStartTime/60),c=new Date(e.currentDay.getFullYear(),e.currentDay.getMonth(),e.currentDay.getDate(),l,n,s,r);e.appointmentData.prefDateTime=c,e.isError=!1},e.bookAppointmentForUser=function(){e.appointmentDetails.userData&&e.appointmentData.prefDateTime&&e.appointmentDetails.packageData?(e.appointmentData.relation=e.appointmentData.relation.name,e.appointmentDetails.userData=e.appointmentData,e.$emit("bookAppointmentForUser",e.appointmentDetails),e.appointmentData.relation=e.relation[0]):e.validateObj("alert-danger")},e.$watch("openForm",function(t){t&&(e.openForm="",e.isRegistration="app.consultation"===n.current.name,e.openFormView(t))}),e.$watch("validate",function(t){t&&e.validateObj(t)})}}}]),e.register.directive("multiSelectDate",["$filter",function(e){return{restrict:"E",require:"?ngModel",scope:{endYear:"=enddate",startYear:"=startYear",checkDate:"=checkDate",order:"=order",disabled:"=disabled"},templateUrl:"/templates/dateOfBirth.html?"+timeStamp,link:function(t,a,i,o){if(o){o.$render=function(){t.date={day:e("date")(o.$viewValue,"dd"),month:e("date")(o.$viewValue,"MM"),year:e("date")(o.$viewValue,"yyyy")}},i.endYear=t.endYear,i.startYear=t.startYear,t.yearOrder=!i.yearOrder||"asc"!==i.yearOrder;var n=i.endYear||(new Date).getFullYear(),s=i.startYear||s-100;t.selects={days:function(){for(var e=new Date(t.date.year,t.date.month,0).getDate()||31,a=[],i=1;i<=e;i++){var o=i.toString();a.push(o.length<2?"0"+o:o)}return a},months:function(){for(var e=[],t=1;t<=12;t++){var a=t.toString();e.push(a.length<2?"0"+a:a)}return e},years:function(){for(var e=[],t=n;t>=s;t--)e.push(t.toString());return e}},t.$watch("date",function(e){if(i.required){var a=!!e.year&&parseInt(e.year)<=n&&parseInt(e.year)>=s,r=!!e.month,l=!!e.day;t.checkDate&&"lesser"===t.order?e.year&&parseInt(e.year)===t.checkDate.getFullYear()?e.month&&parseInt(e.month)-1===t.checkDate.getMonth()?e.day&&parseInt(e.day)>=t.checkDate.getDate()&&(l=!1):e.month&&parseInt(e.month)-1>t.checkDate.getMonth()&&(r=!1,l=!1):e.year&&parseInt(e.year)>t.checkDate.getFullYear()&&(a=!1,r=!1,l=!1):t.checkDate&&"greater"===t.order&&(e.year&&parseInt(e.year)===t.checkDate.getFullYear()?e.month&&parseInt(e.month)-1===t.checkDate.getMonth()?e.day&&parseInt(e.day)<t.checkDate.getDate()&&(l=!1):e.month&&parseInt(e.month)-1<t.checkDate.getMonth()&&(r=!1,l=!1):e.year&&parseInt(e.year)<t.checkDate.getFullYear()&&(a=!1,r=!1,l=!1)),o.$setValidity("required",!!(a||r||l)),o.$setValidity("yearRequired",!!a),o.$setValidity("monthRequired",!!r),o.$setValidity("dayRequired",!!l),
a&&r&&l&&o.$setViewValue(new Date(e.year,e.month-1,e.day))}else e.year&&e.month&&e.day?o.$setViewValue(new Date(e.year,e.month-1,e.day)):e.year&&e.month&&e.day&&o.$setViewValue(new Date(e.year,e.month-1,e.day))},!0)}}}}]),e.register.directive("mediBookAndPay",["$rootScope","navConstantsSvc","standardEventsSvc","$sce","patternService","authService","$stateParams","$state","apiProvider","$window","$uibModal","$timeout","Idle","$interval","$http","notify","medsService","$location","localStorageService",function(e,a,i,o,n,s,r,l,c,d,p,m,u,g,h,f,y,v,k){return{restrict:"E",scope:{openForm:"=?",maxHours:"=?",minHours:"=?",validate:"=?"},templateUrl:"/templates/bookAndPaymentPopup.html?"+timeStamp,link:function(b){function D(){b.user=s.isUserSignedin();var e=t.getFlatProperty(b.user,"userDetails.userId"),a=t.getFlatProperty(b.user,"userDetails.pmEntityID"),i=t.getFlatProperty(b.user,"corpDetails.iwpEmployeeId"),o=t.getFlatProperty(b.user,"token");if(e&&a&&i&&o){var n={medibuddyUserId:e,empId:i,pmEntityId:a},r={method:"POST",url:c.docsappBackend+"/mbweb/checkUserWhatsappConsent",headers:{shorttoken:o,medibuddyuserid:e,pmentityid:a,empid:i},ignoreLoadingBar:!0,data:n};h(r).then(function(e){e&&e.data&&e.data.success&&e.data.show&&(b.showWhatsappConsent=!0)})}}function C(){b.userObj=s.isUserSignedin(),b.showCoPayNote=!1,b.userObj||l.go("app.home",{},{reload:"app.home"}),b.userObj&&b.userObj.isRetailUser&&(b.retailUser=!0,b.disableGender=!1),11186744==b.user.userDetails.pmEntityID&&(b.disableDate=!0),b.strikeNavyaPkgAmount=t.getFlatProperty(s,"detailsForBooking.docObj.strikePackageAmount"),b.programType&&(b.disableGender=!0,b.disableName=!0,b.disableDate=!0,b.disableEmail=!0),b.userObj&&b.userObj.userDetails&&b.userObj.corpDetails&&b.userObj.corpDetails.employeeDetail&&b.userObj.corpDetails.employeeDetail.iwpBeneficiaries&&b.userObj.corpDetails.employeeDetail.iwpBeneficiaries.length>0&&(b.relation=b.userObj.corpDetails.employeeDetail.iwpBeneficiaries.map(function(e){return e}),b.strikeNavyaPkgAmount&&a.wiproIds.indexOf(b.userObj.userDetails.pmEntityID)>-1&&(b.relation=_.filter(b.relation,function(e){return _.contains(B,e.relationId)})),a.intelEntityIds.indexOf(b.userObj.userDetails.pmEntityID)>-1&&(b.intelEmp=!0),b.hideAddingBeneficiary=!b.user||b.user&&b.user.userDetails&&a.hideAddBenfeciary.includes(b.user.userDetails.pmEntityID),a.deloitteIds.indexOf(b.userObj.userDetails.pmEntityID)<0&&a.ibmEntityIds.indexOf(b.userObj.userDetails.pmEntityID)<0&&!b.intelEmp&&!b.isNavya&&!b.hideAddingBeneficiary&&b.relation.push({maid:0,relationName:"Others"}),b.retailUser=!1),b.userObj&&b.userObj.userDetails&&""!=(a.copayEntities[b.userObj.userDetails.pmEntityID]||"")&&(b.isCopay=!0,b.coPayPercentage=a.copayEntities[b.userObj.userDetails.pmEntityID])}function P(){h.get(c.medsService+"app/getDynamicEdd",{headers:{source:"web",mbservertoken:b.user.encryptedToken}}).then(function(e){e.data.message&&(b.edd=e.data.message.STANDARD.eddTime,b.discountDelievery=e.data.message.STANDARD.discountText,b.homeDeliveryOffer=o.trustAsHtml("<b>"+b.discountDelievery+"</b> "+b.edd),e.data.message.STORE_PICKUP&&(b.storePickupIsAvailable=!0,b.storePickup=e.data.message.STORE_PICKUP.eddTime,b.discountStorePickup=e.data.message.STORE_PICKUP.discountText))})}function w(){b.isHomeSampleCollection&&!b.medicine||b.isCovid?b.userAddresses=_.filter(b.userAddresses,function(e){var t=e.city?a.cityTags[e.city.toLowerCase()]||e.city.toLowerCase():"";return t==s.getCity().toLowerCase()}):t.validatePIN(r.searchc)&&(b.userAddresses=_.filter(b.userAddresses,function(e){return e.pincode==r.searchc}))}function S(e){for(var t in e)"number"==typeof e[t]&&(e[t]=e[t].toString())}function T(e,t){var a={orderId:e,browser_fingerprint_id:t};s.makeAjaxCalls("https://www.medibuddy.in/websiteapp/CreateOrderIdBrowserIdMapping",a,"POST").then(function(e){})["catch"](function(e){console.log("error while createOrderIdBrowserFingerprintIdMapping"+e)})}function A(e){h.post(c.medsService+"app/isStorePickUpItemsAvailable",{mbdrugCodes:e,deliveryType:"store_pickup",pincode:parseInt(b.appointmentData.patientPincode)},{headers:{source:"web",mbaccesstoken:b.user.encryptedToken}}).then(function(e){var t=[];if(e.data.message.Status===!1){for(var a=0;a<e.data.message.drugDataNotServiceable.length;a++){var i=e.data.message.drugDataNotServiceable[a].BrandName;t.push(i)}b.NotAvailableDrugs=t,e.data.message.drugDataNotServiceable.length>0&&b.storeCheck(b.NotAvailableDrugs)}else b.storePickupIsAvailable=!0,b.storePickup=e.data.message.STORE_PICKUP.eddTime,b.discountStorePickup=e.data.message.STORE_PICKUP.discountText})}function I(e){return e.getDate()<=b.currentDate.getDate()&&e.getMonth()==b.currentDate.getMonth()&&e.getFullYear()==b.currentDate.getFullYear()}window._MB_Analytics.__push({isCleverTap:!1,isGoogle:!0,name:"pageview",payload:window._Site_Props.__getEventParameters({google:window._Site_Props.__googleTransform("customer details Payment page.")})}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:!0,hj:!0,name:"OrderDetails",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0})}),d.scrollTo(0,0),b.prevPage=function(){d.history.go(-1)},b.hideWalletBalance=e.hideWalletBalance,k.setStorageType("sessionStorage"),r.reorder===!0&&(b.isReOrder=!0),s.reOrderId=null,s.reorder=null,b.uploadrx=!0,b.isSbiUser=!1,b.medsItemDrugCodes=[],b.medicineFlow=a.uploadRxInstructions,b.medsPayment=k.get("medsPayment"),k.setStorageType("localStorage"),b.paymentBlockingCss=!1,b.currentDate=new Date,b.submitted=!1,b.emailPattern=n,b.navyaRedirect="",b.resData={},b.eventHandled=!1;var O=null;b.showWhatsappConsent=!1,y.getCart().then(function(e){e&&e.items&&e.items.length>0&&(b.uploadrx=!1)});var L={};D();var M={service:"Meds",paymentAttemptId:(new Date).getTime().toString()+"-"+(b.user&&b.user.userDetails?b.user.userDetails.userId:"")+"-"+Math.random().toString(36).slice(-4),platform:window.getSrcType(),mbuuid:k.get("auth_uuid")||b.user.userDetails.mbuuid,contractId:"10390"};M.platform="web"==M.platform?"Web":["iOS","iOSMB"].includes(M.platform)?"iOSmWeb":"AndroidmWeb",b.user&&(b.user.corpDetails&&b.user.corpDetails.employeeDetail&&(M.entityName=b.user.corpDetails.employeeDetail.companyName),b.user.userDetails&&(M.pmentityid=b.user.userDetails.pmEntityID,M.mbuserid=b.user.userDetails.userId),M.patientid=b.user.patientId),b.appointmentData={patientName:"",userConsent:!0,email:"",gender:"",phone:"",dateOfBirth:"",genderValue:a.genderTitle,prefDateTime:"",relation:"Self",isCashless:!1,paymentTypeId:-1};var B=a.coreRelationIds;if(r.memberInfo){b.programType=r.searchk;var F=r.memberInfo;b.appointmentData.patientName=F.name,b.appointmentData.email=F.emailId,b.appointmentData.gender=F.gender||"F",b.appointmentData.genderValue=F.genderValue||"Female",b.appointmentData.phone=F.mobileNo,b.appointmentData.dateOfBirth=new Date(parseInt(F.dob.replace("/Date(","").replace(")/",""))),b.appointmentData.prefDateTime=F.lmpDate,b.appointmentData.relation="relation"in(F.details||{})}r.categoryItemTypeId===a.navyaId?(b.isNavya=!0,b.eventCategory="Navya"):b.programType&&(b.eventCategory=b.programType,window._Site_Props.__setServiceDetails({serviceName:"Program",serviceType:b.eventCategory})),b.resetPaymentCustomParams=function(){b.paymentCustomParams={MAWalletUsage:0,MBWalletUsage:0,CorpWalletUsage:0,couponDiscount:0,couponCodeApplied:"",referredBy:"",razorPaymentAmount:""}},b.billWalletUpdation=function(){b.checkoutPricing.walletAmount>=b.checkoutPricing.price?(b.checkoutPricing.walletDeduction=b.checkoutPricing.price,b.checkoutPricing.price=0):(b.checkoutPricing.walletDeduction=b.checkoutPricing.walletAmount,b.checkoutPricing.price=b.checkoutPricing.price-parseInt(b.checkoutPricing.walletAmount))},b.setPaymentCustomParams=function(e,t){b.paymentCustomParams[e]=t},b.resetPaymentCustomParams(),b.getMembershipDetailForUser=function(){b.membershipDetail=[],b.userObj&&s.makeAjaxCalls(c.apiUrl+"/GetRegisteredMembersForProgram",{EnrolType:"MEMBERSHIP"},"POST",b.userObj.token).then(function(e){_.isEmpty(e.data.membershipDetail)||(b.membershipDetail=e.data.membershipDetail)})},b.selectRelation=function(e){if(b.appointmentData.relation=e.relationName,b.appointmentData.gender=e.gender,b.appointmentData.gender&&"string"==typeof b.appointmentData.gender){var t=b.appointmentData.gender.toLowerCase();"male"===t?b.appointmentData.gender="M":"female"===t&&(b.appointmentData.gender="F")}b.appointmentData.patientName=e.name,b.disableName=!!b.appointmentData.patientName,b.disableGender=!!b.appointmentData.gender,e.dob?b.appointmentData.dateOfBirth=new Date(parseInt(e.dob.replace("/Date(","").replace(")/",""))):b.appointmentData.dateOfBirth="",b.appointmentData.maid=e.maid};var x=function(e){b.disableBenefSelection=!1;var t,a=!1;if(e&&(e.maid&&b.relation&&(e.maid=parseInt(e.maid),e.maid&&(t=b.relation.find(function(t){return t.maid===e.maid})),t?(b.selectRelation(t),b.disableBenefSelection=b.disableName&&b.disableGender,a=!0):(t=b.relation.find(function(e){return 0===e.maid}),t&&b.selectRelation(t))),a||(e.patientName&&(b.appointmentData.patientName=e.patientName),e.dob?b.appointmentData.dateOfBirth=new Date(parseInt(e.dob.replace("/Date(","").replace(")/",""))):b.appointmentData.dateOfBirth=""),e.gender&&"string"==typeof e.gender)){var i=e.gender.toLowerCase();"male"===i||"m"===i?b.appointmentData.gender="M":"female"!==i&&"f"!==i||(b.appointmentData.gender="F")}};if(b.famPipeline={show:!1},b.toggleFamilyPopUp=function(){b.famPipeline.show=!b.famPipeline.show,e.medsFamilyFlow=b.famPipeline.show},b.checkCashlessLabel=function(){var e=_.findWhere(s.walletConfigs,{walletName:"MAWallet"});!_.isEmpty(e)&&e.eligibleContracts&&e.eligibleContracts.indexOf(a.consultationContract)&&(b.showNocashless=!0)},C(),b.getMembershipDetailForUser(),r.categoryItemTypeId===a.investigationId&&(b.fromLabTest=!0),b.packageWithoutMembership=!1,r.pB&&(b.bookNonMa=!0,b.poweredBy=r.pB,b.checkCashlessLabel(),r.categoryItemTypeId===a.consultationId&&(b.packageWithoutMembership=!0)),b.userObj&&b.userObj.userDetails&&a.ibmEntityIds.indexOf(b.userObj.userDetails.pmEntityID)>=0&&(b.showCoPayNote=!0,b.copayValue=50),b.userObj&&b.userObj.userDetails&&a.intelEntityIds.indexOf(b.userObj.userDetails.pmEntityID)>=0&&(b.showCoPayNote=!0,b.copayValue=20),b.storePickupIsAvailable=!1,P(),s.profileInfo&&s.profileInfo.userAddresses&&s.profileInfo.userAddresses.length>0&&(b.userAddresses=s.profileInfo.userAddresses,w()),b.validateObj=function(e){"alert-danger"===e&&(b.isError=!0),"Gender"===e.type&&(b.isGenderSelection=!0,e.error?b.errorValueForGender=e.error:b.isGenderSelection=!1),"Coupon"===e.type&&e.error&&(b.errorValueForCoupon=e.error),"Wallet"===e.type&&(b.wallet.isPayByMBWallet=!1,e.error?(b.isWalletFailure=!0,b.errorValueForWallet=e.error):b.isWalletFailure=!1)},b.couponListingOpen=function(){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,dbLog:!b.medicine||"meds",hj:!0,name:b.medicine?"MedsApplyCouponClick":"Coupon Click",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Coupon Click")})}),b.couponCode=null,p.open({animation:!0,windowClass:"couponpage",templateUrl:"templates/couponListingPopup.html?"+timeStamp,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","$sce","$stateParams",function(t,a,o,n,s,r,l,p,m,u,g,h,f){function v(){var e=c.apiUrl+"/CouponList.json";l.makeAjaxCalls(e,{},"POST",b.userObj.token).then(function(e){200===e.status&&e.data.isSuccess&&(a.couponList=e.data.coupons)})}function k(e,a){b.applyCoupon(e,a),t.dismiss("cancel")}a.couponList=[],a.txtCouponCode=b.validatedCouponCode,a.appliedCouponCode=b.validatedCouponCode,a.isMobileView=e.isMobileView,a.closeModal=function(){t.dismiss("cancel")},a.validateCoupon=function(e){if(e)if(b.medicine)b.checkoutData.couponCode=e,b.checkoutData.walletRequest={bookingSource:"web"},y.checkout(b.checkoutData,b).then(function(a){if(a.errMessage)return void g({message:a.errMessage,position:"center",duration:5e3});if(b.couponCode=e,t.dismiss("cancel"),b.checkoutResponseData=a,b.gatewayTitle=h.trustAsHtml(b.checkoutResponseData.checkoutResponse.priceObj.gatewayTitle),b.disclaimerText=h.trustAsHtml(b.checkoutResponseData.checkoutResponse.priceObj.disclaimerText),b.isCouponCodeNotEmpty=!!e,b.validatedCouponCode=a.checkoutResponse.priceObj.isCoupanApplied?e:"",1==a.purelyRx&&(b.purelyRx=a.purelyRx,b.purelyRxText=a.purelyRxText),a.checkoutResponse.priceObj&&a.checkoutResponse.priceObj.coupanInfo&&a.checkoutResponse.priceObj.coupanInfo.discountAmount){switch(b.mediMarketPayment={couponDiscount:a.checkoutResponse.priceObj.coupanInfo.discountAmount},b.couponCode=e,L.coupon_code=e,L.discounted_amount+=b.mediMarketPayment.couponDiscount,L.pgAmount=a.checkoutResponse.priceObj.finalPrice,a.checkoutResponse.walletType){case"CorpWallet":L.corpWalletAmount=a.checkoutResponse.priceObj.cashlessAmount;break;case"MAWallet":L.maWalletAmount=a.checkoutResponse.priceObj.cashlessAmount;break;case"MBWallet":L.mbWalletAmount=a.checkoutResponse.priceObj.cashlessAmount}y.sendGTMEvents(i.MED_COUPONCODE_APPLIED,L)}if(b.splitDetails=a.checkoutResponse.pgCodSplit,b.splitDetails)for(var o in b.splitDetails.splitOptions)b.splitDetails.splitOptions[o].isSelected&&(b.appointmentData.paymentTypeId=b.splitDetails.splitOptions[o].paymentTypeId);return b.checkoutPricing={totalPrice:a.checkoutResponse.priceObj.totalPrice,partnerDiscountAmount:a.checkoutResponse.priceObj.discount.find(function(e){return"partnerDiscountAmount"===e.name}).value||0,firstOrderDiscount:a.checkoutResponse.priceObj.discount.find(function(e){return"firstOrderDiscount"===e.name}).value||0,walletDeduction:a.checkoutResponse.priceObj.cashlessAmount,finalPrice:a.checkoutResponse.priceObj.finalPrice,price:a.checkoutResponse.priceObj.finalPrice},a});else{a.appliedCouponCode="",a.errorMessage="";var o={PackageId:l.detailsForBooking.docObj.packageId,ProviderID:l.detailsForBooking.docObj.dcId,DoctorUniqueId:l.detailsForBooking.docObj.doctorUniqueId?l.detailsForBooking.docObj.doctorUniqueId:"",CouponCode:e,Gender:b.appointmentData.gender,City:b.appointmentPackageData.citySelected,ApplicableDate:b.appointmentData.prefDateTime||new Date,Relation:b.appointmentData.relation};b.fromLabTest&&(o.isForCheckedOutOrder=!0);var n;d.location.href.includes("Medicine")?(n=c.siteUrl+"medibuddy/couponApply",o.service="Meds",o.quoteNumber=1,o.couponCode=e,o.amount=l.bookedAppointmentDetails.medicineCart.totalPrice):n=c.apiUrl+"/CheckCouponCodeApplicability.json",l.makeAjaxCalls(n,o,"POST",b.user.token).then(function(t){return a.appliedCouponCode=e,t.data.isSuccess&&t.data.response.isApplicable?t.data.response.discount||!t.data.response.finalPrice||b.medicine?(b.medsSale=t,k(e,t)):a.errorMessage="Could not apply coupon code.":void(a.errorMessage=t.data.response?t.data.response.message:t.data.response.message)})["catch"](function(e){a.errorMessage="Could not apply coupon code.",g({message:"Could not apply coupon code.",position:"center",duration:5e3})})}},v()}],size:"full-height-mobile"})},!b.retailUser&&b.relation&&!b.programType)for(var N=0;N<b.relation.length;N++)if("string"==typeof b.relation[N].relationName&&"self"===b.relation[N].relationName.toLowerCase()){b.selectRelation(b.relation[N]);break}b.initializeBilldeskPayment=function(e){bdPayment.initialize({msg:e.msg,options:{enableChildWindowPosting:e.options.enableChildWindowPosting,enablePaymentRetry:e.options.enablePaymentRetry,retry_attempt_count:e.options.retry_attempt_count,txtPayCategory:e.options.txtPayCategory},callbackUrl:e.callbackUrl})},b.takeServerDate=function(){var e="";return e=s.serverDate?new Date(s.serverDate):new Date},b.today=function(){b.dt=b.takeServerDate()},b.openDobDatePicker=function(){b.popup.prefDate=!1,b.popup.dateOfBirth=!0},b.toggleMaxDob=function(){b.dateOptionsForDob.maxDate=b.takeServerDate()},b.setDate=function(e,t,a){b.dt=new Date(e,t,a)},b.cancelBooking=function(){b.$emit("cancelBooking",{})},b.initializePayment=function(){if(b.bookedAppointmentDetails=s.bookedAppointmentDetails,b.bookedAppointmentDetails.couponCode="",b.errorValueForCoupon="",b.wallet={gatewayAmount:"",totalAmount:"",walletAmount:"",isPayByMBWallet:"",isPayByCorpWallet:"",isPayByMAWallet:""},L.coupon_code="NA",L.discounted_amount=0,L.pgAmount=0,L.corpWalletAmount=0,L.mbWalletAmount=0,L.maWalletAmount=0,b.isPayment=!0,b.mediMarketPayment={isCod:!1,amountAfterCouponDiscount:b.bookedAppointmentDetails.finalPrice},b.finalPayment=b.bookedAppointmentDetails.finalPrice,b.isEssential&&s.detailsForBooking&&s.detailsForBooking.docObj&&s.detailsForBooking.docObj.quantity>0&&(b.bookedAppointmentDetails.finalPrice*=s.detailsForBooking.docObj.quantity),b.paymentObject=[],b.paymentOptions.length>0){if(b.showWalletPaymentOption=!1,b.showCorpWalletPaymentOption=!1,b.showMaWalletPaymentOption=!1,b.showMBWalletPaymentOption=!1,b.onlyPgOption=!0,b.medicine){var e=!1,t=!1;_.each(b.paymentOptions,function(a){!t&&a.paymentMethod.toLowerCase().indexOf("wallet")>-1&&a.walletAmount>0&&(t=!0),!e&&a.paymentMethod.toLowerCase().indexOf("cashless")>-1&&(e=!0)}),!e&&t&&b.paymentOptions.push({paymentMethod:"CashlessDelivery"})}for(var a=0;a<b.paymentOptions.length;a++)"pgandcorpwallet"===b.paymentOptions[a].paymentMethod.toLowerCase()?(b.CorpBenefAmount=b.paymentOptions[a].walletAmount,b.CorpBalance=s.CorpBalance,b.CorpWalletName=s.corpAliasName,b.showCorpWalletPaymentOption=!!b.paymentOptions[a].walletAmount,b.showWalletPaymentOption=b.showWalletPaymentOption||b.showCorpWalletPaymentOption,b.onlyPgOption=!1):"pgandmawallet"===b.paymentOptions[a].paymentMethod.toLowerCase()?(b.MABenefAmount=b.paymentOptions[a].walletAmount,b.MAWalletName=s.maAliasName,b.showMaWalletPaymentOption=!!b.paymentOptions[a].walletAmount,b.MABalance=s.MABalance,b.showWalletPaymentOption=b.showWalletPaymentOption||b.showMaWalletPaymentOption,b.onlyPgOption=!1):"cashondelivery"===b.paymentOptions[a].paymentMethod.toLowerCase()?(b.mediMarketPayment.isCod=!0,b.showCashlessDifference=b.optedHomeDelivery,b.optedHomeDelivery?b.apolloHomeDelivery?(b.showCashlessDifference=!0,b.cashlessDelivery=b.courier?b.courierDelivery:"24-48",b.codDelivery=b.courier?b.courierDelivery:"24"):b.optedNormalDelivery&&(b.showCashlessDifference=!0,b.cashlessDelivery=b.courier?b.courierDelivery:"24-48",b.codDelivery=b.courier?b.courierDelivery:"24"):b.showCashlessDifference=!1):"pgandmbwallet"===b.paymentOptions[a].paymentMethod.toLowerCase()&&(!b.isCovid||b.isCovid&&b.user.isRetailUser)?(b.showWalletPaymentOption=b.showWalletPaymentOption||!b.medicine,b.showMBWalletPaymentOption=!!b.paymentOptions[a].walletAmount,b.MBBalance=s.MBBalance):"cashlessdelivery"===b.paymentOptions[a].paymentMethod.toLowerCase()&&(b.showWalletPaymentOption=!0,b.showCashlessOption=!0,b.appointmentData.isCashless=!0,b.optedHomeDelivery?b.apolloHomeDelivery?(b.showCashlessDifference=!0,b.cashlessDelivery=b.courier?b.courierDelivery:"24-48",b.codDelivery=b.courier?b.courierDelivery:"24"):b.optedNormalDelivery&&(b.showCashlessDifference=!0,b.cashlessDelivery=b.courier?b.courierDelivery:"24-48",b.codDelivery=b.courier?b.courierDelivery:"24"):b.showCashlessDifference=!1,b.onlyPgOption=!1);if(1===b.paymentOptions.length&&b.mediMarketPayment.isCod&&(b.courier?b.codDelivery=b.courierDelivery:b.optedHomeDelivery?b.optedNormalDelivery?b.codDelivery="48":b.codDelivery="24":b.codDelivery="Pickup within 5 hrs",b.appointmentData.isCashless=!1),!b.medicine&&b.onlyPgOption&&(s.CorpBalance>0||s.MABalance>0)){var i,o,n,r=_.findWhere(s.walletConfigs,{walletName:"MAWallet"}),l=_.findWhere(s.walletConfigs,{walletName:"CorpWallet"}),c=!1;if(_.isEmpty(r)||(r.eligibleContracts.indexOf(s.detailsForBooking.docObj.contractId)>-1?i=!0:o=!0),_.isEmpty(l)||(l.eligibleContracts.indexOf(s.detailsForBooking.docObj.contractId)>-1?n=!0:c=!0),n)b.walletErrorMessage=s.corpAliasName+" wallet is not applicable for the beneficiary selected";else if(i)b.walletErrorMessage=s.maAliasName+" wallet is not applicable for the beneficiary selected";else{var d=o&&c?s.corpAliasName+" and "+s.maAliasName:o?s.maAliasName:c?s.corpAliasName:"";b.walletErrorMessage=d+" wallet(s) is not applicable for the service"}b.showWalletCannotUsedMessage=!0}}angular.forEach(b.walletBalanceDetail,function(e,t){"mawallet"===e.walletName.toLowerCase()?(b.MABalance=e.balance,b.isMAWalletAvailable=!0):"mbwallet"===e.walletName.toLowerCase()?b.MBBalance=e.balance:"corpwallet"===e.walletName.toLowerCase()&&(b.CorpBalance=e.balance)}),b.isPaymentCalled=!1,b.flag=!1,b.isPaymentProcessing=!1,b.isChecmsg=!1,b.mediMarketPayment.isCod&&(b.cashOnDeli=!0),b.consultationCheck?(b.isConsultationPayment=!0,b.isPackagePayment=!1,b.isChecmsg=!0):(b.isConsultationPayment=!1,b.isPackagePayment=!0),b.showMaWalletPaymentOption?(b.wallet.isPayByMAWallet=!0,b.walletChoosed()):b.showCorpWalletPaymentOption?(b.wallet.isPayByCorpWallet=!0,b.walletChoosed()):b.medicine&&b.showCashlessOption&&b.showMBWalletPaymentOption&&(b.wallet.isPayByMBWallet=!0,b.walletChoosed())},b.takeToStoreSelection=function(){var e={sessionData:{},forceUpdate:!0};window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"MedsStoreSel"}),b.resData.appointmentData=JSON.stringify(b.appointmentData),e.sessionData[a.medicineId]=JSON.stringify(b.resData),s.makeAjaxCalls(c.apiUrl+"/SessionStorage.json",e,"POST",b.userObj.token).then(function(e){e.data.isSuccess?l.go("app.storeSelection",{pincode:b.appointmentData.patientPincode,categoryItemTypeId:r.categoryItemTypeId,searchc:r.searchc,searchk:r.searchk,packageId:r.packageId,dcId:r.dcId,appTime:r.appTime},{reload:"app.storeSelection"}):l.go("app.home",{},{reload:"app.home"})})},b.authorizeRazorPay=function(e){var t=c.paymentUrl+b.razorPayOptions.amount;t+="&paymentid="+e.razorpay_payment_id,d.location.href=t,m(function(){b.paymentBlockingCss=!0},0)},b.dismissalRazorPay=function(){b.bookingTabClick(),b.isPaymentProcessing=!1,b.isPaymentCalled=!1,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Payment Cancelled",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:b.customParams,google:window._Site_Props.__googleTransform(b.eventCategory,"PaymentCancelled",b.eventLabel)})}),k.remove("OrderCreatedEvent"),b.onDismissBilldeskPopup&&d.removeEventListener("message",b.onDismissBilldeskPopup),m(function(){b.flag=!1},0,!0),O=null},b.processPaymentOption=function(t){if(t)if(b.medicine){if(b.customParams.deliveryTime=b.appointmentData.isCashless?b.cashlessDelivery:b.codDelivery,b.splitDetails&&b.appointmentData.paymentTypeId==-1)return void f({message:"please select payment option",position:"center",duration:2e3});try{var a={};b.checkoutResponseData.checkoutResponse.walletBalaceDetail.map(function(e){a[e.walletName]=e.balance}),M.couponCodeName=b.checkoutResponseData.checkoutResponse.priceObj.isCoupanApplied?b.checkoutResponseData.checkoutResponse.priceObj.coupanInfo.coupanName:"NA",M.couponDiscountAmount=b.checkoutResponseData.checkoutResponse.priceObj.isCoupanApplied?b.checkoutResponseData.checkoutResponse.priceObj.coupanInfo.discountAmount:0,M.gmv=b.checkoutResponseData.checkoutResponse.priceObj.totalPrice,M.maWalletAmount=L.maWalletAmount=b.wallet.isPayByMAWallet?b.checkoutPricing.walletDeduction:0,M.mbWalletAmount=L.mbWalletAmount=b.wallet.isPayByMBWallet?b.checkoutPricing.walletDeduction:0,M.corpWalletAmount=L.corpWalletAmount=b.wallet.isPayByCorpWallet?b.checkoutPricing.walletDeduction:0,M.codAmount=0,M.otherCharges=0,M.pgAmount=L.pgAmount=b.checkoutResponseData.checkoutResponse.priceObj.pgAmount,M.pgName=M.pgAmount?"PayU":"NA",_.isEmpty(b.checkoutResponseData.checkoutResponse.priceObj.discount)||(M.directDiscountAmount=b.checkoutResponseData.checkoutResponse.priceObj.discount.reduce(function(e,t){return e+t.value},0)),M.pendingWith="NA",M.failureApiName="NA",M.failureReason="NA",M.failureCategory="NA",delete M.orderId,window._MB_Analytics.__push({isCleverTap:!0,dbLog:"meds",hj:!0,name:"PC_INITIATE_PAYMENT",payload:M}),y.sendGTMEvents(i.MED_PAYNOW_BUTTON,L)}catch(n){console.log("Error in creating payment props variable",n)}S(M),y.payment({cartId:b.checkoutResponseData.prePaymentCartId,newCheckout:!0,estimatedAmount:b.checkoutPricing.totalPrice,couponCode:b.couponCode||"",totalAmount:b.checkoutPricing.finalPrice,email:b.checkoutData.email,paymentMethod:b.paymentData,addressCity:b.checkoutData.addressCity,pmEntityId:b.userObj.userDetails.pmEntityID,paymentTypeId:b.appointmentData.paymentTypeId},b.checkoutResponseData.checkoutResponse.accessToken).then(function(t){if(M.orderId=t.paymentMethodResponse&&t.paymentMethodResponse.orderId?t.paymentMethodResponse.orderId.toString():"0",s.refreshOrders=!0,k.set("medicineBookAndPayURL",window.location.pathname),t.paymentMethodResponse&&t.paymentMethodResponse.isInsideSalesOrder&&t.paymentMethodResponse.message)b.paymentConfirmMessage=o.trustAsHtml(t.paymentMethodResponse.message),p.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",scope:b,templateUrl:"confirmPayment.html",size:"login"});else if(t.paymentMethodResponse.isSuccess&&0!==t.paymentMethodResponse.orderId){if(b.orderId=t.paymentMethodResponse.orderId,b.generatedOrderId=t.paymentMethodResponse.orderId,b.isWalletFailure=!1,T(t.paymentMethodResponse.orderId,window.sessionStorage.getItem("branch_fingerprint")||""),!_.isEmpty(t.paymentMethodResponse.payUPopUpOptions)){var a=Number.parseFloat(t.paymentMethodResponse.payUPopUpOptions.amount)/100;b.setPaymentCustomParams("razorPaymentAmount",a)}if(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:b.medicine?"MedsPlaceOrder":"Payment Request",dbLog:!b.medicine||"meds",hj:!0,payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:_.extend(b.customParams,b.paymentCustomParams),google:window._Site_Props.__googleTransform(b.eventCategory,"PaymentRequest",b.eventLabel)})}),b.storeOrderCreatedEvent(t.paymentMethodResponse.orderId,b.customParams,r.isRecommendation,b.programType),(b.wallet.isPayByMBWallet||b.wallet.isPayByCorpWallet||b.wallet.isPayByMAWallet)&&(s.refreshWallet=!0),_.isEmpty(t.paymentMethodResponse.payUPopUpOptions))if(_.isEmpty(t.paymentMethodResponse.billdeskOptions))t.paymentMethodResponse.paymentGatewayURL?(e.$emit("cfpLoadingBar:loading"),d.location.href=t.paymentMethodResponse.paymentGatewayURL,b.paymentBlockingCss=!0):(s.orderId=t.paymentMethodResponse.orderId,T(t.paymentMethodResponse.orderId,window.sessionStorage.getItem("branch_fingerprint")||""),e.$emit("closeBookPayPopup"),b.paymentBlockingCss=!0,k.set(b.userObj.userDetails.userId,b.appointmentData.dateOfBirth.getTime()),b.medicine&&window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:!b.medicine||"meds",hj:!0,name:b.medicine?"MedsThankYouPage":"MedsOrderPlaced",payload:window._Site_Props.__getEventParameters({custom:{payment_mode:b.appointmentData.isCashless?"Cashless":"COD",delivery_type:b.renderStorePickup&&b.storeData?"StorePickup":"Standard"}})}),l.go("app.orderDetails",{reload:"app.orderDetails"}));else{var i=t.paymentMethodResponse.billdeskOptions;i.options={},i.options.enableChildWindowPosting="true",i.options.enablePaymentRetry="true",i.options.retry_attempt_count="2",i.options.txtPayCategory="CREDITDEBITNETBANKINGBHARATQR",b.initializeBilldeskPayment(i),b.onDismissBilldeskPopup=function(e){"callCustomOnCloseFunction"!==e.data&&"dismissModal"!==e.data||b.dismissalRazorPay()},d.addEventListener("message",b.onDismissBilldeskPopup)}else b.razorPayOptions=t.paymentMethodResponse.payUPopUpOptions,b.razorPayOptions.name="MediBuddy",e.isWebView?(b.razorPayOptions.callback_url=c.paymentUrl+b.razorPayOptions.amount,b.razorPayOptions.redirect=!0):b.razorPayOptions.handler=b.authorizeRazorPay,b.razorPayOptions.prefill={name:b.appointmentData.patientName,email:b.appointmentData.email,contact:b.appointmentData.phone},b.razorPayOptions.modal={ondismiss:b.dismissalRazorPay},b.razorPayOptions.image="/assets/images/logo_medibuddy.png",b.razorPayOptions.description="Your order ID: "+t.paymentMethodResponse.orderId,b.razorPayOptions.theme.color="#2198ff",T(t.paymentMethodResponse.orderId,window.sessionStorage.getItem("branch_fingerprint")||""),O=new Razorpay(b.razorPayOptions),b.paymentBlockingCss&&(b.paymentBlockingCss=!1),O.open()}else t.paymentMethodResponse.isSuccess||(b.isPaymentProcessing=!1,b.isPaymentCalled=!1,b.flag=!1,M.failureApiName="/app/medibuddypaymentMethod",M.failureCategory="Order Creation Failure",M.failureReason="API Failure",window._MB_Analytics.__push({isCleverTap:!0,dbLog:"meds",hj:!0,name:"PC_ORDER_CREATION_FAILED",payload:M}),b.medicine?b.bookingTabClick():t.paymentMethodResponse.errorMessage?(b.errPayment=t.paymentMethodResponse.errorMessage,b.existingOrderId=t.paymentMethodResponse.existingOrderId,b.consultationCheck?(b.isConsultationPayment=!0,b.isPackagePayment=!1,b.isChecmsg=!0):(b.isConsultationPayment=!1,b.isPackagePayment=!0)):d.location.href="/technicalGlitch");k.set("PC_INITIATE_PAYMENT",M),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:!b.medicine||"meds",hj:!0,name:b.medicine?"MedsThankYouPage":"MedsOrderPlaced",payload:window._Site_Props.__getEventParameters({custom:{payment_mode:b.appointmentData.isCashless?"Cashless":"COD",delivery_type:b.renderStorePickup&&b.storeData?"StorePickup":"Standard"}})})})["catch"](function(e){M.failureApiName="/app/medibuddypaymentMethod",M.failureCategory="Order Creation Failure",M.failureReason="API Failure",window._MB_Analytics.__push({isCleverTap:!0,dbLog:"meds",hj:!0,name:"PC_ORDER_CREATION_FAILED",payload:M})})}else if(b.user=s.isUserSignedin(),b.user&&b.user.token){b.isPaymentProcessing=!0,b.isConsultationPayment=!1,b.isPackagePayment=!1;var m=c.apiUrl+"/PaymentMethod",u={paymentMethods:[]};angular.forEach(t,function(e,t){u.paymentMethods.push(e.paymentMethod)}),b.isCouponCodeNotEmpty&&(u.couponCode=b.validatedCouponCode),b.isMembershipCouponApplied&&(u.isMembershipUser=!0),0==parseInt(b.finalPayment)&&b.programType&&(b.paymentBlockingCss=!0),b.medicine&&b.user.isRetailUser&&(u.MedicineWalletAmount=b.MBBalance,!b.wallet.isPayByMBWallet&&b.MBBalance>0&&u.paymentMethods.push("CashlessDelivery")),b.errPayment="",b.existingOrderId="",b.paymentConfirmMessage=s.makeAjaxCalls(m,u,"POST",b.user.token).then(function(t){if(s.refreshOrders=!0,k.set("medicineBookAndPayURL",window.location.pathname),t.data.isInsideSalesOrder&&t.data.message)b.paymentConfirmMessage=o.trustAsHtml(t.data.message),p.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",scope:b,templateUrl:"confirmPayment.html",size:"login"});else if(t.data.isSuccess&&0!==t.data.orderId){if(b.orderId=t.data.orderId,b.generatedOrderId=t.data.orderId,b.isWalletFailure=!1,T(t.data.orderId,window.sessionStorage.getItem("branch_fingerprint")||""),!_.isEmpty(t.data.razorPayOptions)){var a=Number.parseFloat(t.data.razorPayOptions.amount)/100;b.setPaymentCustomParams("razorPaymentAmount",a)}if(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:b.medicine?"MedsPlaceOrder":"Payment Request",dbLog:!b.medicine||"meds",hj:!0,payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:_.extend(b.customParams,b.paymentCustomParams),google:window._Site_Props.__googleTransform(b.eventCategory,"PaymentRequest",b.eventLabel)})}),b.storeOrderCreatedEvent(t.data.orderId,b.customParams,r.isRecommendation,b.programType),(b.wallet.isPayByMBWallet||b.wallet.isPayByCorpWallet||b.wallet.isPayByMAWallet)&&(s.refreshWallet=!0),_.isEmpty(t.data.razorPayOptions))if(_.isEmpty(t.data.billdeskOptions))t.data.paymentGatewayURL?(e.$emit("cfpLoadingBar:loading"),d.location.href=t.data.paymentGatewayURL,b.paymentBlockingCss=!0):(s.orderId=t.data.orderId,T(t.data.orderId,window.sessionStorage.getItem("branch_fingerprint")||""),e.$emit("closeBookPayPopup"),b.paymentBlockingCss=!0,k.set(b.userObj.userDetails.userId,b.appointmentData.dateOfBirth.getTime()),b.medicine&&window._MB_Analytics.__push({
isCleverTap:!0,isGoogle:!1,dbLog:!b.medicine||"meds",hj:!0,name:b.medicine?"MedsThankYouPage":"MedsOrderPlaced",payload:window._Site_Props.__getEventParameters({custom:{payment_mode:b.appointmentData.isCashless?"Cashless":"COD",delivery_type:b.renderStorePickup&&b.storeData?"StorePickup":"Standard"}})}),l.go("app.orderDetails",{reload:"app.orderDetails"}));else{var i=t.data.billdeskOptions;i.options={},i.options.enableChildWindowPosting="true",i.options.enablePaymentRetry="true",i.options.retry_attempt_count="2",i.options.txtPayCategory="CREDITDEBITNETBANKINGBHARATQR",b.initializeBilldeskPayment(i),b.onDismissBilldeskPopup=function(e){"callCustomOnCloseFunction"!==e.data&&"dismissModal"!==e.data||b.dismissalRazorPay()},d.addEventListener("message",b.onDismissBilldeskPopup)}else b.razorPayOptions=t.data.razorPayOptions,b.razorPayOptions.name="MediBuddy",e.isWebView?(b.razorPayOptions.callback_url=c.paymentUrl+b.razorPayOptions.amount,b.razorPayOptions.redirect=!0):b.razorPayOptions.handler=b.authorizeRazorPay,b.razorPayOptions.prefill={name:b.appointmentData.patientName,email:b.appointmentData.email,contact:b.appointmentData.phone},b.razorPayOptions.modal={ondismiss:b.dismissalRazorPay},b.razorPayOptions.image="/assets/images/logo_medibuddy.png",b.razorPayOptions.description="Your order ID: "+t.data.orderId,b.razorPayOptions.theme.color="#2198ff",T(t.data.orderId,window.sessionStorage.getItem("branch_fingerprint")||""),O=new Razorpay(b.razorPayOptions),b.paymentBlockingCss&&(b.paymentBlockingCss=!1),O.open()}else t.data.isSuccess||(b.isPaymentProcessing=!1,b.isPaymentCalled=!1,b.flag=!1,b.medicine?b.bookingTabClick():t.data.errorMessage?(b.errPayment=t.data.errorMessage,b.existingOrderId=t.data.existingOrderId,b.consultationCheck?(b.isConsultationPayment=!0,b.isPackagePayment=!1,b.isChecmsg=!0):(b.isConsultationPayment=!1,b.isPackagePayment=!0)):d.location.href="/technicalGlitch")})}},b.storeOrderCreatedEvent=function(e,t,a,i){var o=window._Site_Props.__getPackageDetails(),n=window._Site_Props.__getServiceDetails();b.paymentCustomParams.referredBy?t.referredBy=b.paymentCustomParams.referredBy:delete t.referredBy,t.OrderID=e;var s={orderId:e,service:!!n,"package":!!o,custom:t,eventCategory:b.eventCategory,eventLabel:b.eventLabel,chargedEventPayload:{GMV:t.GMV,isRecommendation:a},packageDetails:o,serviceDetails:n};i&&_.extend(s.chargedEventPayload,{program:i}),k.set("OrderCreatedEvent",JSON.stringify(s))},b.applyCoupon=function(e,t){b.bookedAppointmentDetails.couponCode=e,b.resetPaymentCustomParams();var a={CodeApplied:e,CodeDiscount:t.data.response.discount,isRecommendation:r.isRecommendation};t.data.referrarDetails&&(a.referredBy=t.data.referrarDetails.userId,b.setPaymentCustomParams("referredBy",t.data.referrarDetails.userId)),b.setPaymentCustomParams("couponCodeApplied",e),b.setPaymentCustomParams("couponDiscount",t.data.response.discount),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,dbLog:!b.medicine||"meds",hj:!0,name:b.medicine?"MedsCouponCodeApplied":"Coupon Code Applied",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:a,google:window._Site_Props.__googleTransform(b.eventCategory,"CouponApplied",e+" applied for "+b.eventLabel)})}),b.couponMessage=t.data.response.message,b.isCouponCodeNotEmpty=!0,b.validatedCouponCode=e,b.mediMarketPayment.couponDiscount=t.data.response.discount,b.isEssential&&(b.mediMarketPayment.couponDiscount*=s.detailsForBooking.docObj.quantity),b.medicine&&b.checkoutPricing&&b.checkoutPricing.finalPrice&&(b.checkoutPricing.price=b.checkoutPricing.finalPrice,b.checkoutPricing.price=b.checkoutPricing.price-b.mediMarketPayment.couponDiscount,b.billWalletUpdation()),b.mediMarketPayment.amountAfterCouponDiscount=b.bookedAppointmentDetails.finalPrice-b.mediMarketPayment.couponDiscount,b.isEssential&&(b.mediMarketPayment.amountAfterCouponDiscount+=b.deliveryCost),b.mediMarketPayment.amountAfterCouponDiscount=Number.parseFloat(b.mediMarketPayment.amountAfterCouponDiscount).toFixed(2),b.finalPayment=b.mediMarketPayment.amountAfterCouponDiscount,b.isNavya||b.walletChoosed()},b.removeCoupon=function(){if(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,dbLog:!b.medicine||"meds",hj:!0,name:b.medicine?"MedsCouponCodeRemoved":"Coupon Code Removed",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Coupon Code Removed")})}),b.medicine){var e={couponCode:null};_.extend(e,b.checkoutData),b.checkoutData=e,b.couponCode=null,b.createAppointment()}},b.validateCoupon=function(e){if(b.resetPaymentCustomParams(),b.saleCoupon||""!==b.bookedAppointmentDetails.couponCode){var t={PackageId:s.detailsForBooking.docObj.packageId,ProviderID:s.detailsForBooking.docObj.dcId,DoctorUniqueId:s.detailsForBooking.docObj.doctorUniqueId?s.detailsForBooking.docObj.doctorUniqueId:"",CouponCode:b.saleCoupon?b.saleCoupon:b.bookedAppointmentDetails.couponCode,Gender:b.appointmentData.gender,City:b.appointmentPackageData.citySelected,ApplicableDate:b.appointmentData.prefDateTime||new Date,Relation:b.appointmentData.relation};b.fromLabTest&&(t.isForCheckedOutOrder=!0);var a=!1;e&&(t.enrollmentId=e.enrollmentId,t.enrollmentType=e.membershipType,a=!0);var i=c.apiUrl+"/CheckCouponCodeApplicability.json";s.makeAjaxCalls(i,t,"POST",b.user.token).then(function(e){if(b.applyCoupon(t,e),e.data.isSuccess&&e.data.response.isApplicable){var t=b.saleCoupon?b.saleCoupon:b.bookedAppointmentDetails.couponCode;return void(b.isMembershipCouponApplied=a)}b.removeCoupon(),a&&b.getCouponCode()})["catch"](function(){b.removeCoupon()})}else b.removeCoupon()},b.closeModal=function(){b.modalInstance&&b.modalInstance.close()},b.checkForMembershipBenefits=function(){if(b.isMembershipCouponApplied=!1,!_.isEmpty(b.membershipDetail)){var e=b.appointmentData.maid,t=b.membershipDetail.find(function(t){return t.maid==e});if(t&&t.membershipType)return b.bookedAppointmentDetails.couponCode=t.membershipType,b.validateCoupon(t),!0}return!1},a.sbiIds.indexOf(b.userObj.userDetails.pmEntityID)>-1&&(b.isSbiUser=!0),b.getCouponCode=function(){r.coupon&&(b.bookedAppointmentDetails.couponCode=r.coupon,b.validateCoupon()),a.deloitteIds.indexOf(b.userObj.userDetails.pmEntityID)>-1&&b.olService&&(b.bookedAppointmentDetails.couponCode=a.deloitteTeleCouponCode,b.validateCoupon())},b.showAlert=function(){b.isNavya?window.open(b.navyaRedirect,"_self"):b.appointmentPackageData.isAHC&&b.appointmentPackageData.isSponser?b.AHCBooking():b.ProcessPaymentOption(b.mediMarketPayment)},b.ProcessPaymentOption=function(e){b.paymentObject=[];var t;if(b.modalInstance&&b.modalInstance.close(),b.flag=!0,!b.isPaymentCalled&&b.flag)if(b.isPayment=!1,b.isPaymentCalled=!0,e.isCod){if(b.appointmentData.isCashless&&(b.wallet.isPayByMAWallet||b.wallet.isPayByMBWallet||b.wallet.isPayByCorpWallet))for(t=0;t<b.paymentOptions.length;t++)("cashlessdelivery"===b.paymentOptions[t].paymentMethod.toLowerCase()||b.wallet.isPayByMBWallet&&"pgandmbwallet"===b.paymentOptions[t].paymentMethod.toLowerCase()||b.wallet.isPayByCorpWallet&&"pgandcorpwallet"===b.paymentOptions[t].paymentMethod.toLowerCase()||b.wallet.isPayByMAWallet&&"pgandmawallet"===b.paymentOptions[t].paymentMethod.toLowerCase())&&b.paymentObject.push(b.paymentOptions[t]);else for(t=0;t<b.paymentOptions.length;t++)"cashondelivery"===b.paymentOptions[t].paymentMethod.toLowerCase()&&b.paymentObject.push(b.paymentOptions[t]);b.processPaymentOption(b.paymentObject)}else{if(b.wallet.isPayByMAWallet&&angular.forEach(b.paymentOptions,function(e,t){"pgandmawallet"===e.paymentMethod.toLowerCase()&&b.paymentObject.push(e)}),b.wallet.isPayByMBWallet&&angular.forEach(b.paymentOptions,function(e,t){"pgandmbwallet"===e.paymentMethod.toLowerCase()&&(b.medicine&&!b.user.isRetailUser&&(e.paymentMethod="CashlessDelivery"),b.paymentObject.push(e))}),b.wallet.isPayByCorpWallet&&angular.forEach(b.paymentOptions,function(e,t){"pgandcorpwallet"===e.paymentMethod.toLowerCase()&&b.paymentObject.push(e)}),!b.wallet.isPayByCorpWallet&&!b.wallet.isPayByMBWallet&&!b.wallet.isPayByMAWallet)for(t=0;t<b.paymentOptions.length;t++)"pg"===b.paymentOptions[t].paymentMethod.toLowerCase()&&b.paymentObject.push(b.paymentOptions[t]);b.processPaymentOption(b.paymentObject)}};var E=e.$on("medsPaymentMethod",function(e,t){b.eventHandled||(b.eventHandled=!0,b.showAlert()),console.log("medsPaymentMethod handler called")});b.$on("$destroy",E),b.changeTab=function(){b.activeTabIndex=1,b.tab1Disable=!1,b.collapseTwo=!1,b.collapseOne=!0,b.submitted=!1,b.startTimer(),b.countDownDate=(new Date).getTime()+6e5,d.scrollTo(0,0)},b.startTimer=function(){var e;b.x=g(function(){var t=(new Date).getTime();e=b.countDownDate-t,b.days=Math.floor(e/864e5),b.hours=Math.floor(e%864e5/36e5),b.minutes=Math.floor(e%36e5/6e4),b.seconds=Math.floor(e%6e4/1e3),e<0&&b.bookingTabClick()},1e3)},b.bookingTabClick=function(){g.cancel(b.x),b.minute=10,b.seconds=0,b.activeTabIndex=0,b.showCashlessOption=!1,b.appointmentData.isCashless=!!b.medicine&&!b.resData.cashlessNA,b.collapseTwo=!0,b.tab1Disable=!0,b.collapseOne=!1,b.showCashlessDifference=!1,b.optedHomeDelivery=!1,b.medicine&&y.sendGTMEvents(i.MED_PATIENT_DETAILS_SCREEN_LANDING,L),b.showMBWalletPaymentOption&&b.wallet.isPayByMBWallet&&(b.wallet.isPayByMBWallet=!1),b.showCorpWalletPaymentOption&&b.wallet.isPayByCorpWallet&&(b.wallet.isPayByCorpWallet=!1),b.showMaWalletPaymentOption&&b.wallet.isPayByMAWallet&&(b.wallet.isPayByMAWallet=!1),b.bookedAppointmentDetails&&b.bookedAppointmentDetails.couponCode&&(b.bookedAppointmentDetails.couponCode="",b.validateCoupon()),b.isWalletFailure=!1},b.paymentDoubleClick=function(){return b.flag=!0,!1},b.updateWalletSelection=function(e){b.checkoutData.paymentTypeId=e,y.checkout(b.checkoutData,b).then(function(e){var t=e.checkoutResponse.priceObj||{};if(b.checkoutResponseData=e,b.isCouponCodeNotEmpty=!0,b.gatewayTitle=o.trustAsHtml(b.checkoutResponseData.checkoutResponse.priceObj.gatewayTitle),b.disclaimerText=o.trustAsHtml(b.checkoutResponseData.checkoutResponse.priceObj.disclaimerText),b.checkoutPricing={totalPrice:t.totalPrice,partnerDiscountAmount:t.discount.find(function(e){return"partnerDiscountAmount"===e.name}).value||0,firstOrderDiscount:t.discount.find(function(e){return"firstOrderDiscount"===e.name}).value||0,walletDeduction:t.cashlessAmount,finalPrice:t.finalPrice,price:t.finalPrice},b.finalPayment=t.finalPrice,b.splitDetails=e.checkoutResponse.pgCodSplit,b.splitDetails)for(var a in b.splitDetails.splitOptions)b.splitDetails.splitOptions[a].isSelected&&(b.appointmentData.paymentTypeId=b.splitDetails.splitOptions[a].paymentTypeId);return b.wallet={gatewayAmount:t.pgAmount,totalAmount:t.finalPrice,walletAmount:t.cashlessAmount,isPayByCorpWallet:"CorpWallet"==e.checkoutResponse.walletType,isPayByMAWallet:"MAWallet"==e.checkoutResponse.walletType,isPayByMBWallet:"MBWallet"==e.checkoutResponse.walletType},b.changeWalletResponse=e,e})},b.walletOptionChanged=function(e,t){if(t?window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,dbLog:!b.medicine||"meds",hj:!0,name:b.medicine?"MedsCorpWalletCheck":"Wallet Check",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{wallet:e},google:window._Site_Props.__googleTransform("Wallet Check")})}):window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,dbLog:!b.medicine||"meds",hj:!0,name:b.medicine?"MedsCorpWalletUncheck":"Wallet Uncheck",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{wallet:e},google:window._Site_Props.__googleTransform("Wallet Uncheck")})}),!t&&b.medicine){var a=b.wallet.isPayByMBWallet||b.wallet.isPayByMAWallet||b.wallet.isPayByCorpWallet;if(0==a)switch(e){case"MAWallet":b.wallet.isPayByMAWallet=!0,b.walletType="PGAndMAWallet";break;case"CorpWallet":b.wallet.isPayByCorpWallet=!0,b.walletType="PGAndCorpWallet";break;case"MBWallet":b.wallet.isPayByMBWallet=!0,b.walletType="PGAndMBWallet"}}if(t)switch(e){case"MAWallet":b.walletType="PGAndMAWallet";case"CorpWallet":b.wallet.isPayByMBWallet=!1,b.walletType="PGAndCorpWallet";break;case"MBWallet":b.wallet.isPayByMAWallet=!1,b.wallet.isPayByCorpWallet=!1,b.walletType="PGAndMBWallet"}b.walletChoosed()},b.walletChoosed=function(){if(b.medicine)return b.checkoutData.walletName=b.walletType.replace("PGAnd",""),b.checkoutData.couponCode=b.couponCode,void y.checkout(b.checkoutData,b).then(function(e){b.walletType=b.checkoutData.walletName;var t=e.checkoutResponse.priceObj||{};if(b.checkoutResponseData=e,b.isCouponCodeNotEmpty=!0,b.gatewayTitle=o.trustAsHtml(b.checkoutResponseData.checkoutResponse.priceObj.gatewayTitle),b.disclaimerText=o.trustAsHtml(b.checkoutResponseData.checkoutResponse.priceObj.disclaimerText),b.checkoutPricing={totalPrice:t.totalPrice,partnerDiscountAmount:t.discount.find(function(e){return"partnerDiscountAmount"===e.name}).value||0,firstOrderDiscount:t.discount.find(function(e){return"firstOrderDiscount"===e.name}).value||0,walletDeduction:t.cashlessAmount,finalPrice:t.finalPrice,price:t.finalPrice},b.finalPayment=t.finalPrice,b.splitDetails=e.checkoutResponse.pgCodSplit,b.splitDetails)for(var a in b.splitDetails.splitOptions)b.splitDetails.splitOptions[a].isSelected&&(b.appointmentData.paymentTypeId=b.splitDetails.splitOptions[a].paymentTypeId);return b.wallet={gatewayAmount:t.pgAmount,totalAmount:t.finalPrice,walletAmount:t.cashlessAmount,isPayByCorpWallet:"CorpWallet"==e.checkoutResponse.walletType,isPayByMAWallet:"MAWallet"==e.checkoutResponse.walletType,isPayByMBWallet:"MBWallet"==e.checkoutResponse.walletType},b.changeWalletResponse=e,e});b.finalPayment=parseFloat(b.mediMarketPayment.amountAfterCouponDiscount),b.wallet.deductMBWallet=0,b.wallet.deductMAWallet=0,b.wallet.deductCorpWallet=0;var e=b.isHomeSampleCollection&&b.homeSampleCollectionCharges&&!isNaN(b.homeSampleCollectionCharges);e&&(b.finalPayment=b.finalPayment-b.homeSampleCollectionCharges),b.wallet.isPayByMBWallet&&(b.finalPayment<b.MBBalance?(b.wallet.deductMBWallet=b.finalPayment,b.finalPayment=0,0===b.wallet.deductMBWallet&&(b.wallet.isPayByMBWallet=!1)):(b.wallet.deductMBWallet=b.MBBalance,b.finalPayment=b.finalPayment-b.MBBalance)),b.wallet.isPayByMAWallet&&(b.finalPayment<b.MABenefAmount?(b.wallet.deductMAWallet=b.finalPayment,b.finalPayment=0,0===b.wallet.deductMAWallet&&(b.wallet.isPayByMAWallet=!1)):(b.wallet.deductMAWallet=b.MABenefAmount,b.finalPayment=b.finalPayment-b.MABenefAmount)),b.wallet.isPayByCorpWallet&&(b.finalPayment<b.CorpBenefAmount?(b.wallet.deductCorpWallet=b.finalPayment,b.finalPayment=0,0===b.wallet.deductCorpWallet&&(b.wallet.isPayByCorpWallet=!1)):(b.wallet.deductCorpWallet=b.CorpBenefAmount,b.finalPayment=b.finalPayment-b.CorpBenefAmount)),e&&(b.finalPayment=b.finalPayment+b.homeSampleCollectionCharges),b.setPaymentCustomParams("MAWalletUsage",Number.parseFloat(b.wallet.deductMAWallet)),b.setPaymentCustomParams("MBWalletUsage",Number.parseFloat(b.wallet.deductMBWallet)),b.setPaymentCustomParams("CorpWalletUsage",Number.parseFloat(b.wallet.deductCorpWallet))},b.prescriptionDownload=function(e){var t="";t=e.filePublicUrl?e.filePublicUrl.split("/")[0]:e.result.fileDetails[0].filePublicUrl.split("/")[0],s.fileDownload(t)},b.createAppointment=function(){if(b.errPayment="",b.existingOrderId="",b.user=s.isUserSignedin(),s.bookedAppointmentDetails=b.createAppointmentData,s.bookedAppointmentDetails.finalPrice=b.medicine?0:s.detailsForBooking.docObj.price,b.medicine){var e=y.checkoutData(b);b.checkoutData=e,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,fbq:!0,dbLog:!b.medicine||"meds",hj:!0,fbqReference:"InitiateCheckout",name:b.medicine?"MedsProceedToPaymentPage":"Appointment Creation Request",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:b.customParams,google:window._Site_Props.__googleTransform(b.eventCategory,"AppointmentCreationRequest",b.eventLabel)}),branchLog:{name:"Initiated Checkout",custom_data:{topic:b.eventCategory,netPaidAmount:b.customParams.amount,packageId:R?R.packageId:r.packageId,packageName:R?R.packageName:s.detailsForBooking.docObj?s.detailsForBooking.docObj.packageName:""},alias:R?R.packageName:s.detailsForBooking.docObj?s.detailsForBooking.docObj.packageName:""}}),y.checkout(b.checkoutData).then(function(e){if(e&&e.checkoutResponse&&(b.mbtoken=e.checkoutResponse.accessToken,b.medicine&&!_.isEmpty(e.checkoutResponse.priceObj))){try{L={patient_name:b.appointmentData.patientName,patientid:b.appointmentData.maid?b.appointmentData.maid.toString():"",patient_relation:b.appointmentData.relation,pgAmount:e.checkoutResponse.priceObj.finalPrice,gmv:e.checkoutResponse.priceObj.totalPrice,discounted_amount:0,pincode:b.appointmentData.patientPincode?b.appointmentData.patientPincode.toString():"",AddressType:b.appointmentData.addressType,DeliveryType:b.storeData?"Store":"Home",coupon_code:"NA",corpWalletAmount:0,mbWalletAmount:0,maWalletAmount:0}}catch(t){}switch(e.checkoutResponse.walletType){case"CorpWallet":L.corpWalletAmount=e.checkoutResponse.priceObj.cashlessAmount;break;case"MAWallet":L.maWalletAmount=e.checkoutResponse.priceObj.cashlessAmount;break;case"MBWallet":L.mbWalletAmount=e.checkoutResponse.priceObj.cashlessAmount}_.isEmpty(e.checkoutResponse.priceObj.discount)||(L.discounted_amount=e.checkoutResponse.priceObj.discount.reduce(function(e,t){return e+t.value},0)),y.sendGTMEvents(i.MED_PAYMENT_DETAILS_SCREEN_LANDING,L)}if(b.isPurelyRX=b.checkoutData.isRxUpload&&("UPLOADRX"===b.checkoutData.meta.type||"REORDER"===b.checkoutData.meta.type),b.isSearchRx=b.checkoutData.isRxUpload&&"SEARCH"===b.checkoutData.meta.type,e.errMessage&&(f({message:e.errMessage,position:"center",duration:2e3}),b.submitted=!1),b.isCouponCodeNotEmpty=!1,b.validatedCouponCode=e.checkoutResponse&&e.checkoutResponse.priceObj&&e.checkoutResponse.priceObj.isCoupanApplied&&e.checkoutResponse.priceObj.isCoupanApplied?couponCode:"",b.checkoutPricing={totalPrice:e.checkoutResponse.priceObj.totalPrice,partnerDiscountAmount:e.checkoutResponse.priceObj.discount.find(function(e){return"partnerDiscountAmount"===e.name}).value||0,firstOrderDiscount:e.checkoutResponse.priceObj.discount.find(function(e){return"firstOrderDiscount"===e.name}).value||0,walletDeduction:e.checkoutResponse.priceObj.cashlessAmount,finalPrice:e.checkoutResponse.priceObj.finalPrice,price:e.checkoutResponse.priceObj.finalPrice},b.finalPayment=e.checkoutResponse.priceObj.finalPrice,b.splitDetails=e.checkoutResponse.pgCodSplit,b.splitDetails)for(var a in b.splitDetails.splitOptions)b.splitDetails.splitOptions[a].isSelected&&(b.appointmentData.paymentTypeId=b.splitDetails.splitOptions[a].paymentTypeId);b.wallet={gatewayAmount:e.checkoutResponse.priceObj.pgAmount,totalAmount:e.checkoutResponse.priceObj.finalPrice,walletAmount:e.checkoutResponse.priceObj.cashlessAmount,isPayByCorpWallet:"CorpWallet"==e.checkoutResponse.walletType,isPayByMAWallet:"MAWallet"==e.checkoutResponse.walletType,isPayByMBWallet:"MBWallet"==e.checkoutResponse.walletType},b.paymentData=[],b.appointmentData.isCashless=!0,b.showMaWalletPaymentOption="MAWallet"==e.checkoutResponse.walletType,b.showCorpWalletPaymentOption="CorpWallet"==e.checkoutResponse.walletType,b.showMBWalletPaymentOption="MBWallet"==e.checkoutResponse.walletType;for(var n=0;n<e.checkoutResponse.paymentOptions.length;n++)b.paymentData.push(e.checkoutResponse.paymentOptions[n].paymentMethod),"MBWallet"===e.checkoutResponse.paymentOptions[n].walletName&&(b.wallet.isPayByMBWallet=e.checkoutResponse.walletUsed&&"MBWallet"===e.checkoutResponse.walletType,b.showWalletPaymentOption=!0,b.showMBWalletPaymentOption=!0,b.MBBalance=e.checkoutResponse.paymentOptions[n].walletAmount),"MAWallet"===e.checkoutResponse.paymentOptions[n].walletName&&(b.wallet.isPayByMAWallet=e.checkoutResponse.walletUsed&&"MAWallet"===e.checkoutResponse.walletType,b.showWalletPaymentOption=!0,b.MAWalletName=s.maAliasName,b.showMaWalletPaymentOption=!0,b.MABalance=e.checkoutResponse.paymentOptions[n].walletAmount,b.MABenefAmount=e.checkoutResponse.paymentOptions[n].walletAmount),"CorpWallet"===e.checkoutResponse.paymentOptions[n].walletName&&(b.wallet.isPayByCorpWallet=e.checkoutResponse.walletUsed&&"CorpWallet"===e.checkoutResponse.walletType,b.showWalletPaymentOption=!0,b.showCorpWalletPaymentOption=!0,b.CorpBalance=e.checkoutResponse.paymentOptions[n].walletAmount,b.CorpWalletName=s.corpAliasName);b.checkoutResponseData=e,b.gatewayTitle=o.trustAsHtml(b.checkoutResponseData.checkoutResponse.priceObj.gatewayTitle),b.disclaimerText=o.trustAsHtml(b.checkoutResponseData.checkoutResponse.priceObj.disclaimerText),b.mediMarketPayment={couponDiscount:0,isCod:e.checkoutResponse.priceObj.isCod||!1,amountAfterCouponDiscount:e.checkoutResponse.priceObj.finalPrice},b.paymentOptions=e.checkoutResponse.paymentOptions,b.changeTab()})}else if(b.user&&b.user.token){var t=c.apiUrl+"/Checkout";b.isCouponCodeNotEmpty=!1,b.resetPaymentCustomParams(),b.isMAWalletAvailable=!0,b.createAppointmentData.medicineCart={};var a=window.navigator.userAgent.toLowerCase(),n="web";if(a.indexOf("android")>-1?n="Android":/iphone|ipod|ipad/.test(a)&&(n="iOS"),b.createAppointmentData.cartItems[0].additionalParams.browser_fingerprint_id=window.sessionStorage.getItem("branch_fingerprint")||"",b.createAppointmentData.cartItems[0].additionalParams.Utm_Source=window.sessionStorage.getItem("utm_source")||"medibuddyInWeb",b.createAppointmentData.cartItems[0].additionalParams.Utm_Medium=window.sessionStorage.getItem("utm_medium")||"",b.createAppointmentData.cartItems[0].additionalParams.platform="web"===n?"DESKTOP_WEB":"Android"===n?"ANDROID_WEB":"IOS_WEB",b.createAppointmentData.medicineCart.medicineItems=b.resData.medicineItems,b.createAppointmentData.medicineCart.totalPrice=b.resData.totalPrice,s.makeAjaxCalls(t,b.createAppointmentData,"POST",b.user.token).then(function(e){if(e.data.isSuccess){if(b.showWalletCannotUsedMessage=!1,e.data.walletBalaceDetail&&e.data.walletBalaceDetail.length>0&&!b.isCovid&&(b.walletBalanceDetail=e.data.walletBalaceDetail),e.data.checkoutPricing&&(b.checkoutPricing=e.data.checkoutPricing,b.checkoutPricing.walletAmount=e.data.paymentOptions[0].walletAmount,b.checkoutPricing.price=b.checkoutPricing.finalPrice,b.billWalletUpdation()),b.isEssential&&(b.deliveryCost=0,e&&e.data.additionalPrice&&(b.deliveryCost=e.data.additionalPrice.DeliveryCost)),b.isNavya||e.data.paymentOptions.length>0){if(b.paymentOptions=e.data.paymentOptions,b.appointmentData.prefDateTime&&(b.customParams.appointmentDate=b.appointmentData.prefDateTime,b.customParams.appointmentDateValue=b.appointmentData.prefDateTime.toDateString()),s.bookedAppointmentDetails.finalPrice>0&&(b.customParams.amount=s.bookedAppointmentDetails.finalPrice),s.detailsForBooking.docObj.priceRange&&(b.customParams.GMV=parseInt(s.detailsForBooking.docObj.priceRange)),b.isNavya&&window._Site_Props.__setServiceDetails({serviceName:"Second Opinion",serviceType:"Cancer Care Navya"}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,fbq:!0,dbLog:!b.medicine||"meds",hj:!0,fbqReference:"InitiateCheckout",name:b.medicine?"MedsProceedToPaymentPage":"Appointment Creation Request",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:b.customParams,google:window._Site_Props.__googleTransform(b.eventCategory,"AppointmentCreationRequest",b.eventLabel)}),branchLog:{name:"Initiated Checkout",custom_data:{topic:b.eventCategory,netPaidAmount:b.customParams.amount,packageId:R?R.packageId:r.packageId,packageName:R?R.packageName:s.detailsForBooking.docObj?s.detailsForBooking.docObj.packageName:""},alias:R?R.packageName:s.detailsForBooking.docObj?s.detailsForBooking.docObj.packageName:""}}),b.isMediClinic&&(b.saleCoupon="TCSSPONSOREDCONSULT",b.validateCoupon()),b.isNavya){if(e.data.acknowledgement&&e.data.acknowledgement.isSuccess)b.navyaRedirect=e.data.acknowledgement.redirectUrl,b.bookedAppointmentDetails=s.bookedAppointmentDetails,b.bookedAppointmentDetails.couponCode="",b.mediMarketPayment={amountAfterCouponDiscount:b.bookedAppointmentDetails.finalPrice},b.finalPayment=b.strikeNavyaPkgAmount?0:b.bookedAppointmentDetails.finalPrice;else if(!e.data.acknowledgement||!e.data.acknowledgement.isSuccess)return f({message:"Sorry. Please retry later",position:"center",duration:2e3}),void m(function(){l.go("app.navya")},1e3)}else b.paymentOptions=e.data.paymentOptions,b.initializePayment(),b.checkForMembershipBenefits()||(e.data.applyCoupon?(b.bookedAppointmentDetails.couponCode=e.data.applyCoupon,b.validateCoupon()):b.getCouponCode());b.changeTab()}if(b.isEssential&&(s.detailsForBooking.docObj.quantity>0&&(b.mediMarketPayment.amountAfterCouponDiscount*=s.detailsForBooking.docObj.quantity,b.finalPayment*=s.detailsForBooking.docObj.quantity),b.mediMarketPayment.amountAfterCouponDiscount+=b.deliveryCost,b.finalPayment+=b.deliveryCost),b.medicine&&!_.isEmpty(b.paymentOptions)){var t=b.paymentOptions.find(function(e){return"PG"==e.paymentMethod});t&&t.gatewayAmount&&(b.finalPayment=t.gatewayAmount)}}else b.submitted=!1,e.data.errorMessage.toLowerCase().indexOf("order booking failed")>-1?b.error={error:"Unfortunately, we are not able to process your request at this time.",type:"alert-danger"}:203===e.status&&"Please Login to proceed"===e.data.errorMessage?s.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"bookAndPay",func:"createAppointment",args:null,stayInState:!0}):e.data.errorMessage&&(f({message:e.data.errorMessage,position:"center",duration:5e3}),h.post(c.eventlogsUrl,{eventType:"MedsCheckoutFailure",user:b.user.userDetails.userId,screen:"Checkout",element:b.createAppointmentData.medicineCart.totalPrice,info:e.data.errorMessage,domain:"web",event:"MedsCheckoutFailure"}))}),b.showWhatsappConsent&&b.createAppointmentData.cartItems&&b.createAppointmentData.cartItems.length&&b.createAppointmentData.cartItems.length>0&&b.createAppointmentData.cartItems[0].userConsent){var d=b.user.userDetails.userId,p=b.user.userDetails.pmEntityID,u=b.user.corpDetails?b.user.corpDetails.iwpEmployeeId:null,g=b.user.token;if(d&&p&&u&&g){var v={phonenumber:b.createAppointmentData.cartItems[0].phone,medibuddyUserId:d,empId:u,pmEntityId:p,packageId:b.createAppointmentData.cartItems[0].packageId,source:"medibuddy_web_portal"},k={method:"POST",url:c.docsappBackend+"/mbweb/saveUserWhatsappConsent",headers:{shorttoken:g,medibuddyuserid:d,pmentityid:p,empid:u},data:v};h(k).then(function(e){e&&e.data&&e.data.success})}}}else s.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"bookAndPay",func:"createAppointment",args:null,stayInState:!0})},b.backToUpload=function(){d.history.back()};var R;b.bookWithStorePickup=function(){if(R=null,_.each(b.pharmacyProviderData,function(e){!R&&_.find(e.providers,function(e){return e.name==b.storeData.providerName})&&(R=e,R.packageName=R.packageName.replace(" Package",""))}),R){var e={pincode:b.storeData.pincode,addressLine1:b.storeData.address,addressLine2:null,packageId:R.packageId,packageName:R.packageName,visitType:"DiagnosticCenter",isPickupFromStore:!0,pickupStoreID:b.storeData.storeID};b.customParams={visitType:e.visitType,discount:"10%"};var t=_.findWhere(b.pharmacyProviderData,{packageId:a.apolloPackageId});s.detailsForBooking={docObj:{packageId:t.packageId,packageName:t.packageName,dcId:_.first(t.providers).dcid,dcName:_.first(t.providers).name}},window._Site_Props.__setPackageDetails({packageName:"Medicine",providerName:s.detailsForBooking.docObj.dcName,providerLocation:r.searchc}),b.eventLabel=s.detailsForBooking.docObj.dcName+" at "+r.searchc,b.bookAppointmentForUser(e)}},b.bookWithHomeDelivery=function(){var e={pincode:b.appointmentData.patientPincode,addressLine1:b.appointmentData.patientHouseNo,addressLine2:b.appointmentData.patientLocation,packageId:b.apolloHomeDelivery?a.apolloPackageId:r.packageId,packageName:b.apolloHomeDelivery?"Apollo Pharmacy":r.searchk,visitType:"HomeVisit"};b.customParams={visitType:e.visitType};var t;t=b.apolloHomeDelivery?"10%":b.mediBiz?"15%":b.courier?b.courierDiscount:"10%-15%",b.customParams.discount=t;var i=_.findWhere(b.pharmacyProviderData,{packageId:e.packageId});s.detailsForBooking={docObj:{packageId:i?i.packageId:"",packageName:i?i.packageName:"",dcId:i?_.first(i.providers).dcid:"",dcName:i?_.first(i.providers).name:""}},window._Site_Props.__setPackageDetails({packageName:"Medicine",providerName:s.detailsForBooking.docObj.dcName,providerLocation:r.searchc}),b.eventLabel=s.detailsForBooking.docObj.dcName+" at "+r.searchc,b.optedNormalDelivery=!b.apolloHomeDelivery,b.optedHomeDelivery=!0,b.bookAppointmentForUser(e)},b.bookNonMaPackage=function(){var e=c.apiUrl+"/bookConsultation.json",t={doctorUserName:s.detailsForBooking.docObj.doctorUniqueId,uclmCode:s.detailsForBooking.docObj.properties&&s.detailsForBooking.docObj.properties.UCLMCODE?s.detailsForBooking.docObj.properties.UCLMCODE:"",appointmentDateTime:s.detailsForBooking.docObj.prefDateTime,dob:b.appointmentData.dateOfBirth,gender:b.appointmentData.gender,poweredBy:b.poweredBy,phoneNumber:b.appointmentData.phone,userConsent:b.appointmentData.userConsent,emailId:b.appointmentData.email};s.makeAjaxCalls(e,t,"POST",b.userObj.token).then(function(e){e.data.isSuccess?v.url("/appointmentDetails?orderid="+e.data.appointmentCode):f({message:"Sorry. Please retry later",position:"center",duration:5e3})})},b.checkIfValid=function(e){b.userForm,e||(d.scrollTo(0,0),d.scrollTo(0,0),angular.element(document.querySelector("input.ng-invalid"))[0].focus(),angular.element(document.querySelector("select.ng-invalid"))[0][0].focus())},b.bookAppointment=function(){b.checked=!0,b.customParams={},r.isRecommendation&&(b.customParams.isRecommendation=!0),b.programType&&(b.customParams.program=b.programType),b.bookNonMa?b.bookNonMaPackage():b.medicine?b.renderStorePickup&&b.storeData?(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsBookOrder",payload:window._Site_Props.__getEventParameters({custom:{delivery_type:"StorePickup"}})}),b.bookWithStorePickup()):(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsBookOrder",payload:window._Site_Props.__getEventParameters({custom:{delivery_type:"Standard"}})}),b.bookWithHomeDelivery()):b.bookAppointmentForUser()},b.changeDeliveryDetails=function(e){if(b.medicine)if(0===e)b.active=0,b.storeData="",b.renderStorePickup=!1,b.renderHomeDelivery=!0,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsHomeDeliveryTab"});else{if(b.active=1,b.renderHomeDelivery=!1,b.renderStorePickup=!0,b.medsItemDrugCodes=[],s.medsCartInfo.quantity&&s.medsCartInfo.cartItems){for(var t=0;t<s.medsCartInfo.cartItems.length;t++)b.medsItemDrugCodes.push(s.medsCartInfo.cartItems[t].itemId.toString());A(b.medsItemDrugCodes)}else y.getCartV2().then(function(e){for(var t=0;t<e.cart.cartItems.length;t++)b.medsItemDrugCodes.push(e.cart.cartItems[t].itemId.toString());A(b.medsItemDrugCodes)});window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsStorePickupTab"})}},b.storeCheck=function(t){var a=p.open({animation:!0,backdrop:"none",template:'<div class="modal-bottom-header modal-header p-t-10 p-l-20 p-r-20 primary-color"><div class="btn-border-close m-b-20"><span class="cursor-pointer pull-right" ng-style="{\'color\':isHover ? \'#000\' : \'#aaa\'}" ng-class="{\'md-dark-color\':isMobileView}"ng-init="isHover=false;" ng-mouseover="isHover=true;" ng-mouseout="isHover=false;" ng-click="closeModal()">close</span></div><div class="lgTxt bold">Below Items are not eligible for store pickup</div></div><div class="modal-body primary-color modal-border-body clearfix" ng-class="{\'p-t-0\':!isMobileView}"><div class="col-xs-12 col-md-12 p-l-0 p-r-0"><di class="m-b-5"><b><ul><li ng-repeat="name in ItemsNotAvailable"><p>{{name}}</a></li></ul></b></di><button class="br-15 btn btn-primary btn-block p-t-10 p-b-10 m-t-20" ng-click="closeModal()">Continue with Home Delivery</button></div></div>',scope:b,controller:["$scope","$uibModalInstance",function(e,a){e.ItemsNotAvailable=t,e.closeModal=function(){a.dismiss("cancel")}}],
size:e.isMobileView?"bottom":"border modal-sm",windowClass:e.isMobileView&&"bottom-sheet"});a.result["catch"](function(){b.changeDeliveryDetails(0)})},b.checkGender=function(){var e="";s.detailsForBooking.docObj&&s.detailsForBooking.docObj.genderType?(s.gender=s.detailsForBooking.docObj.genderType.trim(),"m"===s.gender.toLowerCase()||"male"===s.gender.toLowerCase()?(s.gender="M",e="Male"):"f"===s.gender.toLowerCase()||"female"===s.gender.toLowerCase()?(s.gender="F",e="Female"):s.gender="both"):s.detailsForBooking.docObj.genderType||(s.gender="both"),"both"!==s.gender&&s.gender!==b.appointmentData.gender?(b.submitted=!1,b.validate={error:"This is a "+e+" specific package.",type:"Gender"}):b.validate={error:"",type:"Gender"}},b.AHCBooking=function(){var t=c.apiUrl+"AHC/BookPackage.json",a=s.isUserSignedin();b.errorAHC="",a?(b.searchData={patientName:b.appointmentData.patientName,email:b.appointmentData.email,phone:b.appointmentData.phone,userConsent:b.appointmentData.userConsent,packageId:b.appointmentPackageData.packageId,dcid:b.appointmentPackageData.dcId,prefDateTime:b.appointmentData.prefDateTime,visitType:"DiagnosticCenter",addressLine1:b.appointmentData.patientHouseNo,addressLine2:b.appointmentData.patientLocation,couponCode:"",discountedAmount:0,maid:b.appointmentData.maid,ipAddress:"",remark:b.fileUploadTextArea,dateOfBirth:b.appointmentData.dateOfBirth,gender:b.appointmentData.gender,totalPrice:s.detailsForBooking.docObj.price,relation:b.appointmentData.relation,finalPrice:s.detailsForBooking.docObj.price},b.customParams={AHCPackage:!0,appointmentDate:b.appointmentData.prefDateTime,appointmentDateValue:b.appointmentData.prefDateTime.toDateString(),amount:s.detailsForBooking.docObj.price,isRecommendation:r.isRecommendation,visitType:b.searchData.visitType},s.detailsForBooking.docObj.priceRange&&(b.customParams.GMV=parseInt(s.detailsForBooking.docObj.priceRange)),b.isCouponCodeNotEmpty&&(b.searchData.couponCode=b.validatedCouponCode),b.urlData={cartItems:[b.searchData]},b.eventCategory="AHC",b.eventLabel=b.searchData.packageName+" in "+r.searchc,b.eventLabel=r.searchc,s.makeAjaxCalls(t,b.urlData,"POST",a.token).then(function(t){if(t.data.isSuccess&&0!==t.data.orderId)if(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,dbLog:!b.medicine||"meds",hj:!0,name:b.medicine?"MedsProceedToPaymentPage":"Appointment Creation Request",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:b.customParams,google:window._Site_Props.__googleTransform(b.eventCategory,"AppointmentCreationRequest",b.eventLabel)}),branchLog:{name:"Initiated Checkout",custom_data:{topic:b.eventCategory,netPaidAmount:b.customParams.amount,packageId:r.packageId,packageName:s.detailsForBooking.docObj?s.detailsForBooking.docObj.packageName:""},alias:s.detailsForBooking.docObj?s.detailsForBooking.docObj.packageName:""}}),_.isEmpty(t.data.razorPayOptions))s.orderId=t.data.orderId,T(t.data.orderId,window.sessionStorage.getItem("branch_fingerprint")||""),e.$emit("closeBookPayPopup"),b.paymentBlockingCss=!0,b.customParams.Sponsor=!0,b.storeOrderCreatedEvent(t.data.orderId,b.customParams,r.isRecommendation,b.programType),k.set(b.userObj.userDetails.userId,b.appointmentData.dateOfBirth.getTime()),l.go("app.orderDetails",{reload:"app.orderDetails"});else{var a=Number.parseFloat(t.data.razorPayOptions.amount)/100;b.setPaymentCustomParams("razorPaymentAmount",a),b.razorPayOptions=t.data.razorPayOptions,b.razorPayOptions.name="MediBuddy",e.isWebView?(b.razorPayOptions.callback_url=c.paymentUrl+b.razorPayOptions.amount,b.razorPayOptions.redirect=!0):b.razorPayOptions.handler=b.authorizeRazorPay,b.razorPayOptions.prefill={name:b.appointmentData.patientName,email:b.appointmentData.email,contact:b.appointmentData.phone},b.razorPayOptions.modal={ondismiss:b.dismissalRazorPay},b.razorPayOptions.image="/assets/images/logo_medibuddy.png",b.razorPayOptions.description="Your order ID: "+t.data.orderId,b.razorPayOptions.theme.color="#2198ff",T(t.data.orderId,window.sessionStorage.getItem("branch_fingerprint")||""),O=new Razorpay(b.razorPayOptions),O.open(),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:b.medicine?"MedsPlaceOrder":"Payment Request",dbLog:!b.medicine||"meds",hj:!0,payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:_.extend(b.customParams,b.paymentCustomParams),google:window._Site_Props.__googleTransform(b.eventCategory,"PaymentRequest",b.eventLabel)})}),b.storeOrderCreatedEvent(t.data.orderId,b.customParams,r.isRecommendation,b.programType)}else b.errorAHC=t.data.errorMessage,b.submitted=!1})):s.openLoginPopup("","templates/openLoginPopUp.html?"+timeStamp,{controller:"bookAndPay",func:"AHCBooking",args:null,stayInState:!0})},b.bookAppointmentForUser=function(e){b.submitted=!0;var t=s.isUserSignedin();if(b.createAppointmentData={cartItems:[]},b.medicine||b.programType||(b.appointmentData.prefDateTime=s.detailsForBooking.docObj.prefDateTime),b.appointmentPackageData.isSponser){if(b.checkGender(),!b.submitted)return;b.AHCBooking()}else if(b.medicine)if(t){b.searchData={patientName:b.appointmentData.patientName,gender:b.appointmentData.gender,relation:b.appointmentData.relation,phone:b.appointmentData.phone,userConsent:b.appointmentData.userConsent,pincode:e.pincode,addressLine1:_.isString(e.addressLine1)?e.addressLine1.replace(b.emailPattern.getRegexExpression("medicineAddrReplacePattern")," "):"",addressLine2:_.isString(e.addressLine2)?e.addressLine2.replace(b.emailPattern.getRegexExpression("medicineAddrReplacePattern")," "):"",landMark:_.isString(e.landMark)?e.landMark.replace(b.emailPattern.getRegexExpression("medicineAddrReplacePattern")," "):"",uploadedFiles:b.fileArray,isCashless:b.appointmentData.isCashless&&!b.resData.cashlessNA,packageId:e.packageId,packageName:e.packageName,isSponsored:!1,visitType:e.visitType,totalPrice:0,discount:0,finalPrice:0,maid:b.appointmentData.maid,remark:b.fileUploadTextArea,isPickupFromStore:e.isPickupFromStore,pickupStoreID:e.pickupStoreID,dateOfBirth:b.appointmentData.dateOfBirth,email:b.appointmentData.email,ailment:b.appointmentData.ailment},b.customParams.visitType=e.visitType,b.searchData.additionalParams={meta:{source:"web",type:_.isEmpty(b.resData.medicineItems)?"UPLOADRX":"SEARCH"},bookingSource:window.getSrcType(),bookingUrl:window.location.hostname,pushToPartner:b.resData.pushToPartner&&"Apollo Pharmacy"!=e.packageName,withoutPrescription:!1,userType:b.userObj.isRetailUser?"retail":"corporate",opsRemarks:b.resData.opsRemark};var a=_.countBy(b.resData.medicineItems,"rxRequired");b.resData.medicineItems&&a["false"]===b.resData.medicineItems.length&&(b.searchData.additionalParams.meta.type="ONLYOTC"),b.createAppointmentData.cartItems.push(b.searchData),b.eventCategory="Medicine",b.createAppointment()}else s.openLoginPopup("","templates/openLoginPopUp.html?"+timeStamp,{controller:"bookAndPay",func:"bookAppointmentForUser",args:e,stayInState:!0});else if(b.appointmentData.prefDateTime){var i=b.appointmentData;if(b.checkGender(),!b.submitted)return;if(_.isEmpty(s.detailsForBooking.docObj.cart)){i.isSponsored=!1,i.totalPrice=s.detailsForBooking.docObj.price,i.discount=s.detailsForBooking.docObj.priceRange-s.detailsForBooking.docObj.price,i.couponCode=i.discount>0?s.detailsForBooking.docObj.discountCode:"",i.finalPrice=s.detailsForBooking.docObj.price,i.visitType="DiagnosticCenter",b.isHomeSampleCollection||b.isCovid||b.isEssential?(i.visitType=b.isHomeSampleCollection||b.isEssential?"HomeVisit":i.visitType,i.addressLine1=b.appointmentData.patientHouseNo,i.addressLine2=b.appointmentData.patientLocation,i.pincode=b.appointmentData.patientPincode):b.consultationCheck&&b.appointmentData.patientRegistrationNum&&(i.hospitalRegistrationNo=b.appointmentData.patientRegistrationNum);var o=s.createAppointmentObject(i,s.detailsForBooking.docObj);if(_.isEmpty(s.detailsForBooking.docObj.fileArray)||(o.uploadedFiles=s.detailsForBooking.docObj.fileArray),o.isGender="M"===o.gender,o.dcLocation=s.detailsForBooking.docObj.dcLocation,o.ProgramEnrollmentId=r.memberInfo?r.memberInfo.enrollmentId:0,o.remark=b.fileUploadTextArea,_.isEmpty(b.fileArray)||(o.uploadedFiles=b.fileArray),!b.retailUser&&b.appointmentData.maid&&(o.MAID=b.appointmentData.maid),o.additionalParams={bookingSource:window.getSrcType(),bookingUrl:window.location.hostname},b.customParams.visitType=o.visitType,b.createAppointmentData.cartItems.push(o),b.isEssential&&s.detailsForBooking.docObj.quantity>1)for(var n=1;n<s.detailsForBooking.docObj.quantity;n++)b.createAppointmentData.cartItems.push(o)}else _.forEach(s.detailsForBooking.docObj.cart,function(e,t){i.isSponsored=!1,i.totalPrice=e.price,e.priceRange&&e.priceRange>e.price?i.discount=e.priceRange-e.price:i.discount=0,i.couponCode=i.discount>0?e.discountCode:"",i.finalPrice=e.price,i.visitType="DiagnosticCenter",(b.isHomeSampleCollection&&e.homeSampleCollection||b.isCovid)&&(i.visitType=b.isHomeSampleCollection&&e.homeSampleCollection?"HomeVisit":i.visitType,i.addressLine1=b.appointmentData.patientHouseNo,i.addressLine2=b.appointmentData.patientLocation,i.pincode=b.appointmentData.patientPincode);var a=s.createAppointmentObject(i,e);_.isEmpty(s.detailsForBooking.docObj.fileArray)||(a.uploadedFiles=s.detailsForBooking.docObj.fileArray),a.isGender="M"===a.gender,a.dcLocation=s.detailsForBooking.docObj.dcLocation,!b.retailUser&&b.appointmentData.maid&&(a.MAID=b.appointmentData.maid);var o={bookingSource:window.getSrcType(),bookingUrl:window.location.hostname};s.detailsForBooking.docObj.addressFiles&&"object"==typeof s.detailsForBooking.docObj.addressFiles&&(o.addressProof=JSON.stringify(s.detailsForBooking.docObj.addressFiles)),s.detailsForBooking&&s.detailsForBooking.docObj&&!_.isEmpty(o)&&(a.additionalParams=o),b.customParams.visitType=a.visitType,b.createAppointmentData.cartItems.push(a)});b.createAppointment()}else b.validateObj("alert-danger")},b.editCart=function(){l.go("app.labtestlist",{dcID:r.dcId,packgId:r.packageId,city:s.getCity(),dcName:r.dcName,packgName:r.packgName+" diagnostic centers"},{reload:"app.labtestlist"})},b.performFunction=function(){b.serviceType=r.searchk?r.searchk:r.searchc,b.appointmentPackageData=s.detailsForBooking.docObj,b.isMediClinic=s.detailsForBooking.isMediClinic,b.packageName=_.property("packageName")(s.detailsForBooking.docObj),b.endYear=(new Date).getFullYear(),b.appointmentPackageData.minAge&&b.appointmentPackageData.minAge>0&&(b.endYear-=b.appointmentPackageData.minAge),r.categoryItemTypeId===a.homehealthcareId?(b.isHomeSampleCollection=!0,b.homeHealthCare=!0,b.eventCategory="Home Health Care"):r.categoryItemTypeId===a.medicineId?(b.medicine=!0,b.isHomeSampleCollection=!0,b.eventCategory="Medicine"):r.categoryItemTypeId===a.consultationId?(b.consultationCheck=!0,b.eventCategory="Consultation",b.eventLabel=r.searchk?r.searchk:r.searchc,b.eventLabel=s.detailsForBooking.docObj.doctorName+" "+s.detailsForBooking.docObj.doctorSpecialization+" from "+s.getCity()):r.categoryItemTypeId===a.genomFilterName||r.categoryItemTypeId===a.genomeId?(b.genome=!0,b.eventCategory="Genome",b.eventLabel=r.searchk?r.searchk:r.searchc):r.categoryItemTypeId===a.gsoId?(b.getSecondOpinion=!0,b.eventCategory="Get Second Opinion"):r.categoryItemTypeId===a.healthCheckId?(b.packages=!0,b.eventCategory="Health Checks",b.eventLabel=r.searchk?r.searchk:r.searchc):r.categoryItemTypeId===a.olServiceId?(b.olService=!0,b.eventCategory="Tele Consultation",b.eventLabel=r.searchk?r.searchk:r.searchc):r.categoryItemTypeId===a.essentialId?(b.isEssential=!0,b.eventCategory="Essentials",b.eventLabel=r.searchk?r.searchk:r.searchc,b.disableBenefSelection=!0,b.cartFinalPrice=b.appointmentPackageData.price*s.detailsForBooking.docObj.quantity):r.categoryItemTypeId!==a.dentalId&&r.categoryItemTypeId!==a.dentalPackageId||(b.isDental=!0,b.eventCategory="Dental",b.eventLabel=r.searchk?r.searchk:r.searchc),b.consultationCheck||(b.eventLabel=b.appointmentPackageData.packageName+" by "+b.appointmentPackageData.dcName+" from "+s.getCity()),b.getSecondOpinion||b.medicine||(I(s.detailsForBooking.docObj.prefDateTime)&&r.categoryItemTypeId===a.healthCheckId&&l.go("app.packagesnew",{categoryItemTypeId:a.healthCheckFilterName,searchc:"Preventive",city:k.get("city")||"Bengaluru"},{reload:"app.packagesnew"}),b.appointmentPackageData.date=s.detailsForBooking.docObj.prefDateTime.toDateString().replace(" ",", "),b.homeHealthCare||b.genome||(b.appointmentPackageData.time=s.detailsForBooking.docObj.prefDateTime)),b.fromLabTest&&(b.eventCategory="Labtest",b.eventLabel=s.detailsForBooking.docObj.dcName.trim(),b.appointmentPackageData.dcCity=s.getCity(),b.eventLabel=b.eventLabel),!b.consultationCheck&&s.detailsForBooking.docObj&&s.detailsForBooking.docObj.homeSampleCollection&&(b.isHomeSampleCollection=!0),_.contains(a.covidPackageList,s.detailsForBooking.docObj.packageName)&&(b.isCovid=!0,_.contains(a.covidPackageName,s.detailsForBooking.docObj.packageName)&&(b.isCovidDetection=!0),(a.jllEntityIds.indexOf(b.userObj.userDetails.pmEntityID)>-1||a.rblIds.indexOf(b.userObj.userDetails.pmEntityID)>-1)&&b.isCovidDetection&&(b.maskFinalPrice=!0)),s.detailsForBooking&&s.detailsForBooking.errorMessage?b.validate=s.detailsForBooking.errorMessage:b.validate="",b.isError=!1,b.isGenderSelection=!1,b.today(),b.dateOptionsForDob={formatYear:"yy",maxDate:b.takeServerDate(),minDate:new Date(1917,1,1),startingDay:1},b.popup={prefDate:!1,dateOfBirth:!1},b.toggleMaxDob(),b.genderData=a.gender,b.user=s.isUserSignedin();var e=-621355968e5;b.user&&!b.programType&&(b.appointmentData.patientName||(b.appointmentData.patientName=b.user.userDetails.displayName),b.appointmentData.email=b.user.userDetails.email,b.appointmentData.phone=b.user.userDetails.phone,b.user.userDetails.dateOfBirth&&!b.appointmentData.dateOfBirth&&new Date(parseInt(b.user.userDetails.dateOfBirth.replace("/Date(","").replace(")/",""))).getTime()!==e&&(b.appointmentData.dateOfBirth=new Date(parseInt(b.user.userDetails.dateOfBirth.replace("/Date(","").replace(")/","")))),b.appointmentData.gender||(b.appointmentData.gender=b.user.userDetails.gender)),b.bookingTabClick(),b.localscope=b,s.profileInfo&&s.profileInfo.userAddresses&&s.profileInfo.userAddresses.length>0&&(b.userAddresses=s.profileInfo.userAddresses,w()),window._MB_Analytics.__push({branchLog:{name:"Payment Screen Visited",custom_data:{topic:b.eventCategory,netPaidAmount:b.appointmentPackageData.price,packageId:b.appointmentPackageData.packageId,packageName:b.appointmentPackageData.packageName},alias:b.appointmentPackageData.packageName}})},b.formatPackageFilters=function(){s.detailsForBooking.docObj.packageFilters&&s.detailsForBooking.docObj.packageFilters.length>0&&_.forEach(s.detailsForBooking.docObj.packageFilters,function(e,t){if("gender"===e.substring(0,6).toLowerCase()){var i=e.split(":")[1];s.detailsForBooking.docObj.genderType=i}else if("maxage"===e.substring(0,6).toLowerCase()){var o=e.split(":")[1];s.detailsForBooking.docObj.maxAge=parseInt(o)}else if("minage"===e.substring(0,6).toLowerCase()){var n=e.split(":")[1];s.detailsForBooking.docObj.minAge=parseInt(n)}else"homesamplecollection"===e.substring(0,20).toLowerCase()?s.detailsForBooking.docObj.homeSampleCollection=!0:"keywords"===e.substring(0,8).toLowerCase()&&e.split(":")[1].toLowerCase().indexOf(a.dentalPackageName.toLowerCase())>-1?s.detailsForBooking.docObj.isDentalPackage=!0:"priority"===e.substring(0,8).toLowerCase()?s.detailsForBooking.docObj.corpPriority=!0:(s.detailsForBooking.docObj.genderType="Both"===s.detailsForBooking.docObj.genderType?"both":"both"===s.detailsForBooking.docObj.genderType?s.detailsForBooking.docObj.genderType:"M"===s.detailsForBooking.docObj.genderType?s.detailsForBooking.docObj.genderType:"F"===s.detailsForBooking.docObj.genderType?s.detailsForBooking.docObj.genderType:"both",s.detailsForBooking.docObj.minAge=s.detailsForBooking.docObj.minAge>0?s.detailsForBooking.docObj.minAge:0,s.detailsForBooking.docObj.maxAge=s.detailsForBooking.docObj.maxAge>0?s.detailsForBooking.docObj.maxAge:59)}),s.detailsForBooking.docObj.priceRange&&(s.detailsForBooking.docObj.priceRange=parseInt(s.detailsForBooking.docObj.priceRange.split(".")[0])),s.detailsForBooking.docObj.price<s.detailsForBooking.docObj.priceRange&&(s.detailsForBooking.docObj.discountPercent=100-Math.round(s.detailsForBooking.docObj.price/s.detailsForBooking.docObj.priceRange*100))},b.getOlServiceFiles=function(){r.categoryItemTypeId===a.olServiceId&&s.makeAjaxCalls(c.apiUrl+"/SessionStorage/"+a.olServiceId+".json","","GET",b.userObj.token).then(function(e){e.data.isSuccess&&e.data.sessionData[a.olServiceId]?(b.totalFiles=[],b.resData=JSON.parse(e.data.sessionData[a.olServiceId]),b.fileArray=[],b.resData.fileArrays&&_.find(b.resData.fileArrays,function(e){b.fileArray.push(e[0].filePublicUrl)}),b.fileUploadTextArea=b.resData.remarks):l.go("app.home",{},{reload:"app.home"})})},b.$watch("validate",function(e){e&&b.validateObj(e)}),b.data={categoryItemTypeId:r.categoryItemTypeId,keyword:r.categoryItemTypeId===a.healthCheckId?r.searchc:r.searchk,condition:r.categoryItemTypeId===a.healthCheckId?"":r.searchc,packageId:r.packageId,dcId:r.dcId},r.city&&s.setCity(r.city);var j=c.apiUrl+"/categoryitemtypesearchForDC.json";if(b.userObj=s.isUserSignedin(),b.fileArray=[],r.categoryItemTypeId===a.investigationId||r.categoryItemTypeId===a.healthCheckId)s.makeAjaxCalls(c.apiUrl+"/SessionStorage/"+b.data.categoryItemTypeId+".json","","GET",b.userObj.token).then(function(e){e.data.isSuccess&&e.data.sessionData[r.categoryItemTypeId]?(s.detailsForBooking={docObj:JSON.parse(e.data.sessionData[r.categoryItemTypeId])},r.packgName&&r.dcName||(r.packgName=s.detailsForBooking.docObj.testName||s.detailsForBooking.docObj.packageName,r.dcName=s.detailsForBooking.docObj.dcName),s.detailsForBooking.docObj.prefDateTime=new Date(parseInt(r.appTime)),s.detailsForBooking.docObj.packageName=s.detailsForBooking.docObj.cart?_.first(s.detailsForBooking.docObj.cart).packageName:s.detailsForBooking.docObj.packageName,b.homeSampleCollectionCharges=s.detailsForBooking.docObj.homeSampleCollectionCharges,b.performFunction(),window._Site_Props.__setServiceDetails({serviceName:b.eventCategory,serviceType:r.packgName}),window._Site_Props.__setPackageDetails({packageName:s.detailsForBooking.docObj&&s.detailsForBooking.docObj.cart?_.first(s.detailsForBooking.docObj.cart).packageName:"",providerName:s.detailsForBooking.docObj.dcName,providerLocation:s.detailsForBooking.docObj&&s.detailsForBooking.docObj.cart?_.first(s.detailsForBooking.docObj.cart).dcLocation:""})):l.go("app.home",{},{reload:"app.home"})});else if(r.categoryItemTypeId===a.medicineFilterName)s.makeAjaxCalls(c.apiUrl+"/SessionStorage/"+b.data.dcId+".json","","GET",b.userObj.token).then(function(e){if(e.data.isSuccess&&e.data.sessionData[b.data.dcId]){if(b.totalFiles=[],b.resData=JSON.parse(e.data.sessionData[b.data.dcId]),b.fileArray=JSON.parse(b.resData.fileArrays),_.each(b.fileArray,function(e){var t=e.lastIndexOf("/");b.totalFiles.push({filePublicUrl:e,name:e.slice(t+1)})}),b.resData.orderData&&(b.orderData=JSON.parse(b.resData.orderData)),b.otcCart=[],b.resData&&b.resData.medicineItems&&(b.otcCart=b.resData.medicineItems.filter(function(e){return"OTC_STORE"==e.meta.medicineType})),b.resData.providerInfo&&(b.active=0,b.pharmacyProviderData=JSON.parse(b.resData.providerInfo),b.showHomeDelivery=!0,b.renderHomeDelivery=!0,b.renderStorePickup=!1,b.hasApollo=_.findWhere(b.pharmacyProviderData,{packageId:a.apolloPackageId}),b.hasApolloStorePickUp=b.hasApollo&&!!_.findWhere(b.hasApollo.providers,{isStorePickup:!0})&&!(b.otcCart.length>0),1===b.pharmacyProviderData.length&&b.hasApollo&&(b.apolloHomeDelivery=!0),b.resData.courierInfo&&(b.courier=!0,b.courierDetails=b.resData.courierInfo)),b.courier===!0&&(b.courierDiscount="15",b.deliveryTime="24 to 48 hours",b.courierDelivery=b.courierDetails.deliveryTime),b.resData.store&&(b.active=1,b.renderHomeDelivery=!1,b.renderStorePickup=!0,b.storeData=JSON.parse(b.resData.store)),b.resData.remark){if(t.isJsonObject(b.resData.remark)&&!_.isEmpty(JSON.parse(b.resData.remark))){var i=JSON.parse(b.resData.remark);b.resData.remark=i.map(function(e){return(e.name||e.itemName)+" -- "+(e.count||e.quantity)}).join("|")}b.fileUploadTextArea=b.resData.remark}if(a.forceCashlessEntityIds.indexOf(b.userObj.userDetails.pmEntityID)>-1&&(b.resData.cashlessNA=!1,b.resData.pushToPartner=!0),(!b.resData.cashlessNA||b.user.isRetailUser&&b.medicine)&&(b.appointmentData.isCashless=!0),!b.resData.rxRequired&&b.resData.remark&&_.isEmpty(b.fileArray)){var o={medicineCart:b.resData.remark.split("|").map(function(e){var t=e.split(" -- ");return{name:t[0],quantity:t[1]}})};h.post(c.medsService+"medibuddy/generateOtcPrescription",o).then(function(e){e.data.message&&!_.isEmpty(e.data.message.prescription)&&(b.fileArray=b.fileArray.concat(e.data.message.prescription),_.each(b.fileArray,function(e){var t=e.lastIndexOf("/");b.totalFiles.push({filePublicUrl:e,name:e.slice(t+1)})}))})}if(b.user=s.isUserSignedin(),b.user&&!b.programType&&(b.appointmentData.patientName||(b.appointmentData.patientName=b.user.userDetails.displayName),b.appointmentData.email=b.user.userDetails.email,b.appointmentData.phone=b.user.userDetails.phone),b.resData.appointmentData)b.appointmentData=JSON.parse(b.resData.appointmentData);else if(b.resData.patientData){var n=JSON.parse(b.resData.patientData);x(n)}if(b.orderData&&(b.appointmentData.patientHouseNo=b.orderData.addressLine1,b.appointmentData.patientLocation=b.orderData.addressLine2),b.userObj&&b.userObj.userDetails&&b.userObj.userDetails.pmEntityID){b.isTcsUser=1006639==b.userObj.userDetails.pmEntityID;var d=c.medsService+"app/getAilmentList/"+b.userObj.userDetails.pmEntityID;b.appointmentData.ailment="",h.get(d).then(function(e){b.ailmentRequired=e.data.message.isAilmentRequired,b.ailmentRequired&&(b.sysArr=e.data.message.ailmentList)})}b.isHomeSampleCollection=!0,b.medicine=!0,b.appointmentPackageData={dcCity:s.getCity()},b.eventCategory="Medicine",b.appointmentData.patientPincode=r.searchc,w(),b.endYear=(new Date).getFullYear(),window._Site_Props.__setServiceDetails({serviceName:b.eventCategory,serviceType:r.searchc}),b.bookingTabClick()}else l.go("app.home",{},{reload:"app.home"})});else if(_.isEmpty(s.detailsForBooking))if(b.bookNonMa){j=c.apiUrl+"/GetConsulationPackage.json";var W={packageIds:new Array(0)};W.packageIds.push(r.packageId),s.makeAjaxCalls(j,W,"POST",b.userObj.token).then(function(e){if(e.data.categoryItemTypeResponse&&e.data.categoryItemTypeResponse.length>0&&e.data.categoryItemTypeResponse[0].categoryItems&&e.data.categoryItemTypeResponse[0].categoryItems.length>0){if(e.data.categoryItemTypeResponse[0].categoryItems[0]){var t=_.find(e.data.categoryItemTypeResponse[0].categoryItems,function(e){return e.doctorUniqueId===r.doctorId});t?s.detailsForBooking={docObj:t}:s.detailsForBooking={docObj:e.data.categoryItemTypeResponse[0].categoryItems[0]}}else s.detailsForBooking={docObj:{}};s.detailsForBooking.docObj.prefDateTime=new Date(parseInt(r.appTime)),b.formatPackageFilters(),b.performFunction(),window._Site_Props.__setServiceDetails({serviceName:b.eventCategory,serviceType:b.serviceType}),window._Site_Props.__setPackageDetails({packageName:s.detailsForBooking.docObj.packageName,providerName:s.detailsForBooking.docObj.dcName,providerLocation:s.detailsForBooking.docObj.dcLocation})}else l.go("app.home",{},{reload:"app.home"})})}else r.categoryItemTypeId===a.navyaId?s.makeAjaxCalls(c.apiUrl+"/SessionStorage/"+b.data.categoryItemTypeId+".json","","GET",b.userObj.token).then(function(e){e.data.isSuccess&&e.data.sessionData[a.navyaId]?(s.detailsForBooking={docObj:JSON.parse(e.data.sessionData[a.navyaId])},r.packgName&&r.dcName||(r.packgName=s.detailsForBooking.docObj.testName,r.dcName=s.detailsForBooking.docObj.dcName),b.strikeNavyaPkgAmount=t.getFlatProperty(s,"detailsForBooking.docObj.strikePackageAmount"),b.strikeNavyaPkgAmount&&a.wiproIds.indexOf(b.userObj.userDetails.pmEntityID)>-1&&(b.relation=_.filter(b.relation,function(e){return _.contains(B,e.relationId)})),s.detailsForBooking.docObj.prefDateTime=new Date(parseInt(r.appTime)),b.performFunction(),window._Site_Props.__setServiceDetails({serviceName:b.eventCategory,serviceType:b.eventLabel}),window._Site_Props.__setPackageDetails({packageName:s.detailsForBooking.docObj.packageName,providerName:s.detailsForBooking.docObj.dcName,providerLocation:s.detailsForBooking.docObj.dcLocation})):l.go("app.home",{},{reload:"app.home"})}):s.makeAjaxCalls(j,b.data,"POST",b.userObj.token).then(function(e){if(e.data.categoryItemTypeResponse&&e.data.categoryItemTypeResponse.length>0&&e.data.categoryItemTypeResponse[0].categoryItems&&e.data.categoryItemTypeResponse[0].categoryItems.length>0){if(e.data.categoryItemTypeResponse[0].categoryItems[0]){var t=_.find(e.data.categoryItemTypeResponse[0].categoryItems,function(e){return e.doctorUniqueId===r.doctorId});t?s.detailsForBooking={docObj:t}:s.detailsForBooking={docObj:e.data.categoryItemTypeResponse[0].categoryItems[0]}}else s.detailsForBooking={docObj:{}};s.detailsForBooking.docObj.prefDateTime=new Date(parseInt(r.appTime)),b.formatPackageFilters(),b.getOlServiceFiles(),b.performFunction(),window._Site_Props.__setServiceDetails({serviceName:b.eventCategory,serviceType:b.serviceType}),window._Site_Props.__setPackageDetails({packageName:s.detailsForBooking.docObj.packageName,providerName:s.detailsForBooking.docObj.dcName,providerLocation:s.detailsForBooking.docObj.dcLocation})}else l.go("app.home",{},{reload:"app.home"})});else b.getOlServiceFiles(),b.performFunction(),window._Site_Props.__setPackageDetails({packageName:s.detailsForBooking.docObj.packageName,providerName:s.detailsForBooking.docObj.dcName,providerLocation:s.detailsForBooking.docObj.dcLocation});b.querySubmitCheck=!1,b.$on("IdleTimeout",function(){m(function(){b.querySubmitCheck=!0},0,!0)}),b.submitQuery=function(){p.open({templateUrl:"templates/help.html?"+timeStamp,size:"sm",controller:["$scope","$http","notify","$uibModalInstance",function(e,t,a,i){e.subject="User idle in payment page_"+b.eventCategory,e.feebackFunction=function(i){var o={userFeedBack:i.userFeedBack,subject:e.subject,userName:i.userName,phonenumber:i.phonenumber,email:i.email};t.post(c.apiUrl+"UserFeedBack",o,{headers:{"Content-Type":"application/json"}}).then(function(e){a({message:"Thank you! Your feedback is submitted successfully.",position:"center",duration:5e3})})},e.ok=function(){i.dismiss("cancel")}}]})},u.watch();var U=e.$on("bookAndPay",function(e,t){b[t.func](t.args)}),V=e.$on("userDetails",function(e,t){C(),b.getMembershipDetailForUser(),s.profileInfo&&s.profileInfo.userAddresses&&s.profileInfo.userAddresses.length>0&&(b.userAddresses=s.profileInfo.userAddresses,b.appointmentData.patientPincode=r.searchc,w())}),$=e.$on("showWalletInfo",function(e,t){b.bookNonMa&&b.checkCashlessLabel()}),H=e.$on("$stateChangeStart",function(e,t){O&&O.close()});r.categoryItemTypeId!=b.medsPayment.categoryItemTypeId&&b.medicine&&l.go("app.payment",b.medsPayment,{reload:"app.payment"}),b.updateMedicines=function(){b.cartQuantity=0;var e=y.getCartV2();b.cart=e&&e.items?e.items:b.medsCart,b.medsCart=b.cart,_.forEach(b.cart,function(e){var t=b.medicines.findIndex(function(t){return b.item={count:e.count||e.addedQuantity},t.drugCode==e.drugCode});t==-1||(b.medicines[t].count=e.count||e.addedQuantity),b.cartQuantity+=e.count||e.addedQuantity}),k.set("medsCart",b.medsCart)},e.$on("hideWalletBalanceEvent",function(){b.hideWalletBalance=e.hideWalletBalance});var G=e.showNewBenefitsUI;e.$on("newBenefitsFlagSet",function(){G=e.showNewBenefitsUI}),b.openNewBenefitsUI=function(){if(G=!1)p.open({animation:!0,templateUrl:"wallet/corpBenefits.html?"+timeStamp,controller:"corpBenefitsController",controllerAs:"corpBenefitsCtrl",size:e.isMobileView?"benefitsUIMob full-height-mobile":"benefitsUI subsModal"});else{var t=document.createElement("a");t.setAttribute("id","newBenefitsLink"),t.setAttribute("href","https://www.medibuddy.in/walletInfo"),t.setAttribute("target","_blank"),document.body.appendChild(t),t.click(),document.body.removeChild(t)}};var q=e.$on("userLogin",function(e,t){y.AddItemsBulkToCartV2(),s.updateMedsLocalCart(),l.go("app.medicine",{categoryItemTypeId:"Medicine"})}),z=b.$on("familyConfirmClicked",function(e,t){t[0]&&(b.appointmentData.patientName=t[0].name,b.appointmentData.gender="male"===t[0].gender.toLowerCase()||"m"===t[0].gender.toLowerCase()?"M":"F",b.appointmentData.genderValue=t[0].gender,b.appointmentData.dateOfBirth=new Date(parseInt(t[0].dob.replace("/Date(","").replace(")/",""))),b.appointmentData.relation=t[0].relationName,b.appointmentData.maid=t[0].maid.toString()||"0")}),Y=e.$on("userLogout",function(e,t){b.isCorpSponsoredUser=!1,s.medsCartInfo={quantity:0},b.medsCart=y.removeMedsCart(),b.updateMedicines()});b.$on("$destroy",function(){q(),Y(),H(),U(),V(),$(),z(),b.manageAddressPopup&&b.manageAddressPopup.dismiss("cancel"),d.removeEventListener("message",b.onDismissBilldeskPopup)})}}}]),e.register.directive("mediCompareText",[function(){return{require:"ngModel",link:function(e,t,a,i){a.mediCompareText&&(e.$watch(a.mediCompareText,function(e){i.$viewValue&&i.$setValidity("mediCompareText",e===i.$viewValue)}),i.$parsers.push(function(t){var o=t===e.$eval(a.mediCompareText);return i.$setValidity("mediCompareText",o),o?t:void 0}))}}}]),e.register.directive("domManipulation",["$rootScope","$window","$state","$uibModalStack",function(e,t,a,i){return{restrict:"EA",link:function(i,o,n){t.scrollTo(0,0),e.$on("$stateChangeSuccess",function(e){"app.home"===a.current.name||"app.register"===a.current.name?(angular.element(document.body).addClass("home"),angular.element(document.body).removeClass("inner")):(angular.element(document.body).addClass("inner"),angular.element(document.body).removeClass("home"))}),e.$on("dailogserviceOpen",function(e){angular.element(document.body).toggleClass("bodyScrollFix")}),o.on("click",function(){angular.element(document.body).toggleClass("filter-active")})}}}]),e.register.directive("footerHeight",["$interval","$document","$timeout",function(e,t,a){return function(i,o,n){i.stop=function(){e.cancel(i.promise)},i.promise=e(function(){var e=function(e){var a="";return a=t[0].getElementById(e)},o=e("filterId");if(o){var n=o.firstElementChild.clientHeight+100;angular.element(document.getElementById("containeWrap")).css("min-height",n+"px"),a(function(){i.stop()},2e3)}},500)}}]),e.register.directive("mediNotificationContainer",["$timeout","$window",function(e,t){var a=6e3;return{restrict:"E",replace:!0,scope:{setErrorNotification:"=errorMessage"},templateUrl:"/templates/notificationContainer.html?"+timeStamp,link:function(t){function i(i,o){t.notification.message=o,t.alertClass=i,t.notification.visible=!0,e(function(){t.notification.visible=!1},a)}t.notification={},t.notification.visible=!1,t.closeNotification=function(){t.notification.visible=!1},t.$watch("setErrorNotification",function(e){e&&(t.setErrorNotification="",i(e.type,e.error))})}}}]),e.register.directive("fupload",["$rootScope","Upload","$timeout","authService","$state","apiProvider","$window","$stateParams","notify","navConstantsSvc","standardEventsSvc","$http","$uibModal","localStorageService","medsService",function(e,t,a,i,o,n,s,r,l,c,d,p,m,u,g){return{restrict:"AE",scope:{provider:"=?",orderWithPresc:"=?",totalfilearray:"=?",filetextarea:"=?",prescriptionname:"=?",mandatory:"=?",apollohomedelivery:"=?",filePipeline:"=?",isPharmacy:"=?",medicineCart:"=?",isDirectUpload:"=?",cartlength:"=?"},templateUrl:"/templates/mediUploadFileTemplate.html?"+timeStamp,link:function(s,p,h){function f(){s.isAnyFileStillUploading=_.reduce(s.totalFiles,function(e,t){return e||t.isLoading},!1)}function y(){s.filePipeline&&(s.filePipeline.isPrescriptionUploaded=s.totalFiles.length,s.totalFiles.length&&s.$emit("uploadedFiles",!0))}s.hasapollo=!1,s.adjudicationText={0:"CASHLESS",1:"COD",2:"OTHERS"},s.updatedFiles={},s.totalFiles=u.get("medsPrescriptionsWithName")||[],
s.fileArray=u.get("medsPrescriptions")||[],s.isMobileView=e.isMobileView,s.prescriptionname||(s.prescriptionname=h.prescriptionname?h.prescriptionname:"Prescription"),s.filePipeline||(s.filePipeline={}),s.isAnyFileStillUploading=!1,s.activateChat=function(){i.activateChat()},s.provider&&s.provider.length>0&&(_.each(s.provider,function(e,t){e.packageId===c.apolloPackageId?(s.storePickup=e,s.hasapollo=!0):(s.firstProvider=e,s.hasCourier=!!_.first(e.providers).courierInfo)}),1!==s.provider.length||s.firstProvider||(s.firstProvider=s.storePickup)),s.newOrder=function(){s.hideRefill=!0,s.totalFiles=[],s.fileArray=[],s.updatedFiles={},s.refill=null,s.errFiles=[],s.showPrevOrdersList=!1,s.uploadRemark=!1},s.getPreviousOrders=function(){var e=i.isUserSignedin();if(e&&s.orderWithPresc){var t=n.apiUrl+"/medicineorder.json";i.makeAjaxCalls(t,"","GET",e.token).then(function(e){if(s.hideRefill=!1,s.totalFiles=[],s.errFiles=[],e.data.isSuccess){if(i.reOrderId){var t=_.findWhere(e.data.orders,{orderId:i.reOrderId});_.isEmpty(t)?s.totalOrder=e.data.orders:(s.refillOrder(t),i.reOrderId=null,s.totalOrder=[],s.totalOrder.push(t))}else s.totalOrder=e.data.orders;_.forEach(s.totalOrder,function(e,t){e.isSelected=!1}),s.orderAvailable=!0}else s.orderAvailable=!1;window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"Load Previous Orders",payload:window._Site_Props.__getEventParameters({service:!0})})})}},s.refillSignedIn=function(){var e=i.isUserSignedin();e?_.isEmpty(e)||i.makeAjaxCalls(n.apiUrl+"/UpdateSession/"+e.token,"","GET").then(function(e){e.data?s.getPreviousOrders():i.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"fileUpload",func:"refillSignedIn",args:null,stayInState:!0})}):i.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"fileUpload",func:"refillSignedIn",args:null,stayInState:!0})},s.refillOrder=function(e){s.updatedFiles={},s.totalFiles=[],s.refill=e,s.fileArray=e.uploadedFiles,s.showPrevOrdersList=!1,angular.forEach(s.totalOrder,function(e,t){e.isSelected=!1}),e.isSelected=!0,s.selectedOrder=e,s.selectedId=e.orderId,_.each(e.uploadedFiles,function(e){var t=e.lastIndexOf("/");s.totalFiles.push({filePublicUrl:e,name:e.slice(t+1)})}),s.uploadRemark=!0,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"Refill Order",payload:window._Site_Props.__getEventParameters({service:!0})})},s.prescriptionDownload=function(e){var t="";t=e.filePublicUrl?e.filePublicUrl.split("/")[0]:e.result.fileDetails[0].filePublicUrl.split("/")[0],i.fileDownload(t)},s.downloadAllPrescriptions=function(e){_.forEach(e.uploadedFiles,function(e){i.fileDownload(_.first(e.split("/")))})},s.uploadFiles=function(n,r,l){if(g.sendGTMEvents(d.MED_RX_BTN_ACTION),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",hj:!0,name:"MED_RX_BTN_ACTION",payload:window._Site_Props.__getEventParameters({service:!0})}),n){String.prototype.includes||(String.prototype.includes=function(){return String.prototype.indexOf.apply(this,arguments)!==-1});for(var p=0;p<n.length;p++)if(n[p].name.indexOf("exe")>-1||n[p].name.indexOf("bat")>-1||n[p].size/1048576>15)r.push(n[p]),n.splice(p,1),p--;else{var m=_.where(s.totalFiles,{name:n[p].name});_.isEmpty(m)&&s.totalFiles.push(n[p])}}s.files=n,r.length>0&&(s.errFiles=r),0===r.length&&s.totalFiles.length>0&&(s.errFiles=[]),angular.forEach(n,function(n){if(_.contains(s.totalFiles,n)){var r=n.name.split(".").pop().length,p=n.name.substring(0,n.name.length-r-1)+(new Date).getTime()+"."+n.name.split(".").pop();n=t.rename(n,p),n.isLoading=!0,f(),i.uploadFile(n,c.medsContract,"Prescription").then(function(t){a(function(){t.data.isSuccess?(g.sendGTMEvents(d.MED_RX_UPLOAD_SUCCESS),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",hj:!0,name:"MedsFileUploaded",payload:window._Site_Props.__getEventParameters({service:!0})}),_.isEmpty(s.medicineCart)||window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsRxUploaded",payload:window._Site_Props.__getEventParameters({custom:{status:!0}})}),s.UploadPrescription=!1,s.uploadRemark=!0,n.result=t.data,s.updatedFiles[t.data.fileDetails[0].fileName]=t.data.fileDetails,s.fileArray.push(t.data.fileDetails[0].filePublicUrl),s.orderWithPresc||(s.totalfilearray=s.updatedFiles),_.each(s.totalFiles,function(e){e.fileType&&(e.fileType="prescription")})):(_.isEmpty(s.medicineCart)||window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsRxUploaded",payload:window._Site_Props.__getEventParameters({custom:{status:!1}})}),_.find(s.totalFiles,function(e){e.name===n.name&&(s.totalFiles=_.without(s.totalFiles,e))})),y(),n.isLoading=!1,f(),u.set("medsPrescriptionsWithName",s.totalFiles),u.set("medsPrescriptions",s.fileArray);var a={fileArrays:JSON.stringify(s.fileArray),remark:s.filetextarea},r={sessionData:{},forceUpdate:!0};r.sessionData[c.medicineId]=JSON.stringify(a),s.isPharmacy&&e.$emit("medsFileUploaded",!0),l&&"UPLOADRX"===l&&o.go("app.pharmacy",{pincode:i.getPincode(),medicine:"",type:"UPLOADRX"},{reload:"app.pharmacy"})})},function(e){_.find(s.totalFiles,function(e){e.name===n.name&&(s.totalFiles=_.without(s.totalFiles,e))}),y(),n.isLoading=!1,f()})}})},s.unselectItem=function(e){e.ngfName?(s.updatedFiles=_.omit(s.updatedFiles,e.ngfName),s.totalfilearray=s.updatedFiles,_.find(s.totalFiles,function(t){t.ngfName===e.ngfName&&(s.totalFiles=_.without(s.totalFiles,t),_.isEmpty(s.totalFiles)&&(s.uploadRemark=!1))}),_.find(s.fileArray,function(t){var a=_.some(e.result.fileDetails,function(e){return e.filePublicUrl===t});a&&(s.fileArray=_.without(s.fileArray,t))})):(_.isEmpty(s.updatedFiles)?s.fileArray&&_.find(s.fileArray,function(t){t.indexOf(e.name)>-1&&(s.fileArray=_.without(s.fileArray,t))}):(s.updatedFiles=_.omit(s.updatedFiles,e.name),s.totalfilearray=s.updatedFiles),_.find(s.totalFiles,function(t){t.name===e.name&&(s.totalFiles=_.without(s.totalFiles,t),_.isEmpty(s.totalFiles)&&(s.uploadRemark=!1))})),u.set("medsPrescriptionsWithName",s.totalFiles),u.set("medsPrescriptions",s.fileArray),y(),s.hideRefill||0!==s.totalFiles.length||angular.forEach(s.totalOrder,function(e,t){e.isSelected=!1}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"File Removed",payload:window._Site_Props.__getEventParameters({service:!0})}),setTimeout(function(){s.$emit("uploadedFiles",!1)}),s.errFiles=[]},s.proceed=function(){var e=i.isUserSignedin();if(e){var t=0,a=u.get("medsCart");if(a&&a.cart&&a.cart.cartItems.length&&(_.forEach(a.cart.cartItems,function(e){"OUT OF STOCK"==e.meta.availability&&t++}),t))return void l({message:"Some items are out of stock in cart",position:"center",duration:5e3});if(0===s.totalFiles.length&&s.mandatory)l({message:"Please upload a valid prescription to proceed",position:"center",duration:5e3});else{var o=i.isUserSignedin();o?_.isEmpty(o)||i.makeAjaxCalls(n.apiUrl+"/UpdateSession/"+o.token,"","GET").then(function(e){e.data?s.proceedAfterValidation():i.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"fileUpload",func:"proceed",args:null,stayInState:!0})}):i.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"fileUpload",func:"proceed",args:null,stayInState:!0})}}else i.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"fileUpload",func:"proceed",args:null,stayInState:!0});_.isEmpty(s.medicineCart)||window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsSearchRxButton",payload:window._Site_Props.__getEventParameters({service:!0})})},s.showPrevOrders=function(){s.showPrevOrdersList=!0},s.confirmchechout=function(){var e=[],t={fileArrays:JSON.stringify(s.fileArray),remark:s.filetextarea};s.refill&&(t.orderData=JSON.stringify(s.refill)),t.providerInfo=JSON.stringify(s.provider),s.hasCourier&&(t.courierInfo=_.first(s.firstProvider.providers).courierInfo),s.medicineCart&&(_.each(s.medicineCart.cartItems,function(t,a){1==t.meta.rxRequired&&(s.mandatory=!0);var i=s.medicineCart.cartItems.find(function(e){return"AVAILABLE"==t.meta.availability&&e.itemId==t.itemId});_.isEmpty(i)||e.push(i)}),s.medicineCart.medicineItems=e),_.isEmpty(s.medicineCart)||_.extend(t,_.pick(s.medicineCart,"pushToPartner","remark","cashlessNA","isOtcOnly","opsRemark","medicineItems","totalPrice"));var a={sessionData:{},forceUpdate:!0};a.sessionData[c.medicineId]=JSON.stringify(t),(void 0===s.firstProvider||s.hasapollo&&s.apollohomedelivery)&&(s.firstProvider=s.storePickup),i.makeAjaxCalls(n.apiUrl+"/SessionStorage.json",a,"POST",s.userObj.token).then(function(e){e.data.isSuccess&&(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,fbq:!0,fbqReference:"AddToCart",name:"Slot Booked",dbLog:!0,hj:!0,googleSheet:!0,payload:window._Site_Props.__getEventParameters({service:!0,google:window._Site_Props.__googleTransform("Medicine","SlotBooked",r.pincode)})}),_.isEmpty(s.medicineCart)||window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsProceedWeb"}),u.setStorageType("sessionStorage"),u.set("medsPayment",JSON.stringify({categoryItemTypeId:r.categoryItemTypeId,searchc:r.pincode,searchk:s.firstProvider.packageName,dcId:c.medicineId,packageId:s.firstProvider.packageId})),u.setStorageType("localStorage"),s.cartlength&&s.cartlength>0?o.go("app.medicineCart",{pincode:r.pincode,medicine:r.medicine||"medicine"},{reload:"app.medicineCart"}):o.go("app.payment",{categoryItemTypeId:r.categoryItemTypeId,searchc:r.pincode,searchk:s.firstProvider.packageName,dcId:c.medicineId,packageId:s.firstProvider.packageId},{reload:"app.payment"}))})},s.popup=function(){m.open({animation:!0,backdrop:"none",template:'                <div class="modal-bottom-header modal-header p-t-10 p-l-20 p-r-20 primary-color">                  <div class="btn-border-close m-b-20"><span class="cursor-pointer pull-right" ng-style="{\'color\':isHover ? \'#000\' : \'#aaa\'}" ng-class="{\'md-dark-color\':isMobileView}"ng-init="isHover=false;" ng-mouseover="isHover=true;" ng-mouseout="isHover=false;" ng-click="closeModal()">close</span></div>                  <div class="lgTxt bold" style="font-size: 20px;">Important message on cart items</div>                </div>                <div class="modal-body primary-color modal-border-body clearfix" ng-class="{\'p-t-0\':!isMobileView}">                  <div class="col-xs-12 col-md-12 p-l-0 p-r-0">                  <div style="border-color: #80808038;border-width: 1px;/* border: groove; */border-radius: 10px;padding: 10px;border-style: ridge;">                    <div class="lgTxt" style="font-size: 15px;">Following items are out of stock.</div>                    <ul>                    <div  ng-repeat="item in outOfStockItems">                      <li class="m-b-5"><b>{{item.name}}</b> </li>                    </div>                    </ul>                    </div>                    <br>                    <div class="lgTxt" style="font-size: 13px;">Please clear the out of stock items from cart and proceed</div>                    <button class="br-15 btn btn-danger btn-block p-t-10 p-b-10 m-t-20" ng-click="continue()">Clear cart & Proceed</button>                  </div>                </div>                ',scope:s,controller:["$scope","$uibModalInstance",function(e,t){e.outOfStockItems=s.outOfStockItems,e.closeModal=function(){t.dismiss("cancel")},e.closeModalafterconfirm=function(){o.go("app.medicineCart",{medicine:"Medicines",pincode:i.getPincode()},{reload:"app.medicineCart"}),t.dismiss("cancel")},e.apply=function(){e.closeModal()},e["continue"]=function(){var t=[],a=[];s.dummyCart.forEach(function(e){var i=s.medicineCart.cart.cartItems.findIndex(function(t){return t.meta.itemId==e.itemId}),o=s.medsCart.findIndex(function(t){return t.meta.itemId==e.drugCode});t.push(s.medicineCart.items[i]),a.push(s.medsCart[o])}),s.medicineCart.items=t,u.set("medsCart",a),s.medicineCart.medicineItems=s.dummyCart,e.closeModalafterconfirm()}}],size:e.isMobileView?"bottom":"border modal-sm",windowClass:e.isMobileView&&"bottom-sheet"})},s.proceedAfterValidation=function(){if(_.find(s.updatedFiles,function(e){var t=s.fileArray.indexOf(e[0].filePublicUrl)!==-1;t||s.fileArray.push(e[0].filePublicUrl)}),s.fileArray.length>0||!s.mandatory){s.userObj=i.isUserSignedin();var e={fileArrays:JSON.stringify(s.fileArray),remark:s.filetextarea};s.refill&&(e.orderData=JSON.stringify(s.refill)),e.providerInfo=JSON.stringify(s.provider),s.hasCourier&&(e.courierInfo=_.first(s.firstProvider.providers).courierInfo),s.confirmchechout()}};var v=e.$on("fileUpload",function(e,t){s.hideRefill||s.getPreviousOrders(),t&&s[t.func](t.args)}),k=s.$on("clearFiles",function(e){_.each(s.totalFiles,function(e){s.unselectItem(e)})});s.$on("$destroy",function(){v(),k()}),_.isEmpty(s.totalfilearray)?s.totalfilearray=s.updatedFiles:(_.each(s.totalfilearray,function(e,t){if(_.isArray(e)){var a=_.first(e);s.totalFiles.push({filePublicUrl:a.filePublicUrl,name:a.fileName}),s.updatedFiles[t]=new Array({name:a.fileName,filePublicUrl:a.filePublicUrl})}else{var i=e.lastIndexOf("/");s.totalFiles.push({filePublicUrl:e,name:e.slice(i+1)}),s.updatedFiles[e.slice(i+1)]=new Array({name:e.slice(i+1),filePublicUrl:e})}s.uploadRemark=!0}),u.set("medsPrescriptionsWithName",s.totalFiles),u.set("medsPrescriptions",s.totalfilearray)),y(),s.orderWithPresc&&!i.reOrderId&&(s.newOrder(),i.reOrderId&&s.refillSignedIn())}}}]),e.register.directive("mediManageAddress",["$rootScope","navConstantsSvc","standardEventsSvc","$sce","patternService","authService","$state","apiProvider","$window","$httpParamSerializer","$stateParams","$timeout","notify","$http","$location","medsService",function(e,t,a,i,o,n,s,r,l,c,d,p,m,u,g,h){return{restrict:"AE",scope:{userProfile:"=",allowDelete:"=?",openAddAddress:"=?",filterAddress:"=?"},templateUrl:"templates/mediManageAddress.html?"+timeStamp,link:function(t,i,o){function s(){var t=document.getElementById("address-slider");l=new Glider(t,{slidesToShow:"auto",slidesToScroll:1,draggable:e.isMobileView,skipTrack:!0,itemWidth:230,exactWidth:230,arrows:{prev:".glider-prev",next:".glider-next"}})}var l,c=null;t.editingAddress=null,t.user=n.getUserObj(),t.sendCleverTapEvent=function(e,t){var a=null;t?(t.action=e,a=t):a={action:e},window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Manage Address Book",payload:window._Site_Props.__getEventParameters({custom:a,service:!0})})},t.startEditingAddress=function(e,i){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"MedsAddAddr"}),h.sendGTMEvents(a.MED_ADD_ADDRESS),t.disablePincode=!1,i!==-1?(t.sendCleverTapEvent("Edit",{addressTag:e.addressTag}),t.editingAddress=angular.copy(e),t.editingAddress.isActive=!0,t.editingAddress.additionalProperties?t.editingAddress.additionalProperties.name||(t.editingAddress.additionalProperties.name=t.userProfile.firstName):t.editingAddress.additionalProperties={name:t.userProfile.firstName},t.editingAddress.index=i):(t.sendCleverTapEvent("New"),t.filterAddress&&(t.disablePincode=!!t.filterAddress.pincode),t.editingAddress=angular.copy(t.filterAddress),t.editingAddress&&"object"==typeof t.editingAddress||(t.editingAddress={}),t.editingAddress.additionalProperties={name:""},t.editingAddress.isActive=!0,t.editingAddress.index=t.userProfile.userAddresses?t.userProfile.userAddresses.length:0),t.allowDelete&&n.scrollToSection("addressForm")},t.cancelEditAddress=function(){t.editingAddress.addressTag?t.sendCleverTapEvent("Cancel",{addressTag:t.editingAddress.addressTag}):t.sendCleverTapEvent("Cancel"),t.editingAddress=null,p(function(){l&&l.refresh()},100)},t.toggleAddressState=function(e,a){a?t.sendCleverTapEvent("Undo Delete",{addressTag:e.addressTag}):t.sendCleverTapEvent("Delete",{addressTag:e.addressTag}),e.isActive=a,c&&(p.cancel(c),c=null);var i=!a;i||t.userProfile.userAddresses.forEach(function(e){e.isActive||(i=!0)}),i&&(c=p(function(){d()},3e3))};var d=function(e){var a=[];e||_.each(t.userProfile.userAddresses,function(e){a.push(e.addressTag)});var i=r.apiUrl+"/UpdateProfile.json";n.makeAjaxCalls(i,t.userProfile,"POST",t.user.token,t.cityName).then(function(e){if(e.data.isSuccess){t.sendCleverTapEvent("Save Successful"),e.data.profile.dob&&(e.data.profile.dob=new Date(parseInt(e.data.profile.dob.replace("/Date(","")))),(!e.data.profile.userAddresses||e.data.profile.userAddresses&&0===e.data.profile.userAddresses.length)&&(e.data.profile.userAddresses=[]),n.userAddresses=e.data.profile.userAddresses.filter(function(e){return e.latitude&&e.longitude}),e.data.profile.gender&&("f"===e.data.profile.gender.toLowerCase()?e.data.profile.gender="Female":"m"===e.data.profile.gender.toLowerCase()?e.data.profile.gender="Male":e.data.profile.gender="Others"),t.userProfile=e.data.profile,n.profileInfo=e.data.profile;for(var i=0,o=t.userProfile.userAddresses.length;i<o;i++){var s=t.userProfile.userAddresses[i];if(!_.contains(a,s.addressTag)){t.$emit("selectAddress",s);break}}t.userProfile&&p(function(){l&&l.refresh()},100),m({message:"Updated Successfully!",position:"center",duration:5e3})}else m({message:"Sorry! Please try again after sometime.",position:"center",duration:5e3})})};t.submitNewAddress=function(e){if(e.$valid){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"MedsBookOrder"}),h.sendGTMEvents(a.MED_SAVE_ADDRESS),t.editingAddress.addressTag?t.sendCleverTapEvent("Save",{addressTag:t.editingAddress.addressTag}):t.sendCleverTapEvent("Save"),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsHomeDelivery"});var i=t.editingAddress.index;delete t.editingAddress.index,t.userProfile.userAddresses||(t.userProfile.userAddresses=[]),t.editingAddress.isPrimary&&t.userProfile.userAddresses.forEach(function(e){e.isPrimary=!1}),t.userProfile.userAddresses[i]=t.editingAddress,t.editingAddress=null,d(t.userProfile.userAddresses[i].addressTag)}},p(s,100);var u=e.$on("userLogin",function(e,a){t.user=n.getUserObj(),p(function(){l&&l.refresh()},100)});t.$on("$destroy",function(){if(l&&l.destroy(),u(),c){p.cancel(c);var e=r.apiUrl+"/UpdateProfile.json";n.makeAjaxCalls(e,t.userProfile,"POST",t.user.token,t.cityName).then(function(){})["catch"](function(){}),n.profileInfo.userAddresses=_.filter(n.profileInfo.userAddresses,function(e){return e.isActive}),c=null}}),t.$watch("userProfile",function(e){l&&l.refresh()}),t.sendCleverTapEvent("View Address Book"),t.openAddAddress&&!t.editingAddress&&t.startEditingAddress(null,-1)}}}]),e.register.directive("productSearch",["$rootScope","$window","authService","apiProvider","$http","$state","$uibModal","$timeout","patternService","navConstantsSvc","standardEventsSvc","$location","$stateParams","corpLabsService","medsService",function(e,a,i,o,n,s,r,l,c,d,p,m,u,g,h){return{restrict:"E",scope:{isLoading:"=?",showSuggestion:"=?",searchText:"=?",isSeo:"=?",pipeline:"=?",categoryType:"=?",onlyLocation:"=?",srcPage:"=?",isCorpLabs:"=?",disabled:"=?"},templateUrl:"/templates/product-search.html?"+timeStamp,link:function(f,y,v){function k(){T="",A=!1,i.makeAjaxCalls(o.apiUrl+"/Labs/FetchPincodeByCity/"+f.pipeline.preferredCity,"","GET").then(function(e){e.data.isServicable&&e.data.pincode?T=e.data.pincode+"":A=!0,b()})}function b(){f.setCityPincode=!0;var e=i.getPincode();T?f.validatePinCode(T,!0):A&&(e?f.validatePinCode(e):f.selectLocation())}function D(e){f.pipeline.searchText&&(f.isLoading=!0,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",hj:!0,name:"MedsSearch",payload:window._Site_Props.__getEventParameters({custom:{keyword:e}})}),h.sendGTMEvents(p.MED_MEDS_SEARCH,{search_value:e}),n.post(o.medsService+"app/medicine/search",{from:0,key:e,pmEntityId:w.userDetails?w.userDetails.pmEntityID:"1018900",source:"medibuddy",to:10},{headers:{pmEntityId:w.userDetails?w.userDetails.pmEntityID:"1018900"}}).then(function(e){_.isEmpty(e.data.message)?(f.isLoading=!1,f.searchResult=[]):(f.searchResult=e.data.message,f.counter=0,f.showDropdown=!0,f.isLoading=!1)},function(e){f.isLoading=!1,f.searchResult=[]}))}function C(e,t){f.pipeline.searchText&&(f.isLoading=!0,i.makeAjaxCalls(o.apiUrl+"/Labs/Search/"+f.city+"/"+f.pincode+"/"+e+"/10/"+(t?"true":"false"),"","GET",w.token,f.city,!0).then(function(t){t.data.isSuccess?(f.searchResult=t.data.searchedItems,f.counter=0,f.showDropdown=!0,f.isLoading=!1,f.pipeline.searchText=e):(f.isLoading=!1,f.searchResult=[]),t.data.suggestedKeyword&&e&&(f.pipeline.suggestedKeyword=e.toLowerCase()!==t.data.suggestedKeyword.toLowerCase()?t.data.suggestedKeyword:""),f.pipeline.searchText&&f.$emit("productSearchResult",f.searchResult,!0)},function(e){f.isLoading=!1,f.searchResult=[],f.$emit("productSearchResult",[],!0),notify({message:"There is some trouble loading in search results, please try again later",position:"center",duration:5e3})}))}var P="",w=i.isUserSignedin(),S=!!_.isEmpty(w)||w.isRetailUser;if(f.city=i.getCity(),f.isMergeFlow=!0,f.isMobileView=e.isMobileView,f.isMedicine=!1,f.isLabs=!1,f.isAhc=!1,f.setCityPincode=!1,_.isEmpty(f.pipeline)&&(f.pipeline={}),f.categoryType)switch(f.pincode=i.getPincode(),f.categoryType){case d.investigationId:f.isLabs=!0,f.redirectTo="app.labs",f.placeholderText="Search Lab Tests, Health Check Up Package";break;case d.medicineId:f.isMedicine=!0,f.redirectTo=f.isSeo?"app.aboutmedicine":"app.medicine",f.placeholderText="Search Medicines";break;case d.healthCheckId:f.isAhc=!0,f.redirectTo="app.ahc",f.placeholderText="Search Health Checks"}else f.isCorpLabs?(f.pincode=i.getPincode(),f.redirectTo="app.consumerLabs",f.placeholderText="Search Lab Tests, Health Check Up Package"):(f.categoryType=d.medicineId,f.isMedicine=!0);f.errorMessage="",f.pipeline||(f.pipeline={}),f.details={inputPincode:f.pincode&&f.city?f.pincode:"",showcity:f.pincode&&f.city?f.city:"",pincodeSelectionToogle:!(!f.pincode||!f.city),inputPincodeData:!f.pincode||!f.city},f.onFocus=function(){var e=document.querySelector("#product-search.search-background");e&&(!f.isCorpLabs&&a.scrollTo(0,0),e.classList.add("activate-search"),f.isCorpLabs&&(g.sendEvents("Search Page"),l(function(){t.hideFooter(!0)})),f.pipeline.focus=!0,f.isLabs&&(0==f.pipeline.proceedToCart&&window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",name:"Booking Flow Search Bar Clicked",payload:window._Site_Props.__getEventParameters({service:!0,custom:{srcPage:"Labs Landing Page"}})}),window._MB_Analytics.__push({isCleverTap:!0,name:"Search Page",dbLog:"labs",payload:window._Site_Props.__getEventParameters({service:!0,custom:{srcPage:"Labs Landing Page"}})})))},f.clearText=function(e){f.pipeline.searchText="",f.searchResult=[],f.$emit("productSearchResult",[]),e&&e.stopPropagation()},f.placeholderText||(f.placeholderText="Filter Lab Tests");var T="",A=!1;f.pipeline.preferredCity&&k(),f.getCityByPincode=function(e,t){f.isMedibuddyLoading=!0;var a=o.apiUrl+"/Labs/FetchCityByPincode/"+e;u.autoCartId&&(a+="/true"),i.makeAjaxCalls(a,"","GET",w.token,f.city).then(function(a){a.data.isServicable?(a.data.city&&(f.details={},f.details.inputPincode=e,f.details.showcity=a.data.city,f.details.pincodeSelectionToogle=!0,f.setCityPincode&&(i.setPincode(e),i.setCity(a.data.city),f.city=a.data.city,f.pincode=e,f.$emit("selectedCity",{city:f.city,pincode:f.pincode}),f.$emit("pincodeChange",e))),f.errorMessage="",f.isMedibuddyLoading=!1,f.isAvailable=!0,f.setCityPincode=!1):t?(f.isMedibuddyLoading=!1,f.isAvailable=!1,f.details.pincodeSelectionToogle=!1,f.pincode=i.getPincode(),f.pincode?f.validatePinCode(f.pincode):f.selectLocation()):(f.errorMessage="Sorry! We are not serviceable in "+e+" location. Please try another pincode",f.isMedibuddyLoading=!1,f.isAvailable=!1,f.details.pincodeSelectionToogle=!1)})["catch"](function(e){f.errorMessage="There is an error fetching the details. Please try again or after sometime.",f.isMedibuddyLoading=!1,f.isAvailable=!1,f.details.pincodeSelectionToogle=!1})},f.mergeFlowPincode=function(e,t){f.isMedibuddyLoading=!0;var a=o.apiUrl+"/Labs/v1/FetchCityByPincode/"+e;u.autoCartId&&(a+="/true"),i.makeAjaxCalls(a,"","GET",w.token,f.city).then(function(a){S&&a.data.isRetailPackagesAvailable||!S&&a.data.isSuccess?(a.data.city&&(f.details={},f.details.inputPincode=e,f.details.showcity=a.data.city,f.details.pincodeSelectionToogle=!0,f.setCityPincode&&(i.setPincode(e),i.setCity(a.data.city),f.city=a.data.city,f.pincode=e,f.$emit("pincodeChange",e)),g.sendEvents("Pincode Verification")),f.errorMessage="",f.isMedibuddyLoading=!1,f.isAvailable=!0,f.setCityPincode=!1):t?(f.isMedibuddyLoading=!1,f.isAvailable=!1,f.details.pincodeSelectionToogle=!1,f.pincode=i.getPincode(),f.pincode?f.validatePinCode(f.pincode):f.selectLocation()):(g.sendEvents("Pincode Not Servicable"),f.errorMessage="Sorry! We are not serviceable in "+e+" location. Please try another pincode",f.isMedibuddyLoading=!1,f.isAvailable=!1,f.details.pincodeSelectionToogle=!1)})["catch"](function(t){503==t.status?(g.sendEvents("Pincode Not Servicable"),f.errorMessage="Sorry! We are not serviceable in "+e+" location. Please try another pincode"):f.errorMessage="There is an error fetching the details. Please try again or after sometime.",f.isMedibuddyLoading=!1,f.isAvailable=!1,f.details.pincodeSelectionToogle=!1})},f.assignCityByPincode=function(e){f.ahcAvailablePackages={},f.errorMessage="true",f.details.pincodeSelectionToogle=!1,i.makeAjaxCalls(o.apiUrl+"/AHC/FetchCityByPincode",{PMEntityId:w.userDetails?w.userDetails.pmEntityID:"",Pincode:e},"POST").then(function(t){t.data.isSuccess&&t.data.city?(f.details={},f.details.inputPincode=e,f.details.showcity=t.data.city,f.details.pincodeSelectionToogle=!0,f.errorMessage="",f.isMedibuddyLoading=!1,f.isAvailable=!0,f.ahcAvailablePackages=t.data,f.setCityPincode&&(i.setPincode(e),i.setCity(t.data.city),f.city=t.data.city,f.pincode=e,f.$emit("ahcAvailablePackages",t.data),window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"ahc",name:"AHC Pincode Selected",payload:window._Site_Props.__getEventParameters({custom:{City:f.city,Success:!0,pincode:e,PMEntityId:w.userDetails?w.userDetails.pmEntityID:"",companyName:w.corpDetails&&w.corpDetails.employeeDetail?w.corpDetails.employeeDetail.companyName||"":""}})}))):t.data.isSuccess?(f.errorMessage="Sorry! We are not serviceable in "+e+" location. Please try another pincode",f.isMedibuddyLoading=!1,f.isAvailable=!1,f.details.pincodeSelectionToogle=!1,window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"ahc",name:"AHC Pincode Error",payload:window._Site_Props.__getEventParameters({custom:{City:f.city,Success:!1,pincode:e,PMEntityId:w.userDetails?w.userDetails.pmEntityID:"",companyName:w.corpDetails&&w.corpDetails.employeeDetail?w.corpDetails.employeeDetail.companyName||"":""}})})):(f.errorMessage="Please enter correct pincode",f.details.pincodeSelectionToogle=!1,f.isMedibuddyLoading=!1,f.isAvailable=!1,window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"ahc",name:"AHC Pincode Error",payload:window._Site_Props.__getEventParameters({custom:{City:"Non servicable city",Success:!1,pincode:e,PMEntityId:w.userDetails?w.userDetails.pmEntityID:"",companyName:w.corpDetails&&w.corpDetails.employeeDetail?w.corpDetails.employeeDetail.companyName||"":""}})}))})["catch"](function(t){f.errorMessage="Please enter correct pincode",f.details.pincodeSelectionToogle=!1,f.isMedibuddyLoading=!1,f.isAvailable=!1,window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"ahc",name:"AHC Pincode Error",payload:window._Site_Props.__getEventParameters({custom:{City:"Non servicable city",Success:!1,pincode:e,PMEntityId:w.userDetails?w.userDetails.pmEntityID:"",companyName:w.corpDetails&&w.corpDetails.employeeDetail?w.corpDetails.employeeDetail.companyName||"":""}})})})},f.fetchInfoForpincode=function(e){var t={categoryItemTypeId:f.categoryType,pincode:e,getPackageDetails:!0};f.pincodeKeyword=e,f.isMedibuddyLoading=!0,P=o.apiUrl+"pincodeAvailabilityCheck.json",i.makeAjaxCalls(P,t,"POST",w.token).then(function(t){if(t.data.isAvailable&&_.contains(i.allCities,t.data.pincodeCity)){t.data.pincodeCity&&(f.city=t.data.pincodeCity,i.setPincode(e),i.setCity(t.data.pincodeCity),f.city=t.data.pincodeCity,f.pincode=e,i.medicineCityParams=f.city.toLowerCase(),f.details={},f.details.inputPincode=e,f.details.showcity=t.data.pincodeCity,f.details.pincodeSelectionToogle=!0,f.$emit("selectedCity",{city:f.city,pincode:f.pincode}),f.$emit("pincodeChange",e),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsPINSubmitWeb",payload:window._Site_Props.__getEventParameters({custom:{pincode:f.pincode}})})),f.errorMessage="",f.isMedibuddyLoading=!1,f.isAvailable=!0;var a=m.path(),o=a.split("/");f.showSuggestion?"Medicine"==o[1]?s.go(f.redirectTo,{pincode:f.pincode},{reload:f.redirectTo}):"pharmacy"==o[1]&&s.go("app.pharmacy",{pincode:f.pincode},{reload:"app.pharmacy"}):"Medicine"==o[1]?s.go(f.redirectTo,{pincode:f.pincode},{reload:f.redirectTo}):"pharmacy"==o[1]&&s.go("app.pharmacy",{pincode:f.pincode},{reload:"app.pharmacy"})}else f.errorMessage=t.data.errorMessage,f.isMedibuddyLoading=!1,f.isAvailable=!1,f.details.pincodeSelectionToogle=!1})},f.validate=function(e,t){var a=new RegExp(c.getRegexExpression(t)),i=String.fromCharCode(e.charCode?e.charCode:e.which);if(!a.test(i)&&13!==e.charCode)return e.preventDefault(),!1},f.validatePinCode=function(e,t){e&&!f.disabled&&(f.isCorpLabs?f.mergeFlowPincode(e,t):f.isLabs?f.getCityByPincode(e,t):f.isAhc?f.assignCityByPincode(e):f.fetchInfoForpincode(e))},f.closeForm=function(){var e=f.details.inputPincode,t=f.details.showcity;f.isLabs||f.isCorpLabs?(i.setPincode(e),i.setCity(t),f.city=t,f.pincode=e,f.isCorpLabs?g.sendEvents("Pincode Success"):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",name:"Pincode Success"}),f.$emit("selectedCity",{city:f.city,pincode:f.pincode}),f.$emit("pincodeChange",e)):f.isAhc&&(i.setPincode(e),i.setCity(t),f.city=t,f.pincode=e,f.$emit("ahcAvailablePackages",f.ahcAvailablePackages)),I.close(),I=null};var I=null;f.selectLocation=function(t){if(f.isMedicine||f.isLabs||f.isAhc||f.isCorpLabs){if(f.isMedicine?window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsChangePINWeb"}):f.isLabs?window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",name:"Booking Flow Pincode Popup"}):f.isCorpLabs&&(t?g.sendEvents("Pincode Popup"):g.sendEvents("Change Location")),f.userProfile=i.profileInfo,f.userProfile&&!_.isEmpty(f.userProfile.userAddresses)&&!i.getPincode()){f.userAddresses=f.userProfile.userAddresses;var a=f.userAddresses.find(function(e){return e.isPrimary});a&&a.pincode&&f.validatePinCode(a.pincode)}I=r.open({animation:!0,scope:f,backdrop:"none",template:'<div ng-class="{\'modal-bottom-header modal-header\':isMobileView,\'modal-body\':!isMobileView}"><div class="clearfix text-right"><span class="cursor-pointer" ng-style="{\'color\':isHover ? \'#000\' : \'#aaa\'}" ng-class="{\'md-dark-color\':isMobileView}"ng-init="isHover=false;" ng-mouseover="isHover=true;" ng-mouseout="isHover=false;" ng-click="cancelDialog()">close</span></div><ng-include src="\'pincode_popup.html\'"></ng-include></div></div>',controller:["$scope","$uibModalInstance",function(e,t){var a=f.pincode&&f.city&&!f.errorMessage;f.details={inputPincode:a?f.pincode:"",showcity:a?f.city:"",pincodeSelectionToogle:!!a,inputPincodeData:!a},f.setCityPincode=!1,e.cancelDialog=function(){t.dismiss("cancel")},e.pincodeCheck=function(e){6!=e.target.value.length&&(f.errorMessage=""),e.target.value.length>0?(f.details.inputPincodeData=!1,f.details.pincodeSelectionToogle=!1):(f.details.inputPincodeData=!0,f.details.pincodeSelectionToogle=!1)}}],size:e.isMobileView?"bottom":"sm modal-border",windowClass:e.isMobileView&&"bottom-sheet"}),I.opened.then(function(){l(function(){var e=angular.element(document.querySelector('input[name="pincode"]'))[0];e&&e.focus()})}),I.result["catch"](function(){f.isCorpLabs?g.sendEvents("Pincode Cancel"):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",name:"Pincode Cancel"}),f.errorMessage="",i.getPincode()&&f.isAvailable||(f.setCityPincode=!0,i.getPincode()&&"app.medicine"===s.current.name?f.validatePinCode(i.getPincode().toString()):f.isAhc?f.assignCityByPincode(560029):f.validatePinCode("560029"));
})}else i.cityPopup("lg")},f.pincode&&f.city||u.city&&u.city==f.city&&/^[a-z]+$/.test(u.city)?(f.isLabs||f.isAhc||f.isCorpLabs)&&f.pincode&&!u.city&&(f.setCityPincode=!0,f.validatePinCode(f.pincode)):f.selectLocation(!0),f.searchBarClick=function(){f.isLabs||f.isCorpLabs||(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",hj:!0,name:"MedsSearchField"}),f.isSeo&&(f.pincode?s.go("app.pharmacy",{pincode:f.pincode},{reload:"app.pharmacy"}):f.selectLocation()))},f.debounceSearch=_.debounce(function(e){f.isMedicine?D(e):C(e)},800,!1),f.searchItems=function(e){f.pipeline.searchText=e,e&&e.length>1?f.debounceSearch(e):(f.searchResult=[],f.$emit("productSearchResult",[]))},f.redirectToSearch=function(e,t){if(e&&e.length>2||t){var a;t&&(t.count=1,i.medsCartInfo.cartItems=[t],a=t.name,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsSearchItemSelected",payload:window._Site_Props.__getEventParameters({custom:{medicineName:t.name}})})),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"Medicine Search",payload:window._Site_Props.__getEventParameters({custom:{searchText:e,selected:a}})}),f.showSuggestion||f.$emit("checkmedicines",e),f.showSuggestion&&s.go("app.pharmacy",{pincode:f.pincode,medicine:e},{reload:"app.pharmacy"})}},f.onKeyup=function(e,t){switch(e.keyCode){case 13:f.redirectToSearch(t,f.searchResult[f.counter]);break;case 27:f.showDropdown=!1;break;case 38:f.counter>0&&f.counter--;break;case 40:f.searchResult.length-1>f.counter&&f.counter++;break;default:f.$emit("checkmedicines",t)}},f.$on("allCities",function(e,t){f.city=t}),f.$on("clearProductSearchText",function(){f.clearText()}),f.$on("setSuggestedKey",function(e,t){f.clearText(),f.pipeline.suggestedKeyword="",C(t,!0)})}}}]),e.register.directive("providerSelection",["$rootScope","corpWellnessService","authService","$anchorScroll","navConstantsSvc","$filter","apiProvider","$timeout","$window","$uibModal",function(e,a,i,o,n,s,r,l,c,d){return{restrict:"AE",scope:{selectedPackage:"=?",pipeline:"=?",sponsored:"=?",checkout:"=?",dcList:"=?",providerSlots:"=?",allAhcPackageList:"=?",emitHandler:"=?",oldCorporateFlow:"=?"},templateUrl:"templates/providerTemplate.html?"+timeStamp,link:function(p,m,u,g){function h(e){y=l(function(){p.driver.highlight({element:"#"+e})},200)}function f(e){if(!p.isMobileView&&c.innerHeight&&e&&e.pageY){var t;t=void 0!==window.pageYOffset?window.pageYOffset:"CSS1Compat"===(document.compatMode||"")?document.documentElement.scrollTop:document.body.scrollTop;var a=c.innerHeight-e.clientY;if(a<200){var i=t+250-a;c.scrollTo(0,i)}}else l(function(){o.yOffset=150,o("selectedSlot")})}p.isMobileView=e.isMobileView,p.searchProvider={},p.recommendation={},p.homeSampleOption=1,p.totalPrice=p.selectedPackage.price,p.nextDay=new Date(i.serverDate).addDays(1).toDateString();var y;requirejs(["tour"],function(t){p.driver=new t({opacity:.5,allowClose:!1,padding:0,keyboardControl:!1,scrollIntoViewOptions:{}}),e.$on("$stateChangeStart",function(){_.isEmpty(p.recommendation)||p.closeRecommendation(),p.driver.reset()})}),p.pipeline.highlightDateFilter=function(e){h(e),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"UCP Request Home Sample Slot Edit",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0})})},p.user=i.isUserSignedin(),p.user&&p.user.corpConfig&&p.user.corpConfig.bookTillDate&&(p.bookTillDate=new Date(p.user.corpConfig.bookTillDate)),p.showHideSponserPackageList=p.dcList,_.forEach(p.showHideSponserPackageList,function(e,t){e.parsedDcId=parseInt(e.dcId),e.providerRelativeUrl&&(e=a.filterProviderWithProfile(e))}),p.formatTime=function(e){return i.getTimeFormate(e)},p.showMessage=n.hpEntityIds.indexOf(t.getFlatProperty(p,"user.userDetails.pmEntityID"))>-1&&!1,p.notifyMessage="Please note that some of the key Hospitals may be available for appointment bookings after 8th Nov 2021. However, you can still choose from other available medical centres or opt for home sample pick up anytime.",p.closeRecommendation=function(){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"AHC Hide Recommendation",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{recommendedDate:s("date")(p.sponsored.prefDate.date,"yyyy-MM-dd"),companyName:p.user.corpDetails.employeeDetail.companyName}})}),p.showHideSponserPackageList=p.recommendation.prevProviders,_.isEmpty(p.allAhcPackageList)||(p.allAhcPackageList[p.recommendation.curIndex].sponserTempPackageDetails=p.showHideSponserPackageList),p.recommendation={},p.isMobileView||(p.driver.reset(),l.cancel(y))},p.viewRecommendation=function(e){var t=r.apiUrl+"ProviderRecommendation",a={ProviderId:e.dcId,SlotDateTime:s("date")(p.sponsored.prefDate.date,"yyyy-MM-dd"),PackageId:e.packageId,contractId:e.contractId};p.checkout&&(a.MPPackageId=p.selectedPackage.packageId),i.makeAjaxCalls(t,a,"POST",p.user.token,p.cityName).then(function(t){if(!_.isEmpty(t.data.recommendedProviders)){if(p.recommendation.prevProviders=angular.copy(p.showHideSponserPackageList),_.isEmpty(p.allAhcPackageList)){var a=_.pluck(t.data.recommendedProviders,"providerId");p.showHideSponserPackageList=_.filter(p.showHideSponserPackageList,function(e){return _.contains(a,e.dcId)})}else _.each(p.allAhcPackageList,function(a,i){a.provider.packageId==e.packageId&&(p.recommendation.curIndex=i,a.sponserTempPackageDetails=_.map(t.data.recommendedProviders,function(e){return a.sponserPackageDetails.find(function(t){return e.providerId==t.dcId})}),a.sponserTempPackageDetails=_.filter(a.sponserTempPackageDetails,function(e){return!!e}),p.showHideSponserPackageList=a.sponserTempPackageDetails)});if(_.isEmpty(p.showHideSponserPackageList))return void(p.showHideSponserPackageList=p.recommendation.prevProviders);p.recommendation.packageName=e.packageName,p.recommendation.date=p.sponsored.prefDate.date.toDateString(),window._Site_Props.__setPackageDetails({packageName:e.packageName,providerName:e.dcName,providerLocation:e.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"AHC Show Recommendations",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{recommendedDate:s("date")(p.sponsored.prefDate.date,"yyyy-MM-dd"),companyName:p.user.corpDetails.employeeDetail.companyName}})}),p.isMobileView?d.open({animation:!0,template:'<div class="modal-body result sponsored"><h3 style="margin-top:0px">'+e.packageName+"</h3><b>"+p.recommendation.date+'</b><button class="btn btn-default btn-close pull-left" type="button" ng-click="ok(false)"><i class="mm mm-close"></i></button><ng-include src="\'providerTempalte.html\'"></ng-include></div>',scope:p,size:"full-height-mobile",controller:["$scope","$uibModalInstance",function(e,t){e.ok=function(){p.closeRecommendation(!0),t.dismiss("cancel")}}]}):h("highlight")}})};var v=_.debounce(function(){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"UCP Filter Provider",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{providerName:p.searchProvider.dcName,providerLocation:p.searchProvider.dcLocation,providerCount:p.showHideSponserPackageList.length,packageName:t.getFlatProperty(p,"selectedPackage.packageName"),showOnlyHomeSample:p.isRecommended}})})},1e3);p.isRecommended=!1,p.handleFilterChange=function(){if(p.showHideSponserPackageList=p.dcList,p.searchProvider.dcLocation){var e=p.searchProvider.dcLocation.toLowerCase();p.showHideSponserPackageList=_.filter(p.dcList,function(t){return t.dcLocation.toLowerCase().includes(e)})}if(p.searchProvider.dcName){var t=p.searchProvider.dcName.toLowerCase();p.showHideSponserPackageList=_.filter(p.showHideSponserPackageList,function(e){return e.dcName.toLowerCase().includes(t)})}p.isRecommended&&(p.showHideSponserPackageList=_.filter(p.showHideSponserPackageList,function(e){return e.isHomeSampleAvailable})),v()},p.toggleFilter=function(){p.isRecommended=!p.isRecommended,p.handleFilterChange()},p.nextDayFilter="",p.sponsored={prefDate:{date:null,position:0},isAutoSlotProviderAvailable:!_.isEmpty(p.providerSlots),fetchSlotInfo:function(e){p.autoBookSlots=[],p.$broadcast("closeSlot"),p.checkout&&!_.isEmpty(p.showHideSponserPackageList)&&_.each(p.showHideSponserPackageList,function(e){var t=p.selectedPackage.providerSlots.find(function(t){return t.providerId==parseInt(e.dcId)});if(t){var a=t.daySlots.find(function(e){return parseInt(e.date.replace("/Date(","").replace(")/",""))==p.sponsored.prefDate.date.getTime()});a&&a.workingDaySlots&&!_.isEmpty(a.workingDaySlots.slots)?(e.slotStartTime=i.getTimeFormate(_.first(a.workingDaySlots.slots).slotStartTime),e.slotEndTime=i.getTimeFormate(_.last(a.workingDaySlots.slots).slotEndTime)):(e.slotStartTime="",e.slotEndTime="")}}),p.driver&&p.driver.hasHighlightedElement()&&(p.driver.reset(),p.$broadcast("onEditSlot",p.sponsored.prefDate.date),p.bookSlotAfterValidation(p.pipeline.selectedProvider)),p.sponsored.prefDate.date.toDateString()==(new Date).addDays(1).toDateString()||6==p.sponsored.prefDate.date.getDay()||0==p.sponsored.prefDate.date.getDay()?p.nextDayFilter=function(e){return e&&e.isAutoSlotAvailable?e:null}:p.nextDayFilter="",_.each(p.dcList,function(e,t){p.checkout&&(e.availableSlots=p.selectedPackage.availableSlots,e.contractId=p.selectedPackage.contractId);var a=p.providerSlots.find(function(t){return t.providerId==parseInt(e.dcId)});if(a&&p.sponsored.prefDate){e.isHomeSampleAvailable=e.isHomeSampleAvailable&&_.has(a,"homeVisitAvailableSlots"),e.isHomeSampleAvailable&&(e.availableSlots=p.selectedPackage.availableSlots,e.homeVisitAvailableSlots=a.homeVisitAvailableSlots,e.radiologyAvailableSlots=a.radiologyAvailableSlots);var i=(a.daySlots||a.slots).find(function(e){return e.date.indexOf(Math.floor(p.sponsored.prefDate.date.setHours(0,0,0,0)))>-1});if(i){if(e.isAutoSlotAvailable=!0,!_.isEmpty(i.workingDaySlots)&&!_.isEmpty(e.availableSlots)){var o=e.availableSlots.findIndex(function(e){return e.day===i.workingDaySlots.day});o>-1&&!_.isEmpty(i.workingDaySlots.slots)&&(e.availableSlots[o]=i.workingDaySlots)}i.availableSlots<0&&(i.availableSlots=0),i.availableSlots<=i.totalSlots*(n.minSlotThreshold/100)?(e.slotStatus=!i.availableSlots&&i.totalSlots?"Not Available":"Filling Fast",e.slotStatusColor=!i.availableSlots&&i.totalSlots?"#f60":"#da7e19"):e.slotStatus=""}else e.isAutoSlotAvailable=!1;p.autoBookSlots.push(a)}}),p.isHomeSampleProviderAvailable=_.find(p.dcList,function(e){return e.isHomeSampleAvailable}),t.getFlatProperty(p,"sponsored.prefDate.date")&&window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"ucp",hj:!0,name:"AHC Appointment Date",googleSheet:n.ahcFilterName,payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{recommendedDate:s("date")(p.sponsored.prefDate.date,"yyyy-MM-dd"),companyName:p.user.corpDetails&&p.user.corpDetails.employeeDetail?p.user.corpDetails.employeeDetail.companyName||"":""}})}),e&&p.pipeline&&(p.pipeline.groupedSlots=_.groupBy(_.flatten(_.pluck(p.autoBookSlots,"daySlots")),function(e){return new Date(parseInt(e.date.replace("/Date(","").replace(")/",""))).setHours(0,0,0,0)}),p.pipeline.updateDateSlots()),p.inCardSlots={currentTimeStamp:Date.parse(p.sponsored.prefDate.date),providerGroupSlots:{}},_.forEach(p.pipeline.groupedSlots[p.inCardSlots.currentTimeStamp],function(e,t){p.inCardSlots.providerGroupSlots[e.providerId]=e.workingDaySlots.slots}),l(function(){1==p.showHideSponserPackageList.length&&"MediBuddyProvider"==p.showHideSponserPackageList[0].dcName&&p.bookSlotAfterValidation(p.showHideSponserPackageList[0])})}},p.valueChanged=function(e){p.homeSampleOption=parseInt(e),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"UCP Home Sample Toggle",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{"homeSample+centerVisit":1==p.homeSampleOption,onlyCenterVisit:2==p.homeSampleOption}})})};var k="";p.providerSelected=!1,p.selectProviderWithTimeSlot=function(e,a){var i,o;o=e.slotStartTime%60,p.selectedSlotStartTiming=e.slotStartTime,i=Math.floor(e.slotStartTime/60),p.prefDateTime=new Date(p.sponsored.prefDate.date.getFullYear(),p.sponsored.prefDate.date.getMonth(),p.sponsored.prefDate.date.getDate(),i,o,0,0),p.$emit("selectedSlot",{date:p.sponsored.prefDate.date,time:p.formatTime(e.slotStartTime),provider:a,prefDateTime:p.prefDateTime}),window._Site_Props.__setPackageDetails({packageName:a.packageName||t.getFlatProperty(p,"selectedPackage.packageName"),providerName:a.dcName,providerLocation:a.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,dbLog:"ucp",hj:!0,name:"Request Slot",googleSheet:n.ahcFilterName,payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{isRecommendation:!!p.recommendation.date,isHomeSampleAvailable:!!a.isHomeSampleAvailable,"homeSample+centerVisit":!!a.isHomeSampleAvailable&&1==p.homeSampleOption,onlyCenterVisit:!a.isHomeSampleAvailable||2==p.homeSampleOption},google:window._Site_Props.__googleTransform("AHC","RequestSlot",a.packageName+" by "+a.dcName)})})},p.pipeline.checkIfHomeSampleReq=function(e,a){p.pipeline.homeVisitDate="",p.providerSelected=!0,p.selectedDC=e,p.pipeline.homeSampleSelection=a||p.pipeline.homeSampleSelection,p.isMobileView?k=d.open({animation:!0,templateUrl:"home_sample_check.html",scope:p,size:"full-height-mobile",controller:["$scope","$uibModalInstance",function(e,t){e.close=function(){p.closehomeSampleOption(!0)}}]}):(c.scrollTo(0,100),l(function(){p.driver.highlight({element:"#homeSampleSlots"})},100)),window._Site_Props.__setPackageDetails({packageName:t.getFlatProperty(p,"selectedPackage.packageName"),providerName:e.dcName,providerLocation:e.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"UCP Home Sample Popup",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{"homeSample+centerVisit":1==p.homeSampleOption,onlyCenterVisit:2==p.homeSampleOption}})})},p.bookSlotAfterValidation=function(e,a){return p.emitHandler?void p.$emit(p.emitHandler,{packageDetailLocation:e,sponsored:p.sponsored}):void(!p.sponsored.prefDate.date||p.nextDay==p.sponsored.prefDate.date.toDateString()&&e.noAutoSlotAvailable||(e.packageId=e.packageId||p.selectedPackage.packageId,p.bookClicked=!0,p.clickDCId=e.dcId,p.clickPackageId=e.packageId,p.pipeline.blockProviderTimeSlots=[],i.makeAjaxCalls(r.apiUrl+"/ProviderTimeSlotForAHC",{providerid:p.clickDCId,BookingDate:p.sponsored.prefDate.date,PMEntityId:p.user.userDetails?p.user.userDetails.pmEntityID:""},"POST").then(function(e){e.data.isSuccess&&e.data.providerTimeSlots&&_.each(e.data.providerTimeSlots,function(e){e.isAvailable||p.pipeline.blockProviderTimeSlots.push(e.slotTime)})}),p.bookClicked?(window._Site_Props.__setPackageDetails({packageName:e.packageName||t.getFlatProperty(p,"selectedPackage.packageName"),providerName:e.dcName,providerLocation:e.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,dbLog:"ucp",hj:!0,name:"Request Slot",googleSheet:n.ahcFilterName,payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{isRecommendation:!!p.recommendation.date,isHomeSampleAvailable:!!e.isHomeSampleAvailable,"homeSample+centerVisit":!!e.isHomeSampleAvailable&&1==p.homeSampleOption,onlyCenterVisit:!e.isHomeSampleAvailable||2==p.homeSampleOption},google:window._Site_Props.__googleTransform("AHC","RequestSlot",e.packageName+" by "+e.dcName)})})):window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Slot Selection Cancelled",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:p.recommendation.date?{isRecommendation:!0}:null,google:window._Site_Props.__googleTransform("AHC","SlotSelectionCancelled",e.packageName+" by "+e.dcName)})}),f(a)))},p.getAmenities=function(){var e={ProviderIds:_.map(p.showHideSponserPackageList,function(e){return e.dcId})};"string"==typeof p.selectedPackage.packageId?e.mpPackageId=p.selectedPackage.packageId:e.PackageId=p.selectedPackage.packageId;var t=r.apiUrl+"GetHospitalAmeneties.json";i.makeAjaxCalls(t,e,"POST","","",!0).then(function(e){e.data.isSuccess&&(p.ameneties=e.data.ameneties)})},p.getAmenities(),p.closeDetails=function(e){p.clickPackageId="",e&&(p.pipeline.homeVisitDate="")},e.$on("mbProvider",function(){l(function(){1==p.showHideSponserPackageList.length&&"MediBuddyProvider"==p.showHideSponserPackageList[0].dcName&&p.bookSlotAfterValidation(p.showHideSponserPackageList[0])})}),p.$on("closeSlot",function(e,t){p.closeDetails()}),p.$on("clearAhcSearch",function(){p.searchProvider.dcName="",p.searchProvider.dcLocation="",p.handleFilterChange(),p.closeDetails()}),p.$on("selectedSlot",function(e,t){_.isEmpty(p.recommendation)||p.closeRecommendation(),p.homeVisitDate=p.pipeline.homeVisitDate}),p.$on("homeVisitDate",function(e,a){p.pipeline.homeVisitDate=a,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"UCP Home Sample Slot Selected",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{homeSampleDate:t.getFlatProperty(a,"prefDateTime")&&a.prefDateTime instanceof Date&&a.prefDateTime.toLocaleString()}})})}),p.closehomeSampleOption=function(e){e||p.selectedPackage.isHomeSampleOnlyPackage||(p.pipeline.homeSampleSelection=p.homeSampleOption),p.providerSelected=!1,p.isMobileView?k.close():(p.driver.reset(),l.cancel(y))},p.$on("bookSlotForProvider",function(e,t){p.$broadcast("onEditSlot",p.pipeline.homeVisitDate?p.pipeline.homeVisitDate.date:p.pipeline.selectedSlot.date),p.bookSlotAfterValidation(t)})}}}]),e.register.directive("rcSubmit",["$parse",function(e){return{restrict:"A",require:["rcSubmit","?form"],controller:["$scope",function(e){this.attempted=!1;var t=null;this.setAttempted=function(){this.attempted=!0},this.setFormController=function(e){t=e},this.needsAttention=function(e){return!!t&&(e?e.$invalid&&(e.$dirty||this.attempted):t&&t.$invalid&&(t.$dirty||this.attempted))}}],compile:function(t,a,i){return{pre:function(e,t,a,i){var o=i[0],n=i.length>1?i[1]:null;o.setFormController(n),e.rc=e.rc||{},e.rc[a.name]=o},post:function(t,a,i,o){var n=o[0],s=o.length>1?o[1]:null,r=e(i.rcSubmit);a.bind("submit",function(e){return n.setAttempted(),t.$$phase||t.$apply(),!!s.$valid&&(t.$apply(function(){r(t,{$event:e})}),void e.preventDefault())})}}}}}]),e.register.directive("statusTimeline",["$timeout",function(e){return{restrict:"EA",scope:{orderStatus:"=timelineStatus",status:"=status"},templateUrl:"templates/status-timeline.html?"+timeStamp,link:function(t){e(function(){t.active=!0},1),t.getWidth=function(){return t.active&&t.orderStatus&&t.orderStatus.length>0&&t.status.state>=0?t.status.state>=t.orderStatus.length-1?"100%":100*t.status.state/(t.orderStatus.length-1)+"%":"0%"}}}}]),e.register.directive("userAddress",["$uibModal","authService","navConstantsSvc",function(e,a,i){return{restrict:"E",scope:{medicine:"=?",homeVisit:"=?",form:"=?",appointmentData:"=orderInfo",userAddresses:"=addressList",appointmentPackageData:"=packageData"},templateUrl:"/templates/user-address.html?"+timeStamp,link:function(o,n,s){var r=i.cityTags;if(o.setAddress=function(e){e&&(o.appointmentData.patientHouseNo=e.addressLine1,o.appointmentData.patientLocation=e.addressLine2,o.appointmentData.addressType=e.addressType,o.appointmentPackageData.dcCity=e.city,o.medicine||(o.appointmentData.patientPincode=e.pincode),o.selectedAddressTag=e.addressTag,o.orderInfo=o.appointmentData,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:o.medicine?"MedsAddressSelect":"SelectAddress",dbLog:!o.medicine||"meds",hj:!0,payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{address:e.addressLine1+", "+e.addressLine2,city:e.city,pincode:e.pincode,itemSource:o.appointmentData?"EnterPatientsInfoPage":"BookingPage",visitType:"HomeVisit"}})}))},o.isAddressSelected=function(e){return o.selectedAddressTag===e.addressTag},o.manageAddressClose=function(e){if((o.medicine||o.homeVisit)&&t.validatePIN(o.appointmentData.patientPincode)?o.userAddresses=_.filter(a.profileInfo.userAddresses,function(e){return e.pincode==o.appointmentData.patientPincode&&e.isActive}):o.homeVisit&&o.appointmentPackageData.dcCity?o.userAddresses=_.filter(a.profileInfo.userAddresses,function(e){var t=e.city?r[e.city.toLowerCase()]||e.city.toLowerCase():"";return t==a.getCity().toLowerCase()}):o.userAddresses=_.filter(a.profileInfo.userAddresses,function(e){return e.isActive}),e){var i=o.userAddresses.find(function(t){return t.addressTag===e.addressTag});i&&o.setAddress(i)}else if(o.selectedAddressTag){var i=o.userAddresses.find(function(e){return e.addressTag===o.selectedAddressTag});i&&o.setAddress(i)}else o.selectedAddressTag=null;o.addressList=o.userAddresses,o.manageAddressPopup=null},o.manageAddressOpen=function(a){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsManageAddr"}),o.manageAddressPopup=e.open({templateUrl:"templates/manageAddressPopup.html?"+timeStamp,size:"full-height-mobile",controller:["$scope","$http","notify","$uibModalInstance","authService",function(e,i,n,s,r){e.subject="User idle in payment page_"+o.eventCategory,e.userData={userProfile:r.profileInfo},e.openAddAddress=a,e.closeModal=function(){s.dismiss("cancel"),o.manageAddressClose()},e.$on("selectAddress",function(e,t){s.dismiss("cancel"),o.manageAddressClose(t)}),(o.medicine||o.homeVisit)&&t.validatePIN(o.appointmentData.patientPincode)&&(e.filterAddress={pincode:o.appointmentData.patientPincode})}]})},!_.isEmpty(o.userAddresses))for(var l=0;l<o.userAddresses.length;l++)if(o.userAddresses[l]&&o.userAddresses[l].isPrimary){o.setAddress(o.userAddresses[l]);break}}}}]),e.register.directive("userFeedback",["$window","authService","apiProvider","$http","$rootScope","navConstantsSvc",function(e,t,a,i,o,n){return{restrict:"E",scope:{isPopup:"=?",orderId:"=?",requestData:"=?",feedbackRating:"=?"},templateUrl:"/templates/user-feedback.html?"+timeStamp,link:function(s,r,l){function c(e){switch(e){case n.medsContract:return s.iconLink="/assets/services/medicine.svg",s.serviceType=n.medicineFilterName,n.medicineFilterName;case n.ahcContract:return s.iconLink="/assets/services/health-check.svg",s.serviceType=n.ahcFilterName,n.ahcFilterName;case n.healthCheckContract:return s.iconLink="/assets/services/health-check.svg",s.serviceType=n.healthCheckFilterName,n.healthCheckFilterName;case n.labtestContract:return s.iconLink="/assets/services/labtest.svg",s.serviceType=n.investigationFilterName,n.investigationFilterName;default:return s.iconLink="",s.serviceType="",""}}function d(e){if(s.requestData&&!s.requestData.userFeedbackReceived){if(s.feedbackRating=e,s.isMedicine=n.medsContract==s.requestData.contractType,s.requestData.orderStatusDate=new Date(s.requestData.orderStatusDate),s.requestData.orderFulFillmentDate=new Date(s.requestData.orderFulFillmentDate),window._Site_Props.__setServiceDetails({serviceType:c(s.requestData.contractType)}),!_.isEmpty(s.feedbackRating.questions)){var t=_.filter(s.feedbackRating.questions,function(e){return e.categoryType==s.requestData.fulFillmentType});_.isEmpty(t)||(s.feedbackRating.questions=t),_.each(s.feedbackRating.questions,function(e){s.feedback.answers[e.questionId]={}})}s.showLoader=!1,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsFeedbackCard",payload:window._Site_Props.__getEventParameters({service:!0,custom:p})})}else s.feedback.isfeedbackGiven=!0,s.feedbackSubmitted=!0}var p={};s.isMobileView=o.isMobileView,s.user=t.isUserSignedin()||{},s.feedbackRating=s.feedbackRating||{},s.user.userType=s.user.corpDetails?"Corporate":"Retail",p.userType=s.user.userType||"",s.feedback={},s.feedback.answers={},s.captureResponse=!1,s.showLoader=!0,s.feedbackResponse={},s.onSelect=function(e,t){s.feedback.answers[e][t]||delete s.feedback.answers[e][t],s.feedbackResponse.enableSubmit=!_.isEmpty(s.feedback.answers[e])},s.orderId&&!s.requestData?(p.orderid=s.orderId,i.get(a.medsService+"medibuddy/getFeedback?orderId="+s.orderId).then(function(e){e.data.success?(s.requestData=e.data.requestData,d(e.data.feedbackRating)):s.showError=!0},function(e){s.showError=!0})):s.requestData&&d(s.feedbackRating),s.onSubmit=function(){s.feedback.isPositive=s.feedback.stars>3,s.captureResponse=!0,s.feedback.isReasonRequired=!s.feedback.isPositive&&!_.isEmpty(s.feedbackRating.questions)},s.submitFeedback=function(t){s.isPopup||e.scrollTo(0,0);var n={source:o.isWebView?e.navigator.userAgent.indexOf("iPhone")>-1?"IOS":"Android":"MediBuddy_Web",overallRating:s.feedback.stars,remarks:s.feedback.remarks||"",requestId:s.requestData.requestId,orderId:parseInt(s.requestData.orderId),categoryId:s.requestData.contractType,isfeedbackGiven:!!t,fulFillmentType:s.requestData.fulFillmentType,feedbackResponse:{}};!_.isEmpty(s.feedback.answers)&&t&&_.each(s.feedback.answers,function(e,t){var a=Object.keys(e).map(function(e){return parseInt(e)});a&&a.length&&(n.feedbackResponse.questionId=parseInt(t),n.feedbackResponse.answerId=a)}),i.post(a.medsService+"medibuddy/saveFeedback",n).then(function(e){s.feedbackSubmitted=!0,e.data.success&&(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsFeedbackSubmit",payload:window._Site_Props.__getEventParameters({service:!0,custom:_.extend({},p,{"email Id":s.user.userDetails?s.user.userDetails.email:"","rating value":s.feedback.stars,"rating text":s.feedback.remarks||""})})}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsFeedbackStatus",payload:window._Site_Props.__getEventParameters({service:!0,custom:_.extend({},p,{response:!!t})})})),s.isPopup&&s.$emit("onFeedbackSubmit")},function(e){s.feedbackSubmitted=!0})};var m=s.$on("starsSelected",function(e,t){s.feedback.stars=t});s.$on("$destroy",function(e){s.feedback.stars&&s.captureResponse&&!s.feedbackSubmitted&&s.submitFeedback(),m()})}}}]),e.register.directive("videoPopUp",["$rootScope",function(e){return{restrict:"EA",scope:{showVideo:"=?"},templateUrl:"templates/videoPopUp.html?"+timeStamp,link:function(e){e.showVideo=!1;var t=document.getElementById("player");e.isIOS=/iphone|ipod|ipad/.test(window.navigator.userAgent.toLowerCase()),e.isIOS&&(e.showVideo=!0),t&&(t.addEventListener("play",function(){t.style.removeProperty("object-fit"),t.currentTime<.1&&window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"labs",name:"Video Started",payload:window._Site_Props.__getEventParameters({service:!0,custom:{srcPage:"Labs Landing Page",videoURLId:"gV02QFqLH0E",videoTimeInSecs:0}})})}),t.addEventListener("canplaythrough",function(){e.showVideo=!0}),t.addEventListener("ended",function(){window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"labs",name:"Video Ended",payload:window._Site_Props.__getEventParameters({service:!0,custom:{srcPage:"Labs Landing Page",videoURLId:"gV02QFqLH0E",videoTimeInSecs:t?t.currentTime:0}})})}),t.addEventListener("webkitfullscreenchange",function(){document.fullscreenElement&&window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"labs",name:"Video Full Screen",payload:window._Site_Props.__getEventParameters({service:!0,custom:{srcPage:"Labs Landing Page",videoURLId:"gV02QFqLH0E",videoTimeInSecs:t?t.currentTime:0,videoUrl:"https://www.youtube.com/watch?v=gV02QFqLH0E"}})})})),e.closeVideo=function(){e.showVideo=!1,t&&t.pause(),window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"labs",name:"Video Force Closed",payload:window._Site_Props.__getEventParameters({service:!0,custom:{srcPage:"Labs Landing Page",videoURLId:"gV02QFqLH0E",videoTimeInSecs:t?t.currentTime:0}})})}}}}]),e.register.directive("visionCareGuidelines",["$rootScope","notify",function(e,t){return{restrict:"EA",scope:{requestDetails:"=?"},templateUrl:"templates/visionCareGuidelines.html?"+timeStamp,link:function(e){e.isIOS=/iphone|ipod|ipad/.test(window.navigator.userAgent.toLowerCase()),e.androidWebView=/wv/.test(window.navigator.userAgent.toLowerCase()),e.homeVisit=!(!e.requestDetails||"Home_Visit"!=e.requestDetails.visitType),e.providerId=e.requestDetails&&e.requestDetails.servingProviderId?e.requestDetails.servingProviderId:0;var a;e.isIOS?420580==e.providerId?a=e.homeVisit?"https://www.lenskart.com/?webOnly=true":"https://www.lenskart.com/stores?webOnly=true":419451==e.providerId&&(a=e.homeVisit?"https://www.specsmakers.in/?webOnly=true":"https://www.specsmakers.in/a/storelocator?webOnly=true"):420580==e.providerId?a=e.homeVisit?"https://link.medibuddy.app/JEgMX2vfmLb":"https://link.medibuddy.app/IGT7kORfmLb":419451==e.providerId&&(a=e.homeVisit?"https://link.medibuddy.app/h4p7N03fmLb":"https://link.medibuddy.app/uJWChefgmLb"),e.copyCouponCode=function(e){window.navigator.clipboard.writeText(e),t({message:"Coupon Code Copied",position:"center",duration:5e3})},e.redirectUrl=function(){if(e.isIOS)try{window.webkit.messageHandlers.deepLinkUrl.postMessage(a)}catch(t){window.WebToNativeCommunicationInterface.openDeeplink(a)}else if(e.androidWebView)try{window.WebToNativeCommunicationInterface.openDeeplink(a)}catch(t){window.webkit.messageHandlers.deepLinkUrl.postMessage(a)}else window.open(a,"_blank")}}}}])})}();