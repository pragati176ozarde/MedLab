!function(){"use strict";define(["angular","moment","utility"],function(e,t,o){var a=e.module("marketplace.AuthService",[]);a.factory("authService",["$http","$sce","$rootScope","$location","$window","$uibModal","$state","navConstantsSvc","cityList","apiProvider","$cookies","localStorageService","$anchorScroll","standardEventsSvc",function(a,i,n,r,s,l,u,d,c,p,m,g,h,f){var v,y="",E=[],b=[],S=[],P=!1,I={},T=["gmail.com","yahoo.com","yahoo.co.in","rediffmail.com"],C={},A=!1,L={};return window.templates&&(I=e.copy(window.templates),delete window.templates),{linkInsurerSection:{},corporatePackages:{},mediCart:{},mergeCart:{},benef:[],ahcCart:{},filterObj:{},activeService:null,userAddresses:[],openRxPopUp:function(){return A},timeline:{details:null,selected:""},scrollToSection:function(e,t){e&&setTimeout(function(){h.yOffset=t?t:n.isMobileView?100:50,h(e)})},medsCartInfo:{quantity:0},returnApiUrl:function(){return p.apiUrl},returnContents:function(e){return I[e]},getTimeFormate:function(e){var t=function(e,o){var a=e.toString();return a.length<o?t("0"+a,o):a},o="";if(e){var a=e%60,i="",n=Math.floor(e/60);n>=12?(i="PM",12===n?n=n:n-=12):i="AM";var r=t(n,"2")+":"+t(a,"2");o=r+" "+i}return o},getUniqCollection:function(e){var t=_.uniq(e,function(e){return e.dcId});return t},getUniqPackageIdCollection:function(e){var t=_.uniq(e,function(e){return e.packageId});return t},getUniqDoctorCollection:function(e){var t=_.uniq(e,function(e){return e.doctorUniqueId});return t},getUniqCollectionName:function(e){var t=_.uniq(e,function(e){return e.name});return t},getUniqCollectionProvider:function(e){var t=_.first(e),o=[];return t&&!_.isEmpty(t.dcName)?o=_.uniq(e,function(e){return e.dcName}):t&&!_.isEmpty(t.hospName)?o=_.uniq(e,function(e){return e.hospName}):o},getUniqId:function(e){var t=_.uniq(e,function(e){return e.id});return t},getUniqCollectionAmenities:function(e){var t=_.uniq(e,function(e){return e.name});return t},getUniqCollectionLocation:function(e){var t=[];return t=_.uniq(e,function(e){return e.hospBranch?e.hospBranch:e.dcLocation?e.dcLocation:void 0})},fileDownloadV1:function(e,t,o){var a=new Promise(function(a,i){var n=this.getUserObj(),r=p.apiUrl+"DownloadFile/"+e+"/"+t+"/"+o;this.makeAjaxCalls(r,{},"GET",n.token,"",!0).then(function(t){if(t.data&&"OK"==t.data.httpStatusCode){var o=document.createElement("a");o.setAttribute("id",e),o.setAttribute("href",t.data.signedURL),document.body.appendChild(o),o.click(),document.body.removeChild(o),a({signedURL:t.data.signedURL,isSuccess:t.data.httpStatusCode})}else notify({message:"Cannot download the report at the moment",position:"center",duration:5e3}),i(t)})}.bind(this));return a},fileDownload:function(e){var t=new Promise(function(t,o){var a=this.getUserObj(),i=p.apiUrl+"/GetFileSignedURLDownload/"+e;this.makeAjaxCalls(i,{},"GET",a.token,"",!0).then(function(a){if(a.data&&"OK"==a.data.httpStatusCode){var i=document.createElement("a");i.setAttribute("id",e),i.setAttribute("href",a.data.signedURL),document.body.appendChild(i),i.click(),document.body.removeChild(i),t({signedURL:a.data.signedURL,isSuccess:a.data.httpStatusCode})}else notify({message:"Cannot download the report at the moment",position:"center",duration:5e3}),o(a)})}.bind(this));return t},fileDownloadiOS:function(e,t){if(t){var o=new Promise(function(t,o){var i=this.getUserObj(),n=p.apiUrl+"/GetFileSignedURLDownload/"+e;this.makeAjaxCalls(n,{},"GET",i.token,"",!0).then(function(e){e.data&&"OK"==e.data.httpStatusCode?a.get(e.data.signedURL,{responseType:"arraybuffer"}).success(function(e){var t=new Blob([e],{type:"application/pdf"}),o=URL.createObjectURL(t);window.open(o)}):(notify({message:"Cannot download the report at the moment",position:"center",duration:5e3}),o(e))})}.bind(this));return o}},multipleFilesDownload:function(e,t,o){var a=setInterval(function(){t&&o?this.fileDownloadV1(e.pop(),t,o):this.fileDownload(e.pop()),e.length||clearInterval(a)}.bind(this),500)},get:function(e,t,o){return e.slice(t,t+o)},getNewFieldForDcServices:function(e,t){return _.forEach(e,function(e,o){_.forEach(t,function(t,o){t.dcServices&&t.dcServices.length>0&&_.forEach(t.dcServices,function(a,i){a===e.name&&t.dummyDcServices.push({id:o+1,name:e.name,selected:!1})})})}),t},getTimeWithAMPM:function(e){var t="",o=function(e,t){return e=e.toString(),e.length<t?o("0"+e,t):e};if(e){var a=e%60,i="",n=Math.floor(e/60);n>=12?(i="PM",12===n?n=n:n-=12):i="AM";var r=o(n,"2")+":"+o(a,"2");t=r+" "+i}return t},finder:function(e,t,o){for(var a=t[0][o],i=1;i<t.length;i++)a=e(a,t[i][o]);return a},createDateTime:function(e,t){var o=new Date(e).getDate(),a=new Date(e).getMonth()+1,i=new Date(e).getFullYear(),n=new Date(t).getHours(),r=new Date(t).getMinutes(),s=i+","+a+","+o+" "+n+":"+r,l=new Date(s);return l},createAppointmentObject:function(e,t){var o={patientName:e.patientName,email:e.email,phone:e.phone,userConsent:e.userConsent,emergencyPhone:"",dateOfBirth:e.dateOfBirth,gender:e.gender,packageId:t.packageId,packageName:t.packageName,dcId:t.dcId,dcName:t.dcName,dcLocation:t.dcLocation,prefDateTime:e.prefDateTime.toJSON(),isSponsored:!1,doctorId:t.doctorUniqueId,visitType:e.visitType?e.visitType:"",addressLine1:e.addressLine1?e.addressLine1:"",addressLine2:e.addressLine2?e.addressLine2:"",couponCode:e.couponCode?e.couponCode:"",citySelected:t.dcCity,totalPrice:t.price,discount:e.discount,finalPrice:e.finalPrice?e.finalPrice:t.price,relation:e.relation,pincode:e.pincode?e.pincode:"",hospitalRegistrationNo:e.hospitalRegistrationNo?e.hospitalRegistrationNo:""};return E=o,o},toggeFilter:function(e){var t={isMedicine:!1,isPharmacy:!1,isHealthcheckup:!1,isConsultation:!1,isInvestigation:!1,isMoreCity:!1,isOlService:!1,isHomeHealthCare:!1,isGso:!1,isGnome:!1,isDental:!1,isCovid:!1,categoryItemTypeId:"",cities:[]};return e===d.healthCheckFilterName?(t.isHealthcheckup=!0,t.isMoreCity=!1,t.categoryItemTypeId=d.healthCheckId,t.cities=c[d.healthCheckId]):e===d.medicineFilterName||e===d.pharmacyFilterName?(t.isMedicine=e===d.medicineFilterName,t.isPharmacy=e===d.pharmacyFilterName,t.categoryItemTypeId=d.medicineId,t.cities=c[d.medicineId]):e===d.consultationFilterName?(t.isConsultation=!0,t.categoryItemTypeId=d.consultationId,t.cities=c[d.consultationId]):e===d.investigationFilterName?(t.isInvestigation=!0,t.categoryItemTypeId=d.investigationId,t.cities=c[d.investigationId]):"covid"===e?(t.isCovid=!0,t.categoryItemTypeId=d.investigationId,t.cities=c[d.investigationId]):"morecity"===e?(t.isMoreCity=!0,t.isHealthcheckup=!0,t.cities=c[d.healthCheckId]):e===d.olServiceFilterName?(t.isMoreCity=!1,t.isOlService=!0,t.categoryItemTypeId=d.olServiceId,t.cities=c[d.olServiceId]):e===d.gsoFilterName?(t.isMoreCity=!1,t.isGso=!0,t.categoryItemTypeId=d.gsoId,t.cities=c[d.gsoId]):e===d.genomFilterName?(t.isMoreCity=!1,t.isGenome=!0,t.categoryItemTypeId=d.genomeId,t.cities=c[d.genomeId]):e===d.homeHealthCareFilterName?(t.isMoreCity=!1,t.isHomeHealthCare=!0,t.categoryItemTypeId=d.homehealthcareId,t.cities=c[d.homehealthcareId]):e===d.dentalFilterName&&(t.isDental=!0,t.isMoreCity=!1,t.categoryItemTypeId=d.dentalId,t.cities=c[d.dentalId]),t},checkSeriveType:{c920aa2144b9e51184af002219349965:"c920aa2144b9e51184af002219349965","Health checks":"c920aa2144b9e51184af002219349965","467117a029f0e511aa80002219349965":"467117a029f0e511aa80002219349965",Medicine:"467117a029f0e511aa80002219349965",ad131e35ffb9e51184af002219349965:"ad131e35ffb9e51184af002219349965",Consultation:"ad131e35ffb9e51184af002219349965","4f81d4702c8242009081cfde6301dd38":"4f81d4702c8242009081cfde6301dd38",olService:"4f81d4702c8242009081cfde6301dd38","259fb4d2abcb480fb4e8778a33b9c9d2":"259fb4d2abcb480fb4e8778a33b9c9d2",gso:"259fb4d2abcb480fb4e8778a33b9c9d2",ba678c34a85141299c0b43ac3b1ee8ca:"ba678c34a85141299c0b43ac3b1ee8ca","Home Health Care":"ba678c34a85141299c0b43ac3b1ee8ca","1b1fbfb833ea4e8d96c0a0325da21d69":"1b1fbfb833ea4e8d96c0a0325da21d69",Genome:"1b1fbfb833ea4e8d96c0a0325da21d69","66d51e1e3d674dddbae81df593392f12":"66d51e1e3d674dddbae81df593392f12",Dental:"66d51e1e3d674dddbae81df593392f12"},setPincode:function(e){g.set("pincode",e)},setAddress:function(e){g.set("address",e)},getAddress:function(){return g.get("address")},getPincode:function(){return g.get("pincode")},setUserLocation:function(e){g.set("userLocation",e)},getUserLocation:function(){return g.get("userLocation")},setRecentSearches:function(e){g.set("recentSearches",e)},getRecentSearches:function(){const e=g.get("recentSearches");return _.isArray(e)?e:null},getUserRoles:function(){return g.get("_mp_user").rolesFeatures.roles},getUserFeatures:function(){return g.get("_mp_user").rolesFeatures.features},getAccessToken:function(){return g.get("_mp_user").accessTokenObj.access_token},getCorpToken:function(){return g.get("corpToken")},getUserId:function(){return g.get("_mp_user").userDetails.userId},setUserObj:function(e){var t=-621355968e5,o=new Date(parseInt(e.userDetails.dateOfBirth.replace("/Date(","").replace(")/","")));g.get(e.userDetails.userId)&&t===o.getTime()&&(e.userDetails.dateOfBirth=e.userDetails.dateOfBirth.replace(o.getTime(),g.get(e.userDetails.userId))),g.set("_mp_user",e)},getUserObj:function(){return g.get("_mp_user")?g.get("_mp_user"):null},destroyUserObj:function(){this.refreshOrders=!0,this.orderHistory=[];var e=["app.navya","app.walletInfo","app.appointmentDetails","app.insurancePage","app.payment","app.medicine","app.orders","app.orderDetails","app.hospitalizationDetail","app.hospitalizationBooking","app.orderData","app.claims","app.storeSelection","app.getsecondopinion"];g.remove("_mp_user"),g.remove("auth_uuid"),g.remove("UniqSessionId"),g.remove("patientId"),g.remove("corpMbId"),g.remove("corpToken");var t=document.cookie.split(";");t.forEach(function(e){var t=e.split("=");if(t.length){var a=t[0].trim();document.cookie=a+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; domain="+o.getCookieDomain()+"; path=/;"}}),_.contains(e,u.current.name)&&u.go("app.home",{},{reload:"app.home"}),window._MB_Analytics.__resetOnLogout(),n.$emit("userLogout",""),this.setDefaultLocation()},isActive:function(){var e=this.getUserObj();return!!e},setCity:function(e){e&&(e=e.charAt(0).toUpperCase()+e.slice(1)),window._Site_Props.__setLocation(e),g.set("city",e)},getCity:function(){return g.get("city")?g.get("city"):window.location.href.indexOf("/corporate")===-1||window.location.href.indexOf("/vaccination")===-1?"Bengaluru":null},getBanner:function(e){for(var t={"x-mb-source":"infiniti-web"},o=[],a=0;a<e.length;a++)o.push(this.makeAjaxCalls(p.dynoBannerUrl+e[a],"","GET","","",!1,t).then(function(e){if(e.data.isSuccess)return e.data.data})["catch"](function(e){console.log(e)}));return o},getBannerPlatformPath:function(e,t,o){var a={"x-mb-source":"infiniti-web"};return o?this.makeAjaxCalls(p.dynoBannerUrl+"getbannerlist",{bannerplatform:e,bannerpath:t,pmentityid:o},"POST","","",!1,a).then(function(e){if(e.data.isSuccess)return e.data.data})["catch"](function(e){console.log(e)}):this.makeAjaxCalls(p.dynoBannerUrl+"getbannerlist",{bannerplatform:e,bannerpath:t},"POST","","",!1,a).then(function(e){if(e.data.isSuccess)return e.data.data})["catch"](function(e){console.log(e)})},setOrderDetails:function(e){v=e},getOrderDetails:function(){return v},setDefaultLocation:function(){window.sessionStorage.removeItem("corp_redirection_cta"),window.sessionStorage.removeItem("opened_wallet_coverage_popup");var e=this.getUserLocation();e&&"SAVED_ADDRESS"==e.type&&(this.setUserLocation(d.defaultLabsLocation),this.setPincode("560029"),this.setCity("Bengaluru"),this.userAddresses=[],n.$emit("DefaultLocationSet"))},L2Csetuserdetails:function(e){C.IsGoldUser=e.isGold||!1,C.L2CCheckbox=e.isRetailUser||!1,C.L2CPrice=e.price||0,C.L2CText=e.text||null,C.isL2Cchecked=e.isRetailUser&&e.checkboxFlag},L2Cgetuserdetails:function(){return C},L2Cchangecheckbox:function(e){C.isL2Cchecked=e},uploadFile:function(e,t,o,i,n){var r=this.isUserSignedin();if(o&&t){var s=new Promise(function(s,l){this.makeAjaxCalls(p.apiUrl+"GetFileSignedURLUpload",{fileName:e.name,fileType:o,appId:9203,contractType:t,s3AccountType:"MB"},"POST",r?r.token:"abc",null,i,n).then(function(i){i.data&&i.data.success&&i.data.signedURL?a.put(i.data.signedURL,e,{headers:{"Content-Type":e.type}}).then(function(n){if(200==i.status){var u={fileName:e.name,fileType:o,appId:9203,fileIdentifier:i.data.fileIdentifier,signedURL:i.data.signedURL,contractType:t},d={AccessToken:r?r.token:"abc"};a.put(p.apiUrl+"SaveFileDetails",u,{headers:d}).then(function(e){e.data&&e.data.success?(e.data={isSuccess:e.data.success,fileUploadedList:[e.data.fileIdentifier.replaceAll("-","")],fileDetails:[{fileName:e.data.fileName,filePublicUrl:e.data.fileIdentifier}]},s(e)):l({isSuccess:!1,errorMessage:"Failed to upload to s3"})})["catch"](function(e){l({isSuccess:!1,errorMessage:"Failed to upload to s3"})})}else l({isSuccess:!1,errorMessage:"Failed to upload to s3"})})["catch"](function(e){l({isSuccess:!1,errorMessage:"Failed to upload to s3"})}):l({isSuccess:!1,errorMessage:"Failed to get signed url"})})["catch"](function(e){l({isSuccess:!1,errorMessage:"Failed to get signed url"})})}.bind(this));return s}},makeAjaxCalls:function(e,t,o,i,n,r,s){var l="DESKTOP_WEB";if(window.innerWidth<480){var u=window.navigator.userAgent.toLowerCase();l=u.indexOf("android")==-1?"IOS_WEB":"ANDROID_WEB"}t&&"GENOME"===t.keyword&&(n=" ");var d=a({method:o,url:e,data:t,headers:_.extend({mbservertoken:e==p.infinitiNode+"CorporateData/UserCreation"?i:void 0,AccessToken:i,City:n?n.trim():this.getCity(),Pincode:this.getPincode()>0?this.getPincode():0,mbaccesstoken:i,Platform:window.getSrcType(),Booking_Platform:l,browser_fingerprint_id:window.sessionStorage.getItem("branch_fingerprint")||""},s),ignoreLoadingBar:r});return d},getWalletBalance:function(){var e=p.apiUrl+"/CheckWalletBalanceWithBenef\t",t=this.getUserObj();return t&&t.token&&u&&u.current&&u.current.name&&"app.walletInfo"===u.current.name?this.makeAjaxCalls(e,{},"GET",t.token,"",!1):t&&t.token?this.makeAjaxCalls(e,{},"GET",t.token,"",!0):void 0},getSubsEligibility:function(){var e=p.infinitiNodeStg+"wallet/preWalletConfiguration",t=this.getUserObj();if(t&&t.token)return this.makeAjaxCalls(e,{userId:t.userDetails.userId,entityId:t.userDetails.pmEntityID},"POST",t.token)},isUserSignedin:function(){return this.user=this.getUserObj(),!!(this.user&&this.user.token&&this.user.userDetails&&this.user.userDetails.firstName)&&this.user},cityPopup:function(e){if(_.isArray(this.allCities)){var t=l.open({templateUrl:"templates/allCities.html?"+timeStamp,controller:["$scope","$rootScope","authService","$sce",function(e,o,a,i){e.modelOptions={debounce:{"default":200,blur:250},getterSetter:!0},e.allCities=a.allCities,e.topCities=a.topCities,e.allCities=_.difference(a.allCities,a.topCities),e.selectedCity=a.getCity();var n=c[d.medicineId]||[],r=_.union(a.allCities,a.topCities);e.selectedCity&&_.indexOf(e.topCities,e.selectedCity)<0&&_.some(e.allCities,function(t,o){if(t===e.selectedCity)return e.allCities.splice(o,1),e.allCities.unshift(t),!0}),e.cityError=i.trustAsHtml(a.cityError),e.ok=function(){t.close()},e.close=function(){t.close(),a.getCity()||state.go("app.home",{},{reload:"app.home"})},e.setUserCity=function(t){t&&(e.selectedCity=t,o.$broadcast("allCities",t),e.ok())},e.onCitySearch=function(){e.city&&e.city.length>1?(e.noMatch=!r.filter(function(t){return t.toLowerCase().indexOf(e.city.toLowerCase())>-1}).length,e.noService=n.filter(function(t){return t.toLowerCase()===e.city.toLowerCase()}).length&&e.noMatch):(e.noService=!1,e.noMatch=!1),e.noService&&window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"City Not Serviceable",payload:window._Site_Props.__getEventParameters({service:!0,custom:{city:e.city}})})}}],size:e});this.modalInstance=t}},updateMedsLocalCart:function(){var e=g.get("medsCart"),t=this.isUserSignedin();return!t.isRetailUser&&e&&(e=e.cart.cartItems.filter(function(e){return!e.fromOtcStore})),g.set("medsCart",e),e},removeMedsLocalCart:function(){return g.set("medsCart",[]),[]},openPopup:function(e,t){l.open({animation:!0,templateUrl:t,controller:["$scope","$uibModalInstance","$rootScope","$timeout","$state","authService",function(e,t,o,i,n,r){e.logInUser={userName:"",password:""};var s=6e3;e.isReLogin=!0,e.validatepassword=function(t){e.isReLogin=!t.password},e.isPasswordWrong=!1,e.isHomePage=n.includes("app.home"),e.usersigninedinFailed=function(){e.isPasswordWrong=!0,i(function(){e.isPasswordWrong=!1},s)},e.ok=function(){t.dismiss("cancel")},e.getUserObj=function(){return g.get("_mp_user")?g.get("_mp_user"):null};var l=g.get("city");e.signinIn=function(t){e.user=e.getUserObj();var o={username:e.user.userDetails.email,password:t.password,isSSOLogin:!1,authServerAccessToken:"",isSocialLogin:!1,appName:"",appUniqueIdentifier:"",appAccessToken:"",email:e.user.userDetails.email,firstName:"",lastName:"",checkUser:!1},i=p.apiUrl+"MarketPlaceLogon";a.post(i,o,{headers:{"Content-Type":"application/json",City:l,Platform:"web"}}).then(function(t){console.log("response",t),t.data.isSuccess?(r.setUserObj(_.extend(t.data.user,{isRetailLabsFlowEnabled:t.data.isRetailLabsFlowEnabled})),e.ok(),n.reload()):(e.loginErrorMsg=t.data.errorMessage,e.usersigninedinFailed())})}}],size:e})},logoutUser:function(){this.destroyUserObj()},openRegistrationPopup:function(e,o,a){if(o="templates/openRegistrationPopup.html?"+timeStamp,a||(a={}),!P){P=!0;l.open({animation:!0,templateUrl:o,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","$sce",function(e,o,i,n,r,s,l,u,c,m,h,f){o.regFormCheck=!0,o.regScreen=!1,o.counter=30,o.showResendLink=!1;var v="";o.otpEnterScreen=!0,o.userInfo={email:a.email,phone:a.phone||"",entityId:a.entityId,name:"",grade:"",dob:"",empCode:"",gender:"",grade:"",leader:""},o.dateConstrains={maxDate:new Date(t().format("YYYY-MM-DD"))},o.phoneNumberVerified=!!o.userInfo.phone;var y={defaultFields:{email:!0,empCode:!0,mobile:!0,gender:!0,dob:!0,name:!0,grade:!1,leader:!1},entityId:{11186623:["mobile","gender","dob","name","grade"],11184763:["email","empCode","mobile","gender","dob","name","leader"],11184764:["email","empCode","mobile","gender","dob","name","leader"],11184765:["email","empCode","mobile","gender","dob","name","leader"]}},E={},b=[],S=y.entityId;if(o.userInfo.entityId&&(b=S&&S[o.userInfo.entityId]?S[o.userInfo.entityId]:[]),0==b.length)E=y.defaultFields;else for(var I=0;I<b.length;I++)E[b[I]]=!0;if(d.populateEmpCodeForEntities.includes(o.userInfo.entityId)&&o.userInfo.entityId&&o.userInfo.email&&(E.empCode=!1,o.userInfo.empCode=l.generateEmployeeCode(o.userInfo.entityId,o.userInfo.email)),o.entitySpecificFields=E,E.dob||(o.userInfo.dob="01-01-0001"),a.empCode&&!E.empCode){var T=a.empCode.split("@");T.length>0?o.userInfo.empCode=T[0]:o.userInfo.empCode=a.empCode}if(u.location.href.includes("medibuddy"))try{var C={screen:"Self Registration",appVersion:"",domain:"medibuddyInWeb",event:"LF_SELFREG_FORM_OPEN",email:o.userInfo.email,phone:o.userInfo.phone,advertiserId:u.sessionStorage.getItem("branch_fingerprint"),auth_uuid:g.get("auth_uuid")||void 0},A=Object.assign({},C,{meta:JSON.stringify(C)});r.post(p.eventlogsUrl,A)}catch(L){console.log(L)}o.validateOtp=function(t){if(t){$("#verifyerr").text("");var n=p.unifiedLogin+"unified-login/user/verifyZeroDayUser",s={phonenumber:o.userInfo.phone,token:o.token,phrase:$("#otp").val(),platform:"medibuddyInweb"};r.post(n,s,{headers:{"Content-Type":"application/json"}}).then(function(t){if(t=t.data,t.data.isSuccess){if(u.location.href.includes("medibuddy"))try{var n={screen:"Self Registration",appVersion:"",id:o.userInfo.phone,domain:"medibuddyInWeb",event:"LF_SELFREG_PHONE_VERIFIED",email:o.userInfo.email,phone:o.userInfo.phone,advertiserId:u.sessionStorage.getItem("branch_fingerprint"),auth_uuid:g.get("auth_uuid")||void 0},s=Object.assign({},n,{meta:JSON.stringify(n)});r.post(p.eventlogsUrl,s)}catch(d){console.log(d)}l.loggedUserName=t.data.user.firstName,l.setUserObj(_.extend(t.data.user,{isRetailLabsFlowEnabled:t.data.isRetailLabsFlowEnabled})),o.ok(),e.dismiss("cancel"),i.$emit("userLogin",a),a.controller&&("authService"==a.controller&&a.func?l[a.func].apply(null,a.args):i.$broadcast(a.controller,a)),i.$broadcast("search","")}else{if(u.location.href.includes("medibuddy"))try{var n={screen:"Self Registration",appVersion:"",id:o.userInfo.phone,domain:"medibuddyInWeb",event:"LF_SELFREG_PHONE_NOT_VERIFIED",email:o.userInfo.email,phone:o.userInfo.phone,advertiserId:u.sessionStorage.getItem("branch_fingerprint"),auth_uuid:g.get("auth_uuid")||void 0},s=Object.assign({},n,{meta:JSON.stringify(n)});r.post(p.eventlogsUrl,s)}catch(d){console.log(d)}$("#verifyerr").text(t.data.message)}})}},o.validateNumber=function(e,t){var o=new RegExp(s.getRegexExpression(t)),a=String.fromCharCode(e.charCode?e.charCode:e.which);if(!o.test(a)&&13!==e.charCode&&9!==e.charCode)return e.preventDefault(),!1},o.ok=function(){P=!1,e.dismiss("cancel"),o.user&&o.user.token&&o.user.userDetails||(l.insuranceSelected=!1,"app.covidVaccination"==c.current.name&&c.go("app.home",{reload:!1}))},o.openOtpFlow=function(){o.regFormCheck=!1,o.regScreen=!0,o.otpEnterScreen=!1,o.counter=30,o.showResendLink=!1,$(".timer").html(""),$("#verifyerr").text(""),$("#loginerr").text(""),setTimeout(function(){$("#otp").val("")},100),v=setInterval(function(){$(".timer").text(o.counter+"s"),o.counter--,1===o.counter&&(o.showResendLink=!0,o.stopTimerCorp())},1e3)},o.stopTimerCorp=function(){clearInterval(v),o.counter=60,o.showResendLink=!0},o.updatePhone=function(){var e=/^[1-9]{1}[0-9]{9}$/;$("#phone").removeClass("input-error"),$("#phonerr").text(""),$("#signuperr").text(""),$("#loginerr").text(""),e.test(o.userInfo.phone)?($("#phonerr").text(""),$(".loginBtn").prop("disabled",!1)):($("#phonerr").text("Please enter valid 10 digit number"),$(".loginBtn").prop("disabled",!0))},o.registerUser=function(t,n){if(t){if(u.location.href.includes("medibuddy"))try{var s={screen:"Self Registration",appVersion:"",domain:"medibuddyInWeb",event:"LF_SELFREG_FORM_SUBMITTED",email:o.userInfo.email,phone:o.userInfo.phone,advertiserId:u.sessionStorage.getItem("branch_fingerprint"),auth_uuid:g.get("auth_uuid")||void 0},d=Object.assign({},s,{meta:JSON.stringify(s)});r.post(p.eventlogsUrl,d)}catch(c){console.log(c)}o.counter=30,o.stopTimerCorp(),$("#loginerr").text(""),n||$(".otpPhone").append(o.userInfo.phone);var m=p.unifiedLogin+"unified-login/user/registerZeroDayUser",h={employeeId:o.userInfo.empCode,dateOfBirth:o.userInfo.dob,name:o.userInfo.name,email:o.userInfo.email,phone:o.userInfo.phone,gender:o.userInfo.gender,corporateName:"NonTPASSO",entityId:o.userInfo.entityId,grade:o.userInfo.grade?o.userInfo.grade:void 0,platform:"medibuddyInweb"},f=g.get("retailToken")||null;n&&o.openOtpFlow(),r.post(m,h,{headers:{"Content-Type":"application/json",retailToken:f}}).then(function(t){if(t=t.data,t.success)if(o.phoneNumberVerified)l.loggedUserName=t.data.user.userDetails.firstName,l.setUserObj(_.extend(t.data.user,{isRetailLabsFlowEnabled:t.data.isRetailLabsFlowEnabled})),o.ok(),e.dismiss("cancel"),i.$emit("userLogin",a),a.controller&&("authService"==a.controller&&a.func?l[a.func].apply(null,a.args):i.$broadcast(a.controller,a)),i.$broadcast("search","");else if(n||o.openOtpFlow(),t.data.otpResponse){if(o.token=t.data.otpResponse.otpKey,u.location.href.includes("medibuddy"))try{var s={screen:"Self Registration",appVersion:"",phone:o.phone,domain:"medibuddyInWeb",event:"LF_SELFREG_USER_CREATED",email:o.email,advertiserId:u.sessionStorage.getItem("branch_fingerprint"),auth_uuid:g.get("auth_uuid")||void 0},d=Object.assign({},s,{meta:JSON.stringify(s)});r.post(p.eventlogsUrl,d)}catch(c){console.log(c)}}else t.message&&$("#loginerr").text(t.message);else{if($("#loginerr").text(t.error),u.location.href.includes("medibuddy"))try{var s={screen:"Self Registration",appVersion:"",info:t.errorMessage,phone:o.phone,domain:"medibuddyInWeb",event:"LF_SELFREG_USER_CREATION_FAILED",email:o.email,advertiserId:u.sessionStorage.getItem("branch_fingerprint"),auth_uuid:g.get("auth_uuid")||void 0},d=Object.assign({},s,{meta:JSON.stringify(s)});r.post(p.eventlogsUrl,d)}catch(c){console.log(c)}console.log(t)}})}}}],size:"reg-corp"})}document.querySelector("header").classList.remove("sticky-header")},openUbiPopUp:function(e,t,o,a,i,n,r){t=a?a+timeStamp:"templates/openUbiPopUp.html?"+timeStamp,o||(o={});l.open({animation:!0,templateUrl:t,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","apiProvider",function(e,t,o,a,i,n,s,l,u,d,c,p){t.isMobileView=o.isMobileView,t.filteredBeneficiaries=r||[],t.step=0,t.isUpdating=!1,t.closeUbiPopUp=function(){e.dismiss("cancel")},t.updateBenefs=function(){t.isUpdating=!0;var e=g.get("_mp_user"),o=e?e.token:"abc",a=p.apiUrl+"beneficiary",i=t.filteredBeneficiaries.map(function(t){var i={Name:t.details,ModifiedUserId:e.userDetails.userId||123,benefId:t.maid};return s.makeAjaxCalls(a,i,"PATCH",o).then(function(e){return e.data})["catch"](function(e){throw e})});Promise.all(i).then(function(){t.step=1,t.isUpdating=!1,t.$apply()})["catch"](function(e){t.isUpdating=!1,t.$apply()})},t.isFormValid=function(){var e=!0;return t.beneficiaryForm?t.filteredBeneficiaries.forEach(function(o){var a="beneficiaryDetails-"+o.maid,i=t.beneficiaryForm[a];i&&!i.$valid&&(e=!1),t.filteredBeneficiaries.some(function(e){return e.error})&&(e=!1)}):e=!1,e},t.validateName=function(e){var o=/^[a-zA-Z\s]*$/,a="beneficiaryDetails-"+e.maid,i=t.beneficiaryForm[a];i&&i.$dirty&&(e.details&&e.details.trim()===e.name?e.error="Invalid name. Ensure the name is different from the relation name":e.details&&!o.test(e.details)?e.error="Invalid name. Ensure the name contains only alphabets":e.error=null,t.isFormValid())}}],size:e})},openLoginPopup:function(e,t,a,i,r,u){if(t=i?i+timeStamp:"templates/openLoginPopUpnew.html?"+timeStamp,a||(a={}),!P){P=!0;l.open({animation:!0,templateUrl:t,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","apiProvider",function(e,t,i,n,l,d,c,p,m,h,f,v){t.isMobileView=i.isMobileView,$(".loginBtn").prop("disabled",!0),t.loginScreen=!1,t.linkAccountScreen=!0,t.showResendLink=!1,t.loginMedibuddyCheck=!0,t.displayTxt=r,t.forgotPasswordScreen=!0,t.otpEnterScreen=!0,t.signUpScreen=!0,t.otpDataId="",t.counter=30,t.phone="",t.name="",t.email="",t.showSkipText=!!g.get("showSkipText")&&g.get("showSkipText");var y="";t.isValidate=!0,t.mailId="";var E=g.get("city");t.emailPattern=d,t.loginObj={userName:"",password:""},t.gender={M:"Male",F:"Female"},p._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"Login/Signup",payload:p._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{itemSource:s.location.href}})}),t.isNewLogin=!0,setTimeout(function(){$("#phone").focus()}),t.selectedBtn=function(e,o){"LOGIN"===e?(t.screen="login",t.loginMedibuddyCheck=!0,t.loginScreen=!1,t.signUpScreen=!0,t.tabBtns=!1,t.linkAccountScreen=!0,t.forgotPasswordScreen=!0,t.otpEnterScreen=!0,$(".signup").removeClass("active"),$(".login").addClass("active"),setTimeout(function(){t.defaultFocus()})):"LinkingScreen"===e&&t.linkAccount()},t.showErrorScreen=function(){$("#name").addClass("input-error"),$("#namerr").text("Please enter name"),$("#emailerr").text("Please enter email"),$("#email").addClass("input-error"),$("#phone").val(t.phone)},t.linkAccount=function(){return t.ok(),p._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,hj:!0,name:"LF_CORPORATE_LOGIN_INITATE",payload:p._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"Login Page","Entry Point":"I have Corporate Account"}})}),c.openIdealLoginPopup("lg","templates/corporateIdealLoginPopup.html?"+timeStamp,a,"CORP_PHONE","LOGIN_MODAL")},t.stopTimer=function(){clearInterval(y),t.counter=60,t.showResendLink=!0},t.otpVerify=function(e){t.otpDataId=e,t.forgotPasswordScreen=!0,t.linkAccountScreen=!0,t.otpEnterScreen=!1,t.tabBtns=!1,t.loginScreen=!0,t.signUpScreen=!0,t.showResendLink=!1,t.counter=60,$(".timer").html(""),$("#verifyerr").text(""),setTimeout(function(){t.defaultFocus()}),setTimeout(function(){$("#otp").val("")},100),y=setInterval(function(){$(".timer").text(t.counter+"s"),t.counter--,1===t.counter&&(t.showResendLink=!0,t.stopTimer())},1e3)},t.updateOtp=function(){$("#verifyerr").text("")},t.loginuserbyOtpVerify=function(n,r){if(n){$(".verifyBtn").prop("disabled",!0);var s,u=g.get("_mp_user"),d=u&&u.userDetails&&u.userDetails.userId||null,m=r?c.isUserSignedin():{},h={source:"medibuddyInWeb",platform:"medibuddy",otp:$("#otp").val(),otpDataId:t.otpDataId,phonenumber:t.phone,advertiserId:p.localStorage.getItem("UniqSessionId"),imei:"MediBuddy_3b82314e-c6ae-4839-b50b-a9e4e64c6f65",version:"3.1.62",name:t.name,email:t.email,isMandatoryMobile:r,corpToken:g.get("corpToken")||void 0,mbUserId:d};s=r?v.unifiedLogin+"unified-login/user/verifyotpV1":v.unifiedLogin+"unified-login/user/verifyotpV2",l.post(s,h,{headers:{"Content-Type":"application/json"}}).then(function(n){var s=n.data;$(".verifyBtn").prop("disabled",!1),s.isSuccess?(r&&p._MB_Analytics.__push({isCleverTap:!0,dbLog:"mbConsumerLabs",name:"Verification Sucess",payload:p._Site_Props.__getEventParameters({custom:{pmEntityId:m&&m.userDetails?m.userDetails.pmEntityID:"",userId:m&&m.userDetails?m.userDetails.pmEntityID:""}})}),g.set("patientId",s.patientId),g.set("daservertoken",s.daservertoken),g.set("auth_uuid",s.auth_uuid),g.set("refreshToken",s.refreshToken),g.set("accessToken",s.accessToken),g.set("mbServerToken",s.longtoken),g.set("shortToken",s.user.token),document.cookie="refreshToken="+s.refreshToken+"; domain="+o.getCookieDomain(),document.cookie="accessToken="+s.accessToken+"; domain="+o.getCookieDomain(),document.cookie="mbServerToken="+s.longtoken+"; domain="+o.getCookieDomain(),document.cookie="shortToken="+s.user.token+"; domain="+o.getCookieDomain(),document.cookie="redirect="+s.user.token+"; domain="+o.getCookieDomain(),s.user.userDetails&&s.user.userDetails.pmEntityID&&(document.cookie="pmEntityId="+s.user.userDetails.pmEntityID+"; domain="+o.getCookieDomain()),"retail"==s.userProfile&&(g.set("retailMbId",s.user.userDetails.userId),g.set("retailToken",s.longtoken)),c.loggedUserName=s.user.userDetails.firstName,r?null:c.setUserObj(_.extend(s.user,{patientId:s.patientId,isRetailLabsFlowEnabled:s.isRetailLabsFlowEnabled})),t.ok(),e.dismiss("cancel"),r?c.getuserLongToken(s.user.token).then(function(e){if(e.data.isSuccess&&e.data.encryptedToken){g.set("corpToken",e.data.encryptedToken);var t=m.encryptedToken,o=m.userDetails.userId;c.getEncryptedTokenForLinking({corpToken:t,corpMbId:o}).then(function(e){i.$emit("userLogin",a)})}else i.$emit("userLogin",a)})["catch"](function(e){console.log("Error Occured",e.message),i.$emit("userLogin",a)}):i.$emit("userLogin",a),a.controller&&("authService"==a.controller&&a.func?c[a.func].apply(null,a.args):i.$broadcast(a.controller,a)),i.$broadcast("search","")):(r&&p._MB_Analytics.__push({isCleverTap:!0,dbLog:"mbConsumerLabs",name:"Verification Failed",payload:p._Site_Props.__getEventParameters({custom:{pmEntityId:m&&m.userDetails?m.userDetails.pmEntityID:"",userId:m&&m.userDetails?m.userDetails.pmEntityID:""}})}),g.set("toShowMandPopUp",!0),$("#verifyerr").text(s.error))})["catch"](function(e){r&&p._MB_Analytics.__push({isCleverTap:!0,dbLog:"mbConsumerLabs",name:"Verification Failed",payload:p._Site_Props.__getEventParameters({custom:{userName:c.loggedUserName,pmEntityId:m&&m.userDetails?m.userDetails.pmEntityID:"",userId:m&&m.userDetails?m.userDetails.pmEntityID:""}})}),g.set("toShowMandPopUp",!0),$(".verifyBtn").prop("disabled",!1),console.log(e)})}else $("#phone").focus(),$("#phone").addClass("input-error")},t.defaultFocus=function(){var e=null;e=t.otpEnterScreen?t.linkAccountScreen?document.querySelector("#phone"):document.querySelector("#username"):document.querySelector("#otp"),
e&&e.focus&&e.focus()},t.loginUserWithOtp=function(e,o,a){if(e){if(a){var i=c.isUserSignedin();p._MB_Analytics.__push({isCleverTap:!0,dbLog:"mbConsumerLabs",name:"OTP Requested",payload:p._Site_Props.__getEventParameters({custom:{pmEntityId:i&&i.userDetails?i.userDetails.pmEntityID:"",userId:i&&i.userDetails?i.userDetails.pmEntityID:""}})})}$(".otpPhone").text("+91-"),$("#phone").val()?$(".otpPhone").append($("#phone").val()):$(".otpPhone").append(t.phone),$("#phone").removeClass("input-error"),$(".verifyBtn").prop("disabled",!1),t.counter=30,t.stopTimer();var n=g.get("_mp_user"),r=n&&n.userDetails&&n.userDetails.userId||null,s={source:"medibuddyInWeb",platform:"medibuddy",phonenumber:$("#phone").val()?$("#phone").val():t.phone,flow:u?u:"Retail-Login-Flow",isMandatoryMobile:a,idealLoginFlow:!1,advertiserId:p.localStorage.getItem("UniqSessionId"),mbUserId:r},d=v.unifiedLogin+"unified-login/user/register";$("#phone").val()&&(t.phone=$("#phone").val()),l.post(d,s,{headers:{"Content-Type":"application/json"}}).then(function(e){var o=e.data;o.success?(g.set("toShowMandPopUp",!1),t.otpDataId=o.data.otpDataId,t.otpVerify(t.otpDataId)):($("#loginerr").text(o.errorText),$("#verifyerr").text(o.errorText))})["catch"](function(e){console.log(e)})}else $("#phone").addClass("input-error")},t.backToLogin=function(){t.stopTimer(),t.linkAccountScreen=!1,t.forgotPasswordScreen=!0,t.otpEnterScreen=!0,t.tabBtns=!0,t.loginScreen=!0,t.signUpScreen=!0,setTimeout(function(){t.defaultFocus()})},t.editMobile=function(){t.otpEnterScreen=!0,t.forgotPasswordScreen=!0,t.linkAccountScreen=!0,t.tabBtns=!1,t.screen="login","login"===t.screen?($("#phone").text($(".otpPhone").val()),t.loginScreen=!1,t.signUpScreen=!0):"signup"===t.screen&&(t.loginScreen=!0,t.signUpScreen=!1),setTimeout(function(){t.defaultFocus()})},t.loginMedibuddy=function(o){if(o){var n={username:t.loginObj.userMBName,password:t.loginObj.passwordMB};t.loginMedibuddyCheck=!0,t.stopTimer(),p._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsLoginSubmit"});var r=v.apiUrl+"MarketPlaceLogon";l.post(r,n,{headers:{"Content-Type":"application/json",City:E,Platform:"web"}}).then(function(o){t.loginMedibuddyCheck=!1;var n=o.data;o.data.isSuccess?(c.loggedUserName=t.loginObj.userMBName,c.setUserObj(_.extend(o.data.user,{isRetailLabsFlowEnabled:o.data.isRetailLabsFlowEnabled})),t.ok(),e.dismiss("cancel"),a.controller&&("authService"==a.controller&&a.func?c[a.func].apply(null,a.args):i.$broadcast(a.controller,a)),i.$broadcast("search",""),c.getuserLongToken(n.user.token).then(function(e){e.data.isSuccess&&e.data.encryptedToken&&(g.set("corpToken",e.data.encryptedToken),c.getEncryptedTokenForLinking({corpToken:e.data.encryptedToken,corpMbId:n.user.userDetails.userId}).then(function(e){i.$emit("userLogin",a)}))})["catch"](function(e){console.log("Error Occured",e.message),i.$emit("userLogin",a)})):"User OTP Not Verified"===o.data.errorMessage?(t.guid=o.data.tokenForLoginModel,t.signinUp(),t.verifyOtpRegUser=!0,t.sendOtp({})):(console.log("in else",o.data.errorMessage),t.loginErrorMsg=o.data.errorMessage,$("#corplogerr").text(o.data.errorMessage),t.usersigninedinFailed())})}},t.updateuserMBName=function(){$("#corplogerr").text("")},t.updateMBPwd=function(){$("#corplogerr").text("")},t.ok=function(){P=!1,e.dismiss("cancel"),t.counter=30,c.isUserSignedin()||"app.covidVaccination"==m.current.name&&m.go("app.home",{reload:!1})},t.forgotPassword=function(){t.counter=30,t.infinitiLoginCheck=!1,t.userNamePlaceholder="Enter your Mobile or Email",t.loginObj.userName="",t.isPasswordCheck=!0,t.forgotPassErrorMsg="",t.forgotPasswordScreen=!1,t.linkAccountScreen=!0,t.otpEnterScreen=!0,t.loginScreen=!0,t.signUpScreen=!0,setTimeout(function(){t.defaultFocus()})},t.validateNumber=function(e,t){var o=new RegExp(d.getRegexExpression(t)),a=String.fromCharCode(e.charCode?e.charCode:e.which);if(!o.test(a)&&13!==e.charCode&&9!==e.charCode)return e.preventDefault(),!1},t.updateMob=function(){var e=/^[1-9]{1}[0-9]{9}$/;$("#phone").removeClass("input-error"),$("#moberr").text(""),$("#signuperr").text(""),$("#loginerr").text("");var t=$("#phone").val();e.test(t)?($("#moberr").text(""),$(".signUpBtn").prop("disabled",!1),$(".loginBtn").prop("disabled",!1)):($("#moberr").text("Please enter valid 10 digit number"),$(".signUpBtn").prop("disabled",!0),$(".loginBtn").prop("disabled",!0))},t.closePopup=function(){e.close(),t.ok()},t.openDetailsPage=function(){t.ok();var e=g.get("_mp_user").userDetails.userId;if(p.location.href.includes("medibuddy")){var o={screen:"Home_Page",appVersion:"",domain:"medibuddyInWeb",event:"LF_MANDATORY_MOBILE_POPUP_CLICKHERE",advertiserId:p.sessionStorage.getItem("branch_fingerprint"),auth_uuid:g.get("auth_uuid")||void 0,mbUserId:e},a=Object.assign({},o,{meta:JSON.stringify(o)});l.post(v.eventlogsUrl,a)}return c.openLoginPopup("lg","templates/mandatoryPhoneNoImp.html?"+timeStamp,void 0,"templates/mandatoryPhoneNoImp.html?")},t.skipMandatoryMobile=function(){var e=g.get("_mp_user"),o=e&&e.userDetails&&e.userDetails.userId||null;if(p.location.href.includes("medibuddy")){var a={screen:"Home_Page",appVersion:"",domain:"medibuddyInWeb",event:"LF_MANDATORY_MOBILE_POPUP_SKIPCLICK",advertiserId:p.sessionStorage.getItem("branch_fingerprint"),auth_uuid:g.get("auth_uuid")||void 0,mbUserId:o},i=Object.assign({},a,{meta:JSON.stringify(a)});l.post(v.eventlogsUrl,i)}var n=c.isUserSignedin();p._MB_Analytics.__push({excludeCleverTap:!0,dbLog:"mbConsumerLabs",name:"Mandatory Popup Skipped",payload:p._Site_Props.__getEventParameters({custom:{pmEntityId:n.userDetails?n.userDetails.pmEntityID:"",userId:n.userDetails?n.userDetails.userId:""}})}),g.set("toShowMandPopUp",!1),t.ok()},t.redirectToMandatoryMobile=function(){var e=g.get("_mp_user"),o=e&&e.userDetails&&e.userDetails.userId||null;if(p.location.href.includes("medibuddy")){var a={screen:"Home_Page",appVersion:"",domain:"medibuddyInWeb",event:"LF_MANDATORY_MOBILE_POPUP_CONTINUEVERIFICATION",advertiserId:p.sessionStorage.getItem("branch_fingerprint"),auth_uuid:g.get("auth_uuid")||void 0,mbUserId:o},i=Object.assign({},a,{meta:JSON.stringify(a)});l.post(v.eventlogsUrl,i)}return t.ok(),c.openLoginPopup("lg","templates/openMandatoryMobilePopup.html?"+timeStamp,void 0,"templates/openMandatoryMobilePopup.html?",null,"Mandatory-Popup-Flow")},t.updateName=function(){var e=/^[A-Za-z0-9 ]+$/;$("#name").removeClass("input-error"),$("#namerr").text(""),$("#signuperr").text("");var t=$("#name").val();""===t||e.test(t)?($("#namerr").text(""),$(".signUpBtn").prop("disabled",!1)):($("#namerr").text("Please enter valid name"),$(".signUpBtn").prop("disabled",!0))},t.updateEmail=function(){var e=/^(([^<>()\[\]\\.,;:\s@']+(\.[^<>()\[\]\\.,;:\s@']+)*)|('.+'))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;$("#email").removeClass("input-error"),$("#emailerr").text(""),$("#signuperr").text("");var t=$("#email").val();if(""===t||e.test(t)){var o=t.split("@");T.includes(o[1])?($("#emailerr").text("Please enter valid email"),$(".signUpBtn").prop("disabled",!0)):(console.log(" valid"),$("#emailerr").text(""),$(".signUpBtn").prop("disabled",!1))}else console.log("not valid"),$("#emailerr").text("Please enter valid email"),$(".signUpBtn").prop("disabled",!0)},t.signUpUser=function(e){if(console.log(e),e){t.counter=30,$(".otpPhone").text("+91-"),$(".otpPhone").append($("#phone").val()),t.name=$("#name").val(),t.email=$("#email").val(),t.phone=$("#phone").val();var o={source:"medibuddy",platform:"medibuddy",phonenumber:$("#phone").val(),flow:u?u:"signUpScreen",isMandatoryMobile:!1,idealLoginFlow:!1,name:t.name,email:t.email,advertiserId:p.localStorage.getItem("UniqSessionId")},a=v.siteUrl+"unified-login/user/register";l.post(a,o,{headers:{"Content-Type":"application/json"}}).then(function(e){var o=e.data;o.success?(t.otpDataId=o.data.otpDataId,t.otpVerify(t.otpDataId)):$("#signuperr").text(o.errorText)})["catch"](function(e){console.log("error",e)})}},c.showRegisterTab&&(t.selectedBtn("REGISTER"),c.showRegisterTab=!1),c.showLinkingScreen&&t.selectedBtn("LinkingScreen")}],size:n.isMobileView?"login-new modal-bottom":"login-new",windowClass:n.isMobileView&&"bottom-sheet"})}document.querySelector("header").classList.remove("sticky-header")},openResponseSubmitPopUp:function(e){var t="templates/responseSubmitPopUp.html?"+timeStamp,o=l.open({animation:!0,backdrop:!0,templateUrl:t,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","apiProvider",function(t,o,a,i,n,r,s,l,u,d,c,p){o.isMobileView=a.isMobileView,o.ok=function(){t.dismiss("cancel")},o.status=e}],size:n.isMobileView?"md":"sm",windowClass:"qnaSubmitWindow"});return o},openHRAQnAPopUp:function(){var e="templates/checkoutHRAQnAPopUp.html?"+timeStamp;l.open({animation:!0,templateUrl:e,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","apiProvider",function(e,t,o,a,i,n,r,s,l,u,d,c){t.isMobileView=o.isMobileView;var p=r.isUserSignedin();t.hraDescription=o.hraDescription,t.boschUser=11195213==p.userDetails.pmEntityID,s._MB_Analytics.__push({isCleverTap:!0,dbLog:"HRAPopUpOpened",name:"HRAPopUpOpened",payload:s._Site_Props.__getEventParameters({custom:{userId:p.userDetails.userId,uuid:p.userDetails.uuid,email:p.userDetails.email,pmEntityId:p.userDetails.pmEntityID,phone:p.userDetails.phone,employeeId:p.corpDetails&&p.corpDetails.iwpEmployeeId?p.corpDetails.iwpEmployeeId:"",name:p.userDetails.firstName,gender:p.userDetails.gender}})}),t.ok=function(){s._MB_Analytics.__push({isCleverTap:!0,dbLog:"HRAPopUpClosed",name:"HRAPopUpClosed",payload:s._Site_Props.__getEventParameters({custom:{userId:p.userDetails.userId,uuid:p.userDetails.uuid,email:p.userDetails.email,pmEntityId:p.userDetails.pmEntityID,phone:p.userDetails.phone,employeeId:p.corpDetails&&p.corpDetails.iwpEmployeeId?p.corpDetails.iwpEmployeeId:"",name:p.userDetails.firstName,gender:p.userDetails.gender}})}),e.dismiss("cancel")},t.initialPopUpSubmit=function(){s._MB_Analytics.__push({isCleverTap:!0,dbLog:"HRAPopUpQnARequested",name:"HRAPopUpOpenedRequested",payload:s._Site_Props.__getEventParameters({custom:{userId:p.userDetails.userId,uuid:p.userDetails.uuid,email:p.userDetails.email,pmEntityId:p.userDetails.pmEntityID,phone:p.userDetails.phone,employeeId:p.corpDetails&&p.corpDetails.iwpEmployeeId?p.corpDetails.iwpEmployeeId:"",name:p.userDetails.firstName,gender:p.userDetails.gender}})}),e.dismiss("cancel"),r.openHRAQnAContent(!0,t.boschUser,!1)},o.$on("hraDescriptionSet",function(){t.hraDescription=o.hraDescription})}],size:n.isMobileView?"md":"sm"})},openHRAQnAContent:function(t,a,i){var r="templates/checkoutHRAQnAContent.html?"+timeStamp;l.open({animation:!1,templateUrl:r,backdrop:t,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","apiProvider",function(t,n,r,l,u,d,c,p,m,h,f,v){function y(){if(n.isIOS&&(b.accessToken=m.params.AuthToken,i&&c.makeAjaxCalls(v.apiUrl+"/MarketPlaceLogon",{isSSOLogin:!0,authServerAccessToken:b.accessToken},"POST").then(function(e){e&&e.data&&e.data.user&&e.data.user.token&&(document.cookie="redirect="+e.data.user.token+"; domain="+o.getCookieDomain(),e.data.user.userDetails&&e.data.user.userDetails.pmEntityID&&(document.cookie="pmEntityId="+e.data.user.userDetails.pmEntityID+"; domain="+o.getCookieDomain())),a=11195213==e.data.user.userDetails.pmEntityID,l(function(){n.authenticated=!0}),t.dismiss("cancel"),c.openHRAQnAContent(!1,a,!1)})),n.isAndroid){var e=document.cookie.split(";");if(e){var r=_.first(e.filter(function(e){return e.startsWith(" redirect")}));r?c.makeAjaxCalls(v.apiUrl+"GetUserLongToken",{shortToken:r.substring(10)},"POST").then(function(e){e.data.isSuccess&&(g.set("corpToken",e.data.encryptedToken),b.accessToken=e.data.encryptedToken,i&&c.makeAjaxCalls(v.apiUrl+"/MarketPlaceLogon",{isSSOLogin:!0,authServerAccessToken:b.accessToken},"POST").then(function(e){l(function(){n.authenticated=!0}),e&&e.data&&e.data.user&&e.data.user.token&&(document.cookie="redirect="+e.data.user.token+"; domain="+o.getCookieDomain(),e.data.user.userDetails&&e.data.user.userDetails.pmEntityID&&(document.cookie="pmEntityId="+e.data.user.userDetails.pmEntityID+"; domain="+o.getCookieDomain())),a=11195213==e.data.user.userDetails.pmEntityID,t.dismiss("cancel"),c.openHRAQnAContent(!1,a,!1)}))}):(r=_.first(e.filter(function(e){return e.startsWith("redirect")})),r&&c.makeAjaxCalls(v.apiUrl+"GetUserLongToken",{shortToken:r.substring(9)},"POST").then(function(e){e.data.isSuccess&&(g.set("corpToken",e.data.encryptedToken),b.accessToken=e.data.encryptedToken,i&&c.makeAjaxCalls(v.apiUrl+"/MarketPlaceLogon",{isSSOLogin:!0,authServerAccessToken:b.accessToken},"POST").then(function(e){l(function(){n.authenticated=!0}),e&&e.data&&e.data.user&&e.data.user.token&&(document.cookie="redirect="+e.data.user.token+"; domain="+o.getCookieDomain(),e.data.user.userDetails&&e.data.user.userDetails.pmEntityID&&(document.cookie="pmEntityId="+e.data.user.userDetails.pmEntityID+"; domain="+o.getCookieDomain())),a=11195213==e.data.user.userDetails.pmEntityID,t.dismiss("cancel"),c.openHRAQnAContent(!1,a,!1)}))})),S=r||"noToken"}}}function E(e){if(n.isIOS)return void p.webkit.messageHandlers.hraMessage.postMessage(e);if(n.isAndroid){var o="hraQnASubmitted"===e;return void s.WebToNativeCommunicationInterface.closeWebWindow(o)}t.dismiss("cancel")}n.isMobileView=r.isMobileView,n.isAuthRequired=i,n.authenticated=!1;var b=c.isUserSignedin(),S="";if(n.isSubmitClicked=!1,n.isSubmitted=!1,n.isIOS=p.navigator.userAgent.toLowerCase().includes("ipad")|p.navigator.userAgent.toLowerCase().includes("ipod")|p.navigator.userAgent.toLowerCase().includes("iphone"),n.isAndroid=!!p.WebToNativeCommunicationInterface,b){if(i){var P=11195213==b.userDetails.pmEntityID;t.dismiss("cancel"),c.openHRAQnAContent(!0,P,!1)}b.accessToken="",b.accessToken=b.encryptedToken,n.isAuthRequired=!1}else b={},b.accessToken="",b.shortToken="",y();n.ok=function(){E("hraQnAClosed"),n.isAndroid||n.isIOS||p._MB_Analytics.__push({isCleverTap:!0,dbLog:"HRAQnAPopUpClosed",name:"HRAQnAPopUpClosed",payload:p._Site_Props.__getEventParameters({custom:{userId:b.userDetails.userId,uuid:b.userDetails.uuid,email:b.userDetails.email,pmEntityId:b.userDetails.pmEntityID,phone:b.userDetails.phone,employeeId:b.corpDetails&&b.corpDetails.iwpEmployeeId?b.corpDetails.iwpEmployeeId:"",name:b.userDetails.firstName,gender:b.userDetails.gender}})})},e.element(document).ready(function(){return n.isIOS?void p.webkit.messageHandlers.pageLoadingEvents.postMessage("pageLoadingCompleted"):n.isAndroid?void s.WebToNativeCommunicationInterface.showLoader(!1):void 0}),n.QnAContent={Personal:[{key:"age",question:"Enter your age",type:"input",content:"Ex : 28",format:"number"},{key:"height",question:"Enter your height",type:"input",content:"Ex : 180",format:"number"},{key:"weight",question:"Enter your weight",type:"input",content:"Ex : 70",format:"number"}],"General Well-being":[{key:"healthAndLifeStyle",question:"How would you rate overall health & lifestyle compared to others of your age?",type:"select",content:["Excellent","Good","Average","Poor"]},{key:"healthyLifeBenefits",question:"How would you rate your seriousness towards the benefits of a healthy lifestyle?",type:"select",content:["Excellent","Good","Average","Poor"]},{key:"healthCheckUps",question:"How often do you see a physician in a year for check-ups, health screening, or general disease, prevention?",type:"select",content:["Less than 1","1 to 2","2 to 3","More than 3"]},{key:"workDaysMissed",question:"How many days of work did you miss due to illness in the past six months?",type:"select",content:["Less than 5","5 to 8","8 to 12","More than 12"]},{key:"diagnosedOrTreated",question:"Have you ever been diagnosed or treated for any of the below conditions?",type:"multiselect",content:["Diabetes","Hypertension or High Blood Pressure","Heart Disease","Cancer","None of the Above"]},{key:"complaints",question:"Do you currently have complaints about any of the following symptoms?",type:"multiselect",content:["Excessive thirst","Frequent urination","Headaches","Giddiness","Chest pain","Breathlessness","Numbness or weakness in limbs","Excessive weight loss in last six months","Development of a cyst or lump","White patches inside the mouth or white spots on the tongue","Unusual bleeding or discharge in last six months","None of the Above"]},{key:"familyHealthCondtion",question:"Does any of your immediate family members (Parent/Brother/Sister) have a history with the following health conditions?",type:"multiselect",content:["Diabetes","Hypertension or High Blood Pressure","Heart Disease","Stroke","Any type of cancer","None of the Above"]}],"Physical activity":[{key:"physicalActivityV2",question:"How much time do you spend on physical activity or exercises in a week? (Brisk walking, running, climbing, etc.)",type:"select",content:["Less than 30 minutes","30 minutes to 1 hour","1 to 2 hours","More than 2 hours"]},{key:"energyLevelsDuringDaV2",question:"How would you describe your energy levels throughout the day?",type:"select",content:["Excellent","Good","Average","Poor"]}],Nutrition:[{key:"appetiteLevel",question:"How would you describe your apetite or eating habits?",type:"select",content:["Poor (Eating less)","High (Over eating)","Normal"]},{key:"fruitsAndVeggieEatingHabbit",question:"How many servings of fruits & vegetables do you eat in a week?",type:"select",content:["Less than 1","1 to 2","2 to 3","More than 3"]},{key:"hightFatFoodEatingHabbit",question:"How often do you avoid ating foods that are high in Fats? (Milk, friend food, fatty meats, etc.)",type:"select",content:["Always","Usually","Sometimes","Never"]}],"Emotional Health":[{key:"stress",question:"How often did you feel restless, indifferent, depressed, or distracted inthe last month?",type:"select",content:["Regularly","Usually","Sometimes","Never"]},{key:"SleepPattern",question:"How many hours do you sleep daily?",type:"select",content:["Less than 6","6 to 8","8 to 10","More than 10"]}],Habits:[{key:"tobaccoConsumption",question:"How often do you consume tobacco products?(Cigrettes, smokeless tobacco, cigars, pipes, etc.)",type:"select",content:["Regularly","Usually","Sometimes","Never"]},{key:"alchoholConsumption",question:"How often do you consume alcohol products?(Beer, liquor, wine, etc.)",type:"select",content:["Regularly","Usually","Sometimes","Never"]}],"Health Screening":[{key:"BPRating",question:"How was your Blood Pressure level?",type:"select",content:["Normal","High","Low","Dont know"]},{key:"ECGReport",question:"How was your ECG (Electrocardiogram) result?",type:"select",content:["Normal","Unusual","Dont know"]},{key:"TMTReport",question:"How was your TMT (Treadmill Test) result?",type:"select",content:["Normal","Unusual","Dont know"]},{key:"TotalCholesterol",question:"What was your Cholesterol level?",type:"select",content:["Less than 200","200 - 300","More than 300","Dont know"]},{key:"BloodSugarLevel",question:"What was your Blood Sugar level?",type:"select",content:["Less than 100","100 - 200","More than 200","Dont know"]},{key:"HbA1C",question:"What was your HbA1C (Glycated haemoglobin) level?",type:"select",content:["Less than 6","6 to 8","More than 8","Dont know"]}]},a&&(n.QnAContent={Personal:[{key:"age",question:"Age",type:"input",content:"",format:"number"},{key:"email",question:"Email ID",type:"input",content:"",format:"text"},{key:"height",question:"Height (CM)",type:"input",content:"",format:"number"},{key:"weight",question:"Weight (KG)",type:"input",content:"",format:"number"}],Habits:[{key:"tobaccoConsumption",question:"Do you Smoke or consume Tobacco?",type:"select",content:["Yes","No"]},{key:"tobaccoQuantity",question:"If Yes, how many per day? Please answer 0 (zero) if you do not smoke",type:"input",content:"","default":"0"},{key:"alcoholConsumption",question:"Do you consume Alcohol?",type:"select",content:["Yes","No"]},{key:"alcoholQuantity",question:"If Yes, how many units / week? Please answer 0 (zero) if you do not consume alcohol",type:"input",content:"","default":"0"}],"Emotional Health":[{key:"sleepPattern",question:"How many Hours of sleep do you get daily? (in hours)",type:"input",content:""},{key:"sleepQuality",question:"Do you wake up fresh on most days",type:"select",content:["Yes","No"]}],"Physical Activity":[{key:"exercise",question:"Do you exercise?",type:"select",content:["Yes","No"]},{key:"exerciseDuration",question:"If Yes, How many mins / week? (in minutes) Please answer 0 (zero) if you do not exercise",type:"input",content:"","default":"0"},{key:"prefferedExercise",question:"Preferred exercise ? (e.g. Walking, swimming, badminton )",type:"input",content:"",format:"text","default":"None"},{key:"exerciseIntensity",question:"What is the intensity of your exercise?",type:"select",content:["Easy","Moderate","Strenuous","Not Applicable"]}],"General Well-being":[{key:"hypertension",question:"Do you have Hypertension?",type:"select",content:["Yes","No"]},{key:"hypertensionType",question:"If yes, Controlled / Uncontrolled. Please select Not Applicable if you do not have Hypertension",type:"select",content:["Controlled","Uncontrolled","Not Applicable"]},{key:"diabetes",question:"Do you have Diabetes?",type:"select",content:["Yes","No"]},{key:"diabetesType",question:"If yes, Controlled / Uncontrolled. Please select Not Applicable if you do not have Diabetes",type:"select",content:["Controlled","Uncontrolled","Not Applicable"]},{key:"cholestrol",question:"Do you have raised Cholestrol?",type:"select",content:["Yes","No"]},{key:"cholestrolType",question:"If yes, Controlled / Uncontrolled. Please select Not Applicable if you do not have Raised Cholestrol",type:"select",content:["Controlled","Uncontrolled","Not Applicable"]},{key:"hypertensionHistory",question:"Family History of Hypertension?",type:"select",content:["Yes","No"]},{key:"diabetesHistory",question:"Family History of Diabetes?",type:"select",content:["Yes","No"]},{key:"heartattackHistory",question:"Family history of Heart attack?",type:"select",content:["Yes","No"]},{key:"interests",question:"Over the last 2 weeks, how often have you been bothered because of Little interest or pleasure in doing things?",type:"select",content:["Not at all","Several days","More than half the days","Nearly every day"]},{key:"depression",question:"Over the last 2 weeks, how often have you been bothered because of Feeling down, depressed or hopeless?",type:"select",content:["Not at all","Several days","More than half the days","Nearly every day"]},{key:"nervousness",question:"Over the last 2 weeks, how often have you been bothered because of Feeling nervous, anxious or on edge?",type:"select",content:["Not at all","Several days","More than half the days","Nearly every day"]},{key:"worry",question:"Over the last 2 weeks, how often have you been bothered because of Not being able to stop or control worrying?",type:"select",content:["Not at all","Several days","More than half the days","Nearly every day"]}]}),n.inputQnA={},n.handleQnASelection=function(e,t){"select"===e.type&&n.setSingleSelect(e.key,t),"multiselect"===e.type&&n.setMultiSelect(e.key,t)},n.categories=Object.keys(n.QnAContent),_.each(n.categories,function(e){_.each(n.QnAContent[e],function(e){"select"===e.type||"multiselect"===e.type?(n.inputQnA[e.key]={},_.each(e.content,function(t){n.inputQnA[e.key][t]=!1})):n.inputQnA[e.key]=""})}),n.stopClickPropagation=function(e){e.stopPropagation()},n.setMultiSelect=function(e,t){var o="#"+e+"nooptionselected";n.inputQnA[e][t]=!n.inputQnA[e][t];var a=!1;_.each(Object.keys(n.inputQnA[e]),function(t){n.inputQnA[e][t]===!0&&(a=!0)}),a&&$(o).text("")},n.setSingleSelect=function(e,t){var o="#"+e+"nooptionselected",i="#"+e+"Typenooptionselected";if(_.each(Object.keys(n.inputQnA[e]),function(t){n.inputQnA[e][t]=!1}),n.inputQnA[e][t]=!0,a)if("hypertensionType"==e){if(n.inputQnA.hypertension.No&&"Not Applicable"!=t)return void $(o).text("Only Not Applicable is Valid");if(n.inputQnA.hypertension.Yes&&"Not Applicable"==t)return void $(o).text("Invalid Selection")}else if("diabetesType"==e){if(n.inputQnA.diabetes.No&&"Not Applicable"!=t)return void $(o).text("Only Not Applicable is Valid");if(n.inputQnA.diabetes.Yes&&"Not Applicable"==t)return void $(o).text("Invalid Selection")}else if("cholestrolType"==e){if(n.inputQnA.cholestrol.No&&"Not Applicable"!=t)return void $(o).text("Only Not Applicable is Valid");if(n.inputQnA.cholestrol.Yes&&"Not Applicable"==t)return void $(o).text("Invalid Selection")}else if("hypertension"==e){if("No"==t&&(n.inputQnA.hypertensionType.Controlled||n.inputQnA.hypertensionType.Uncontrolled))return void $(i).text("Only Not Applicable is Valid");if("Yes"==t&&n.inputQnA.hypertensionType["Not Applicable"])return void $(i).text("Invalid Selection");$(i).text("")}else if("diabetes"==e){if("No"==t&&(n.inputQnA.diabetesType.Controlled||n.inputQnA.diabetesType.Uncontrolled))return void $(i).text("Only Not Applicable is Valid");if("Yes"==t&&n.inputQnA.diabetesType["Not Applicable"])return void $(i).text("Invalid Selection");$(i).text("")}else if("cholestrol"==e){if("No"==t&&(n.inputQnA.cholestrolType.Controlled||n.inputQnA.cholestrolType.Uncontrolled))return void $(i).text("Only Not Applicable is Valid");if("Yes"==t&&n.inputQnA.cholestrolType["Not Applicable"])return void $(i).text("Invalid Selection");$(i).text("")}$(o).text("")},n.handleMultiSelect=function(e){var t="#"+e+"nooptionselected",o=[];$(t).text("");var a=!1;return _.each(Object.keys(n.inputQnA[e]),function(t){n.inputQnA[e][t]===!0&&(a=!0,o.push(t))}),a?($(t).text(""),o):["None of the Above"]},n.submitHRA=function(){var e={},t=!0,o=!1,i=!0;if(_.each(n.categories,function(r){_.each(n.QnAContent[r],function(r){"select"===r.type?t=n.validateSingleSelect(r.key):"multiselect"===r.type&&(t=n.handleMultiSelect(r.key)),"input"===r.type&&(t=n.handleTextInputs(r.key)),i&=!!t,t||o||(document.getElementById(r.key).scrollIntoView({behavior:"smooth",block:"center"}),o=!0),t&&(a?(e.questions||(e.questions={}),"age"===r.key||"gender"===r.key||"email"===r.key||"employeeId"===r.key||"employeeName"===r.key||"height"===r.key||"weight"===r.key?e[r.key]=t:e.questions[r.question]=t,e.skipComputation=!0):e[r.key]=t)})}),i){n.isSubmitClicked=!0,n.isIOS||n.isAndroid||p._MB_Analytics.__push({isCleverTap:!0,dbLog:"HRAQnAPopUp",name:"HRASubmit",payload:p._Site_Props.__getEventParameters({custom:{userId:b.userDetails.userId,uuid:b.userDetails.uuid,email:b.userDetails.email,pmEntityId:b.userDetails.pmEntityID,phone:b.userDetails.phone,employeeId:b.corpDetails&&b.corpDetails.iwpEmployeeId?b.corpDetails.iwpEmployeeId:"",name:b.userDetails.firstName,gender:b.userDetails.gender}})}),b.accessToken&&(e.accessToken=b.accessToken);var s=c.openResponseSubmitPopUp(!1),l=n.isAndroid?"Android":n.isIOS?"IOS":"Browser";p._MB_Analytics.__push({isCleverTap:!0,dbLog:"HRAQnAResponseSubmitInitiated",name:"HRAQnAResponseSubmitInitiated",payload:p._Site_Props.__getEventParameters({custom:{token:b.accessToken||"noToken",platform:r.isMobileView?"MWeb":"Web",deviceType:l,refreshToken:S}})}),c.makeAjaxCalls("https://healthriskbackend.docsapp.in/healthData",e,"POST").then(function(e){n.isAndroid||n.isIOS||p._MB_Analytics.__push({isCleverTap:!0,dbLog:"HRAQnASubmitted",name:"HRAQnaSubmitted",payload:p._Site_Props.__getEventParameters({custom:{userId:b.userDetails.userId,uuid:b.userDetails.uuid,email:b.userDetails.email,pmEntityId:b.userDetails.pmEntityID,phone:b.userDetails.phone,employeeId:b.corpDetails&&b.corpDetails.iwpEmployeeId?b.corpDetails.iwpEmployeeId:"",name:b.userDetails.firstName,gender:b.userDetails.gender}})});var t=c.openResponseSubmitPopUp(!0);s.close(),setTimeout(function(){t.close(),E("hraQnASubmitted"),r.$emit("requiredHRASubmitted","")},3e3)})["catch"](function(e){n.isAndroid||n.isIOS||p._MB_Analytics.__push({isCleverTap:!0,dbLog:"HRAQnASubmitError",name:"HRAQnaSubmitError",payload:p._Site_Props.__getEventParameters({custom:{userId:b.userDetails.userId,uuid:b.userDetails.uuid,email:b.userDetails.email,pmEntityId:b.userDetails.pmEntityID,phone:b.userDetails.phone,employeeId:b.corpDetails&&b.corpDetails.iwpEmployeeId?b.corpDetails.iwpEmployeeId:"",name:b.userDetails.firstName,gender:b.userDetails.gender}})}),s.close(),E("hraQnAClosed")})}},n.validateSingleSelect=function(e){var t="#"+e+"nooptionselected";$(t).text("");var o="",i=!1;return _.each(Object.keys(n.inputQnA[e]),function(r){if(a)if("hypertensionType"==e){if(n.inputQnA.hypertension.No&&!n.inputQnA.hypertensionType["Not Applicable"])return $(t).text("Only Not Applicable is Valid"),!1;if(n.inputQnA.hypertension.Yes&&n.inputQnA.hypertensionType["Not Applicable"])return $(t).text("Invalid Selection"),!1}else if("diabetesType"==e){if(n.inputQnA.diabetes.No&&!n.inputQnA.diabetesType["Not Applicable"])return $(t).text("Only Not Applicable is Valid"),!1;if(n.inputQnA.diabetes.Yes&&n.inputQnA.diabetesType["Not Applicable"])return $(t).text("Invalid Selection"),!1}else if("cholestrolType"==e){if(n.inputQnA.cholestrol.No&&!n.inputQnA.cholestrolType["Not Applicable"])return $(t).text("Only Not Applicable is Valid"),!1;if(n.inputQnA.cholestrol.Yes&&n.inputQnA.cholestrolType["Not Applicable"])return $(t).text("Invalid Selection"),!1}n.inputQnA[e][r]===!0&&(i=!0,o=r)}),i?($(t).text(""),o):($(t).text("Please select one or more options"),!1)},n.handleTextInputs=function(e){var t="#"+e+"inputErr",o=e+"HRAinput";n.inputQnA[e]=document.getElementById(o).value;var a=/^[1-9][0-9]*$/,i=!0;if("age"===e?a=/^([1-9][0-9]|1[01][0-9]|120)$/:"height"===e?a=/^([8-9][0-9]|[12][0-9][0-9]|300)$/:"weight"===e?a=/^([3-9][0-9]|1[0-9][0-9]|200)$/:"email"===e?a=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/:"sleepPattern"===e?a=/^([1-9]|1[0-9]|2[0-4])$/:i=!1,$(t).text(""),i&&!a.test(n.inputQnA[e]))return"employeeName"!=e&&"gender"!=e&&"email"!=e&&"prefferedExercise"!=e?$(t).text("please enter a valid number"):"email"===e&&$(t).text("please enter a valid email"),!1;if(!i){if("tobaccoQuantity"===e&&(n.inputQnA.tobaccoConsumption.Yes||n.inputQnA.tobaccoConsumption.No)){if(n.inputQnA.tobaccoConsumption.Yes&&n.inputQnA[e]<1)return $(t).text("number should be greater than 1"),!1;if(n.inputQnA.tobaccoConsumption.No&&0==n.inputQnA[e].length)return n.inputQnA[e]="0","0";if(n.inputQnA.tobaccoConsumption.No&&0!=n.inputQnA[e])return $(t).text("number should be 0"),!1}if("alcoholQuantity"===e&&(n.inputQnA.alcoholConsumption.Yes||n.inputQnA.alcoholConsumption.No)){if(n.inputQnA.alcoholConsumption.Yes&&n.inputQnA[e]<1)return $(t).text("number should be greater than 1"),!1;if(n.inputQnA.alcoholConsumption.No&&0==n.inputQnA[e].length)return n.inputQnA[e]="0","0";if(n.inputQnA.alcoholConsumption.No&&0!=n.inputQnA[e])return $(t).text("number should be 0"),!1}if("exerciseDuration"===e&&(n.inputQnA.exercise.Yes||n.inputQnA.exercise.No)){if(n.inputQnA.exercise.Yes&&(n.inputQnA[e]<1||n.inputQnA[e]>10080))return $(t).text("number should be greater than 1 and less than 10080"),!1;if(n.inputQnA.exercise.No&&0==n.inputQnA[e].length)return n.inputQnA[e]=0,"0";if(n.inputQnA.exercise.No&&0!=n.inputQnA[e])return $(t).text("number should be 0"),!1}if("prefferedExercise"===e)return(n.inputQnA.exercise.Yes||n.inputQnA.exercise.No)&&n.inputQnA.exercise.Yes&&0===n.inputQnA[e].length?($(t).text("please enter a value"),!1):n.inputQnA.exercise.No?(n.inputQnA[e]=" "," "):n.inputQnA[e];if(0===n.inputQnA[e].length&&"prefferedExercise"!=e)return $(t).text("please enter a value"),!1}return n.inputQnA[e]}}],windowClass:n.isMobileView?"bottom-sheet qnaWindow":"qnaWebWindow subsModal"})},openRaiseWalletQueryPopUp:function(e,t){l.open({animation:!0,templateUrl:t,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","apiProvider",function(e,t,o,a,i,n,r,s,l,u,d,c){
t.isMobileView=o.isMobileView,t.user=r.getUserObj(),t.ok=function(){e.dismiss("cancel")},t.query={email:t.user.userDetails.email||"",querySubject:null,queryText:null},t.isSubmitClicked=!1,t.isSubmitted=!1,t.updateQueryForm=function(){var e=/^.{10,100}$/,t=/^.{20,500}$/,o=/^(([^<>()\[\]\\.,;:\s@']+(\.[^<>()\[\]\\.,;:\s@']+)*)|('.+'))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;$("#inputqueryerr").text(""),$("#querysubmiterr").text(""),$("#inputqueryerremail").text("");var a=$("#querysubject").val(),i=$("#querybody").val(),n=$("#queryemail").val();""===n||o.test(n)?""===a||e.test(a)?""===i||t.test(i)?""!==a&&""!==i&&""!==n?($("#inputqueryerr").text(""),$("#inputqueryerrsubj").text(""),$(".querySubmit").prop("disabled",!1)):""!==a?$("#inputqueryerrsubj").text(""):""!==i?$("#inputqueryerr").text(""):""!==n&&$("#inputqueryerremail").text(""):($("#inputqueryerr ").text("minimum length should be 20"),$(".querySubmit").prop("disabled",!0)):($("#inputqueryerrsubj").text("minimum subject length should be 10"),$(".querySubmit").prop("disabled",!0)):($("#inputqueryerremail").text("invalid Email"),$(".querySubmit").prop("disabled",!0))},t.submitWalletQuery=function(){t.isSubmitClicked=!0;var o=t.user.corpDetails.employeeDetail&&t.user.corpDetails.employeeDetail.companyName?t.user.corpDetails.employeeDetail.companyName:"",i={email:t.query.email,userId:t.user.userDetails.userId,phoneNo:t.user.userDetails.phone,companyName:o,comment:t.query.queryText,description:t.query.querySubject,subject:"Important: Your Recent Transaction Inquiry",type:"Wallet Query",platform:"medibuddyWeb",group_id:36000353134};r.makeAjaxCalls(c.freshdesk+"/createUserTicket",i,"POST","",!1).then(function(o){o.data&&o.data.ticketId&&(t.isSubmitted=!0,a(function(){e.dismiss("cancel")},3e3))})}}],size:n.isMobileView?"login-new modal-bottom":"login-new",windowClass:n.isMobileView&&"bottom-sheet"});document.querySelector("header").classList.remove("sticky-header")},openResetPasswordPopUp:function(){l.open({animation:!0,templateUrl:"/templates/forgotPassowordUsernameDialog.html?"+timeStamp,controller:["$uibModalInstance","$scope","$rootScope","$timeout","patternService","authService","$window","$state","$uibModal","notify","$sce","$location",function(e,t,o,i,n,r,s,l,u,c,m,_){t.forgotPassowordUserDetails={email:"",username:""},t.validInput=!1,t.showForgotPassowordgetUserDetailsDialog=!0,$("#forgotPassowordUserDetailsError").text(""),t.forgotPassword=function(e){if(""!=t.forgotPassowordUserDetails.email){var o=d.emailIdRegex;if(!t.forgotPassowordUserDetails.email.match(o))return void $("#forgotPassowordUserDetailsError").text("Please enter a valid Email ID")}var i=g.get("_mp_user"),n="Pre_Login";null!=i&&(n="Post_Retail_Login");var r="By Username";""!=t.forgotPassowordUserDetails.email&&(r="By EmailId");try{var s={sessionId:localStorage.getItem("UniqSessionId"),auth_uuid:g.get("auth_uuid")||"",emailId:t.forgotPassowordUserDetails.email,username:t.forgotPassowordUserDetails.username,fpwd_type:r,domain:"medibuddy",event:"LF_FPWD_REQUEST_SUBMITTED",login_status:n},l=Object.assign({},s,{meta:JSON.stringify(s)});a.post(p.eventlogsUrl,l)}catch(u){console.log(u)}var c=p.apiUrl+"/ForgetPasswordV1",m={emailId:t.forgotPassowordUserDetails.email,userName:t.forgotPassowordUserDetails.username};a.post(c,m).then(function(e){if(console.log(e),"User_Not_Found"==e.data.status||"Multiple_User_Found"==e.data.status||"Mail_Not_Sent"==e.data.status)return void $("#forgotPassowordUserDetailsError").text(e.data.message);try{var o={sessionId:localStorage.getItem("UniqSessionId"),auth_uuid:g.get("auth_uuid")||"",domain:"medibuddy",event:"LF_FPWD_LINK_SENT",login_status:n,mbUserId:e.data.userId,userType:e.data.userType},i=Object.assign({},o,{meta:JSON.stringify(o)});a.post(p.eventlogsUrl,i)}catch(r){console.log(r)}t.showForgotPassowordgetUserDetailsDialog=!1})["catch"](function(e){$("#forgotPassowordUserDetailsError").text("We are experiencing technical issues. Please try again in some time"),console.log(e)})},t.clearEmailField=function(){t.forgotPassowordUserDetails.email="",t.checkValidity(),$("#forgotPassowordUserDetailsError").text("")},t.clearUsernameField=function(){t.forgotPassowordUserDetails.username="",t.checkValidity()},t.checkValidity=function(){t.validInput=""!=t.forgotPassowordUserDetails.email||""!=t.forgotPassowordUserDetails.username},t.closeDialogBox=function(){e.dismiss("cancel")}}],size:n.isMobileView?"bottom":"border modal-sm",windowClass:n.isMobileView&&"bottom-sheet"})},openIdealLoginPopup:function(e,t,a,i,r){if(a||(a={}),!P){P=!0;l.open({animation:!0,templateUrl:t,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","$sce",function(e,t,n,l,u,c,m,h,f,v,y,E){try{h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,hj:!0,name:"IDEAL_LOGIN_ENTRY_POINT_CLICKED",payload:h._Site_Props.__getEventParameters({custom:{medibuddyUserId:"",source:h.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:h.sessionStorage.getItem("branch_fingerprint")||"",triggeredFrom:r,entryPoint:h.location.href}})})}catch(b){console.log(b)}t.showResendLink=!1,t.disableLoginButton=!0,t.corpSubmitPhoneScreen="CORP_PHONE"==i,t.corpSubmitEmailScreen="CORP_EMAIL"==i,t.corpSubmitUsernameScreen="CORP_USERNAME"==i,t.corpSubmitUsernamePasswordScreen="CORP_USERNAME_PASSWORD"==i,t.corpSubmitPhoneOtpScreen="PHONE_OTP"==i,t.corpSubmitEmailOtpScreen="EMAIL_OTP"==i,t.corpSkipPhoneScreen="SKIP_PHONE"==i,t.corpLoginLoaderScreen="LOGIN_LOADER"==i,t.corpAccountVerified=!1,t.corpPhoneOtpVerified=!1,t.corpEmailOtpVerified=!1,t.corpUsernamePasswordVerified=!1,t.corpPhoneOtpSkipped=!1,t.isTPAMessage=!1,t.TPAMessage="",t.hideAnimation=!0,t.showPassword=!1,t.otpVerificationTime=1,t.otpDataId="",t.counter=30,t.entityId="",t.phone=null,t.name="",t.email="",t.errorMessage="";var S="",I=g.get("city");t.loginObj={username:"",password:""},h._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"Login/Signup",payload:h._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{itemSource:s.location.href}})}),t.emailOtpModel=[];for(var C=0;C<6;C++)t.emailOtpModel.push({value:"",name:"otp-field-"+C});t.phoneOtpModel=[];for(var C=0;C<4;C++)t.phoneOtpModel.push({value:"",name:"otp-field-"+C});t.validate=function(e,t){var o=new RegExp(c.getRegexExpression(t)),a=String.fromCharCode(e.charCode?e.charCode:e.which);if(!o.test(a)&&13!==e.charCode&&9!==e.charCode||1==e.target.value.length)return e.preventDefault(),!1},t.validatePhoneNumber=function(e,t){var o=new RegExp(c.getRegexExpression(t)),a=String.fromCharCode(e.charCode?e.charCode:e.which);if(!o.test(a)&&13!==e.charCode&&9!==e.charCode)return e.preventDefault(),!1},t.toggleShowPassword=function(e){t.showPassword=e},t.defaultFocus=function(){var e=null;t.corpSubmitPhoneOtpScreen||t.corpSubmitEmailOtpScreen?e=document.querySelector("#otp-field-0"):t.corpSubmitPhoneScreen?e=document.querySelector("#corpphone"):t.corpSubmitEmailScreen?e=document.querySelector("#corpemail"):t.corpSubmitUsernameScreen?e=document.querySelector("#username"):t.corpSubmitUsernamePasswordScreen&&(e=document.querySelector("#password")),e&&e.focus&&e.focus()},setTimeout(function(){t.defaultFocus()}),t.switchCorpLoginScreenTo=function(e,o){t.errorMessage="",t.corpSubmitPhoneScreen="CORP_PHONE"==e,t.corpSubmitEmailScreen="CORP_EMAIL"==e,t.corpSubmitUsernameScreen="CORP_USERNAME"==e,t.corpSubmitUsernamePasswordScreen="CORP_USERNAME_PASSWORD"==e,t.corpSubmitPhoneOtpScreen="PHONE_OTP"==e,t.corpSubmitEmailOtpScreen="EMAIL_OTP"==e,t.corpSkipPhoneScreen="SKIP_PHONE"==e,t.corpLoginLoaderScreen="LOGIN_LOADER"==e,t.corpSubmitPhoneScreen&&!o&&(t.disableLoginButton=!1,t.updateCorpMob()),t.corpSubmitEmailScreen&&!o&&(t.disableLoginButton=!1,t.updateEmailCorp()),t.corpSubmitUsernameScreen&&(t.disableLoginButton=!1),setTimeout(function(){t.defaultFocus()}),t.corpLoginLoaderScreen&&setTimeout(function(){t.okCorp()},1500)},t.skipCorpIdealLogin=function(){h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,hj:!0,name:"LF_IDEAL_LOGIN_CORP_LOGIN_SKIPPED",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,domain:"medibuddy",timeStamp:JSON.stringify((new Date).valueOf()),info:"IDEAL_LOGIN_SCREEN",loginScreenEvent:"Login Page"}})}),t.okCorp(!1)},t.openLearnMoreSection=function(){h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,hj:!0,name:"LF_IDEAL_LOGIN_LEARN_MORE",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,domain:"medibuddy",timeStamp:JSON.stringify((new Date).valueOf()),info:"IDEAL_LOGIN_SCREEN",loginScreenEvent:"Login Page"}})}),t.switchCorpLoginScreenTo("SKIP_PHONE")},t.continueVerification=function(){h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,hj:!0,name:"LF_IDEAL_LOGIN_CONTINUE_VERIFICATION",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,domain:"medibuddy",timeStamp:JSON.stringify((new Date).valueOf()),info:"IDEAL_LOGIN_SCREEN",loginScreenEvent:"Login Page"}})}),t.switchCorpLoginScreenTo("CORP_PHONE")},t.handleBackFlow=function(){t.corpSubmitPhoneScreen&&(t.okCorp(),m.openLoginPopup("lg","templates/openLoginPopUpnew.html?"+timeStamp)),t.corpSubmitPhoneOtpScreen&&t.switchCorpLoginScreenTo("CORP_PHONE"),t.corpSubmitEmailScreen&&t.corpPhoneOtpSkipped&&(t.corpPhoneOtpVerified=!1,t.corpPhoneOtpSkipped=!1,t.switchCorpLoginScreenTo("CORP_PHONE")),t.corpSubmitEmailOtpScreen&&t.switchCorpLoginScreenTo("CORP_EMAIL"),t.corpSubmitUsernameScreen&&t.switchCorpLoginScreenTo("CORP_EMAIL"),t.corpSubmitUsernamePasswordScreen&&t.switchCorpLoginScreenTo("CORP_EMAIL")},t.updateCorpMob=function(){t.phone=$("#corpphone").val();var e=/^[1-9]{1}[0-9]{9}$/;$("#corpphone").removeClass("input-error"),t.errorMessage="",e.test(t.phone)?t.disableLoginButton=!1:(t.errorMessage="Please enter valid 10 digit number",t.disableLoginButton=!0)},t.updateEmailCorp=function(){t.email=$("#corpemail").val();var e=/^(([^<>()\[\]\\.,;:\s@']+(\.[^<>()\[\]\\.,;:\s@']+)*)|('.+'))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if($("#corpemail").removeClass("input-error"),t.errorMessage="",t.email&&!e.test(t.email))t.errorMessage="Please enter a valid email ID",t.disableLoginButton=!0;else{var o=t.email?t.email.split("@"):[];o.length&&T.includes(o[1])?(t.errorMessage="Please enter valid Corporate Email",t.disableLoginButton=!0):(t.errorMessage="",t.disableLoginButton=!1)}},t.validateKeyDown=function(e,o,a){var i;if("Backspace"==e.key)if("phone"==o)if(""!==t.phoneOtpModel[a].value&&void 0!==t.phoneOtpModel[a].value){t.phoneOtpModel[a].value="";var n=document.querySelector(".input-otp #"+t.phoneOtpModel[a].name);n&&n.focus&&n.focus()}else{var r=0===a?0:a-1;t.phoneOtpModel[r].value="";var n=document.querySelector(".input-otp #"+t.phoneOtpModel[r].name);n&&n.focus&&n.focus()}else if("email"==o)if(""!==t.emailOtpModel[a].value&&void 0!==t.emailOtpModel[a].value){t.emailOtpModel[a].value="";var n=document.querySelector(".input-otp #"+t.emailOtpModel[a].name);n&&n.focus&&n.focus()}else{var r=0===a?0:a-1;t.emailOtpModel[r].value="";var n=document.querySelector(".input-otp #"+t.emailOtpModel[r].name);n&&n.focus&&n.focus()}"Enter"==e.key&&(i="phone"==o?t.phoneOtpModel.find(function(e){return""===e.value||void 0===e.value}):t.emailOtpModel.find(function(e){return""===e.value||void 0===e.value}),i||("phone"==o?t.submitCorpUserPhoneOTP(!0):t.submitCorpUserEmailOTP(!0)))},t.focusNextInput=function(e){var o,a,i,n=null;"phone"==e?t.phoneOtpModel.forEach(function(e){if(a=null!=n?n:e.value){var t=new RegExp(c.getRegexExpression("integerchk"));t.test(+a)?(i=a.toString(),e.value=+i[0],n=i.slice(1)?i.slice(1):null):(e.value=null,n=null)}}):t.emailOtpModel.forEach(function(e){if(a=null!=n?n:e.value){var t=new RegExp(c.getRegexExpression("integerchk"));t.test(+a)?(i=a.toString(),e.value=+i[0],n=i.slice(1)?i.slice(1):null):(e.value=null,n=null)}});var o="phone"==e?t.phoneOtpModel.find(function(e){return""===e.value||void 0===e.value}):t.emailOtpModel.find(function(e){return""===e.value||void 0===e.value});if(o){var r=document.querySelector(".input-otp #"+o.name);r&&r.focus&&(r.focus(),$("#otp-field-0").removeClass("input-error"),$("#otp-field-1").removeClass("input-error"),$("#otp-field-2").removeClass("input-error"),$("#otp-field-3").removeClass("input-error"),$("#otp-field-0").addClass("border-blue"),$("#otp-field-1").addClass("border-blue"),$("#otp-field-2").addClass("border-blue"),$("#otp-field-3").addClass("border-blue"),"email"==e&&($("#otp-field-4").removeClass("input-error"),$("#otp-field-5").removeClass("input-error"),$("#otp-field-4").addClass("border-blue"),$("#otp-field-5").addClass("border-blue"))),$(".verifyBtn").prop("disabled",!0)}else"phone"==e?document.querySelector("#otp-field-3").focus():document.querySelector("#otp-field-5").focus(),$(".verifyBtn").prop("disabled",!1)},t.stopTimerCorp=function(){clearInterval(S),t.counter=30,t.showResendLink=!0},t.otpVerifyCorp=function(e){t.otpDataId=e,t.showResendLink=!1,t.counter=60,$(".timer").html(""),t.errorMessage="",setTimeout(function(){$("#otp").val("")},100),S=setInterval(function(){$(".timer").text(t.counter+"s"),t.counter--,1===t.counter&&(t.showResendLink=!0,t.stopTimerCorp())},1e3)},t.okCorp=function(){try{h._MB_Analytics.__push({branchLog:{name:"corporateLoginBackButtonClicked",custom_data:{medibuddyUserId:"",source:h.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:h.sessionStorage.getItem("branch_fingerprint")||"",entryPoint:h.location.href}}})}catch(o){console.log(o)}e.dismiss("cancel"),P=!1,t.counter=30,t.stopTimerCorp(),t.user=m.getUserObj(),t.user&&t.user.token&&t.user.userDetails||(m.insuranceSelected=!1,"app.covidVaccination"==f.current.name&&f.go("app.home",{reload:!1}))},t.TPAErrorMessage=function(e){t.isTPAMessage=!0,t.TPAMessage=e?e:"Oops! You need to login through "},t.openUsernameScreen=function(){h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_TO_USERPWD_REDIRECTION",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),t.switchCorpLoginScreenTo("CORP_USERNAME")},t.openUsernameScreen=function(){h._MB_Analytics.__push({excludeCleverTap:"true",dbLog:!0,name:"LF_USERNAME_LOGIN_INITATE",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,screen:"USERNAME_PWD_SCREEN"}})}),t.switchCorpLoginScreenTo("CORP_USERNAME")},t.emailToSSORedirection=function(e,o,a){u.post("https://infi-node.medibuddy.in/mobile/redirecturl",{username:o}).then(function(i){if(i.data.ssoRedirect&&i.data.singleSignOnUrl)h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_REDIRECT_TO_TPA_SSO",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:o,corporateDomain:o.split("@")[1]}})}),console.log("emailToSSORedirection **** ==>",i.data),h.location.href=i.data.singleSignOnUrl;else{if("EMAIL_OTP_SCREEN_PWD_REDIRECTION"==e)return void t.openUsernameScreen();t.showCustomError(a.errorMessageDisplay?a.errorMessageDisplay:d.errorMessages.nudgeToUsernamePassword)}})["catch"](function(e){t.openUsernameScreen()})},t.initiateOtpFlow=function(e){e&&h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_RETRY",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0}})});var o=$("#email").val()?$("#email").val():t.email;try{if(h.location.href===p.siteUrl){var a={screen:"Login",appVersion:"",domain:"medibuddyInweb",event:"corporateLoginOtpRequested",email:t.email,auth_uuid:g.get("auth_uuid")||void 0},i=Object.assign({},a,{meta:JSON.stringify(a)});u.post(p.eventlogsUrl,i)}h._MB_Analytics.__push({branchLog:{name:"corporateLoginOtpRequested",custom_data:{medibuddyUserId:"",source:h.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:h.sessionStorage.getItem("branch_fingerprint")||"",email:o,entryPoint:h.location.href}}})}catch(n){console.log(b)}var r={corporateEmailAddress:o},s=p.apiUrl+"/SendEmailOTPForLogin";$("#email").val()&&(t.email=$("#email").val()),u.post(s,r,{headers:{"Content-Type":"application/json"}}).then(function(e){h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_SENT",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),t.otpVerifyCorp(t.otpDataId)})["catch"](function(e){h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_NOT_SENT",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",corporateDomain:t.email.split("@")[1]}})}),console.log(e)})},t.showRegistrationWindow=function(){return h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_SHOW_SELF_REGISTRATION_FORM",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"Login Page",email:t.email}})}),t.okCorp(),m.openRegistrationPopup("lg","templates/openRegistrationPopup.html?"+timeStamp,{email:t.email,entityId:t.entityId,phone:t.phone})},t.routeToResetPasswordDialog=function(){t.loginObj.username="";try{var e="Pre_Login",o=g.get("_mp_user");null!=o&&(e="Post_Retail_Login");var a={sessionId:localStorage.getItem("UniqSessionId"),auth_uuid:g.get("auth_uuid")||"",domain:"medibuddy",event:"LF_FPWD_INITIATE",login_status:e},i=Object.assign({},a,{meta:JSON.stringify(a)});u.post(p.eventlogsUrl,i)}catch(n){console.log(n)}t.okCorp(),m.openResetPasswordPopUp()},t.skipCorpUserPhone=function(){h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,hj:!0,name:"LF_IDEAL_LOGIN_SKIP",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,domain:"medibuddy",timeStamp:JSON.stringify((new Date).valueOf()),info:"IDEAL_LOGIN_SCREEN",loginScreenEvent:"Login Page"}})}),t.corpPhoneOtpVerified=!1,t.corpPhoneOtpSkipped=!0,t.hideAnimation=!1,setTimeout(function(){t.hideAnimation=!0},500),t.switchCorpLoginScreenTo("CORP_EMAIL")},t.submitCorpUserPhone=function(e){if(e){$("#corpphone").val()?$("#showphone").text($("#email").val()):($("#showphone").append(t.phone),t.phone=$("#corpphone").val()),$("#corpphone").removeClass("input-error"),$(".verifyBtn").prop("disabled",!1),t.counter=30,t.stopTimerCorp();var o=g.get("_mp_user"),a=o&&o.userDetails&&o.userDetails.userId||null,i={source:"medibuddyInWeb",platform:"medibuddy",phonenumber:$("#corpphone").val()?$("#corpphone").val():t.phone,flow:"Ideal-Login-Flow",isMandatoryMobile:!1,advertiserId:h.localStorage.getItem("UniqSessionId"),mbUserId:a,idealLoginFlow:!0},n=p.unifiedLogin+"unified-login/user/register";u.post(n,i,{headers:{"Content-Type":"application/json"}}).then(function(e){var o=e.data;o.success?(t.otpDataId=o.data.otpDataId,t.otpVerifyCorp(t.otpDataId),t.switchCorpLoginScreenTo("PHONE_OTP")):t.errorMessage=o.errorText})["catch"](function(e){console.log(e)})}else $("#corpphone").addClass("input-error"),t.errorMessage="Please enter correct Phone Number",$("#corpphonelabel").css("color","red")},t.submitCorpUserPhoneOTP=function(e){if(e){$(".verifyBtn").prop("disabled",!0);var i=g.get("_mp_user"),r=i&&i.userDetails&&i.userDetails.userId||null,s=(1e3*$("#otp-field-0").val()+100*$("#otp-field-1").val()+10*$("#otp-field-2").val()+1*$("#otp-field-3").val()).toString(),l={source:"medibuddyInWeb",platform:"medibuddy",otp:s,otpDataId:t.otpDataId,phonenumber:t.phone,advertiserId:h.localStorage.getItem("UniqSessionId"),imei:"MediBuddy_3b82314e-c6ae-4839-b50b-a9e4e64c6f65",version:"3.1.62",name:t.name,email:t.email,isMandatoryMobile:!1,corpToken:g.get("corpToken")||void 0,mbUserId:r},d=p.unifiedLogin+"user/idealLogin/verifyotp";u.post(d,l,{headers:{"Content-Type":"application/json"}}).then(function(e){var i=e.data;$(".verifyBtn").prop("disabled",!1),i.isSuccess?(g.set("patientId",i.patientId),g.set("daservertoken",i.daservertoken),g.set("auth_uuid",i.auth_uuid),g.set("refreshToken",i.refreshToken),g.set("accessToken",i.accessToken),g.set("mbServerToken",i.longtoken),g.set("shortToken",i.user.token),document.cookie="mbServerToken="+i.longtoken+"; domain="+o.getCookieDomain(),document.cookie="refreshToken="+i.refreshToken+"; domain="+o.getCookieDomain(),document.cookie="accessToken="+i.accessToken+"; domain="+o.getCookieDomain(),document.cookie="shortToken="+i.user.token+"; domain="+o.getCookieDomain(),document.cookie="redirect="+i.user.token+"; domain="+o.getCookieDomain(),i.user.userDetails&&i.user.userDetails.pmEntityID&&(document.cookie="pmEntityId="+i.user.userDetails.pmEntityID+"; domain="+o.getCookieDomain()),"retail"==i.userProfile&&(g.set("retailMbId",i.user.userDetails.userId),g.set("retailToken",i.longtoken)),m.loggedUserName=i.user.userDetails.firstName,m.setUserObj(_.extend(i.user,{patientId:i.patientId,isRetailLabsFlowEnabled:i.isRetailLabsFlowEnabled})),n.$emit("userLogin",a),a.controller&&("authService"==a.controller&&a.func?m[a.func].apply(null,a.args):n.$broadcast(a.controller,a)),n.$broadcast("search",""),t.corpPhoneOtpVerified=!0,t.hideAnimation=!1,setTimeout(function(){t.hideAnimation=!0},500),t.corpPhoneOtpSkipped=!1,i.isCorporateLinked?t.switchCorpLoginScreenTo("LOGIN_LOADER"):t.switchCorpLoginScreenTo("CORP_EMAIL")):t.errorMessage=i.errorText})["catch"](function(e){$(".verifyBtn").prop("disabled",!1)})}else t.errorMessage="Please enter correct OTP"},t.submitCorpUserEmail=function(e){if(e)try{var o=$("#corpemail").val()?$("#corpemail").val():t.email;if(e){$("#corpemail").val()?($("#showemail").text($("#corpemail").val()),t.email=$("#corpemail").val()):$("#showemail").append(t.email),$("#corpemail").removeClass("input-error"),t.counter=30,t.stopTimerCorp();var a={flow:"Ideal-Login-Flow",auth_uuid:g.get("auth_uuid")||null,idealLoginFlow:!0,corporateEmailAddress:o,version:"v1"},i=p.apiUrl+"/CheckEmailOTPLoginLaunch";u.post(i,a,{headers:{"Content-Type":"application/json"}}).then(function(e){var o=e.data;if(h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_REQUEST",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),o.isSuccess){var a=o.checkTpAorNonTpaUserResponse&&o.checkTpAorNonTpaUserResponse.reasonType?o.checkTpAorNonTpaUserResponse.reasonType:0,i=o.checkTpAorNonTpaUserResponse&&o.checkTpAorNonTpaUserResponse.userType?o.checkTpAorNonTpaUserResponse.userType:"NonTPAUser";if("Allow EmailOTP"===o.clientAction)h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ENABLED",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,screen:"Email_Login",loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_PRESENT_IN_MB",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),"TPAUser"==i?h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_TPA",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}):h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_NON_TPA",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),t.initiateOtpFlow(),t.switchCorpLoginScreenTo("EMAIL_OTP");else if("Highlight UserNameAndPassword Flow"===o.clientAction){if(5==a?h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_PRESENT_IN_MB",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}):8==a?(h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ENABLED",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,screen:"Email_Login",loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_PRESENT_IN_MB",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_TPA",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_MULTIPLE_LOGINS",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",userEmail:t.email,corporateDomain:t.email.split("@")[1]}})}),t.emailToSSORedirection("EMAIL_OTP_SCREEN",t.email,o)):1==a&&h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_ABSENT_IN_MB",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),"TPAUser"==i?(h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_TPA",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),t.emailToSSORedirection("EMAIL_OTP_SCREEN",t.email,o)):"NonTPAUser"==i&&h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_NON_TPA",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),[10].includes(a))return h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ENABLED",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,screen:"Email_Login",loginScreenEvent:"EMAIL_OTP_SCREEN",emailid:t.email,corporateDomain:t.email.split("@")[1]}})}),h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_PRESENT_IN_MB",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_NON_TPA",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_MULTIPLE_LOGINS",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",userEmail:t.email,corporateDomain:t.email.split("@")[1]}})}),void t.showCustomError(o.errorMessageDisplay?o.errorMessageDisplay:d.errorMessages.nudgeToUsernamePassword);var n=p.infinitiNode+"/mobile/redirecturl";u.post(n,{username:t.email},{headers:{"Content-Type":"application/json"}}).then(function(e){if(e.data.ssoRedirect){console.log("res.data ****",e.data),h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_REDIRECT_TO_TPA_SSO",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})});var o=e.data.singleSignOnUrl;s.location.href=o}else t.showCustomError(e.errorMessageDisplay?e.errorMessageDisplay:d.errorMessages.nudgeToUsernamePassword)})["catch"](function(e){t.showCustomError(o.errorMessageDisplay?o.errorMessageDisplay:d.errorMessages.nudgeToUsernamePassword)})}else if("Redirect To SSO"===o.clientAction){var n=o.ssoUrl;if(n){try{if(h.location.href===p.siteUrl){var r={screen:"Login",appVersion:"",domain:"medibuddyInweb",event:"SSOredirection",email:t.email,auth_uuid:g.get("auth_uuid")||void 0},l=Object.assign({},r,{meta:JSON.stringify(r)});u.post(p.eventlogsUrl,l)}}catch(c){console.log(c)}h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_REDIRECT_TO_NONTPA_SSO",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),t.okCorp(),h.open(n,"_blank").focus()}else t.showCustomError(o.errorMessageDisplay?o.errorMessageDisplay:d.errorMessages.nudgeToUsernamePassword)}else"Show Error Message"===o.clientAction?(h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ERR_MSG",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),t.showCustomError(o.errorMessageDisplay?o.errorMessageDisplay:d.errorMessages.nudgeToUsernamePassword)):"Show Registration Page"===o.clientAction?(h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ENABLED",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,screen:"Email_Login",loginScreenEvent:"EMAIL_OTP_SCREEN",emailid:t.email,corporateDomain:t.email.split("@")[1]}})}),h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_ABSENT_IN_MB",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_NON_TPA",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_SELFREG_FORM_OPEN_REQ",payload:h._Site_Props.__getEventParameters({custom:{screen:"Corp_login",appVersion:"",domain:"medibuddyInWeb",event:"LF_SELFREG_FORM_OPEN_REQ",advertiserId:h.sessionStorage.getItem("branch_fingerprint"),email:t.email,auth_uuid:g.get("auth_uuid")||void 0}})}),t.initiateOtpFlow(),t.entityId=o.checkTpAorNonTpaUserResponse.pM_EntityId,t.isRegistration=!0,t.switchCorpLoginScreenTo("EMAIL_OTP")):(9==a&&h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ENABLED",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),"TPAUser"==i?(h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_ABSENT_IN_MB",
payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_TPA",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),9==a?t.emailToSSORedirection("DISPLAY_ERROR_MESSAGE",t.email,o):t.emailToSSORedirection("EMAIL_OTP_SCREEN_PWD_REDIRECTION",t.email)):t.showCustomError(o.errorMessageDisplay?o.errorMessageDisplay:d.errorMessages.nudgeToUsernamePassword))}else"NonTPA_UserNotFound"==o.errorMessage&&(h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ENABLED",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_ABSENT_IN_MB",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})})),t.showCustomError(o.errorMessageDisplay?o.errorMessageDisplay:d.errorMessages.nudgeToUsernamePassword)})["catch"](function(e){return t.showCustomError(d.errorMessages.apiError),!1})}}catch(n){}else{$("#corpemail").addClass("input-error"),t.errorMessage="Please enter correct Email ID",$("#corpemaillabel").css("color","red");try{h._MB_Analytics.__push({branchLog:{name:"corporateLoginInvalidEmailEntered",custom_data:{medibuddyUserId:"",source:h.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:h.sessionStorage.getItem("branch_fingerprint")||"",email:$("#email").val()?$("#email").val():t.email,entryPoint:h.location.href}}})}catch(n){console.log(n)}}},t.submitCorpUserEmailOTP=function(e){if(e){$(".verifyBtn").prop("disabled",!0);var i=(1e5*$("#otp-field-0").val()+1e4*$("#otp-field-1").val()+1e3*$("#otp-field-2").val()+100*$("#otp-field-3").val()+10*$("#otp-field-4").val()+1*$("#otp-field-5").val()).toString(),r={corporateEmailAddress:t.email,otp:i,isEmailOTPLogin:!0},s=p.apiUrl+"/MarketPlaceLogon";u.post(s,r,{headers:{"Content-Type":"application/json",Platform:"web"}}).then(function(e){e&&e.data&&e.data.user&&e.data.user.token&&(document.cookie="redirect="+e.data.user.token+"; domain="+o.getCookieDomain(),e.data.user.userDetails&&e.data.user.userDetails.pmEntityID&&(document.cookie="pmEntityId="+e.data.user.userDetails.pmEntityID+"; domain="+o.getCookieDomain()));var r=e.data;if($(".verifyBtn").prop("disabled",!1),h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_VERIFY_INITIATE",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginEventScreen:"OTP Screen"}})}),r.isSuccess){h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_VERIFY_SUCCESS",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginEventScreen:"EMAIL_OTP_SCREEN"}})}),h._MB_Analytics.__push({name:"corpLoginOtpVerified",branchLog:{name:"corporateLoginOtpVerificationSuccessful",custom_data:{medibuddyUserId:"",source:h.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:h.sessionStorage.getItem("branch_fingerprint")||"",email:$("#email").val()?$("#email").val():t.email,otpEntered:i,entryPoint:h.location.href}}}),m.loggedUserName=r.user.userDetails.firstName,m.setUserObj(_.extend(r.user,{isRetailLabsFlowEnabled:r.isRetailLabsFlowEnabled})),t.corpAccountVerified=!0;var s=1500;g.set("delayForMandatoryPopup",s),setTimeout(function(){t.okCorp()},s),t.corpEmailOtpVerified=!0,a.controller&&("authService"==a.controller&&a.func?m[a.func].apply(null,a.args):n.$broadcast(a.controller,a)),n.$broadcast("search",""),m.getuserLongToken(r.user.token).then(function(e){e.data.isSuccess&&e.data.encryptedToken&&(document.cookie="mbServerToken="+e.data.encryptedToken+"; domain="+o.getCookieDomain(),g.set("corpToken",e.data.encryptedToken),m.getEncryptedTokenForLinking({corpToken:e.data.encryptedToken,corpMbId:r.user.userDetails.userId}).then(function(e){n.$emit("userLogin",a)}))})["catch"](function(e){console.log("Error Occured",e.message),n.$emit("userLogin",a)})}else{if(t.isRegistration&&"Oops, Looks like your corporate data is not present with us. Please check your username once again. Please connect with your HR or contact Medibuddy customer support to get your correct username"===r.errorMessage)return h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_VERIFY_SUCCESS",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginEventScreen:"EMAIL_OTP_SCREEN"}})}),void t.showRegistrationWindow();h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_VERIFY_FAILED",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginEventScreen:"EMAIL_OTP_SCREEN"}})}),t.otpVerificationTime+=1,t.otpVerificationTime>=4&&!g.get(obj.userDetails)?t.errorMessage="Sorry, We are not able to connect your corporate account. Please use your phone number to login and use other services.":t.errorMessage=r.errorMessage,$("#otp-field-0").removeClass("border-blue"),$("otp-field-1").removeClass("border-blue"),$("#otp-field-2").removeClass("border-blue"),$("#otp-field-3").removeClass("border-blue"),$("#otp-field-4").removeClass("border-blue"),$("#otp-field-5").removeClass("border-blue"),$("#otp-field-0").addClass("input-error"),$("#otp-field-1").addClass("input-error"),$("#otp-field-2").addClass("input-error"),$("#otp-field-3").addClass("input-error"),$("#otp-field-4").addClass("input-error"),$("#otp-field-5").addClass("input-error");try{h._MB_Analytics.__push({branchLog:{name:"corporateLoginOtpErrorReceived",custom_data:{medibuddyUserId:"",source:h.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:h.sessionStorage.getItem("branch_fingerprint")||"",email:$("#email").val()?$("#email").val():t.email,otpEntered:i,entryPoint:h.location.href,errorMessage:r.errorMessage}}})}catch(l){console.log(l)}}t.corpEmailOtpVerified=!1})["catch"](function(e){t.corpEmailOtpVerified=!1,$(".verifyBtn").prop("disabled",!1),e.data?t.errorMessage="Something went wrong. Please try again after sometime":t.errorMessage="Please check the entered Email ID"})}else t.errorMessage="Please enter valid OTP"},t.submitCorpUserUsername=function(e){e?u.post(p.infinitiNode+"mobile/checkTPAorNonTPAUser",{flow:"Ideal-Login-Flow",auth_uuid:g.get("auth_uuid")||null,idealLoginFlow:!0,userName:t.loginObj.username}).then(function(e){return 204==e.status?void t.checkNonTPA():(h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USERNAME_SUBMIT",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.username}})}),void("Show Registration Page"==e.data.clientAction?(t.entityId=e.data.checkTpAorNonTpaUserResponse.pM_EntityId,t.showRegistrationWindow()):"TPAUser"==e.data.userType?(3==e.data.reasonType?(h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_PRESENT_IN_MB",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.username}})}),h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_TPA",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.username}})})):1==e.data.reasonType&&h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_ABSENT_IN_MB",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.username}})}),t.ssoRedirectFnt(t.loginObj.username)):(h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_NON_TPA",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.username}})}),5!=e.data.reasonType&&4!=e.data.reasonType||h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_PRESENT_IN_MB",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.username}})}),t.isNonTPAUser=!0,t.switchCorpLoginScreenTo("CORP_USERNAME_PASSWORD"))))})["catch"](function(e){t.TPAErrorMessage()}):($("#username").addClass("input-error"),t.errorMessage="Please enter valid user name",$("#corpusernamelabel").css("color","red"))},t.ssoRedirectFnt=function(){u.post("https://infi-node.medibuddy.in/mobile/redirecturl",{username:t.loginObj.username}).then(function(e){e.data.ssoRedirect&&e.data.singleSignOnUrl?(h.location.href=e.data.singleSignOnUrl,h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USRNAME_REDIRECT_TO_TPA_SSO",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN"}})})):(t.isTPAUser=!0,t.switchCorpLoginScreenTo("CORP_USERNAME_PASSWORD"))})["catch"](function(e){t.TPAErrorMessage()})},t.submitCorpUserUsernamePassword=function(e){e?(t.isTPAUser?t.tpaLogin():t.nonTpaLogin(e),t.corpUsernamePasswordVerified=!0):($("#username").addClass("input-error"),$("#usernameLoginerr").text("Please enter correct Email ID"))},t.encryptPayLoad=function(e){var t="ABEiM0RVZneImaq7zN3u/wABEiM0RV==",o="ABEiM0RVZneImaq7";t=h.CryptoJS.enc.Utf8.parse(t),o=h.CryptoJS.enc.Utf8.parse(o);var a=h.CryptoJS.AES.encrypt(e,t,{iv:o});return a.toString()},t.nonTpaLogin=function(e){var i={username:t.loginObj.username,password:t.loginObj.password};t.stopTimerCorp(),h._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsLoginSubmit"});var r=p.apiUrl+"MarketPlaceLogon";u.post(r,i,{headers:{"Content-Type":"application/json",City:I,Platform:"web"}}).then(function(e){var i=e.data;if(e.data.isSuccess){m.loggedUserName=t.loginObj.username,m.setUserObj(_.extend(e.data.user,{isRetailLabsFlowEnabled:e.data.isRetailLabsFlowEnabled})),e&&e.data&&e.data.user&&e.data.user.token&&(document.cookie="redirect="+e.data.user.token+"; domain="+o.getCookieDomain()),t.corpAccountVerified=!0;var r=1500;g.set("delayForMandatoryPopup",r),setTimeout(function(){t.okCorp()},r),a.controller&&("authService"==a.controller&&a.func?m[a.func].apply(null,a.args):n.$broadcast(a.controller,a)),n.$broadcast("search",""),m.getuserLongToken(i.user.token).then(function(e){e.data.isSuccess&&e.data.encryptedToken&&(document.cookie="mbServerToken="+e.data.encryptedToken+"; domain="+o.getCookieDomain(),g.set("corpToken",e.data.encryptedToken),m.getEncryptedTokenForLinking({corpToken:e.data.encryptedToken,corpMbId:i.user.userDetails.userId}).then(function(e){n.$emit("userLogin",a)}))})["catch"](function(e){console.log("Error Occured",e.message),n.$emit("userLogin",a)})}else"User OTP Not Verified"===e.data.errorMessage?(t.guid=e.data.tokenForLoginModel,t.signinUp(),t.verifyOtpRegUser=!0,t.sendOtp({})):(console.log(e.data.errorMessage),t.loginErrorMsg="Sorry, We are not able to connect your corporate account. Please use your phone number to login and use other services.",$("#corplogerr").text(e.data.errorMessage),t.usersigninedinFailed())})},t.tpaLogin=function(){t.encryptUserName=t.encryptPayLoad(t.loginObj.username),t.encryptPassWord=t.encryptPayLoad(t.loginObj.password);var e={encPassword:t.encryptPassWord,encUserName:t.encryptUserName};u.post(p.infinitiNode+"mobile/authenticate",e).then(function(e){if(204==e.status)return void t.tpaLogin();if(h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USRNAME_PWD_SUBMIT",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),e.data.isSuccess&&e.data.authServerToken){e&&e.data&&e.data.user&&e.data.user.token&&(document.cookie="redirect="+e.data.user.token+"; domain="+o.getCookieDomain(),e.data.user.userDetails&&e.data.user.userDetails.pmEntityID&&(document.cookie="pmEntityId="+e.data.user.userDetails.pmEntityID+"; domain="+o.getCookieDomain())),h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_TPA_AUTHENTICATE_SUCCESS",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USERNAME_LOGIN_SUCCESS",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})});var i=e.data.authServerToken,r=p.apiUrl+"MarketPlaceLogon",s={isSSOLogin:!0,authServerAccessToken:e.data.authServerToken};u.post(r,s,{headers:{"Content-Type":"application/json",City:I}}).then(function(e){e&&e.data&&e.data.user&&e.data.user.token&&(document.cookie="redirect="+e.data.user.token+"; domain="+o.getCookieDomain(),document.cookie="mbServerToken="+i+"; domain="+o.getCookieDomain(),e.data.user.userDetails&&e.data.user.userDetails.pmEntityID&&(document.cookie="pmEntityId="+e.data.user.userDetails.pmEntityID+"; domain="+o.getCookieDomain()));var r=e.data;if(e.data.isSuccess){m.loggedUserName=t.loginObj.userMBName,m.setUserObj(_.extend(e.data.user,{isRetailLabsFlowEnabled:e.data.isRetailLabsFlowEnabled})),t.corpAccountVerified=!0;var s=1500;g.set("delayForMandatoryPopup",s),setTimeout(function(){t.okCorp()},s),a.controller&&("authService"==a.controller&&a.func?m[a.func].apply(null,a.args):n.$broadcast(a.controller,a)),n.$broadcast("search",""),m.getuserLongToken(r.user.token).then(function(e){e.data.isSuccess&&e.data.encryptedToken&&(g.set("corpToken",e.data.encryptedToken),m.getEncryptedTokenForLinking({corpToken:e.data.encryptedToken,corpMbId:r.user.userDetails.userId}).then(function(e){n.$emit("userLogin",a)}))})["catch"](function(e){console.log("Error Occured",e.message),n.$emit("userLogin",a)})}else t.loginErrorMsg=e.data.errorMessage,t.usersigninedinFailed()})["catch"](function(e){t.loginErrorMsg=e.data.errorMessage?e.data.errorMessage:"We are facing technical issues, Please login after some time",t.usersigninedinFailed()})}else e.data.isSuccess&&!e.data.isEmailVerified?(h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_TPA_AUTHENTICATE_EMAIL_NOT_VERIFIED",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),t.TPAErrorMessage("You need to verify your email ")):e.data.isSuccess&&!e.data.authServerToken?(h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_TPA_AUTHENTICATE_TOKEN_ABSENT",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),t.TPAErrorMessage()):(h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_TPA_AUTHENTICATE_FAILED",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName,errorReason:e.data.message}})}),t.loginErrorMsg=e.data.message,t.usersigninedinFailed())})["catch"](function(e){h._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USRNAME_PWD_SUBMIT",payload:h._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),t.loginErrorMsg=e&&e.data&&"Not Found"!=e.data.message?e.data.message:null,t.loginErrorMsg?t.usersigninedinFailed():t.TPAErrorMessage()})},t.usersigninedinFailed=function(){t.isPasswordWrong=!0},t.showCustomError=function(e){e||(e="Internal Server Error"),$("#email").addClass("input-error"),t.errorMessage=e,$("#corpemaillabel").css("color","red");try{if("https://www.medibuddy.in/"===h.location.href){var o={screen:"Login",appVersion:"",domain:"medibuddyInweb",event:"errLoginHRPortal",email:t.email,auth_uuid:g.get("auth_uuid")||void 0},a=Object.assign({},o,{meta:JSON.stringify(o)});u.post(p.eventlogsUrl,a)}}catch(i){console.log(i)}}}],size:n.isMobileView?"login-new modal-bottom":"login-new",windowClass:n.isMobileView&&"bottom-sheet"})}document.querySelector("header").classList.remove("sticky-header")},openLoginPopupCorp:function(e,t,a,i){if(a||(a={}),!P){P=!0;l.open({animation:!0,templateUrl:t,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","$sce",function(e,t,n,r,l,u,c,m,h,f,v,y){$(".loginBtn").prop("disabled",!0);try{m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,hj:!0,name:"CORP_LOGIN_ENTRY_POINT_CLICKED",payload:m._Site_Props.__getEventParameters({custom:{medibuddyUserId:"",source:m.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:m.sessionStorage.getItem("branch_fingerprint")||"",triggeredFrom:i,entryPoint:m.location.href}})})}catch(E){console.log(E)}t.loginScreen=!1,t.linkAccountScreen=!0,t.showResendLink=!1,t.loginMedibuddyCheck=!0,t.tpoerrorMessage=!1,t.otpEnterScreen=!0,t.showRetailLogin=!0,t.otpVerificationTime=1,t.otpDataId="",t.counter=30,t.entityId="",t.phone="",t.name="",t.email="",t.hideotpshare=!1;var b="";t.isValidate=!0,t.mailId="";var S=g.get("city");t.emailPattern=u,t.loginObj={userName:"",password:""},t.gender={M:"Male",F:"Female"},m._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"Login/Signup",payload:m._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{itemSource:s.location.href}})}),t.isNewLogin=!0,setTimeout(function(){$("#email").focus()}),t.otpModel=[];for(var I=0;I<6;I++)t.otpModel.push({value:"",name:"otp-field-"+I});t.validate=function(e,t){var o=new RegExp(u.getRegexExpression(t)),a=String.fromCharCode(e.charCode?e.charCode:e.which);if(!o.test(a)&&13!==e.charCode&&9!==e.charCode||1==e.target.value.length)return e.preventDefault(),!1},t.validateKeyDown=function(e,o){var a;if("Backspace"==e.key)if(""!==t.otpModel[o].value&&void 0!==t.otpModel[o].value){t.otpModel[o].value="";var i=document.querySelector(".input-otp #"+t.otpModel[o].name);i&&i.focus&&i.focus()}else{var n=0===o?0:o-1;t.otpModel[n].value="";var i=document.querySelector(".input-otp #"+t.otpModel[n].name);i&&i.focus&&i.focus()}"Enter"==e.key&&(a=t.otpModel.find(function(e){return""===e.value||void 0===e.value}),a||t.loginuserbyOtpVerifyCorp(!0))},t.defaultFocus=function(){var e=null;e=t.otpEnterScreen?t.linkAccountScreen?document.querySelector("#email"):document.querySelector("#username"):document.querySelector("#otp-field-0"),e&&e.focus&&e.focus()},t.focusNextInput=function(){var e,o,a,i=null;if(t.otpModel.forEach(function(e){if(o=null!=i?i:e.value){var t=new RegExp(u.getRegexExpression("integerchk"));t.test(+o)?(a=o.toString(),e.value=+a[0],i=a.slice(1)?a.slice(1):null):(e.value=null,i=null)}}),e=t.otpModel.find(function(e){return""===e.value||void 0===e.value})){var n=document.querySelector(".input-otp #"+e.name);n&&n.focus&&(n.focus(),$("#otp-field-0").removeClass("input-error"),$("#otp-field-1").removeClass("input-error"),$("#otp-field-2").removeClass("input-error"),$("#otp-field-3").removeClass("input-error"),$("#otp-field-4").removeClass("input-error"),$("#otp-field-5").removeClass("input-error"),$("#otp-field-0").addClass("border-blue"),$("#otp-field-1").addClass("border-blue"),$("#otp-field-2").addClass("border-blue"),$("#otp-field-3").addClass("border-blue"),$("#otp-field-4").addClass("border-blue"),$("#otp-field-5").addClass("border-blue"))}else document.querySelector("#otp-field-5").focus()},t.linkAccountCorp=function(){try{m._MB_Analytics.__push({branchLog:{name:"corporateLoginViaUsernamePassword",custom_data:{medibuddyUserId:"",source:m.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:m.sessionStorage.getItem("branch_fingerprint")||"",entryPoint:m.location.href}}})}catch(e){console.log(e)}t.linkAccountScreen=!1,t.otpEnterScreen=!0,t.loginScreen=!0,setTimeout(function(){t.defaultFocus()})},t.stopTimerCorp=function(){clearInterval(b),t.counter=30,t.showResendLink=!0},t.validate=function(e,t){var o=new RegExp(u.getRegexExpression(t)),a=String.fromCharCode(e.charCode?e.charCode:e.which);if(!o.test(a)&&13!==e.charCode&&9!==e.charCode||1==e.target.value.length)return e.preventDefault(),!1},t.otpVerifyCorp=function(e){t.otpDataId=e,t.linkAccountScreen=!0,t.otpEnterScreen=!1,t.showResendLink=!1,t.loginScreen=!0,t.counter=60,setTimeout(function(){t.defaultFocus()}),$(".timer").html(""),$("#verifyerr").text(""),setTimeout(function(){$("#otp").val("")},100),b=setInterval(function(){$(".timer").text(t.counter+"s"),t.counter--,1===t.counter&&(t.showResendLink=!0,t.stopTimerCorp())},1e3)},t.okCorp=function(){try{m._MB_Analytics.__push({branchLog:{name:"corporateLoginBackButtonClicked",custom_data:{medibuddyUserId:"",source:m.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:m.sessionStorage.getItem("branch_fingerprint")||"",entryPoint:m.location.href}}})}catch(o){console.log(o)}e.dismiss("cancel"),t.counter=30,t.stopTimerCorp(),t.user&&t.user.token&&t.user.userDetails||(c.insuranceSelected=!1,"app.covidVaccination"==h.current.name&&h.go("app.home",{reload:!1}))},t.emailToSSORedirection=function(e,o,a){l.post("https://infi-node.medibuddy.in/mobile/redirecturl",{username:o}).then(function(i){if(i.data.ssoRedirect&&i.data.singleSignOnUrl)m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_REDIRECT_TO_TPA_SSO",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:o,corporateDomain:o.split("@")[1]}})}),console.log("emailToSSORedirection **** ==>",i.data),m.location.href=i.data.singleSignOnUrl;else{if("EMAIL_OTP_SCREEN_PWD_REDIRECTION"==e)return void t.showOldCorpLoginWindow();t.showCustomError(a.errorMessageDisplay?a.errorMessageDisplay:d.errorMessages.nudgeToUsernamePassword)}})["catch"](function(e){t.showOldCorpLoginWindow()})},t.loginuserbyOtpVerifyCorp=function(i){if(i){$(".verifyBtn").prop("disabled",!0);var r=(1e5*$("#otp-field-0").val()+1e4*$("#otp-field-1").val()+1e3*$("#otp-field-2").val()+100*$("#otp-field-3").val()+10*$("#otp-field-4").val()+1*$("#otp-field-5").val()).toString(),s={corporateEmailAddress:t.email,otp:r,isEmailOTPLogin:!0},u=p.apiUrl+"/MarketPlaceLogon";l.post(u,s,{headers:{"Content-Type":"application/json",Platform:"web"}}).then(function(i){i&&i.data&&i.data.user&&i.data.user.token&&(document.cookie="redirect="+i.data.user.token+"; domain="+o.getCookieDomain(),i.data.user.userDetails&&i.data.user.userDetails.pmEntityID&&(document.cookie="pmEntityId="+i.data.user.userDetails.pmEntityID+"; domain="+o.getCookieDomain()));var s=i.data;if($(".verifyBtn").prop("disabled",!1),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_VERIFY_INITIATE",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginEventScreen:"OTP Screen"}})}),s.isSuccess)m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_VERIFY_SUCCESS",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginEventScreen:"EMAIL_OTP_SCREEN"}})}),m._MB_Analytics.__push({name:"corpLoginOtpVerified",branchLog:{name:"corporateLoginOtpVerificationSuccessful",custom_data:{medibuddyUserId:"",source:m.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:m.sessionStorage.getItem("branch_fingerprint")||"",email:$("#email").val()?$("#email").val():t.email,otpEntered:r,entryPoint:m.location.href}}}),c.loggedUserName=s.user.userDetails.firstName,c.setUserObj(_.extend(s.user,{isRetailLabsFlowEnabled:s.isRetailLabsFlowEnabled})),t.okCorp(),e.dismiss("cancel"),a.controller&&("authService"==a.controller&&a.func?c[a.func].apply(null,a.args):n.$broadcast(a.controller,a)),n.$broadcast("search",""),c.getuserLongToken(s.user.token).then(function(e){e.data.isSuccess&&e.data.encryptedToken&&(g.set("corpToken",e.data.encryptedToken),c.getEncryptedTokenForLinking({corpToken:e.data.encryptedToken,corpMbId:s.user.userDetails.userId}).then(function(e){n.$emit("userLogin",a)}))})["catch"](function(e){console.log("Error Occured",e.message),n.$emit("userLogin",a)});else{if(t.isRegistration&&"Oops, Looks like your corporate data is not present with us. Please check your username once again. Please connect with your HR or contact Medibuddy customer support to get your correct username"===s.errorMessage)return m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_VERIFY_SUCCESS",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginEventScreen:"EMAIL_OTP_SCREEN"}})}),void t.showRegistrationWindow();m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_VERIFY_FAILED",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginEventScreen:"EMAIL_OTP_SCREEN"}})}),t.otpVerificationTime+=1,t.otpVerificationTime>=4&&!g.get(obj.userDetails)?($("#verifyerr").text("Sorry, We are not able to connect your corporate account. Please use your phone number to login and use other services."),t.showRetailLogin=!1):$("#verifyerr").text(s.errorMessage),$("#otp-field-0").removeClass("border-blue"),$("otp-field-1").removeClass("border-blue"),$("#otp-field-2").removeClass("border-blue"),$("#otp-field-3").removeClass("border-blue"),$("#otp-field-4").removeClass("border-blue"),$("#otp-field-5").removeClass("border-blue"),$("#otp-field-0").addClass("input-error"),$("#otp-field-1").addClass("input-error"),$("#otp-field-2").addClass("input-error"),$("#otp-field-3").addClass("input-error"),$("#otp-field-4").addClass("input-error"),$("#otp-field-5").addClass("input-error");try{m._MB_Analytics.__push({branchLog:{name:"corporateLoginOtpErrorReceived",custom_data:{medibuddyUserId:"",source:m.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:m.sessionStorage.getItem("branch_fingerprint")||"",email:$("#email").val()?$("#email").val():t.email,otpEntered:r,entryPoint:m.location.href,errorMessage:s.errorMessage}}})}catch(l){console.log(l)}}})["catch"](function(e){$(".verifyBtn").prop("disabled",!1),e.data?$("#verifyerr").text("Something went wrong. Please try again after sometime"):$("#verifyerr").text("Please check the entered Email ID")})}else $("#verifyerr").text("Please enter valid OTP")},t.initiateOtpFlow=function(e){e&&m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_RETRY",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0}})});var o=$("#email").val()?$("#email").val():t.email;try{if(m.location.href===p.siteUrl){var a={screen:"Login",appVersion:"",domain:"medibuddyInweb",event:"corporateLoginOtpRequested",email:t.email,auth_uuid:g.get("auth_uuid")||void 0},i=Object.assign({},a,{meta:JSON.stringify(a)});l.post(p.eventlogsUrl,i)}m._MB_Analytics.__push({branchLog:{name:"corporateLoginOtpRequested",custom_data:{medibuddyUserId:"",source:m.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:m.sessionStorage.getItem("branch_fingerprint")||"",email:o,entryPoint:m.location.href}}})}catch(n){console.log(E)}var r={corporateEmailAddress:o},s=p.apiUrl+"/SendEmailOTPForLogin";$("#email").val()&&(t.email=$("#email").val()),l.post(s,r,{headers:{"Content-Type":"application/json"}}).then(function(e){m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_SENT",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),t.otpVerifyCorp(t.otpDataId)})["catch"](function(e){m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_NOT_SENT",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",corporateDomain:t.email.split("@")[1]}})}),console.log(e)})},t.openLoginScreenOld=function(e,o){if(t.okCorp(),e)try{if(m.location.href===p.siteUrl){var n={screen:"Login",appVersion:"",domain:"medibuddyInweb",event:"corpLoginUsernamePwdVerifyReq",email:t.email,auth_uuid:g.get("auth_uuid")||void 0},r=Object.assign({},n,{meta:JSON.stringify(n)});l.post(p.eventlogsUrl,r)}}catch(s){console.log(s)}else m._MB_Analytics.__push({excludeCleverTap:"true",dbLog:!0,name:"LF_USERNAME_LOGIN_INITATE",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,screen:"USERNAME_PWD_SCREEN"}})});return o||(o="EMAIL_OTP_SCREEN"),g.set("toShowMandPopUp",!0),c.openUserNamePasswordLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,a,o,i)},t.openRetailLogin=function(){return t.okCorp(),c.openLoginPopup("lg","templates/openLoginPopUpnew.html?"+timeStamp)},t.showRetailLoginMsg=function(){$("#corperr").text("Sorry, We are not able to connect your corporate account. Please use your phone number to login and use other services."),t.hideotpshare=!0,t.showRetailLogin=!1},t.showOldCorpLoginWindow=function(){m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_TO_USERPWD_REDIRECTION",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),t.hideotpshare=!0,t.openLoginScreenOld(!0)},t.showRegistrationWindow=function(){return m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_SHOW_SELF_REGISTRATION_FORM",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"Login Page",email:t.email}})}),t.okCorp(),c.openRegistrationPopup("lg","templates/openRegistrationPopup.html?"+timeStamp,{email:t.email,entityId:t.entityId})},t.loginUserWithOtpCorp=function(e,o){var a=$("#email").val()?$("#email").val():t.email;if(e){try{if(m.location.href===p.siteUrl){var n={screen:"Login",appVersion:"",domain:"medibuddyInWeb",event:"emailidentered",auth_uuid:g.get("auth_uuid")||void 0},r=Object.assign({},n,{meta:JSON.stringify(n)});l.post(p.eventlogsUrl,r)}}catch(u){console.log(u)}$("#email").val()?$(".otpEmail").text($("#email").val()):$(".otpEmail").append(t.email),$("#email").removeClass("input-error"),t.counter=30,t.stopTimerCorp();var c={flow:i?i:"Corporate-Login-Flow",auth_uuid:g.get("auth_uuid")||null,idealLoginFlow:!1,corporateEmailAddress:a,version:"v1"},_=p.apiUrl+"/CheckEmailOTPLoginLaunch";$("#email").val()&&(t.email=$("#email").val()),l.post(_,c,{headers:{"Content-Type":"application/json"}}).then(function(e){var o=e.data;if(console.log(o),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_REQUEST",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),o.isSuccess){var a=o.checkTpAorNonTpaUserResponse&&o.checkTpAorNonTpaUserResponse.reasonType?o.checkTpAorNonTpaUserResponse.reasonType:0,i=o.checkTpAorNonTpaUserResponse&&o.checkTpAorNonTpaUserResponse.userType?o.checkTpAorNonTpaUserResponse.userType:"NonTPAUser";
if("Allow EmailOTP"===o.clientAction)g.set("toShowMandPopUp",!0),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ENABLED",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,screen:"Email_Login",loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_PRESENT_IN_MB",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),"TPAUser"==i?m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_TPA",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}):m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_NON_TPA",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),t.initiateOtpFlow();else if("Highlight UserNameAndPassword Flow"===o.clientAction){if(5==a?m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_PRESENT_IN_MB",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}):8==a?(m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ENABLED",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,screen:"Email_Login",loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_PRESENT_IN_MB",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_TPA",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_MULTIPLE_LOGINS",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",userEmail:t.email,corporateDomain:t.email.split("@")[1]}})}),t.emailToSSORedirection("EMAIL_OTP_SCREEN",t.email,o)):1==a&&m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_ABSENT_IN_MB",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),"TPAUser"==i?(m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_TPA",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),t.emailToSSORedirection("EMAIL_OTP_SCREEN",t.email,o)):"NonTPAUser"==i&&m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_NON_TPA",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),[10].includes(a))return m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ENABLED",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,screen:"Email_Login",loginScreenEvent:"EMAIL_OTP_SCREEN",emailid:t.email,corporateDomain:t.email.split("@")[1]}})}),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_PRESENT_IN_MB",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_NON_TPA",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_MULTIPLE_LOGINS",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",userEmail:t.email,corporateDomain:t.email.split("@")[1]}})}),void t.showCustomError(o.errorMessageDisplay?o.errorMessageDisplay:d.errorMessages.nudgeToUsernamePassword);var n=p.infinitiNode+"/mobile/redirecturl";l.post(n,{username:t.email},{headers:{"Content-Type":"application/json"}}).then(function(e){if(e.data.ssoRedirect){console.log("res.data ****",e.data),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_REDIRECT_TO_TPA_SSO",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})});var o=e.data.singleSignOnUrl;s.location.href=o}else t.showCustomError(e.errorMessageDisplay?e.errorMessageDisplay:d.errorMessages.nudgeToUsernamePassword)})["catch"](function(e){t.showCustomError(o.errorMessageDisplay?o.errorMessageDisplay:d.errorMessages.nudgeToUsernamePassword)})}else if("Redirect To SSO"===o.clientAction){var n=o.ssoUrl;if(n){try{if(m.location.href===p.siteUrl){var r={screen:"Login",appVersion:"",domain:"medibuddyInweb",event:"SSOredirection",email:t.email,auth_uuid:g.get("auth_uuid")||void 0},u=Object.assign({},r,{meta:JSON.stringify(r)});l.post(p.eventlogsUrl,u)}}catch(c){console.log(c)}m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_REDIRECT_TO_NONTPA_SSO",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),t.okCorp(),t.hideotpshare=!0,m.open(n,"_blank").focus()}else t.showCustomError(o.errorMessageDisplay?o.errorMessageDisplay:d.errorMessages.nudgeToUsernamePassword)}else"Show Error Message"===o.clientAction?(m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ERR_MSG",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),t.showCustomError(o.errorMessageDisplay?o.errorMessageDisplay:d.errorMessages.nudgeToUsernamePassword)):"Show Registration Page"===o.clientAction?(m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ENABLED",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,screen:"Email_Login",loginScreenEvent:"EMAIL_OTP_SCREEN",emailid:t.email,corporateDomain:t.email.split("@")[1]}})}),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_ABSENT_IN_MB",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_NON_TPA",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_SELFREG_FORM_OPEN_REQ",payload:m._Site_Props.__getEventParameters({custom:{screen:"Corp_login",appVersion:"",domain:"medibuddyInWeb",event:"LF_SELFREG_FORM_OPEN_REQ",advertiserId:m.sessionStorage.getItem("branch_fingerprint"),email:t.email,auth_uuid:g.get("auth_uuid")||void 0}})}),t.initiateOtpFlow(),t.entityId=o.checkTpAorNonTpaUserResponse.pM_EntityId,t.isRegistration=!0):(9==a&&m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ENABLED",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),"TPAUser"==i?(m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_ABSENT_IN_MB",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_TPA",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),9==a?t.emailToSSORedirection("DISPLAY_ERROR_MESSAGE",t.email,o):t.emailToSSORedirection("EMAIL_OTP_SCREEN_PWD_REDIRECTION",t.email)):t.showCustomError(o.errorMessageDisplay?o.errorMessageDisplay:d.errorMessages.nudgeToUsernamePassword))}else"NonTPA_UserNotFound"==o.errorMessage&&(m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ENABLED",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_ABSENT_IN_MB",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})})),t.showCustomError(o.errorMessageDisplay?o.errorMessageDisplay:d.errorMessages.nudgeToUsernamePassword)})["catch"](function(e){t.showCustomError(d.errorMessages.apiError)})}else{$("#email").addClass("input-error"),$("#loginerr").text("Please enter correct Email ID"),$("#corpemaillabel").css("color","red"),t.hideotpshare=!0;try{m._MB_Analytics.__push({branchLog:{name:"corporateLoginInvalidEmailEntered",custom_data:{medibuddyUserId:"",source:m.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:m.sessionStorage.getItem("branch_fingerprint")||"",email:$("#email").val()?$("#email").val():t.email,entryPoint:m.location.href}}})}catch(h){console.log(h)}}},t.showHRPortalErr=function(){$("#email").addClass("input-error"),$("#loginerr").text("We did not find any users with the given email. Please contact your HR to create your account"),$("#corpemaillabel").css("color","red");try{if(m.location.href===p.siteUrl){var e={screen:"Login",appVersion:"",domain:"medibuddyInweb",event:"errLoginHRPortal",email:t.email,auth_uuid:g.get("auth_uuid")||void 0},o=Object.assign({},e,{meta:JSON.stringify(e)});l.post(p.eventlogsUrl,o)}}catch(a){console.log(a)}t.hideotpshare=!0},t.showCustomError=function(e){e||(e="Internal Server Error"),$("#email").addClass("input-error"),$("#loginerr").text(e),$("#corpemaillabel").css("color","red");try{if("https://www.medibuddy.in/"===m.location.href){var o={screen:"Login",appVersion:"",domain:"medibuddyInweb",event:"errLoginHRPortal",email:t.email,auth_uuid:g.get("auth_uuid")||void 0},a=Object.assign({},o,{meta:JSON.stringify(o)});l.post(p.eventlogsUrl,a)}}catch(i){console.log(i)}t.hideotpshare=!0},t.editEmailCorp=function(){t.otpEnterScreen=!0,t.linkAccountScreen=!0,t.loginScreen=!1,setTimeout(function(){t.defaultFocus()})},t.loginMedibuddyCorp=function(o){if(o){var i={username:t.loginObj.userMBName,password:t.loginObj.passwordMB};t.loginMedibuddyCheck=!0,t.stopTimerCorp(),m._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsLoginSubmit"});var r=p.apiUrl+"MarketPlaceLogon";l.post(r,i,{headers:{"Content-Type":"application/json",City:S,Platform:"web"}}).then(function(o){t.loginMedibuddyCheck=!1;var i=o.data;o.data.isSuccess?(c.loggedUserName=t.loginObj.userMBName,c.setUserObj(_.extend(o.data.user,{isRetailLabsFlowEnabled:o.data.isRetailLabsFlowEnabled})),t.okCorp(),e.dismiss("cancel"),a.controller&&("authService"==a.controller&&a.func?c[a.func].apply(null,a.args):n.$broadcast(a.controller,a)),n.$broadcast("search",""),c.getuserLongToken(i.user.token).then(function(e){e.data.isSuccess&&e.data.encryptedToken&&(g.set("corpToken",e.data.encryptedToken),c.getEncryptedTokenForLinking({corpToken:e.data.encryptedToken,corpMbId:i.user.userDetails.userId}).then(function(e){n.$emit("userLogin",a)}))})["catch"](function(e){console.log("Error Occured",e.message),n.$emit("userLogin",a)})):"User OTP Not Verified"===o.data.errorMessage?(t.guid=o.data.tokenForLoginModel,t.signinUp(),t.verifyOtpRegUser=!0,t.sendOtp({})):(console.log(o.data.errorMessage),t.loginErrorMsg=o.data.errorMessage,$("#corperr").text("Sorry, We are not able to connect your corporate account. Please use your phone number to login and use other services."),t.hideotpshare=!0,t.showRetailLogin=!1,$("#corplogerr").text(o.data.errorMessage),t.usersigninedinFailed())})}},t.updateuserMBNameCorp=function(){$("#corplogerr").text("")},t.updateMBPwdCorp=function(){$("#corplogerr").text("")},t.okCorp=function(){P=!1,e.dismiss("cancel"),t.counter=30,t.user=c.getUserObj(),t.user&&t.user.token&&t.user.userDetails||(c.insuranceSelected=!1,"app.covidVaccination"==h.current.name&&h.go("app.home",{reload:!1}))},t.updateEmailCorp=function(){t.tpoerrorMessage=!1;var e=/^(([^<>()\[\]\\.,;:\s@']+(\.[^<>()\[\]\\.,;:\s@']+)*)|('.+'))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;$("#email").removeClass("input-error"),$("#corplogerr").text(""),$("#corperr").text(""),$("#loginerr").text("");var o=$("#email").val();if(""===o||e.test(o)){var a=o.split("@");T.includes(a[1])?($("#loginerr").text("Please enter valid Corporate Email"),$(".loginBtn").prop("disabled",!0)):($("#loginerr").text(""),$(".loginBtn").prop("disabled",!1))}else $("#loginerr").text("Please enter a valid email ID"),$(".loginBtn").prop("disabled",!0)}}],size:"login-corp"})}document.querySelector("header").classList.remove("sticky-header")},openInsurancePopUp:function(e,t,o){l.open({animation:!0,templateUrl:t,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","$sce",function(e,t,a,i,n,r,s,l,u,d,c,m){t.linkInfo={policyNumber:"",userName:"",entityId:0},t.errMsg="",t.sortDatas=o.policyList,t.backToInsuranceForm=function(){t.InsuranceLinkError=!1},t.InsuranceLinkError=!1,t.closeModal=function(){e.dismiss("cancel")},t.linkInsurerAccount=function(){if(!t.linkInfo.entityId)return void(t.errMsg="Please Choose Your Policy");if(1==l.location.href.includes("medibuddy"))try{var e={appVersion:"",domain:"medibuddyInWeb",event:"LYI_Submit",policy_provider_pmEntityId:t.linkInfo.entityId,pol_number:t.linkInfo&&t.linkInfo.policyNumber},o=Object.assign({},e,{meta:JSON.stringify(e)});n.post(p.eventlogsUrl,o)}catch(a){console.log(a)}var i={entityId:t.linkInfo.entityId,retailPolicyNumber:t.linkInfo.policyNumber},r=s.getUserObj();s.makeAjaxCalls(p.infinitiNode+"CorporateData/UserCreation",i,"POST",r.encryptedToken).then(function(e){if(e.data.isSuccess&&e.data.authServerToken){g.set("policyNumber",JSON.stringify(t.linkInfo.policyNumber)),t.closeModal();var o=l.location.href+"sl?AuthToken="+e.data.authServerToken;l.location.href=o}t.InsuranceLinkError=!0,t.insuranceErroMsg=e.data.message})["catch"](function(e){t.InsuranceLinkError=!0,t.insuranceErroMsg=e.data.message,console.log(e)})},t.myChangeInfo=function(e,o){t.linkInfo[e]=o,t.errMsg=""}}],size:"login-corp"})},openSubsPopup:function(){l.open({animation:!0,templateUrl:"templates/subs.html?"+timeStamp,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","$sce",function(e,t,o,a,i,n,s,l,u,d,c,p){t.closeModal=function(){e.dismiss("cancel")},t.allowed_subscriptions=[{packageName:"Tier1",displayName:"Basic Package",packagePrice:1e3,description:"This package sucks, don't even think about buying it"},{packageName:"Tier2",displayName:"Intermediate Package",packagePrice:2e3,description:"This package is alright i guess, might give it a try"},{packageName:"Tier3",displayName:"Advanced Package",packagePrice:3e3,description:"This package is pretty good, 8/10 would buy again"},{packageName:"Tier4",displayName:"Epic Package",packagePrice:4e3,description:"This package is crazy good, youl'l regret not buying this"},{packageName:"Tier5",displayName:"Extreme Package",packagePrice:5e3,description:"This package is better than taco bell, do I need to say more?"},{packageName:"Tier6",displayName:"Legendary Package",packagePrice:6e3,description:"This should be illegal bruh"},{packageName:"Tier7",displayName:"No Longer a Package",packagePrice:7e3,description:"This package is has ascended the physical realm and become the very embodiment of value for money"}],t.subsWaves=["url(/assets/icons/subs/wave-2.svg)","url(/assets/icons/subs/wave-5.svg)","url(/assets/icons/subs/wave-6.svg)","url(/assets/icons/subs/wave-4.svg)","url(/assets/icons/subs/wave-3.svg)","url(/assets/icons/subs/wave-1.svg)","url(/assets/icons/subs/wave-7.svg)"],t.selected=!1,t.selectedSubscription=void 0,t.addSubscription=function(e){t.selectedSubscription=e,t.selected=!0},t.removeSubscription=function(e){t.selectedSubscription=void 0,t.selected=!1},t.checkoutSubsCart=function(){console.log("puhsed cart item to db/redist"),t.closeModal(),r.url("/subsCheckout")}}],size:n.isMobileView?"bottom":"border modal-sm",windowClass:n.isMobileView?"bottom-sheet":"subsModal"})},checkoutSubsCart:function(){r.url("/subsCheckout")},openUserNamePasswordLoginPopup:function(e,t,a,i,n){if(a||(a={}),!P){P=!0;l.open({animation:!0,templateUrl:t,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","$sce",function(e,t,r,l,u,d,c,m,h,f,v,E){t.isEmpty=!1,t.userNamePlaceholder="Enter your Mobile or Email",t.tooltipText=E.trustAsHtml("<div><b>MediBuddy</b> is the exclusive one-stop app for <b>Medi Assist</b> members to manage all their healthcare needs. Your <b>MediBuddy</b> helps make the most of your health and wellness benefits, anytime, anywhere and on-the-go: <br><br> Access a curated catalog of outpatient services on <b>Infiniti</b><br><br> Don't have your <b> MediBuddy</b> login yet? Activate your account now.</div>"),t.userOtpVarified=!1,t.infinitiLoginCheck=!0,t.showpassword=!1,t.isTPA=!1;var S=6e3;t.showRetailLogin=!0,t.loginClicked=1,t.isValidate=!0,t.entityId=0,t.mailId="";var I=g.get("city");t.emailPattern=d,t.loginObj={userName:"",password:""},t.gender={M:"Male",F:"Female"},m._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:!0,name:"Login/Signup",payload:m._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{itemSource:s.location.href}})}),t.usernameChanged=function(){t.showpassword=!1,t.isTPAMessage=!1;var e=/^\S*$/;void 0==t.loginObj.userMBName||0==e.test(t.loginObj.userMBName)?t.regexTestFailed=!0:t.regexTestFailed=!1},t.ssoRedirectFnt=function(){u.post("https://infi-node.medibuddy.in/mobile/redirecturl",{username:t.loginObj.userMBName}).then(function(e){e.data.ssoRedirect&&e.data.singleSignOnUrl?(m.location.href=e.data.singleSignOnUrl,m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USRNAME_REDIRECT_TO_TPA_SSO",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN"}})})):t.TPAUserMessage()})["catch"](function(e){t.TPAErrorMessage()})},t.okCorp=function(){P=!1,e.dismiss("cancel"),t.counter=30,t.user=c.getUserObj(),t.user&&t.user.token&&t.user.userDetails||(c.insuranceSelected=!1,"app.covidVaccination"==h.current.name&&h.go("app.home",{reload:!1}))},t.showRegistrationWindow=function(){return t.okCorp(),c.openRegistrationPopup("lg","templates/openRegistrationPopup.html?"+timeStamp,{email:t.loginObj.userMBName,empCode:t.loginObj.userMBName,entityId:t.entityId})},t.checkNonTPA=function(){t.showpassword||t.regexTestFailed||u.post("https://infi-node.medibuddy.in/mobile/checkTPAorNonTPAUser",{flow:n?n:"Username-Password-Login-Flow",auth_uuid:g.get("auth_uuid")||null,idealLoginFlow:!1,userName:t.loginObj.userMBName}).then(function(e){return 204==e.status?void t.checkNonTPA():(void 0!=i&&""!=i?(m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USERNAME_SUBMIT",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:i,emailId:t.loginObj.userMBName}})}),i=""):m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USERNAME_SUBMIT",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),void("Show Registration Page"==e.data.clientAction?(t.entityId=e.data.checkTpAorNonTpaUserResponse.pM_EntityId,t.showRegistrationWindow()):"TPAUser"==e.data.userType?(3==e.data.reasonType?(m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_PRESENT_IN_MB",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_TPA",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})})):1==e.data.reasonType&&m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_ABSENT_IN_MB",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),t.ssoRedirectFnt(t.loginObj.userMBName)):(m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_NON_TPA",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),5!=e.data.reasonType&&4!=e.data.reasonType||m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_PRESENT_IN_MB",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),t.isNonTPAUser=!0,t.showpassword=!0)))})["catch"](function(e){t.TPAErrorMessage()})},t.usersigninedinFailed=function(){t.isPasswordWrong=!0,l(function(){t.isPasswordWrong=!1},S)},t.encryptPayLoad=function(e){var t="ABEiM0RVZneImaq7zN3u/wABEiM0RV==",o="ABEiM0RVZneImaq7";t=m.CryptoJS.enc.Utf8.parse(t),o=m.CryptoJS.enc.Utf8.parse(o);var a=m.CryptoJS.AES.encrypt(e,t,{iv:o});return a.toString()},t.TPAUserMessage=function(){t.isTPAUser=!0,t.showpassword=!0},t.TPAErrorMessage=function(e){t.isTPAMessage=!0,t.TPAMessage=e?e:"Oops! You need to login through "},t.tpaLogin=function(){t.encryptUserName=t.encryptPayLoad(t.loginObj.userMBName),t.encryptPassWord=t.encryptPayLoad(t.loginObj.passwordMB);var i={encPassword:t.encryptPassWord,encUserName:t.encryptUserName};u.post("https://infi-node.medibuddy.in/mobile/authenticate",i).then(function(i){if(204==i.status)return void t.tpaLogin();if(m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USRNAME_PWD_SUBMIT",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),i.data.isSuccess&&i.data.authServerToken){i&&i.data&&i.data.user&&i.data.user.token&&(document.cookie="redirect="+i.data.user.token+"; domain="+o.getCookieDomain(),i.data.user.userDetails&&i.data.user.userDetails.pmEntityID&&(document.cookie="pmEntityId="+i.data.user.userDetails.pmEntityID+"; domain="+o.getCookieDomain())),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_TPA_AUTHENTICATE_SUCCESS",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USERNAME_LOGIN_SUCCESS",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})});var n=p.apiUrl+"MarketPlaceLogon",s={isSSOLogin:!0,authServerAccessToken:i.data.authServerToken};u.post(n,s,{headers:{"Content-Type":"application/json",City:I}}).then(function(o){t.loginMedibuddyCheck=!1;var i=o.data;o.data.isSuccess?(c.loggedUserName=t.loginObj.userMBName,c.setUserObj(_.extend(o.data.user,{isRetailLabsFlowEnabled:o.data.isRetailLabsFlowEnabled})),t.ok(),e.dismiss("cancel"),a.controller&&("authService"==a.controller&&a.func?c[a.func].apply(null,a.args):r.$broadcast(a.controller,a)),r.$broadcast("search",""),c.getuserLongToken(i.user.token).then(function(e){e.data.isSuccess&&e.data.encryptedToken&&(g.set("corpToken",e.data.encryptedToken),c.getEncryptedTokenForLinking({corpToken:e.data.encryptedToken,corpMbId:i.user.userDetails.userId}).then(function(e){r.$emit("userLogin",a)}))})["catch"](function(e){console.log("Error Occured",e.message),r.$emit("userLogin",a)})):(t.loginErrorMsg=o.data.errorMessage,t.usersigninedinFailed())})["catch"](function(e){t.loginErrorMsg=e.data.errorMessage?e.data.errorMessage:"We are facing technical issues, Please login after some time",t.usersigninedinFailed()})}else i.data.isSuccess&&!i.data.isEmailVerified?(m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_TPA_AUTHENTICATE_EMAIL_NOT_VERIFIED",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),t.TPAErrorMessage("You need to verify your email ")):i.data.isSuccess&&!i.data.authServerToken?(m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_TPA_AUTHENTICATE_TOKEN_ABSENT",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),t.TPAErrorMessage()):(m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_TPA_AUTHENTICATE_FAILED",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName,errorReason:i.data.message}})}),t.loginErrorMsg=i.data.message,t.usersigninedinFailed())})["catch"](function(e){m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USRNAME_PWD_SUBMIT",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),t.loginErrorMsg=e&&e.data&&"Not Found"!=e.data.message?e.data.message:null,t.loginErrorMsg?t.usersigninedinFailed():t.TPAErrorMessage()})},t.isNewLogin=!0,t.openTab=function(){var e=m.location.pathname+m.location.search;t.url="https://me.medibuddy.in?redirecturl="+e+"sl?AuthToken=",m.location=t.url},t.selectedTab=function(e){t.logInUser.userName="",t.logInUser.password="",t.logInUser.confirmPassword="",t.logInUser.dateOfBirth="",t.logInUser.mobile="",t.logInUser.firstName="",t.logInUser.lastName="",t.logInUser.userRegisterName="",t.logInUser.registerPassword="",t.logInUser.employeeId="",t.logInUser.gender="",t.logInUser.isChecked=!1,"LOGIN"===e?(t.mailAlertForm=!1,t.otpCheckForFBOrGoogle=!1,t.isNewForm=!1,t.isNewLogin=!0):"REGISTER"===e&&l(function(){t.isSingUpCreated=!0,t.isPasswordWrong=!1,t.isNewForm=!0,t.isNewLogin=!1},0)},t.changeClass=function(){t.invalidClass&&(t.invalidClass=void 0)},t.backToInfinitiLogin=function(){t.forgetFormMedibuddy=!1,t.isPasswordCheck=!1,t.otpCheckLogin=!1,t.forgetPasssOtpCheck=!1,t.localScope=t,t.medibuddyLoginCheck=!1,t.infinitiLoginCheck=!0,t.userNames=[]},t.loginMedibuddy=function(){if(t.showpassword){var i={username:t.loginObj.userMBName,password:t.loginObj.passwordMB};t.loginMedibuddyCheck=!0,m._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsLoginSubmit"});var n=p.apiUrl+"MarketPlaceLogon";u.post(n,i,{headers:{"Content-Type":"application/json",City:I,Platform:"web"}}).then(function(i){var n=i.data;i&&i.data&&i.data.user&&i.data.user.token&&(document.cookie="redirect="+i.data.user.token+"; domain="+o.getCookieDomain(),i.data.user.userDetails&&i.data.user.userDetails.pmEntityID&&(document.cookie="pmEntityId="+i.data.user.userDetails.pmEntityID+"; domain="+o.getCookieDomain())),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USRNAME_PWD_SUBMIT",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),t.loginMedibuddyCheck=!1,i.data.isSuccess?(t.showRetailLogin=!0,c.loggedUserName=t.loginObj.userMBName,c.setUserObj(_.extend(i.data.user,{isRetailLabsFlowEnabled:i.data.isRetailLabsFlowEnabled})),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USERNAME_LOGIN_SUCCESS",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",userType:"NON-TPA",emailId:t.loginObj.userMBName}})}),t.ok(),e.dismiss("cancel"),a.controller&&("authService"==a.controller&&a.func?c[a.func].apply(null,a.args):r.$broadcast(a.controller,a)),r.$broadcast("search",""),c.getuserLongToken(n.user.token).then(function(e){e.data.isSuccess&&e.data.encryptedToken&&(g.set("corpToken",e.data.encryptedToken),c.getEncryptedTokenForLinking({corpToken:e.data.encryptedToken,corpMbId:n.user.userDetails.userId}).then(function(e){r.$emit("userLogin",a)}))})["catch"](function(e){console.log("Error Occured",e.message),r.$emit("userLogin",a)})):"User OTP Not Verified"===i.data.errorMessage?(m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_OTP_NOT_VERIFIED",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0}})}),t.guid=i.data.tokenForLoginModel,t.signinUp(),t.verifyOtpRegUser=!0,t.sendOtp({})):(t.loginClicked+=1,t.loginClicked>=5&&!g.get(obj.userDetails)?(t.loginErrorMsg="Sorry, We are not able to connect your corporate account. Please use your phone number to login and use other services.",t.showRetailLogin=!1):t.loginErrorMsg=i.data.errorMessage,t.usersigninedinFailed())})["catch"](function(e){console.log(e),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USERNAME_LOGIN_FAILED",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",reason:e&&e.data&&e.data.errorMessage?e.data.errorMessage:"",loginNameDetails:i.username}})})})}},t.resetPassword=function(e){var o=!1,a=!1,i={};if(_.isEmpty(t.userNames)||(o=!0,i.username=t.loginObj.selectedUserName),t.loginObj.userName.match(/[a-z]/i)?t.loginObj.userName.match(t.emailPattern.getRegexExpression("emailchk"))?o=!0:(t.userNamePlaceholder="Enter valid email Id",t.loginObj.userName="",t.invalidClass=!0):t.loginObj.userName.match(/^\d{10}/)?(o=!0,
a=!0):(t.userNamePlaceholder="Enter valid mobile number",t.loginObj.userName="",t.invalidClass=!0),o){a?i.mobile=t.loginObj.userName:i.emailId=t.loginObj.userName,t.userNames=[],t.selectedUsername="";try{if(m.location.href===p.siteUrl){var n={screen:"Login",appVersion:"",domain:"medibuddyInweb",event:"forgotpwdrequest",email:t.loginObj.userName,auth_uuid:g.get("auth_uuid")||void 0},r=Object.assign({},n,{meta:JSON.stringify(n)});u.post(p.eventlogsUrl,r)}}catch(s){console.log(s)}u.post(p.apiUrl+"ForgetPassword",i,{headers:{"Content-Type":"application/json",City:I}}).then(function(e){e.data.isSuccess?(t.forgetPasssOtpCheck=!0,t.isPasswordCheck=!1,t.fogetAuthToken=e.data.keyForLoginModel,e.data.mobileOTPSentResponse?(t.fogetPassSednTo=e.data.mobileOTPSentResponse.sentTo,t.forgetOtpKey=e.data.mobileOTPSentResponse.keyForToken):(t.fogetPassSednTo=e.data.emailOTPSentResponse.sentTo,t.forgetOtpKey=e.data.emailOTPSentResponse.keyForToken)):"Multiple users with your emailId"!==e.data.errorMessage||_.isEmpty(e.data.userNames)?t.forgotPassErrorMsg=e.data.errorMessage:(t.userNames=e.data.userNames,t.loginObj.selectedUserName=e.data.userNames[0],t.infinitiLoginCheck=!1,t.isPasswordCheck=!0)})}},t.forgetOtpPassSend=function(o){var i={OTP:o.OTP,keyForToken:t.forgetOtpKey,NewPassword:o.password,KeyForLoginViewModel:t.fogetAuthToken};t.loginErrorMsg="",u.post(p.apiUrl+"MarketPlaceChangePasswordThroughMobile",i,{headers:{"Content-Type":"application/json",City:I}}).then(function(o){if(o.data.isSuccess){t.forgetPasssOtpCheck=!1,c.setUserObj(o.data.loginDetails.user);try{if(m.location.href===p.siteUrl){var i={screen:"Login",appVersion:"",user:o.data.loginDetails.user,domain:"medibuddyInweb",event:"forgotpwdsent",email:t.loginObj.userName,auth_uuid:g.get("auth_uuid")||void 0},n=Object.assign({},i,{meta:JSON.stringify(i)});u.post(p.eventlogsUrl,n)}}catch(s){console.log(s)}t.ok(),e.dismiss("cancel"),r.$emit("userLogin",a),a.controller&&r.$broadcast(a.controller,a),r.$broadcast("search","")}else o.data.errorMessage&&("Wrong OTP"===o.data.errorMessage?v({message:"Please Enter Valid OTP.",position:"center",duration:5e3}):t.loginErrorMsg=o.data.errorMessage)})},t.ok=function(){e.dismiss("cancel")},t.validateMailId=function(e){var o=/^(([^<>()\[\]\\.,;:\s@']+(\.[^<>()\[\]\\.,;:\s@']+)*)|('.+'))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;e?(t.isValidate=o.test(e),t.isValidMail=t.isValidate===!0,t.isMail=!1):(t.isMail=!0,t.isValidate=!0)},t.getMailIdPopup=function(e,t){f.open({templateUrl:t,keyboard:!0,backdrop:"static",controller:["$uibModalInstance","$scope","$rootScope","$timeout","$state","authService",function(e,t,a,i,n,r){t.isValidate=!0,t.isfb=!0,t.ok=function(){e.dismiss("cancel")},t.validateMailId=function(e){var o=/^(([^<>()\[\]\\.,;:\s@']+(\.[^<>()\[\]\\.,;:\s@']+)*)|('.+'))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;e?(t.isValidate=o.test(e),t.isValidMail=t.isValidate===!0,t.isMail=!1):(t.isMail=!0,t.isValidate=!0)},t.getUserObjectForGoogle=function(e,t,o){var a={isSocialLogin:!0,appName:"gmail",appUniqueIdentifier:e.id,appAccessToken:t,email:e.emails,mobile:e.mobile,firstName:e.name.givenName,lastName:e.name.familyName,checkUser:"new"!==o};return a},t.createGoogleUser=function(e,i){var n=p.apiUrl+"MarketPlaceLogon",s=t.getUserObjectForGoogle(e,i,"new");u.post(n,s,{headers:{"Content-Type":"application/json",City:I,Platform:"web"}}).then(function(e){if(e.data.isSuccess)e&&e.data&&e.data.user&&e.data.user.token&&(document.cookie="redirect="+e.data.user.token+"; domain="+o.getCookieDomain(),e.data.user.userDetails&&e.data.user.userDetails.pmEntityID&&(document.cookie="pmEntityId="+e.data.user.userDetails.pmEntityID+"; domain="+o.getCookieDomain())),r.setUserObj(e.data.user),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_SSO_SUCCESSFUL_LOGIN",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0}})});else if("User OTP Not Verified"===e.data.errorMessage){m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_SSO_LOGIN_USR_OTP_NOT_VERIFIED",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0}})}),t.guid=e.data.tokenForLoginModel;var i={socialLoginDetail:s,isSocialLoginOTP:!0,appId:9194},n=p.apiUrl+"VerifyUser";u.post(n,i,{headers:{"Content-Type":"application/json"}}).then(function(e){t.mobile=e.data.mobileNo,e.data.isSMSSent===!0?(l(function(){t.mailAlertForm=!1,t.otpCheckForFBOrGoogle=!0,t.activePill=1},0),t.otpResponse={otpKey:""},t.otpResponse.otpKey=e.data.otpKey,m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_SSO_LOGIN_USR_SMS_OTP_SENT",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,mobileNo:t.mobile}})})):e.data.isEmailSent===!0&&(l(function(){t.mailAlertForm=!1,t.otpCheckForFBOrGoogle=!0,t.activePill=1},0),t.otpResponse={otpKey:""},t.otpResponse.otpKey=e.data.emailKey,m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_SSO_LOGIN_USR_EMAIL_OTP_SENT",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0,emailKey:t.otpResponse.otpKey}})}))})}else a.$broadcast("invalidUser",!1),m._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_SSO_LOGIN_FAIL",payload:m._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0}})})})},t.getMailId=function(){t.googleUser=b,t.access_token=y,t.googleUser.emails=t.mailId,t.googleUser.mobile=t.mobile,t.createGoogleUser(t.googleUser,t.access_token)},a.$on("closePopup",function(e){t.ok(!1)}),t.isValidMailId=!1,a.$on("invalidUser",function(e,o){t.isValidMail=!1,t.isValidMailId=!0,i(function(){t.isValidMailId=!1},6e3)})}],size:e})},r.$on("closePopup",function(e){t.ok(!1),e.preventDefault()}),t.isSingUpCreated=!0,t.patternCheck=d,t.isValidate=!0,t.isUser=!1,t.isLogin=!0,t.preStoredValue="",t.isValidMail=!1,t.isFirstName=!1,t.isMobile=!1,t.isLastName=!1,t.isError=!1,t.logInUser={userName:"",password:"",confirmPassword:"",dateOfBirth:"",mobile:"",firstName:"",lastName:""},t.openPopup={opened:!1,openDobPopup:!1},t.ok=function(){P=!1,e.dismiss("cancel"),t.user=c.getUserObj(),t.user&&t.user.token&&t.user.userDetails||(c.insuranceSelected=!1,a.stayInState||h.go("app.home",{reload:!1}))},t.openRetailLogin=function(){return t.ok(),c.openLoginPopup("lg","templates/openLoginPopUpnew.html?"+timeStamp)},t.createUser=function(e){var o={userName:e.userRegisterName,password:e.registerPassword,email:e.userRegisterName,mobile:e.mobile,firstName:e.firstName,lastName:e.lastName,dateOfBirth:e.dateOfBirth},a="";1==e.isChecked?(a=p.apiUrl+"RegisterWellnessCorpUser",o.name=e.firstName,o.phone=e.mobile,o.employeeId=e.employeeId,o.corporateName=e.userRegisterName.split("@").pop(),o.gender=e.gender):a=p.apiUrl+"RegisterUser",u.post(a,o,{headers:{"Content-Type":"application/json"}}).then(function(a){if(a.data.isSuccess){t.otpResponse=a.data.otpResponse,t.guid=a.data.tokenForLoginModel,t.phoneOrEmail=a.data.otpResponse.mobileNo,t.otpCheck=!0,t.registerCheck=!1,t.isSingUpCreated=!1;var i={name:e.firstName,email:e.userRegisterName,phonenumber:e.mobile};m._MB_Analytics.__push({isCleverTap:!0,fbq:!0,fbqReference:"CompleteRegistration",name:"Registered",payload:m._Site_Props.__getEventParameters({custom:i}),branchLog:{name:"Registered",custom_data:i}})}else"You already exist with us."===a.data.errorMessage?(t.logInUser.OTP="",v({message:"User already exists with  email-Id: "+o.email,position:"center",duration:5e3}),t.isNewLogin=!0,t.infinitiLoginCheck=!0,t.otpCheck=!1,t.otpCheckForFBOrGoogle=!1,t.activePill=0,t.backToInfinitiLogin(),t.loginObj.userName=e.userRegisterName,t.resetPassword()):a.data.errorMessage?(t.isError=!0,t.registerErrorMessage=a.data.errorMessage,l(function(){t.isError=!1},9e3),t.isLogin=!0):1==e.isChecked&&v({message:"Looks like your company have not partnered with us. Write to infiniti@mahs.in and mention your phone number.",position:"center",duration:5e3})})},t.signinUp=function(e){e&&t.createUser(e)},t.isCorporateUser=function(e){t.logInUser.isChecked=!1,e&&(t.logInUser.isChecked=!0)},t.routeToResetPasswordDialog=function(){t.infinitiLoginCheck=!1,t.userNamePlaceholder="Enter your Mobile or Email",t.loginObj.userName="",t.isPasswordCheck=!0,t.forgotPassErrorMsg="";try{var e="Pre_Login",o=g.get("_mp_user");null!=o&&(e="Post_Retail_Login");var a={sessionId:localStorage.getItem("UniqSessionId"),auth_uuid:g.get("auth_uuid")||"",domain:"medibuddy",event:"LF_FPWD_INITIATE",login_status:e},i=Object.assign({},a,{meta:JSON.stringify(a)});u.post(p.eventlogsUrl,i)}catch(n){console.log(n)}t.ok(!1),c.openResetPasswordPopUp()},t.forgotPassword=function(){try{m._MB_Analytics.__push({dbLog:!0,name:"Forgotpasswordclick",payload:m._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{itemSource:s.location.href},source:m.sessionStorage.getItem("utm_source")||"",platform:"MBWeb"})})}catch(e){console.log(e)}t.infinitiLoginCheck=!1,t.userNamePlaceholder="Enter your Mobile or Email",t.loginObj.userName="",t.isPasswordCheck=!0,t.forgotPassErrorMsg=""},t.userVerification=function(){t.localScope=t;var o={tokenForLoginModel:t.guid,Token:t.otpResponse.otpKey,Phrase:t.logInUser.OTP},i=p.apiUrl+"UserVerification";u.post(i,o,{headers:{"Content-Type":"application/json"}}).then(function(o){if(o.data.isSuccess){t.otpCheck=!1,t.otpCheckLogin=!1,t.verifyOtpRegUser=!1,t.userOtpVarified=!0,e.dismiss("cancel");var i=o.data.loginDetails.user;c.setUserObj(i);var n={email:i.userDetails.email,phonenumber:i.userDetails.phone,patientid:i.userDetails.userId};i.userDetails&&m._MB_Analytics.__push({isCleverTap:!0,name:"OTP Verified",payload:m._Site_Props.__getEventParameters({custom:n}),branchLog:{name:"OTP Verified",custom_data:n}}),r.$emit("userLogin",a),a.controller&&r.$broadcast(a.controller,a),r.$broadcast("search",""),h.reload()}else o.data.isSuccess||v({message:"OTP verification Failed, Please enter correct OTP.",position:"center",duration:5e3})})},t.sendOtp=function(e){var o={};o=t.verifyOtpRegUser?{tokenForLoginModel:t.guid,appId:9194}:{isMobileVerification:!0,LoginName:e.userRegisterName?e.userRegisterName:e.userName,MobileNo:e.mobile,appId:9194};var a=p.apiUrl+"VerifyUser";u.post(a,o,{headers:{"Content-Type":"application/json"}}).then(function(e){t.otpResponse={},(e.data.isSMSSent||e.data.isEmailSent)&&(e.data.isSMSSent?t.phoneOrEmail="phone "+e.data.mobileNo:t.phoneOrEmail="email id "+e.data.emailId,t.otpResponse.otpKey=e.data.otpKey,t.isSingUpCreated=!1,t.verifyOtpRegUser?t.otpCheckLogin=!0:t.otpCheck=!0)})},t.signedIn=!1,t.feebackFunction=function(e){var o={userFeedBack:e.userFeedBack,subject:e.subject,userName:e.userName,phonenumber:e.phonenumber,email:e.email};u.post(p.apiUrl+"UserFeedBack",o,{headers:{"Content-Type":"application/json",City:I}}).then(function(e){t.ok(!1),v({message:"Thank you! Your feedback is submitted successfully.",position:"center",duration:5e3})})},c.showRegisterTab&&(t.activePill=1,t.selectedTab("REGISTER"),c.showRegisterTab=!1)}],size:"login"})}document.querySelector("header").classList.remove("sticky-header")},openClaimDetails:function(e){var t=l.open({templateUrl:"userorders/claimDetails.html?"+timeStamp,controller:["$scope","authService","apiProvider",function(o,a,i){o.cancelRequest=a.cancelRequest,o.claimDetail=e.data.claimDetail,o.documentsLength=0,o.docCallsMade=!1,o.auditTrailCallsMade=!1,o.fetchAuditTrail=function(){if(!o.auditTrailCallsMade){var e=i.apiUrl+"/infiniti/auditrail/claim.json",t={claimIds:o.claimDetail.clmIds,dbType:o.claimDetail.basicDetails.sourcerDbType};a.makeAjaxCalls(e,t,"POST").then(function(e){e.data.isSuccess&&(o.auditTrailList=e.data.auditTrail),o.auditTrailCallsMade=!0})}},o.fetchDocuments=function(){if(!o.docCallsMade){var e=i.apiUrl+"/infiniti/attachment/claim.json",t={claimIds:o.claimDetail.clmIds,dbType:o.claimDetail.basicDetails.sourcerDbType};a.makeAjaxCalls(e,t,"POST").then(function(e){e.data.isSuccess&&(_.isEmpty(e.data.attachments)||(o.claimAttachments=e.data.attachments.claimAttachments,o.dmsAttachments=e.data.attachments.dmsAttachments,o.emailAttachments=e.data.attachments.emailPAAttachments,o.faxAttachments=e.data.attachments.faxAttachments,o.documentsLength=o.claimAttachments.length+o.dmsAttachments.length+o.emailAttachments.length+o.faxAttachments.length)),o.docCallsMade=!0})}},o.cancel=function(){a.cancelRequest="",t.close()}}],size:"claim-details"})},getuserLongToken:function(e){return this.makeAjaxCalls(p.apiUrl+"GetUserLongToken",{shortToken:e},"POST")},getEncryptedTokenForLinking:function(e){if(!g.get("retailToken")||g.get("retailToken").length<=1||g.get("retailMbId")<=1)return new Promise(function(e,t){e("No Retail Data")});var t="corpToken:"+e.corpToken+",corpmbid:"+e.corpMbId+",retailToken:"+g.get("retailToken")+",retailmbid:"+g.get("retailMbId"),o=null,i=window.CryptoJS.enc.Base64.parse("YVhWemRHTGxNVFppZVhSVGMydGxlUT09");return o=window.CryptoJS.AES.encrypt(t,i,{mode:window.CryptoJS.mode.ECB,padding:window.CryptoJS.pad.Pkcs7}),a.post(p.profileLinkUrl+"userLinking/v1",{data:o.toString()}).then(function(e){""!=r.path()&&r.path("")})["catch"](function(e){console.log("User Linking Failed")})},getsessionTokenUsing:function(e,t){var i=p.apiUrl+"MarketPlaceLogon",s={isSSOLogin:!0,authServerAccessToken:e},l=r.search();l&&l.utm_appname&&(s.appName=l.utm_appname,l.utm_appAgent&&(s.appAgent=l.utm_appAgent,r.search("utm_appAgent",null)),g.set("utm_appname",l.utm_appname),window.localStorage.setItem("parent_app",l.utm_appname),r.search("utm_appname",null)),this.isSSOLogin=!0;this.makeAjaxCalls(i,s,"POST").then(function(e){if(e.data.isSuccess)if("Server Login Error."===e.data.errorMessage){r.search("AuthToken",null),r.path("/");try{if(window.location.href.includes("medibuddy")){var i={screen:"SSO_Login",appVersion:"",domain:"medibuddyInWeb",event:"LF_SSO_LOGIN_FAILED",advertiserId:window.sessionStorage.getItem("branch_fingerprint"),auth_uuid:g.get("auth_uuid")||void 0},s=Object.assign({},i,{meta:JSON.stringify(i)});a.post(p.eventlogsUrl,s)}}catch(l){console.log(l)}}else if(e.data.isSuccess&&e.data.user){e&&e.data&&e.data.user&&e.data.user.token&&(document.cookie="redirect="+e.data.user.token+"; domain="+o.getCookieDomain(),e.data.user.userDetails&&e.data.user.userDetails.pmEntityID&&(document.cookie="pmEntityId="+e.data.user.userDetails.pmEntityID+"; domain="+o.getCookieDomain())),g.set("toShowMandPopUp",!0),e.data.user.isSSOLogin=!0,g.set("_mp_user",_.extend(e.data.user,{isRetailLabsFlowEnabled:e.data.isRetailLabsFlowEnabled,isNewAHCFlowEnabled:e.data.isNewAHCFlowEnabled,isMergeFlowEnabled:e.data.isMergeFlowEnabled})),window._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_SSO_SUCCESSFUL_LOGIN",payload:window._Site_Props.__getEventParameters({custom:{auth_uuid:g.get("auth_uuid")||void 0}})});var u=r.search();if(delete u.AuthToken,delete u.refurl,r.search("AuthToken",null),r.search("refurl",null),t){t=t.indexOf("Health-checks")>-1||t.indexOf("Health-Care")>-1?t.replace(/-/g," "):t,t.indexOf("medibuddy.in")>-1&&(t=t.split("medibuddy.in")[1]),u.bookingSrc&&(n.bookingSrc=u.bookingSrc),t="/"===t[0]?t:"/"+t,r.url(t);for(var d in u)u.hasOwnProperty(d)&&r.search(d,u[d]);r.replace()}else r.path("/")}})},setOfferPackageIdList:function(e){S=[],S=e},isOtcEnabled:function(){var e=this.isUserSignedin();return!(e&&e.userDetails&&e.userDetails.pmEntityID)||!(d.otcEntityIds.indexOf(e.userDetails.pmEntityID)>-1)},getOfferPackageIdList:function(){return S=["22dd74b0067e48a7b1deff5043d0708e","a565adabaf854d4ea9dabe06c4596068","c4f071665c044e8889c9bc0bf11086dc","81eaa1bcad1a4d66b0127c5073d824c1","c15181b08a4046b9a795557ec454cf0a","e21aff63b6d14c93a1204ac410dd7192","50289e129f754c069f3cea4a4cc2be91","13675d40546d4d3d89d8341669a27dfc","71e5596615164b45baf569c3ecac0536","8af37dfa49714f718cd4cd095ff87bcf","b0722de202914d97aea7a9c0b9ac8cd8","5fed6b043bb149478a73d3ec6563a17f","efd5e376d79d4647a346c8c64a9e785f","3476b074edf54778847c4bf580af1353","adf22f3414c34eb092bdfbcb7fc75d1b","deb91166f27f46c5a71db203f91abfdc","fb8f63ddc2fd475cb4899831de5dda57","f97f503247164327bb50662b59d53318","5e84f0412a2f41acb54a012b20b1b537","6d6b80b9148b401e9555d2d455f7c15f","989dbee469fd443ba3c2fce234093e6f","492a12074e43452b9441f1dd0d0bea51","4e7c454462624b4ca5e5cf3b1fb8f86a","18ac0089a56d4384a11bf9b2271dcec5","74b1ad2150484176a30573fe11a0187b","c164dba6ca71416e953ae6a702619618","9d08bf94ef8a488f8a2bbf14b56dedf0","12aa5d916eae41fbaf5cb4c6555a2387","0c91e94c56f34e13952e093f7d1e61e5","463f7e9bc8bf419d9c7dbbcceb55ce69","139234e951fa47f19008b9d6d4318e07","5ecc71bdca76464bb8ac94822a836248","fdd0879ea76f4abb9d3f0e641375871e","9ca53cf556d240849605877f5cc0b297","dc7335be10f141a1b0965e147fac7f7a","c88ee7339383413c9498e29a292c2fed","733177960dd945edbf870b3be7ae8e4c","ebbc4e6275854b85a7053580c45f5a55","c31294d1ad14497abd853f97a85a14dc","dfadb17c33f540c0a6505f391f305fd2","814497728c99421b8e75a21022562b6c","fb77a2480c1e45e3ae49886761523f3f","f06b0cbf7dff4adb81beacdff3588d7b","3fe684b5221944168122a2a303f823a5","9564169a0e6e4001a772f9f6fcbe7634","0d94b9a163df4b4db0bb763e593d1f1e","418deae4a3b74cc6a980abe71dc3febd","aef0e1cae4124191aa962fda6d18fa81","7737a5c1e3e44d56af02b479f51fadf2","8c041eae77504b29ab69630b4b1bb46b","291761f617ee44c0bb76b9ca4878777a","86305085fb074f8fabb1d0f67b482693","cb1a1e6430b14ca79097e5ccbf4ba71c","a3589ae105bc4ba3a82e7662891750eb","88d1d1ad939840e3abd25c9fa251ac04","1d94d999f93f491ead0df84288df2cfc","1ddd573d9c3745b5b3167d1eac0768d8","a82df636ca084a79a893fabec9e35eda","95b3670b60564d9a861d1530ab9fb802","acbcd393f4ec4bee95a4d37af75ca455","a533ceddd8dd41bb973e118549f97575","743b71918f164a089a00b7673912e2c9","87e294828b3c47b7ae8ba2419df09fb2","861b7de21c4c4929b165b9af62079d53","55c983b9118d490a9a8e302ec1ede3b1","b3122df8793b486a99756dd617150c95","8f25d44ae32f46c8999a9b5defcb24cc","ae826a25fe754e53a94c7510c0532ace"],[]},activateChat:function(e){if(e)window._MB_Analytics.__push({branchLog:{name:"Topic Visited",custom_data:{topic:"MB Gold"}}});else{var t=this.isUserSignedin(),o={};t&&t.userDetails&&(o.patientid=t.userDetails.userId),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",name:"MedsConsultNow",branchLog:{name:"Talk to Doc",custom_data:o}})}var a=p.doctorUrl;t&&t.encryptedToken&&(a=p.doctorUrl+"&accessToken="+t.encryptedToken);var i=e?p.goldUrl:a;n.isWebView||e?window.location.href=i:window.open(i,"_blank")},generateEmployeeCode:function(e,t){var o=t.split("@");return e+"-E"+o[0].toUpperCase()},sendRxMandatoryFlowEvents:function(e,t){L.appointmentTime=t.fulfillmentDate,L.isMandatoryForCorporate=t.isRxMandatoryForCorporate,L.isMandatory=!t.isOptional,L.requestId=t.requestId.toString(),L.platform="WEB",L.appversion="WEB",L.diff=Math.abs(new Date-new Date(t.fulfillmentDate))/6e4,L.submissionType=t.submissionType,L.reason=t.reason,L.rejectionReason="REUPLOAD_RX"==t.feature||"PAYMENT_PENDING"==t.feature?t.remarks:"",t.paymentBreakup&&(L.paymentAmount=t.paymentBreakup.totalAmount.value),L["mb-s-sessionId"]=o.getMBSessionId();var a=this.isUserSignedin();a&&a.userDetails&&(L.mbuserid=a.userDetails.userId.toString(),a.userDetails.uuid&&(L.mbuuid=a.userDetails.uuid.toString()),L.pmentityid=a.userDetails.pmEntityID.toString()),window._MB_Analytics.__push({name:e.name,schema:e.schema,payload:L})},submit:function(e,t,o){var a=this,i={requestId:e.requestId,feature:e.featureDetails.feature,attended:t,remarks:o},n=new Promise(function(t,o){a.makeAjaxCalls(p.offlineBackend+"mandatory-rx/attendanceOrRx",i,"POST","","","",{mbServerToken:e.authToken}).then(function(e){e.data.success&&t(!0)})["catch"](function(e){console.log("errro in rx or attendance response api"+JSON.stringify(e)),o(!1)})});return n},skipRx:function(e){var t=this,o=new Promise(function(o,a){t.makeAjaxCalls(p.offlineBackend+"mandatory-rx/skipRx",{requestId:e.requestId},"POST","","","",{mbServerToken:e.authToken}).then(function(e){e.data.success&&o(!0)})["catch"](function(e){console.log("errror in skipRx api"+JSON.stringify(e)),a(!1)})});return o},fetchUserBlockedState:function(e){var t=this,o=new Promise(function(o,a){t.makeAjaxCalls(p.authService+"UserDetails/fetchUserBlockedState","","GET","","","",{mbServerToken:e.authToken}).then(function(i){i.data.isSuccess&&i.data.data&&i.data.data.length?(console.log("response from block state API: "+JSON.stringify(i)),t.rxFeatureDetails(e).then(function(a){t.sendRxMandatoryFlowEvents(e.eventName,e.featureDetails),o(a)})["catch"](function(e){console.error("Error in fetching rxFeatureDetails: ",JSON.stringify(e)),a(!1)})):a(!1)})["catch"](function(e){console.log("errro in fetch block state api"+JSON.stringify(e)),a(!1)})});return o},rxFeatureDetails:function(e){var t=this,o=new Promise(function(o,a){t.makeAjaxCalls(p.offlineBackend+"mandatory-rx/featureDetails","","GET","","","",{mbServerToken:e.authToken}).then(function(t){if(t.data.success){var i=t.data.data;switch(e.featureDetails=i,e.requestId=i.requestId,e.isOptional=t.data.data.isOptional,i.feature){case"ATTENDANCE":e.showMarkAttendance=!0,e.eventName=f.OFC_MARKATTENDANCE_POPUP;break;case"MANDATORY_RX":e.showUploadPrescription=!0,e.eventName=f.OFC_UPLOADRX;break;case"RX_VERIFICATION":e.underVerification=!0,i.isReUploadOrder?e.eventName=f.OFC_REUPLOADRX_VERIFICATION_PENDING:e.eventName=f.OFC_UPLOADRX_VERIFICATION_PENDING;break;case"REUPLOAD_RX":e.reupload=!0,e.eventName=f.OFC_REUPLOADRX;break;case"PAYMENT_PENDING":e.claimUnsuccessful=!0,e.eventName=f.OFC_UPLOADRX_CLAIMEXPIRE;break;case"UPLOAD_RX_OPTIONAL":e.rxOptional=!0,e.eventName=f.OFC_UPLOADRX_SKIP}}else a(!1);o(t.data.success)})["catch"](function(e){console.log("errror in fetch feature detail api"+JSON.stringify(e)),a(!1)})});return o},rxMandatoryFlowOffline:function(){var e={authToken:g.get("corpToken"),showMarkAttendance:!1,showUploadPrescription:!1,underVerification:!1,reupload:!1,claimUnsuccessful:!1,showDiv:!1,showDiv2:!1,showToggleDiv:!1,isClicked:!1,isMobileView:n.isMobileView};this.fetchUserBlockedState(e).then(function(t){t&&(A=!0,l.open({templateUrl:"templates/attendance.html?"+timeStamp,controller:["$scope","$uibModalInstance","$state","authService",function(t,o,a,r){t.rxData=e,console.log("rxData",JSON.stringify(t.rxData)),t.renderHtml=function(e){return i.trustAsHtml(e)},t.closeModal=function(){o.dismiss("cancel")},t.skipRx=function(){r.skipRx(e).then(function(e){t.closeModal(),r.rxMandatoryFlowOffline()})["catch"](function(e){console.log(e)})},t.navigate=function(e,o){function i(){switch(o){case"VALID_PRESCRIPTION":a.go("app.validPrescription",{featureDetails:e});break;case"MANDATORY_RX":a.go("app.uploadPrescription",{featureDetails:e,action:o});break;case"REUPLOAD_RX":a.go("app.uploadPrescription",{featureDetails:e,action:o});break;case"PAYMENT_PENDING":a.go("app.paymentPage",{featureDetails:e,action:o});break;case"UPLOAD_RX_OPTIONAL":t.skipRx();break;default:t.skipRx()}t.closeModal()}i(),setTimeout(i,100)},t.clearOtherReason=function(e){"other"!=e.toLowerCase()&&(t.otherReason=null)},t.submit=function(o,i){r.sendRxMandatoryFlowEvents("OFC_ATTENDANCE_SUBMISSION",t.rxData.featureDetails),r.submit(e,o,i).then(function(i){t.closeModal(),"no"==o.toLowerCase()&&l.open({animation:!0,backdrop:"none",template:'<div ng-class="{\'modal-bottom-header modal-header\':isMobileView,\'modal-body\':!isMobileView}"><div class="btn-border-close"><span class="cursor-pointer pull-right" ng-style="{\'color\':isHover ? \'#000\' : \'#aaa\'}" ng-class="{\'md-dark-color\':isMobileView}"ng-init="isHover=false;" ng-mouseover="isHover=true;" ng-mouseout="isHover=false;" ng-click="closeModal()"><img src="/assets/icons/close.svg" alt="close" height="20"></span></div><div class="text-center primary-color"><img class="m-t-15 m-b-15" style="height:10%" src="/assets/consultSponsored/notAttendedSubmit.svg"  height="250"/><div class="bold m-t-10 m-b-10 text-center"><span style="font-size: large;">Thank You for your Response! </span></div><div class="mdTxt bold" ng-class="{\'m-t-10\':isMobileView,\'m-t-20\':!isMobileView}"></div></div></div>',scope:e,controller:["$scope","$uibModalInstance",function(e,t){e.closeModal=function(){function e(){sessionStorage.removeItem("featureInfo"),a.go("app.home"),t.dismiss("cancel")}e(),setTimeout(e,100)}}],size:n.isMobileView?"bottom":"border modal-sm",windowClass:n.isMobileView&&"bottom-sheet"},5e3),r.rxMandatoryFlowOffline()})},t.attendanceEvent=function(e,o){e.reason="other"!=o.toLowerCase()?o:t.otherReason,e.submissionType="NO",t.sendEvent("NO",e)},t.sendEvent=function(e,t){var o="";switch(e){case"MANDATORY_RX":o=f.OFC_UPLOADRX_UPLOAD_NOW;break;case"REUPLOAD_RX":o=f.OFC_REUPLOADRX_REUPLOAD_NOW;break;case"UPLOAD_RX_OPTIONAL":o=f.OFC_UPLOADRX_UPLOADLATER}if("PAYMENT_PENDING"==e)switch(t.feature){case"MANDATORY_RX":o=f.OFC_UPLOADRX_PAYNOW;break;case"REUPLOAD_RX":o=f.OFC_REUPLOADRX_PAYNOW;break;case"PAYMENT_PENDING":o=f.OFC_UPLOADRX_CLAIMEXPIRE_PAYNOW}"SKIP"==e&&(o=f.OFC_UPLOADRX_SKIP),"VALID_PRESCRIPTION"==e&&(o=f.OFC_UPLOADRX_VALID_RX_CLICKED),"YES"!=e&&"NO"!=e||(o=f.OFC_ATTENDANCE_SUBMISSION,t.submissionType=e),"WHY_TO_PAY_CLICK"==e&&(o=f.OFC_UPLOOADRX_WHYTOPAY),r.sendRxMandatoryFlowEvents(o,t)}}],size:n.isMobileView?"md":"",windowClass:n.isMobileView&&"attendance"}).closed.then(function(e){console.log("closed")}))})["catch"](function(e){console.log(JSON.stringify(e))})}}}]),a.factory("patternService",function(){var e={phonechk:/^\(?(\d{3})\)?[- ]?(\d{3})[- ]?(\d{4})$/,pincodechk:/^\d*$/,emailchk:/^(([^<>()[\]\\.,;:\s@\']+(\.[^<>()[\]\\.,;:\s@\']+)*)|(\'.+\'))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,integerchk:/^\d*$/,datechk:/^[\d-]*$/,citychk:/([(A-Za-z\s\')])/,alphanumericchk:/^[a-zA-Z0-9]*$/,passwordchk:/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?\d)(?=.*?[!#$'()*-,.\/<=>?@\[\]^`{|}~])[a-zA-Z\d!#$'()*-,.\/<=>?@\[\]^`{|}~]+$/,fullnamechk:/^[a-zA-Z\s\'\-,]*$/,namechk:/^[a-zA-Z\s\.\'\-]*$/,namechkEnhanced:/^[a-zA-Z\s\.\'\-\,]*$/,mobilechk:/^[6789]\d{9}$/,medicineNameReplacePattern:/[^a-zA-Z'\s.]/gi,medicineAddrReplacePattern:/[^a-zA-Z0-9\-,.:()\/]/gi,pancardchk:/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/gi,aadharchk:/^\d{12}$/,nospecial:/^[\w\-\s]+$/,dobchk_YYYY_MM_DD:/^\d{4}-\d{2}-\d{2}$/};return{getRegexExpression:function(t){return e[t]}}}),a.factory("popupService",["$document","$compile","$rootScope","$controller","$timeout","$sce","authService","$state","$window","apiProvider",function(t,o,a,i,n,r,s,l,u,d){var c={id:null,template:null,templateUrl:null,title:"Default Title",backdrop:!0,success:{label:"OK",fn:null},cancel:{label:"Close",fn:null},controller:null,backdropClass:"modal-backdrop",backdropCancel:!0,footerTemplate:null,modalClass:"silbar",appointmentDetails:"",packageDetailForBookingAppointment:"",css:{top:"100px",left:"30%",margin:"0 auto"}},p=t.find("body");return function(t,m,g){function h(e,t){var o={orderId:e,browser_fingerprint_id:t};s.makeAjaxCalls("https://www.medibuddy.in/websiteapp/CreateOrderIdBrowserIdMapping",o,"POST").then(function(e){})["catch"](function(e){console.log("error while createOrderIdBrowserFingerprintIdMapping"+e)})}e.isObject(t)?(g=m,m=t):m.templateUrl=t,m=e.extend({},c,m);var f,v=(m.id?' id="'+m.id+'" ':"",'<button class="btn" ng-click="$modalCancel()">{{$modalCancelLabel}}</button><button class="btn btn-primary" ng-click="$modalSuccess()">{{$modalSuccessLabel}}</button>'),y=('<div class="modal-footer">'+(m.footerTemplate||v)+"</div>",function(){return m.template?e.isString(m.template)?'<div class="">'+m.template+"</div>":'<div class="">'+m.template.html()+"</div>":'<div class="" ng-include="\''+m.templateUrl+"'\"></div>"}()),E=e.element('<div class="slideBox"><div class="slideContent">'+y+"</div></div>");for(f in m.css)E.css(f,m.css[f]);var b="<div ";m.backdropCancel&&(b+='ng-click="$modalCancel()"'),b+=">";var S=e.element(b);S.addClass(m.backdropClass),S.addClass("fade in");var P=function(e){27===e.keyCode&&A.$modalCancel()},I=function(){p.unbind("keydown",P),E.remove(),m.backdrop&&S.remove()};p.bind("keydown",P);var T,C,A=m.scope||a.$new();A.packageDetail=g.packageDetail,A.HHCandSOcheck=!0,A.packageDetail&&(A.packageDescription=r.trustAsHtml(A.packageDetail.description),A.packageInstructions=r.trustAsHtml(A.packageDetail.instruction),A.packageDetail.packageTests?(A.consultation=_.findWhere(A.packageDetail.packageTests.testGroups,{name:"Consultation"}),A.consultation?(A.totalCount=A.packageDetail.packageTests.count-A.consultation.count,A.consultation.count=A.consultation.count?A.consultation.count:0):(A.consultation={count:0},A.totalCount=A.packageDetail.packageTests.count),e.forEach(A.packageDetail.packageTests.testGroups,function(e,t){e.tests.name=e.name})):(A.totalCount=0,A.consultation={count:0})),A.packageDetailLocation=g.packageDetailLocation,g.packageDetailLocation&&(A.agerange={maxAge:g.packageDetailLocation.maxAge,minAge:g.packageDetailLocation.minAge},_.isEmpty(g.packageDetailLocation.availableSlots)||_.isEmpty(g.packageDetailLocation.availableSlots[0].slots)||(A.slotEndTime=s.getTimeWithAMPM(g.packageDetailLocation.availableSlots[0].slots[0].slotEndTime),A.slotStartTime=s.getTimeWithAMPM(g.packageDetailLocation.availableSlots[0].slots[0].slotStartTime))),A.paymentOptions=g.paymentOptions?g.paymentOptions:[],A.walletFailure=g.walletFailure?g.walletFailure:"",A.bookedAppointmentDetails=s.bookedAppointmentDetails,A.packageDetailForBookingAppointment=s.packageDetailForBookingAppointment,A.bookedAppointmentDetails&&(c.appointmentDetails=A.bookedAppointmentDetails,A.bookedAppointmentDetail=c.appointmentDetails),A.packageDetailForBookingAppointment&&(c.packageDetailForBookingAppointment=A.packageDetailForBookingAppointment,A.packageDetailForBookingAppointment1=c.packageDetailForBookingAppointment),A.isPackageDetailForBookingAppointment="app.consultation"===l.current.name,A.paymentOptions=g.paymentOptions?g.paymentOptions:[],A.bookedAppointmentDetails=s.bookedAppointmentDetails,A.bookedAppointmentDetails&&(A.bookedAppointmentDetails.gender=g.gender),A.packageDetailForBookingAppointment=s.packageDetailForBookingAppointment,A.logInUser={userName:"",password:""},A.pg={gatewayAmount:"",totalAmount:"",walletAmount:""},A.wallet={gatewayAmount:"",totalAmount:"",walletAmount:""},A.isPayBypg=!1,A.isDefault=!1,A.isPayment=!0,A.isEmpty=!1;A.isValidate=!0,A.isMailId=!1,A.isfb=!0,A.paymentDetails={isSummary:!0,isPayOnline:!1},A.paymentOption={value:""},A.finalPayment=0,A.bookedAppointmentDetails&&A.bookedAppointmentDetails.finalPrice&&(A.finalPayment=A.bookedAppointmentDetails.finalPrice),A.mediMarketPayment={amountAfterCouponDiscount:A.finalPayment,isCod:!1},A.isPayble=!0,A.user=s.isUserSignedin(),A.paymentObject=[],A.goNext=function(e){A.paymentDetails.isPayOnline="pay"===e,A.paymentDetails.isSummary="details"===e},A.tabChange=function(e){A.paymentDetails.isPayOnline="pay"===e,A.paymentDetails.isSummary="pay"!==e},A.fillDetails=function(e){a.$emit("fillDetails",e)},A.ok=function(e,t){A.$modalCancel(),e===!0&&(A.bookFromDetails(t),"fail"===e&&window.$location.reload())},A.isPaymentCalled=!1,A.flag=!1,A.paymentDoubleClick=function(){return A.flag=!0,!1},A.isPaymentProcessing=!1,A.isChecmsg=!1,"app.consultation"===l.current.name?(A.isConsultationPayment=!0,A.isPackagePayment=!1,A.isChecmsg="app.consultation"===l.current.name):(A.isConsultationPayment=!1,A.isPackagePayment=!0),A.validateCoupon=function(){if(""!==A.bookedAppointmentDetails.couponCode){var e={PackageId:g.packageDetail.id,ProviderID:"177828aaaaaaaaaaaaaaaaaaaaaaaaaa",DoctorUniqueId:"",CouponCode:A.bookedAppointmentDetails.couponCode,Gender:A.bookedAppointmentDetails.gender,ApplicableDate:A.bookedAppointmentDetails.prefDateTime||new Date},t=d.apiUrl+"/CheckCouponCodeApplicability.json";s.makeAjaxCalls(t,e,"POST",A.user.token).then(function(t){t.data.isSuccess?t.data.response.isApplicable?(A.isCouponCodeNotEmpty=!0,A.isInvalidCoupon=!1,A.showCouponMessage=!0,A.validatedCouponCode=e.CouponCode,
A.mediMarketPayment.couponDiscount=t.data.response.discount,A.finalPayment=A.bookedAppointmentDetails.finalPrice-A.mediMarketPayment.couponDiscount):(A.isCouponCodeNotEmpty=!1,A.bookedAppointmentDetails.couponCode="",A.showCouponMessage=!1,A.isInvalidCoupon=!0,A.errorValueForCoupon=t.data.response.message,A.finalPayment=A.bookedAppointmentDetails.finalPrice):t.data.isSuccess||(A.isCouponCodeNotEmpty=!1,A.showCouponMessage=!1,A.isCouponCodeNotEmpty=!1,A.isInvalidCoupon=!0,A.bookedAppointmentDetails.couponCode="",A.showCouponMessage=!1,A.errorValueForCoupon="Invalid Coupon Code",A.bookedAppointmentDetails.couponCode="",A.finalPayment=A.bookedAppointmentDetails.finalPrice)})}else A.isCouponCodeNotEmpty=!1,A.mediMarketPayment.couponDiscount=0,A.isInvalidCoupon=!1,A.showCouponMessage=!1,A.finalPayment=A.bookedAppointmentDetails.finalPrice},A.authorizeRazorPay=function(e){var t=d.paymentUrl+A.razorPayOptions.amount;t+="&paymentid="+e.razorpay_payment_id,u.location.href=t},A.dismissalRazorPay=function(){A.isPaymentProcessing=!1,A.isPaymentCalled=!1,n(function(){A.flag=!1},0,!0)},A.processPaymentOption=function(t){if(t&&A.user&&A.user.token){A.isPaymentProcessing=!0,A.isConsultationPayment=!1,A.isPackagePayment=!1;var o=d.apiUrl+"/PaymentMethod",i={paymentMethods:[]};e.forEach(t,function(e,t){i.paymentMethods.push(e.paymentMethod)}),A.isCouponCodeNotEmpty&&(i.couponCode=A.validatedCouponCode),s.makeAjaxCalls(o,i,"POST",A.user.token).then(function(e){if(s.refreshOrders=!0,e.data.isSuccess&&0!==e.data.orderId)if(h(e.data.orderId,window.sessionStorage.getItem("branch_fingerprint")||""),_.isEmpty(e.data.razorPayOptions))e.data.paymentGatewayURL?(a.$emit("cfpLoadingBar:loading"),u.location.href=e.data.paymentGatewayURL):(s.orderId=e.data.orderId,l.go("app.orderDetails",{reload:"app.orderDetails"}));else{A.razorPayOptions=e.data.razorPayOptions,A.razorPayOptions.name="MediBuddy",A.razorPayOptions.handler=A.authorizeRazorPay,A.razorPayOptions.prefill={name:A.bookedAppointmentDetails.patientName,email:A.bookedAppointmentDetails.email,contact:A.bookedAppointmentDetails.phone},A.razorPayOptions.modal={ondismiss:A.dismissalRazorPay},A.razorPayOptions.image="/assets/images/logo_medibuddy_infiniti-sm.png",A.razorPayOptions.description="Your order ID: "+e.data.orderId,A.razorPayOptions.theme.color="#2198ff";var t=new Razorpay(A.razorPayOptions);t.open()}else e.data.isSuccess||(u.location.href="/technicalGlitch")})}},A.ProcessPaymentOption=function(e){if(A.flag=!0,A.isPaymentCalled===!1&&A.flag){A.isPayment=!1,A.isPaymentCalled=!0;for(var t=0;t<A.paymentOptions.length;t++)"pg"===A.paymentOptions[t].paymentMethod.toLowerCase()&&A.paymentObject.push(A.paymentOptions[t]);A.processPaymentOption(A.paymentObject)}},a.$on("closePopup",function(e){A.ok(!1)}),A.$title=m.title,A.$modalClose=I,A.$modalCancel=function(){var e=m.cancel.fn||I;e.call(this),A.$modalClose()},A.$modalSuccess=function(){var e=m.success.fn||I;e.call(this),A.$modalClose()},A.$modalSuccessLabel=m.success.label,A.$modalCancelLabel=m.cancel.label,m.controller&&(C=e.extend({$scope:A},g),T=i(m.controller,C),E.contents().data("$ngControllerController",T)),o(E)(A),o(S)(A),p.append(E),m.backdrop&&p.append(S),n(function(){E.addClass("in")},200)}}]),a.run(["$templateCache",function(e){e.put("error-messages.html","<div ng-message='text'>Please enter only alphabetic characters.</div><div ng-message='required1'>Please enter a value in this field.</div><div ng-message='minlength'>Enter at least the minimum number of characters.</div><div ng-message='date'>Enter the date in MM/DD/YYYY format.</div><div ng-message='invalid-date'>Please enter a valid date.</div>")}]),a.factory("seoService",["$rootScope","$http","apiProvider",function(e,t,o){return{getSeoContent:function(a){var i={categoryItemTypeId:a.categoryItemTypeId,seriveCategory:a.condition,keyword:a.keyword,location:a.location,city:a.city,pincode:a.pincode};t.post(o.apiUrl+"getMediBuddySEO",i,{headers:{"Content-Type":"application/json"}}).then(function(t){t.data.isSuccess&&(e.seo.title=t.data.data.TITLE,e.seo.keywords=t.data.data.KEYWORDS,e.seo.metaDescription=t.data.data.DESCRIPTION,e.seo.canonicalName=o.siteUrl+t.data.data.CANONICALNAME,e.seo.content=t.data.data.CONTENT)})}}}]),a.factory("$exceptionHandler",["$injector","$window",function(e,t){return function(o,a){var i,n=(e.get("$http"),e.get("$location")),r=(e.get("$state"),e.get("$log"));r.error.apply(r,arguments),o.message+=' (caused by "'+a+'")',i={exception:o.message||"",stack:o.stack||"",cause:a||"",location:n.path(),client_timestamp:new Date,logging_level:40,user_agent:t.navigator.userAgent}}}])})}();