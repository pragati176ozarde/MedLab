!function(){"use strict";define(["angular","utility"],function(e,a){var s=e.module("marketplace.LabsService",[]);s.factory("labsService",["navConstantsSvc","apiProvider","$sce","authService","$rootScope","$http","$window",function(e,a,s,t,n,i,c){var r=function(e,i){var c={};e?e>0?c.packageIds=[e]:c.deeplinkText=e:_.isEmpty(i)||(c.packageIds=_.pluck(_.union(i.labs,i.packages),"packageId"));var r=t.isUserSignedin(),l=new Promise(function(e,l){var o={descriptionMap:{},labCentrePackages:[]};t.makeAjaxCalls(a.apiUrl+"Labs/FetchPackageDetails",c,"POST",r.token,t.getCity()).then(function(a){a.data.isSuccess&&!_.isEmpty(a.data.packages)?(_.each(a.data.packages,function(e){o.descriptionMap[c.deeplinkText?c.deeplinkText:e.packageId]=e,e.isHomeSampleAvailable||o.labCentrePackages.find(function(a){return a.packageId==e.packageId})||o.labCentrePackages.push(e);var a=_.find(i.labs,function(a){return e.packageId==a.packageId});a||(a=_.find(i.labs,function(a){return e.packageId==a.packageId})),a&&(e.selected=!0,_.extend(a,e));var t=_.find(i.packages,function(a){return e.packageId==a.packageId});t||(t=_.find(i.packages,function(a){return e.packageId==a.packageId})),t&&(e.selected=!0,_.extend(t,e)),e.tests=[];var r=[];if(_.isEmpty(e.availableProfiles)||(e.tests=e.tests.concat(_.pluck(e.availableProfiles,"availableTests")),r=r.concat(e.availableProfiles)),_.isEmpty(e.availableTests)||(e.tests=e.tests.concat(e.availableTests),r.push({profileName:"Others",availableTests:e.availableTests})),n.isMobileView)e.arrayFirstHalf=r;else{var l=Math.ceil(r.length/2);e.arrayFirstHalf=r.slice(0,l),e.arraySecondHalf=r.slice(l,r.length)}e.tests=_.flatten(e.tests),e.shortDescription&&(e.shortDescription=s.trustAsHtml(e.shortDescription)),e.discount=Math.ceil(100-100*e.price/e.priceRange),e.ageText=0==e.minAge&&99==e.maxAge?"All Age Groups":e.minAge+" yrs - "+e.maxAge+" yrs",e.gender&&(e.gender=e.gender.toLowerCase(),"both"==e.gender?(e.genderType="Unisex",e.genderIco="/assets/icons/labs/unisex-ico.svg"):"male"==e.gender||"m"==e.gender?(e.genderType="Male",e.genderIco="/assets/icons/labs/male-ico.svg"):"female"!=e.gender&&"f"!=e.gender||(e.genderType="Female",e.genderIco="/assets/icons/labs/female-ico.svg"))}),e(o)):l()})});return l},l=function(e,a){t.multipleFilesDownload(e)};return{getPackageDetail:r,fileDownload:l}}])})}();