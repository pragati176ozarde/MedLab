var MB_Analytics=function(){function e(){var e=!0,t=!0,a=!0,i=!0,s=!0,o=!0,r=!0,n=!!window.isProduction,l=["page","eventCategory","eventAction","eventLabel","title"],c=function(e,t,a,i){var s={methodName:e,requestBody:JSON.stringify(t),responseBody:a,exceptionMessage:i};fetch("https://www.medibuddy.in/WAPI/Log",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})};return{cleverTap:e,gtmAnalyticsPlatform:t,googleAnalytics:a,branch:i,dbLog:o,hotjar:r,facebookPixel:s,__trackUser:function(e){if(n){if(this.cleverTap)try{clevertap.onUserLogin.push(window._Site_Props.__getUserObj({clevertap:!0}))}catch(t){console.log(t)}this.branch&&e&&window._Site_Props.__getUserObj()&&window._Site_Props.__getUserObj().uuid&&branch.setIdentity(window._Site_Props.__getUserObj().uuid+"",function(e,t){console.log(e?e:t)})}else console.log(window._Site_Props.__getUserObj({clevertap:!0}))},__push:function(e){try{if(e){_.isObject(e.payload)||(e.payload={});var t=window.localStorage.getItem("UniqSessionId");if(!t){var a=(new Date).getTime(),i="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;t="xxxxxxxx-xxxx-Lxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random();return a>0?(t=(a+t)%16|0,a=Math.floor(a/16)):(t=(i+t)%16|0,i=Math.floor(i/16)),("x"===e?t:3&t|8).toString(16)}),window.localStorage.setItem("UniqSessionId",t)}e.payload.sessionId=t}}catch(s){console.log("error settion sessionId")}if(n){if(this.cleverTap&&e.isCleverTap||"true"==e.excludeCleverTap){var o={srcType:window.getSrcType(),utm_source:e.payload&&e.payload.utm_source||window.sessionStorage.getItem("utm_source")||"medibuddyInWeb",utm_medium:e.payload&&e.payload.utm_medium||window.sessionStorage.getItem("utm_medium")||"",utm_campaign:e.payload&&e.payload.utm_campaign||window.sessionStorage.getItem("utm_campaign")||"",userType:"retail",userId:""};window.loggedInEmail&&(o.email=window.loggedInEmail),window.IP&&(o.userIP=window.IP),window.sessionStorage.getItem("utm_medium")&&(o.utm_medium=window.sessionStorage.getItem("utm_medium"));var r=window._Site_Props.__getUserObj();_.isEmpty(r)||(o.userId=r.userDetails?r.userDetails.userId:"",o.mbuuid=r.userDetails?r.userDetails.uuid:"",o.pmEntityID=r.userDetails?r.userDetails.pmEntityID:"",o.userType=r.isRetailUser?"retail":"corporate",o.email=r.userDetails&&r.userDetails.email?r.userDetails.email:"",o.mobile=r.userDetails&&r.userDetails.phone?r.userDetails.phone:"","labs"!=e.dbLog||r.isRetailUser||(o.CompanyName=r.corpDetails&&r.corpDetails.employeeDetail?r.corpDetails.employeeDetail.companyName||"":""),r.isRetailUser||(o.CompanyName=r.corpDetails&&r.corpDetails.employeeDetail?r.corpDetails.employeeDetail.companyName||"":"","true"==window.sessionStorage.getItem("isOneClickFlow")&&(o.isOneClickFlow=window.sessionStorage.getItem("isOneClickFlow")))),window.localStorage.getItem("parent_app")&&(o.parentSourceUrl=window.localStorage.getItem("parent_app")),window.sessionStorage.getItem("LatLong")&&(o.LatLong=window.sessionStorage.getItem("LatLong"));var c=_.extend(o,_.omit(e.payload,l,"isViewOrEvent"));c&&!c.location&&(c.city=window._Site_Props.location),c&&"labs"==e.dbLog&&window._Site_Props.pincode&&(c.pincode=window._Site_Props.pincode),clevertap&&"function"==typeof clevertap.getCleverTapID&&(c["CT-ID"]=clevertap.getCleverTapID());try{e.dbLog&&c&&e.name&&this.dbLog&&this.__eventLogToDB(e.dbLog,e.name,c)}catch(u){console.log(e.name,c,"EventLog")}try{if(clevertap&&"true"!=e.excludeCleverTap&&clevertap.event.push(e.name,c),e.googleSheet&&c&&e.name){var p="string"==typeof e.googleSheet?e.googleSheet:c.serviceName;p&&this.__googleSheetPush(p,e.name,c)}if(("labs"==e.dbLog||e.hj)&&e.name&&this.hotjar){var d="";e.name.split(" ").length>1?d=e.name.toLowerCase().replace(/\ /g,"_"):(d=e.name.charAt(0).toLowerCase()+e.name.substring(1),d=d.replace(/([A-Z])/g,"_$1")),window.hj("event",d)}}catch(s){console.log(e.name,c)}}if(this.googleAnalytics&&(e.isGoogle&&e.payload&&ga("send",_.extend(_.pick(e.payload,l),{hitType:e.payload.isViewOrEvent})),e.gtag&&(gtag("event","purchase",e.payload),dataLayer.push({event:"paymentSuccess",conversionValue:e.payload.value,serviceType:e.payload.u2}),console.log("gtag -> ","purchase",e.payload))),this.facebookPixel&&e.fbq&&e.payload){var m={content_category:e.payload.serviceName,content_type:e.payload.packageName||e.payload.serviceType||e.payload.u2};(e.payload.amount||e.payload.value)&&(m.value=e.payload.amount||e.payload.value,m.currency="INR");try{e.fbqReference&&fbq("track",e.fbqReference,m)}catch(s){console.log(s)}}if(this.branch&&e.branchLog){var g=e.branchLog,h={source:window.location.search.split("utm_source=")[1]};window._Site_Props.__getUserObj().userDetails&&(h.mbUserId=window._Site_Props.__getUserObj().userDetails.userId);var y=[]||e.content_items;_.extend(h,g.custom_data),h.source||delete h.source;var f=g.alias||"";try{branch.logEvent(g.name||e.name,h,y,f,function(e){e&&console.log(e)})}catch(s){console.log(g.name||e.name,h)}}this.gtmAnalyticsPlatform&&e&&e.name&&e.schema&&e.payload&&window.dataLayer.push({event:e.name,schema:e.schema,payload:e.payload,ctx:"INFINITY_WEB"})}else e.name&&console.log(e.name,_.omit(e.payload,l,"isViewOrEvent")),e.branchLog&&console.log("branch -> ",e.branchLog.name||e.name,e.branchLog.custom_data)},__resetOnLogout:function(){if(n){if(this.cleverTap){try{clevertap.logout()}catch(e){}delete window.loggedInEmail}this.branch&&branch.logout&&branch.logout()}},__confirmPushNotification:function(){if(n&&this.cleverTap)try{clevertap.notifications.push({titleText:"Hey, we would like to stay in touch with you!",bodyText:"We promise to only send you relevant content and give you updates on your transactions",okButtonText:"Sure!",rejectButtonText:"Not Now",okButtonColor:"#458bc7",rejectButtonColor:"#458bc7",askAgainTimeInSeconds:86400,serviceWorkerPath:"/clevertap_sw.js",hidePoweredByCT:!0})}catch(e){}},__googleSheetPush:function(e,t,a){return void this.__leadsPush(t,a)},__leadsPush:function(e,t){var a=window._Site_Props.__getUserObj(),i={patientId:a.userDetails.userId+"",pmentityid:a.userDetails.pmEntityID+"",mbuserid:a.userDetails.userId+"",mbuuid:a.userDetails.mbuuid+"",phoneNumber:a.userDetails.phone?a.userDetails.phone+"":"",type:"AHC - "+e,source:"Labs",meta:JSON.stringify(t),platform:window.getSrcType(),channel:"Browser"};fetch("https://claratech.medibuddy.in/sales/addLeads/",{method:"post",headers:{"Content-Type":"text/plain"},body:JSON.stringify({records:[i]})})},__eventLogToDB:function(e,t,a){var i="";switch(e){case"labs":i="mblabs";break;case"hc":i="mbinfiniti";break;case"ucp":i="mbcorp";break;case"ahc":i="mbAHC";break;case"meds":i="mbMeds";break;case"mc":i="mediclinic";break;case"consumerlabs":i="mbConsumerLabs";break;default:i="medibuddy"}if(i&&a){var s={user:a.userId,mbuserid:a.userId?a.userId:"",patientid:a.patientid?a.patientid:"",pmentityid:a.pmEntityID?a.pmEntityID:"",mbuuid:a.mbuuid?a.mbuuid:"",platform:window.getSrcType(),info:a.loginScreenEvent?a.loginScreenEvent:t,domain:i,event:t,appversion:a.srcType,serviceName:a.serviceName,meta:JSON.stringify(a),sessionId:a.sessionId,EventData:a};a.consultationId&&"mblabs"==i&&(s.consultationId=a.consultationId),fetch("https://eventlogs.docsapp.in/event",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(function(e){e.ok||"MB Home Page"!=t&&"Page View"!=t&&c("EventLogFailure",s,t,"")})["catch"](function(e){"MB Home Page"!=t&&"Page View"!=t&&c("EventLogFailure",_.extend(s,{isException:!0}),t,"Exception")})}}}}var t;return{getInstance:function(){return t||(t=e()),t}}}(),Site_Properties=function(){function e(){return{eventParameters:{},userObj:{},serviceDetails:{},packageDetails:{},filterDetails:{},purchaseDetail:{},labsCartInfo:{},location:"",pincode:"",sortBy:"",__getEventParameters:function(e){this.eventParameters={};var t="";if(e.service)for(t in this.serviceDetails)this.eventParameters[t]=this.serviceDetails[t];if(e["package"])for(t in this.packageDetails)this.eventParameters[t]=this.packageDetails[t];if(e.filter)for(t in this.filterDetails)this.eventParameters[t]=this.filterDetails[t];if(e.sortBy&&(this.eventParameters.sortBy=this.sortBy),e.custom)for(t in e.custom)this.eventParameters[t]=e.custom[t];if(e.google)for(t in e.google)this.eventParameters[t]=e.google[t];if(e.purchase)for(t in this.purchaseDetail)this.eventParameters[t]=this.purchaseDetail[t];if(e.labsCart)for(t in this.labsCartInfo)this.eventParameters[t]=this.labsCartInfo[t];return this.eventParameters.location=this.location,this.eventParameters},__setUserObj:function(e){this.userObj=e},__getUserObj:function(e){if(!this.userObj)return{};if(e&&e.clevertap){var t={Site:{Name:this.userObj.userDetails.displayName,Identity:this.userObj.userDetails.userId,Email:this.userObj.userDetails.email,EntityId:this.userObj.pmEntityID,Phone:this.userObj.userDetails.phone?"+91"+this.userObj.userDetails.phone:"",Gender:this.userObj.userDetails.gender,LocationSelected:this.location,Dependants:[],EmailId:this.userObj.userDetails.email,ReferralCode:this.userObj.userDetails.referDetails&&this.userObj.userDetails.referDetails.referCode?this.userObj.userDetails.referDetails.referCode:"",DOB:new Date(parseInt(this.userObj.userDetails.dateOfBirth.replace("/Date(",""))),DateOfBirth:this.userObj.userDetails.dateOfBirth}};return this.userObj.corpDetails&&this.userObj.corpDetails.employeeDetail&&(_.forEach(this.userObj.corpDetails.employeeDetail.iwpBeneficiaries,function(e){1!==e.relationId&&t.Site.Dependants.push({name:e.name,relation:e.relationName,gender:e.gender})}),this.userObj.corpDetails.employeeDetail.companyName&&(t.Site.CompanyName=this.userObj.corpDetails.employeeDetail.companyName)),this.userObj.userDetails.altEmail&&(t.Site.AlternateEmailId=this.userObj.userDetails.altEmail),t}return this.userObj},__setPackageDetails:function(e){this.packageDetails=e},__getPackageDetails:function(){return this.packageDetails},__setServiceDetails:function(e){this.serviceDetails=e},__getServiceDetails:function(){return this.serviceDetails},__setPurchaseDetails:function(e,t,a){this.purchaseDetail={allow_custom_scripts:!0,value:t,transaction_id:e,u2:a,send_to:"DC-9375497/sales/medi_0+transactions",currency:"INR",u3:window._Site_Props.__getUserObj().corpDetails?1:0}},__setFilterDetails:function(e){this.filterDetails=e},__getFilterDetails:function(){return this.filterDetails},__setLocation:function(e,t){this.location=e,t&&(this.pincode=t)},__setSortBy:function(e){this.sortBy=e},__googleTransform:function(e,t,a){return{isViewOrEvent:a?"event":"pageview",page:window.location.pathname,eventCategory:a&&e?e.toLowerCase():"",eventAction:t||"",eventLabel:a||"",title:a?e+" "+t:e}},__setLabsCartInfo:function(e){var t=[];e.labs.length&&t.push("labTest"),e.packages.length&&t.push("hcPackage"),this.labsCartInfo={serviceType:_.union(_.pluck(e.labs,"packageName"),_.pluck(e.packages,"packageName")).toString(),labTestCount:e.labs.length,healthCheckCount:e.packages.length,productType:t.toString(),serviceName:"labTest"}},__getLabsCartInfo:function(){return this.labsCartInfo}}}var t;return{getInstance:function(){return t||(t=e()),t}}}();window._MB_Analytics=new MB_Analytics.getInstance,window._Site_Props=new Site_Properties.getInstance;